{"version":3,"mappings":"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","names":["ThemeContext","createContext","ThemeProvider","children","theme","setTheme","useState","savedTheme","localStorage","getItem","window","matchMedia","matches","isDark","useEffect","root","document","documentElement","classList","remove","add","setItem","Provider","value","toggleTheme","prev","useTheme","context","useContext","Error","readEnv","name","fallbackNames","viteEnv","_a","env","e","nodeEnv","process","candidates","key","EnvSchema","z.object","VITE_SPOTIFY_CLIENT_ID","z.string","optional","VITE_SPOTIFY_CLIENT_SECRET","VITE_YOUTUBE_CLIENT_ID","VITE_YOUTUBE_CLIENT_SECRET","VITE_YOUTUBE_REDIRECT_URI","VITE_SENTRY_DSN","VITE_APP_URL","envToValidate","parsedEnv","safeParse","success","issues","error","map","i","message","join","PROD","console","warn","spotifyConfig","clientId","clientSecret","redirectUri","envRedirect","log","callbackUrl","scope","YOUTUBE_FALLBACK_CONFIG","youtubeConfig","envUrl","hasWindow","windowOrigin","location","origin","fallback","length","getAppUrl","getYouTubeCallbackUrl","_b","VITE_GOOGLE_CLIENT_ID","_c","_d","VITE_GOOGLE_CLIENT_SECRET","_e","_f","resolved_clientId","substring","resolved_clientSecret","resolved_redirectUri","app","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","auth","getAuth","db","getFirestore","storage","getStorage","__FIREBASE_DEFAULTS__","analytics","googleProvider","GoogleAuthProvider","reconnectFirestore","async","conversionConverter","toFirestore","doc","fromFirestore","snapshot","id","data","call","waitForFirestore","saveUserInsights","userId","insights","getUserInsights","signInWithPopup","user","AuthContext","AuthProvider","setUser","userProfile","setUserProfile","loading","setLoading","setError","hasSpotifyAuth","setHasSpotifyAuth","hasYouTubeAuth","setHasYouTubeAuth","isConnectingSpotify","setIsConnectingSpotify","isConnectingYouTube","setIsConnectingYouTube","spotifyError","setSpotifyError","youtubeError","setYoutubeError","spotifyUserProfile","setSpotifyUserProfile","youtubeUserProfile","setYoutubeUserProfile","fetchUserProfile","uid","userDoc","getDoc","exists","email","displayName","photoURL","isProvider","phoneNumber","rating","completedTasks","createdAt","toDate","Date","updatedAt","err","createUserProfile","profile","setDoc","signInWithGoogle","result","fetchSpotifyProfile","getDetailedSpotifyProfile","getSpotifyUserProfile","__vitePreload","Promise","profileData","hasImage","imageUrl","savedTracks","totalPlaylists","product","images","url","externalUrls","country","followers","publicPlaylists","privatePlaylists","collaborativePlaylists","followingArtists","savedAlbums","topGenres","accountType","explicitContentFilter","audioQuality","offlineDownloads","deviceLimit","lastActive","listeningTime","monthlyListeners","nextBilling","crossfade","equalizer","detailedError","basicProfileData","fetchYouTubeProfile","TokenManager","resolve","then","tokenManager","default","tokens","getTokens","accessToken","response","fetch","headers","Authorization","ok","status","refreshedTokens","refreshTokensPublic","refreshToken","retryResponse","json","picture","locale","onAuthStateChanged","firebaseUser","isSpotifyAuthenticated","spotifyAuth","profileError","youtubeTokens","hasYouTubeTokens","checkPlatformAuthStatus","handleSpotifyAuthChange","event","customEvent","detail","authenticated","handleYouTubeAuthChange","addEventListener","removeEventListener","isAuthenticated","signInWithEmail","password","signInWithEmailAndPassword","signUpWithEmail","createUserWithEmailAndPassword","updateProfile","signOut","firebaseSignOut","updateUserProfile","updates","updatedProfile","merge","clearError","disconnectFromSpotify","disconnectFromYouTube","checkYouTubeAuth","signIn","jsx","useAuth","storeTokens","service","currentUser","this","storeTokensLocally","storeTokensInFirestore","LOCAL_STORAGE_PREFIX","tokenData","storedAt","now","JSON","stringify","hasAccessToken","hasRefreshToken","expiresAt","attempt","FIRESTORE_RETRY_ATTEMPTS","tokenDoc","toISOString","setTimeout","FIRESTORE_RETRY_DELAY","getTokensFromFirestore","getTokensFromLocalStorage","getTokenStatus","needsRefresh","refreshTokens","docSnapshot","stored","hasStoredData","storedDataLength","parse","Math","floor","expiresIn","isValid","REFRESH_BUFFER","startTokenMonitoring","existingTimer","refreshTimers","get","clearTimeout","timeUntilRefresh","max","round","timer","notifyListeners","set","lastError","hasClientSecret","method","body","URLSearchParams","grant_type","refresh_token","client_id","client_secret","toString","newTokens","access_token","expires_in","errorMessage","catch","deleteTokens","pow","testTokenStorage","testTokens","retrieved","debugTokenStorage","spotifyKey","youtubeKey","spotifyLocal","youtubeLocal","hasSpotifyData","spotifyDataLength","hasYoutubeData","youtubeDataLength","spotifyFirestore","youtubeFirestore","hasSpotifyTokens","hasYoutubeTokens","spotifyHasRefreshToken","youtubeHasRefreshToken","clearAllCorruptedTokens","addTokenListener","callback","listeners","has","Set","delete","forEach","removeItem","deleteDoc","clearTokens","getCurrentTokenStatus","hasValidTokens","initializeMonitoring","services","__publicField","Map","TokenManagerDebug","testStorage","debugStorage","clearCorruptedTokens","ENDPOINTS","CACHE","PLAYLISTS","TRACKS","ARTISTS","PLAYLISTS_TTL","TRACKS_PREFIX","TRACKS_TTL_PREFIX","ARTISTS_PREFIX","ARTISTS_TTL_PREFIX","CODE_VERIFIER","TOKEN","TOKEN_EXPIRES","CryptoHelper","generateRandomString","possible","values","crypto","getRandomValues","Uint8Array","Array","from","x","sha256","plain","TextEncoder","encode","subtle","digest","base64UrlEncode","buffer","btoa","String","fromCharCode","replace","generateCodeVerifier","generateCodeChallenge","verifier","hashed","CacheManager","getTtl","ttl","Number","setTtl","duration","getCached","dataKey","ttlKey","setWithTtl","invalidate","_SpotifyApiClient","acquireSlot","inFlight","MAX_CONCURRENT","r","releaseSlot","backoffDelay","min","request","options","retryCount","getSpotifyTokenSync","getSpotifyToken","Headers","Object","assign","keys","some","toLowerCase","controller","AbortController","timeout","abort","REQUEST_TIMEOUT_MS","signal","statusText","MAX_RETRIES","currentTokens","refreshError","delay","errorText","text","DOMException","parseErrorResponse","errorData","getPaginated","initialUrl","allItems","nextUrl","items","next","getArtistDetails","artistId","forceRefresh","artistCache","cacheKey","cacheTtlKey","cachedData","processedData","sort","a","b","width","SpotifyApiClient","_SpotifyService","getSearchCacheKey","query","limit","trim","getProfile","getPlaylists","cached","getPlaylistTracks","playlistId","cleanPlaylistId","split","tracksEndpoint","allTracks","extractTrackData","spotifyTracks","results","batchPromises","slice","item","track","basicTrack","artists","artist","artistIds","artistImages","genres","album","duration_ms","popularity","explicit","releaseYear","release_date","searchQuery","artistPromises","timeoutPromise","_","reject","artistsData","race","all","push","artistError","batchResults","filter","Boolean","getPlaylistById","description","trackCount","tracks","total","owner","display_name","external_urls","spotify","createPlaylist","isPublic","public","searchTracks","searchCache","elapsed","lastSearchAt","MIN_SEARCH_INTERVAL_MS","params","q","type","market","msg","includes","size","SEARCH_CACHE_MAX","iterator","done","addTracksToPlaylist","trackUris","batchSize","totalBatches","ceil","batchNumber","batch","uris","clearCache","startsWith","findUserPlaylistByName","match","find","p","getSpotifyPlaylistTracks","createSpotifyPlaylist","addTracksToSpotifyPlaylist","getSpotifyPlaylistById","searchSpotifyTracks","bind","YOUTUBE_API_BASE_URL","extractYouTubeErrorDetails","errors","reason","parseError","getYouTubePlaylists","getYouTubeToken","refreshYouTubeToken","youtubeAuth","part","mine","maxResults","newToken","TypeError","fetchAllYouTubePlaylistItems","nextPageToken","append","searchYouTube","_userId","generateMockSearchResults","ensureYouTubeToken","ensureYouTubeRefresh","videoEmbeddable","videoSyndicated","abortController","timeoutId","fetchError","hashString","str","hash","charCodeAt","abs","padStart","parts","title","itemCount","random","suffix","videoId","kind","etag","snippet","publishedAt","channelId","thumbnails","encodeURIComponent","height","medium","high","channelTitle","liveBroadcastContent","regionCode","pageInfo","totalResults","resultsPerPage","_isMock","createYouTubePlaylist","privacyStatus","addToYouTubePlaylist","resourceId","YOUTUBE_TOKEN_ENDPOINT","FALLBACK_CONFIG","YOUTUBE_CLIENT_ID","YOUTUBE_CLIENT_SECRET","YOUTUBE_REDIRECT_URI","usingFallback","YOUTUBE_SCOPES","STORAGE_KEYS","getYouTubeAuthUrl","state","randomBytes","byte","generateStateParam","redirect_uri","authUrl","response_type","include_granted_scopes","access_type","prompt","exchangeCodeForToken","code","requestData","responseText","error_description","has_access_token","has_refresh_token","handleYouTubeCallback","urlParams","search","authCode","hasCode","hasState","savedState","receivedState","userRef","youtubeConnected","lastUpdated","firestoreError","localError","dispatchEvent","CustomEvent","isYouTubeAuthenticated","clearYouTubeAuth","pathname","href","codeVerifier","bytes","SPOTIFY_CONFIG","CLIENT_ID","CLIENT_SECRET","REDIRECT_URI","AUTH_ENDPOINT","TOKEN_ENDPOINT","SCOPES","FAMILY_FRIENDLY_SCOPES","VITE_SPOTIFY_REDIRECT_URI","AUTH_STATE","RETURN_PATH","ACCESS_TOKEN","REFRESH_TOKEN","EXPIRES_AT","ensureUserAuthenticated","initSpotifyAuth","authError","getSpotifyAuthUrl","handleSpotifyCallback","storedAuthState","getStoredAuthState","usedRedirectUri","has_code","has_code_verifier","has_client_secret","tokenParams","code_verifier","requestParams","exchangeCodeForTokens","getUserId","userTokenRef","spotifyConnected","sessionStorage","localState","sessionState","storedTokens","refreshAccessToken","logoutFromSpotify","scopes","codeChallenge","authState","returnPath","URL","code_challenge_method","code_challenge","entries","searchParams","hasPlaylistAccess","canCreatePlaylists","recommendations","profileResponse","createTestResponse","testPlaylist","cleanupError","token","playlistsResponse","followingResponse","topArtistsResponse","savedTracksResponse","savedAlbumsResponse","allSettled","playlistsData","private","collaborative","playlists","playlist","followingCount","topArtists","genreCount","genre","charAt","toUpperCase","savedTracksCount","savedAlbumsCount","detailedProfile","explicit_content","filter_enabled","contentType","isJson","errorInfo","hasImages","useReadOnlyFallback","generateSearchQueries","stripFeaturingSafe","song","cleanSong","cleanArtist","s","showToast","_NetworkResilienceService","constructor","getInstance","instance","handleFirebaseError","retryable","withRetry","operation","maxRetries","networkError","retryDelays","isOnline","navigator","onLine","setupNetworkMonitoring","suppressExpectedErrors","originalConsoleError","originalConsoleWarn","args","apply","preventDefault","initialize","networkResilience","_ProfileService","getUserStats","realStats","calculateRealStats","conversions","userData","stats","monthlyUsage","monthlyLimit","platformUsage","youtube","soundcloud","successRate","updateUserStats","updateDoc","getUserProfile","firestoreData","bio","isPremium","metadata","creationTime","updateData","uploadProfileImage","file","maxSize","timestamp","fileExtension","pop","fileName","randomUUID","storageRef","ref","cacheControl","uploadTask","uploadBytesResumable","on","serverResponse","downloadURL","getDownloadURL","getProfileSettings","settings","notifications","conversionComplete","weeklyReport","privacy","shareStats","publicProfile","showEmail","showLocation","showStats","updateProfileSettings","exportUserData","conversionHistory","getConversionHistory","exportDate","exportFormat","version","deleteUserAccount","listAll","deleteObject","import","n","z","profileImagesRef","imageList","storageError","conversionsRef","collection","conversionsSnapshot","getDocs","docs","limitCount","where","orderBy","querySnapshot","getPlatformUsage","hasPremiumFeatures","upgradeToPremium","getMonthlyUsage","month","year","used","resetMonthlyUsage","addConversion","tracksConverted","platformDirection","newTotalTracks","newSuccessRate","getSuccessRate","y","indexError","totalConversions","totalTracks","spotifyConversions","youtubeConversions","currentMonthUsage","currentMonth","getMonth","currentYear","getFullYear","tracksMatched","spotifyPlaylistId","youtubePlaylistId","convertedAt","tracksCount","spotifyPlaylistName","calculatedStats","profileService","ConversionStatus","firebaseDb","initialState","IDLE","isLoading","spotifyPlaylists","youtubePlaylists","selectedPlaylistId","currentStep","totalSteps","youtubePlaylistUrl","spotifyPlaylistUrl","matchingProgress","conversionReducer","action","payload","ERROR","ConversionContext","fetchSpotifyPlaylists","fetchYouTubePlaylists","selectPlaylist","selectYouTubePlaylist","startConversion","convertFromPublicUrl","reconnectWithFamilyMode","resetConversion","fetchConversionHistory","dispatch","useConversion","CONVERSION_HISTORY_KEY","saveConversionHistoryToLocalStorage","history","isFirestorePermissionError","logFirestoreError","userAuth","firestoreConnected","ConversionProvider","useReducer","useCallback","isSpotifyAuthed","accountInfo","isAuthed","spotifyTokens","hasTokensFromTokenManager","tokenExpiresAt","detectAccountType","getSpotifyPlaylists","SELECTING_PLAYLIST","familyErrorMessage","rec","LOADING_PLAYLISTS","cleanedPlaylists","thumbnailUrl","playlistName","_g","tracksData","videoIds","contentDetails","videoDetails","BATCH_SIZE","batchIds","videoResponse","videoData","videoDetailsMap","video","videoDetail","videoTitle","videoOwnerChannelTitle","separators","separator","parseInt","calculateTrackSimilarity","originalTrack","spotifyTrack","score","normalize","originalTitle","originalArtist","spotifyTitle","spotifyArtist","titleWords","spotifyTitleWords","commonWords","word","artistWords","spotifyArtistWords","durationDiff","maxDiff","calculateYouTubeSimilarity","youtubeVideo","youtubeTitle","youtubeChannel","youtubeTitleWords","channelWords","youtubeDuration","MATCHING_TRACKS","CREATING_PLAYLIST","LOADING_TRACKS","sourcePlatform","destinationPlatform","detectedSource","detectedDestination","storedSource","storedDestination","cachedTracks","tracksPromise","itemsCount","stateTracksLength","batchCount","batchIndex","batchStart","batchEnd","searchQueries","bestMatch","bestScore","videoSearchResults","trackId","matchDetails","titleMatch","artistMatch","lengthScore","progress","selectedPlaylist","youtubePlaylistName","youtubePlaylistDescription","createPlaylistPromise","findOrCreatePlaylist","newPlaylist","createYouTubePlaylistUrl","successCount","failureCount","totalVideos","failedTracks","processedVideos","matchEntries","t","attempts","failedTrack","bestMatchScore","bestMatchTitle","bestMatchArtist","SUCCESS","missingTracks","feedbackMessage","conversionResult","tracksFailed","conversionId","withConverter","docRef","maxAttempts","Timestamp","fromDate","isArray","saveError","playlistError","res","baseName","convertedSuffix","endsWith","spotifyPlaylistDescription","newSpotifyPlaylist","searchResults","toFixed","searchError","trackUri","uri","addError","userErrorMessage","localHistory","storedHistory","getConversionHistoryFromLocalStorage","count","c","failedTracksLength","queryPromise","empty","isFirestoreChannelTerminationError","reconnectError","handleFirestoreRecovery","_firestoreUsingOfflineMode","playlistUrl","spotifyMatch","youtubeMatch","initProgressiveSpotifyAuth","contextValue","UserContext","UserProvider","jsxRuntimeExports","useUser","cn","inputs","twMerge","clsx","isMobileDevice","test","userAgent","detectConnectionQuality","conn","connection","saveData","effectiveType","randomItem","throttle","func","inThrottle","ParticleField","React","memo","color","className","includeNotes","includeIcons","includePlatforms","includeCircles","animated","colorScheme","density","speedFactor","interactive","containerRef","useRef","particles","setParticles","particlePositions","setParticlePositions","isMouseMoving","setIsMouseMoving","dimensions","setDimensions","mousePositionRef","isMouseMovingRef","animationFrameRef","mouseStopTimerRef","getParticleCount","baseCount","getParticleColor","colors","note","icon","platform","circle","generateParticle","types","content","startX","startY","opacity","rotation","path","newParticles","initialPositions","particle","handleResize","innerWidth","innerHeight","getAnimationForPath","intensity","rotate","scale","handleMouseMove","current","rect","getBoundingClientRect","mouseX","clientX","left","mouseY","clientY","top","cancelAnimationFrame","requestAnimationFrame","newPositions","hasChanges","dist","x1","y1","x2","y2","sqrt","repulsionStrength","angle","atan2","newX","cos","newY","sin","padding","boundedX","boundedY","handleMouseStop","resetMouseStopTimer","renderedParticles","useMemo","position","motion","div","style","fontSize","transform","willChange","zIndex","animate","transition","stiffness","damping","backgroundColor","repeat","Infinity","ease","whileHover","jsxs","AnimatePresence","MorphingBlob","animationDuration","positionStyle","background","borderRadius","animation","FloatingElements","elements","setItems","generateItem","elementIndex","element","dispersed","respawnKey","defaultIcons","disperse","floatingAnimation","repeatType","animationDelay","userSelect","initial","exit","onClick","onMouseEnter","TypingEffect","speed","cursor","loop","onComplete","displayText","setDisplayText","currentIndex","setCurrentIndex","isTyping","setIsTyping","currentTextIndex","setCurrentTextIndex","currentText","timeoutRef","nextTextIndex","variants","primary","secondary","soundswapp","outline","glass","minimal","sizes","sm","md","lg","GlowButton","forwardRef","disabled","variant","fullWidth","leftIcon","rightIcon","props","xmlns","fill","viewBox","cx","cy","stroke","strokeWidth","d","containerVariants","hidden","visible","staggerChildren","delayChildren","itemVariants","EnhancedHeroSection","heroRef","scrollContainerRef","platformIcons","faSpotify","faCompactDisc","faMicrophone","faHeadphones","faMusic","particleColor","morphingBlobColor1","morphingBlobColor2","floatingElementColors","offset","stopColor","stdDeviation","dy","in","patternUnits","strokeLinecap","strokeLinejoin","pathLength","button","whileTap","bottom","right","index","transformStyle","backfaceVisibility","src","alt","objectFit","display","FontAwesomeIcon","h1","WebkitBackgroundClip","backgroundClip","fontWeight","textShadow","rx","span","h2","getElementById","scrollIntoView","behavior","GlassmorphicCard","blurStrength","hoverScale","gradientOverlay","rounded","magneticEffect","glowIntensity","isMobile","setIsMobile","mousePosition","setMousePosition","isHovered","setIsHovered","checkMobile","mobile","getShadowByGlowIntensity","getGlowColorForVariant","low","cardStyles","boxShadow","margin","border","overflow","backdropFilter","WebkitBackdropFilter","roundedClass","onMouseMove","currentTarget","onHoverStart","onHoverEnd","getGradientByVariant","mixBlendMode","backgroundSize","backgroundPosition","SuccessCelebration","isActive","useWindowSize","showConfetti","setShowConfetti","showMessage","setShowMessage","messageTimer","hideTimer","Fragment","Confetti","recycle","numberOfPieces","gravity","tweenDuration","toastSettings","CheckCircle","lightStyles","bg","iconColor","darkStyles","XCircle","warning","AlertTriangle","info","Info","ToastItem","toast","onDismiss","actionLabel","onAction","styles","paused","setPaused","setProgress","progressRef","intervalRef","startTimeRef","remainingRef","touchStartX","setTouchStartX","touchDeltaX","setTouchDeltaX","clearInterval","setInterval","percent","layout","role","tabIndex","onMouseLeave","onFocus","onBlur","onTouchStart","touches","onTouchMove","onTouchEnd","ToastContainer","toasts","maxWidth","mode","GlassmorphicContainer","shadow","blur","hoverEffect","sharedProps","none","xl","full","light","heavy","ChartJS","register","CategoryScale","LinearScale","BarElement","Title","Tooltip","Legend","ArcElement","PointElement","LineElement","scaleOnHover","calculateAdvancedMetrics","totalDuration","avgTracksPerArtist","uniqueArtists","diversityScore","vintageScore","releaseYears","reduce","sum","StatCard","Icon","subtitle","trend","gradient","colorClasses","purple","blue","green","red","yellow","indigo","TrendingUp","SoundSwappLogo","chartOptions","responsive","maintainAspectRatio","easing","plugins","legend","labels","usePointStyle","font","tooltip","titleFont","weight","bodyFont","cornerRadius","callbacks","label","raw","percentage","dataset","datalabels","formatter","scales","beginAtZero","grid","ticks","prepareDurationData","datasets","durationCategories","short","long","borderColor","borderWidth","preparePopularityData","popularityRanges","prepareYearData","years","counts","tension","pointBackgroundColor","pointBorderColor","pointHoverRadius","pointHoverBackgroundColor","pointHoverBorderColor","isYouTubePlaylist","every","isSpotifyPlaylist","formatMinutes","minutes","formatNumber","num","formatPercent","PlaylistInsights","activeView","setActiveView","selectedMetric","setSelectedMetric","showTooltip","setShowTooltip","advancedMetrics","isYoutube","target","rel","minHeight","maxHeight","minWidth","BarChart3","PieChart","Users","Heart","Music","Clock","Flame","avgPopularity","Award","Doughnut","Pie","Line","totalGenreMentions","image","onLoad","previousElementSibling","onError","parentElement","createElement","innerHTML","appendChild","Eye","Headphones","Star","Sparkles","Activity","preference","Calendar","recent","modern","classic","vintage","era","diversityLevel","Zap","MobilePlaylistInsights","navigate","useNavigate","MobileStatCard","ArrowLeft","range","platformConfigs","hover","tabActiveBg","tabText","buttonVariant","features","permissions","basic","advanced","personal","capabilities","community","monetization","tabIcons","overview","usage","ConfirmationDialog","isOpen","onClose","onConfirm","config","handleKeyDown","stopPropagation","LoadingSkeleton","ErrorState","onRetry","SettingsModal","onSettingChange","autoSync","realTimeSync","analyticsCollection","crossPlatformSync","setting","checked","onChange","backgroundSync","syncFavorites","shareListeningData","thirdPartySharing","offlineSync","PlatformCardBack","onBack","accountDetails","onDisconnect","isFlipped","IconComponent","activeTab","setActiveTab","showConfirmDialog","setShowConfirmDialog","showSettingsModal","setShowSettingsModal","setSettings","savedSettings","parsedSettings","handleSettingChange","newSettings","settingName","toggleElement","querySelector","tabs","indexOf","newIndex","renderTabContent","platformName","profilePicture","username","plan","since","fillRule","clipRule","toLocaleString","followedPlaylists","favoriteArtists","familyPlanMembers","paymentMethod","autoRenew","studentVerification","dataSaver","privateSession","lastSync","socialFeatures","recentlyPlayed","subscriberCount","totalViews","averageViews","channelType","verificationStatus","monetizationStatus","contentRating","language","joinDate","lastUploadDate","collaborationStatus","liveStreamingEnabled","communityTabEnabled","membershipsEnabled","superChatEnabled","channelMembershipLevel","topCategories","feature","permission","playbackHours","lastSynced","originalText","settingsData","blob","Blob","createObjectURL","download","click","removeChild","revokeObjectURL","defaultSettings","jsxToReturn","WebkitBackfaceVisibility","MozBackfaceVisibility","visibility","tabId","tabIconElement","onDoubleClick","EnhancedConnectionCard","onConnect","isConnecting","connectionError","userEmail","userMeta","connected","externalConnected","userName","userPhoto","setIsFlipped","setAuthError","cardRef","disconnectButtonRef","contains","handleCardFlip","focus","platformConfig","isSpotify","basePlatformStyle","textColor","userMetaDisplay","FaSpotify","iconContainerBg","indicator","accountTypeColor","glowHslVar","glowRgbVar","disconnectBg","cardGradient","cssVariables","FaYoutube","cardBaseStyles","baseDetails","lastSignInTime","toLocaleDateString","hasUserMeta","statistics","videoCount","playlistCount","viewCount","spotifyDetails","explicitContent","subscription","accountCountry","perspective","backgroundImage","backgroundOrigin","borderStyle","onKeyDown","FloatingLabels","helpText","containerClassName","labelClassName","inputClassName","required","isFocused","setIsFocused","hasValue","setHasValue","inputRef","uniqueId","variantStyle","container","input","labelActive","labelInactive","outlined","htmlFor","AnimatedGradientText","useMousePosition","handleTouchMove","passive","nodeRef","LightingText","baseColor","highlightColor","setPosition","isHovering","setIsHovering","WebkitMaskImage","maskImage","SpotlightCard","glowColor","strength","setOpacity","generateAlternativeQueries","queries","cleanTitle","mainArtist","mainTitle","EnhancedFailedTracksModal","onAddToYouTube","onAddToSpotify","copiedQuery","setCopiedQuery","manualInputs","setManualInputs","updateManualInput","trackIndex","processedValue","X","queryIndex","Search","clipboard","writeText","handleCopyQuery","Check","Copy","defaultValue","placeholder","open","handleAddToYouTube","handleAddToSpotify","ExternalLink","KeyboardFocusableCard","defaultPrevented","ConnectButton","isConnected","bgColor","bgColorConnected","convertTrack","generateGenreColor","generatePlaylistInsights","artistCounts","genreCounts","yearCounts","albumCounts","explicitCount","nonExplicitCount","validPopularityCount","totalPopularity","longestTrackDuration","shortestTrackDuration","longestTrack","shortestTrack","mostPopularTrack","leastPopularTrack","highestPopularity","lowestPopularity","oldestYear","newestYear","oldestTrack","newestTrack","durationMinutes","genrePercentages","yearlyTrends","acc","localeCompare","decadeDistribution","decade","genreArray","artistArray","albumArray","isNaN","topAlbums","avgTrackLength","explicitPercentage","uniqueAlbums","ModernPlaylistConverter","conversion","conversionState","spotifyUrl","setSpotifyUrl","youtubeUrl","setYoutubeUrl","showCelebration","setShowCelebration","setToasts","isProcessing","setIsProcessing","currentWizardStep","setCurrentWizardStep","showPlaylistSuggestions","setShowPlaylistSuggestions","showYoutubePlaylistSuggestions","setShowYoutubePlaylistSuggestions","playlistNameForExport","setPlaylistNameForExport","playlistDescriptionForExport","setPlaylistDescriptionForExport","selectedFailedTracks","setSelectedFailedTracks","platforms","Youtube","setSourcePlatform","setDestinationPlatform","savedSource","savedDestination","lastPlaylistUrl","hasFetchedHistory","destinationIsSpotify","addToast","processingStatuses","block","dismissToast","newToast","toastConfig","resp","concat","batches","videoIdToYear","detailsResp","handlePlaylistUrlSubmit","extractPlaylistId","connectToSpotify","connectToYouTube","getCurrentStep","handleStartConversion","connectAfterLogin","getAuthStatus","sourceAuth","destinationAuth","getConnectionHandlers","connectToSource","connectToDestination","wizardSteps","number","help","Settings","Upload","FileSpreadsheet","Download","Shield","Lock","howItWorks","ClipboardPaste","PlayCircle","resetConverter","handleLogoutOrConnectMissing","viewport","once","LogOut","step","idx","ChevronRight","Loader2","_h","Loader","ChevronLeft","rows","RefreshCw","conv","Link","to","whileInView","amount","cloneElement","Github","Mail","cleanVideoId","cleanTrackUri","isIOSDevice","isAndroidDevice","isTabletDevice","useMobileDetection","initialMobile","initialPortrait","initialIOS","initialAndroid","initialTablet","isPortrait","setIsPortrait","isIOS","setIsIOS","isAndroid","setIsAndroid","isTablet","setIsTablet","setViewport","devicePixelRatio","detectDevice","portrait","ios","android","tablet","handleOrientationChange","isLandscape","isSmallScreen","isMediumScreen","isLargeScreen","isMobileOrTablet","isStandalone","standalone","MobileHeader","MobileBottomNav","MobileNavItem","active","badge","MobileCard","MobileButton","ghost","usePullToRefresh","elementRef","threshold","resistance","onRefresh","isRefreshing","setIsRefreshing","pullDistance","setPullDistance","currentY","isPulling","handleTouchStart","scrollTop","distance","handleTouchEnd","useSwipeGestures","minSwipeDistance","maxSwipeTime","touchStart","touchEnd","isSwiping","cancelable","targetTouches","time","currentX","distanceX","distanceY","timeDiff","isHorizontalSwipe","onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown","useLongPress","onLongPress","onPress","isLongPress","startLongPress","endLongPress","handleTouchCancel","useSwipeActions","defaultPerformanceConfig","enableParticleAnimations","enableComplexAnimations","enableMouseInteractions","enableParallaxEffects","maxParticleCount","maxAnimationFPS","throttleMouseEvents","reduceMotion","lowPowerMode","mobileOptimizations","currentPerformanceConfig","deviceCapabilities","isLowPower","hardwareConcurrency","prefersReducedMotion","isSlowConnection","detectDeviceCapabilities","getOptimizedPerformanceConfig","useViewportLogger","viewportAnalysis","aspectRatio","isDesktop","safeAreaTop","safeAreaBottom","safeAreaLeft","safeAreaRight","availableHeight","availableWidth","scrollbarWidth","orientation","breakpoint","getScrollbarWidth","outer","inner","offsetWidth","parentNode","getSafeAreaInsets","getComputedStyle","getPropertyValue","getBreakpoint","updateViewport","safeAreas","contentArea","headerHeight","bottomNavHeight","availableContentHeight","contentPadding","scrollableHeight","shouldUseCompactLayout","shouldReduceAnimations","shouldOptimizeForTouch","recommendedFontSize","recommendedSpacing","useViewportAnalysis","device","EditProfileModal","onShowToast","isUploading","setIsUploading","isSaving","setIsSaving","formData","setFormData","website","phone","birthDate","favoriteGenre","favoriteArtist","handleInputChange","field","handleNestedChange","category","User","tab","Camera","accept","files","defaultChecked","Palette","Bell","Save","EditProfilePage","back","points","setIsLoading","isExporting","setIsExporting","showDeleteConfirm","setShowDeleteConfirm","userSettings","updateSetting","Smartphone","Globe","exportData","Trash2","PreferencesPage","ThemeSettingsPage","Header","FooterSave","onSave","NotificationSettingsPage","ToggleRow","v","PrivacySettingsPage","DataExportPage","faqData","question","answer","HelpModal","activeCategory","setActiveCategory","expandedItems","setExpandedItems","filteredFAQ","categories","HelpCircle","BookOpen","Play","AlertCircle","subject","newExpanded","toggleExpanded","ChevronDown","HelpPage","_PaymentService","initializeStripe","loadStripe","publishableKey","VITE_STRIPE_PUBLISHABLE_KEY","stripe","getPaymentPlans","price","currency","interval","stripePriceId","VITE_STRIPE_PREMIUM_MONTHLY_PRICE_ID","VITE_STRIPE_PREMIUM_YEARLY_PRICE_ID","createCheckoutSession","planId","paymentAPI","successUrl","cancelUrl","sessionId","redirectToCheckout","handlePaymentSuccess","verifyPayment","updateUserToPremium","premiumSince","currentPeriodStart","current_period_start","currentPeriodEnd","current_period_end","cancelAtPeriodEnd","cancel_at_period_end","stripeSubscriptionId","getUserSubscription","cancelSubscription","reactivateSubscription","hasActivePremium","getSubscriptionDetails","planName","nextBillingDate","paymentService","PremiumModal","plans","setPlans","selectedPlan","setSelectedPlan","subscriptionDetails","setSubscriptionDetails","availablePlans","details","selectedPlanData","Crown","CreditCard","ArrowRight","PremiumPage","ProfileTab","showEditProfile","setShowEditProfile","showSettings","setShowSettings","showHelp","setShowHelp","showPremium","setShowPremium","userStats","setUserStats","isUploadingImage","setIsUploadingImage","headerPhoto","setHeaderPhoto","Plus","History","Edit3","LinkIcon","SPRING_CONFIG","lazy","SuccessCelebration$1","module","isVisible","hapticLight","Sun","Moon","MobileConverter","performanceConfig","throttleMs","debounceMs","maxFPS","enableRAF","rafIdRef","lastFrameTimeRef","frameIntervalRef","throttled","cancel","debounce","wait","lastArgs","debounced","flush","performance","timeSinceLastFrame","cleanup","measurePerformance","fn","start","end","batchUpdates","update","usePerformanceOptimization","isInitialized","setIsInitialized","loadingTimeoutRef","debounceRef","conversionStep","setConversionStep","selectedSourcePlatform","setSelectedSourcePlatform","selectedDestinationPlatform","setSelectedDestinationPlatform","setSelectedPlaylist","setSearchQuery","profileImage","setProfileImage","showToastWrapper","reactExports","setLoadingState","initializeComponent","hapticSuccess","hapticWarning","hapticError","hapticMedium","triggerHaptic","patterns","pattern","vibrate","hapticHeavy","useHapticFeedback","networkStatus","setNetworkStatus","isOffline","updateNetworkStatus","mozConnection","webkitConnection","connectionType","connection2","downlink","rtt","useOfflineStatus","contentRef","swipeRef","historySwipeRef","commands","isEnabled","isListening","setIsListening","transcript","setTranscript","isSupported","setIsSupported","recognitionRef","SpeechRecognition","webkitSpeechRecognition","recognition","continuous","interimResults","lang","onstart","onresult","finalTranscript","interimTranscript","resultIndex","isFinal","lowerTranscript","command","onerror","onend","stop","startListening","stopListening","toggleListening","useVoiceCommands","refresh","scrollDirection","setScrollDirection","lastScrollY","currentScrollY","diff","useScrollDirection","userPlaylists","setUserPlaylists","isLoadingPlaylists","setIsLoadingPlaylists","conversionProgress","setConversionProgress","showWelcomeAnimation","setShowWelcomeAnimation","tabSwipeRef","scrollProgress","isScrolling","handleScroll","scrollToTop","onProgressChange","setScrollProgress","setIsScrolling","scrollTimeoutRef","calculateProgress","scrollHeight","clientHeight","scrollTo","scrollToBottom","scrollToElement","containerRect","elementRect","useScrollProgress","hasMoreContent","setHasMoreContent","isLoadingMore","setIsLoadingMore","nextIndex","prevIndex","longPressRef","selectedPlaylistItem","finally","storedImage","renderConverterContent","ListMusic","img","nextElementSibling","ownerInfo","onContextMenu","draggable","repeatDelay","Unlock","reload","hasFailures","isFailed","fontSizeMap","fontWeightMap","normal","semibold","bold","EnhancedGradientText","showNoise","letterSpacing","textRef","gradients","SpotifyCallback","authLoading","setStatus","connectionQuality","setConnectionQuality","setRetryCount","currentConnectionQuality","redirectDelay","handleRetry","faSpinner","spin","faCheckCircle","faExclamationTriangle","faArrowLeft","faExclamationCircle","faSignInAlt","YouTubeCallback","debugInfo","setDebugInfo","authWaitTime","setAuthWaitTime","authCheckInterval","authTimeout","isMounted","processCallback","currentUrl","waitTime","handleReturnHome","notifyAuthComplete","opener","postMessage","faSync","featureList","desc","SimpleLogin","useLocation","setEmail","setPassword","setDisplayName","isSignUp","setIsSignUp","setLocalError","showPassword","setShowPassword","isRecoveryMode","setIsRecoveryMode","isRecovery","youtubeCallback","passwordScore","pw","getPasswordScore","displayError","f","onSubmit","encType","autoComplete","minLength","EyeOff","MobileLogin","themeCtx","rememberMe","setRememberMe","isSubmitting","setIsSubmitting","validationErrors","setValidationErrors","showSuccessAnimation","setShowSuccessAnimation","validateField","pwd","calculatePasswordStrength","passwordTip","isDarkNow","hour","getHours","getGreeting","validateForm","PrivateRoute","requireProvider","Navigate","PrivacyPolicy","faGithub","faTwitter","TermsOfService","Preloader","initialDelay","showProgressText","customLogo","initialProgress","setVisible","currentStage","setCurrentStage","loadingProgress","setLoadingProgress","loadingComplete","setLoadingComplete","initialTimer","onProgress","stages","currentPercent","stage","increment","simulateLoading","themeColors","glow","spinnerGradient","getThemeColors","sizeConfig","containerSize","innerCircleSize","logoContainerSize","spinnerWidth","progressWidth","getSizeConfig","containerStyles","borderOpacity","bgOpacity","getGlassmorphicStyles","backgroundRepeat","WebkitMask","WebkitMaskComposite","maskComposite","PreloaderDemo","showFullScreen","setShowFullScreen","setSize","setShowProgressText","sizeOption","themeOption","AppInitializer","initialLoadComplete","setInitialLoadComplete","setState","isNavigating","previousUrl","pageLoadTimestamp","storageKey","saveCurrentState","stateToSave","lastUrl","finishLoading","timeElapsed","parsedState","isRefresh","readyState","usePageLifecycle","HTML_PRELOADER_PROGRESS","fallbackTimeout","APP_INITIALIZED","progressInterval","completeProgress","completeTimer","safetyTimeout","TokenManagerInitializer","initializationError","setInitializationError","ShareModal","copied","setCopied","canShare","setCanShare","shareUrl","handleCopy","readOnly","share","convertTrackData","convertedTrack","ConversionInsights","useParams","conversionData","setConversionData","playlistStats","setPlaylistStats","firebaseError","localConversion","conversionRef","conversionDoc","conversionData2","stateConversion","dateValue","parsedDate","getTime","existing","sampleTrack","statsToShow","date","MobileContext","MobileFailedTracksDetails","propsFailedTracks","propsOnAddToYouTube","propsOnAddToSpotify","setFailedTracks","addedTracks","setAddedTracks","hasProcessedData","handleAddToYouTubeButton","handleAddToSpotifyButton","isTrackAdded","hasYouTubeInput","hasSpotifyInput","CheckCircle2","angularCss","App","mobileDetectionReady","setMobileDetectionReady","forceMobile","shareData","closeShareModal","setIsOpen","setShareData","handleOpenShareModal","useShareModal","toggleMobileLayout","_mobileDebug","mobileContextValue","shouldRenderMobile","Router","Routes","Route","Login","injectPolyfillsIntoIframe","iframe","iframeDocument","contentDocument","contentWindow","browserScript","textContent","head","trustedTypesScript","trustedTypes","createPolicy","createHTML","string","createScriptURL","createScript","isValidElement","init","dsn","tracesSampleRate","replaysSessionSampleRate","querySelectorAll","observer","MutationObserver","mutations","mutation","addedNodes","node","nodeName","nodeType","observe","childList","subtree","setupIframePolyfills","ReactDOM","createRoot","render","StrictMode"],"sources":["../../src/lib/ThemeContext.tsx","../../src/lib/env.ts","../../src/lib/firebase.ts","../../src/lib/AuthContext.tsx","../../src/lib/tokenManager.ts","../../src/lib/spotifyApi.ts","../../src/lib/youtubeApi.ts","../../src/lib/youtubeAuth.ts","../../src/lib/cryptoUtils.ts","../../src/lib/spotifyAuth.ts","../../src/lib/improvedConversion.ts","../../src/services/networkResilience.ts","../../src/services/profileService.ts","../../src/types/conversion.ts","../../src/lib/ConversionContext.tsx","../../src/context/UserContext.tsx","../../src/lib/utils.ts","../../src/components/ui/ParticleField.tsx","../../src/components/ui/MorphingBlob.tsx","../../src/components/ui/FloatingElements.tsx","../../src/components/ui/TypingEffect.tsx","../../src/components/ui/GlowButton.tsx","../../src/components/EnhancedHeroSection.tsx","../../src/components/ui/GlassmorphicCard.tsx","../../src/components/feedback/SuccessCelebration.tsx","../../src/components/feedback/EnhancedToast.tsx","../../src/components/ui/GlassmorphicContainer.tsx","../../src/components/visualization/PlaylistInsights.tsx","../../src/components/ui/PlatformCardBack.tsx","../../src/components/EnhancedConnectionCard.tsx","../../src/components/ui/FloatingLabels.tsx","../../src/components/ui/AnimatedGradientText.tsx","../../src/hooks/useMousePosition.ts","../../src/components/ui/LightingText.tsx","../../src/components/ui/SpotlightCard.tsx","../../src/components/EnhancedFailedTracksModal.tsx","../../src/assets/SoundSwappLogo.tsx","../../src/components/EnhancedPlaylistConverter.tsx","../../src/hooks/useMobileDetection.ts","../../src/components/ResponsiveLayout.tsx","../../src/hooks/usePullToRefresh.ts","../../src/hooks/useSwipeGestures.ts","../../src/hooks/useLongPress.ts","../../src/hooks/useSwipeActions.ts","../../src/config/performance.ts","../../src/hooks/useViewportAnalysis.ts","../../src/components/modals/EditProfileModal.tsx","../../src/components/modals/SettingsModal.tsx","../../src/components/modals/HelpModal.tsx","../../src/services/paymentService.ts","../../src/components/modals/PremiumModal.tsx","../../src/components/tabs/ProfileTab.tsx","../../src/components/MobileConverter.tsx","../../src/hooks/usePerformanceOptimization.ts","../../src/hooks/useHapticFeedback.ts","../../src/hooks/useOfflineStatus.ts","../../src/hooks/useVoiceCommands.ts","../../src/hooks/useScrollAnimation.ts","../../src/components/ui/EnhancedGradientText.tsx","../../src/components/SpotifyCallback.tsx","../../src/components/YouTubeCallback.tsx","../../src/components/Login.tsx","../../src/components/MobileLogin.tsx","../../src/components/PrivateRoute.tsx","../../src/components/PrivacyPolicy.tsx","../../src/components/TermsOfService.tsx","../../src/lib/glassmorphic.ts","../../src/components/ui/Preloader.tsx","../../src/components/PreloaderDemo.tsx","../../src/components/AppInitializer.tsx","../../src/hooks/usePageLifecycle.ts","../../src/components/TokenManagerInitializer.tsx","../../src/components/ui/ShareModal.tsx","../../src/lib/playlistInsights.ts","../../src/components/ConversionInsights.tsx","../../src/context/MobileContext.tsx","../../src/components/visualization/MobileFailedTracksDetails.tsx","../../src/App.tsx","../../src/hooks/useShareModal.ts","../../src/lib/polyfillInjector.ts","../../src/main.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\n\ntype Theme = 'light' | 'dark';\n\ninterface ThemeContextType {\n  theme: Theme;\n  toggleTheme: () => void;\n  isDark: boolean;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  // Check if user has a preference stored, otherwise use system preference\n  const getInitialTheme = (): Theme => {\n    const savedTheme = localStorage.getItem('theme') as Theme | null;\n    if (savedTheme) return savedTheme;\n    \n    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n  };\n\n  const [theme, setTheme] = useState<Theme>(getInitialTheme);\n  \n  const isDark = theme === 'dark';\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n    root.classList.remove('light', 'dark');\n    root.classList.add(theme);\n    localStorage.setItem('theme', theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme(prev => (prev === 'light' ? 'dark' : 'light'));\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme, isDark }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n};\n\nexport const useTheme = (): ThemeContextType => {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n}; ","/// <reference types=\"vite/client\" />\n/// <reference path=\"../vite-env.d.ts\" />\nimport { z } from 'zod';\n\n// Helper: read from both import.meta.env and process.env, with VITE_ and non-VITE fallbacks\nfunction readEnv(name: string, fallbackNames: string[] = []): string | undefined {\n  let viteEnv: any = {};\n  try {\n    // @ts-ignore - import.meta may not exist in Node\n    viteEnv = (typeof window !== 'undefined' && import.meta?.env) || {};\n  } catch (e) {\n    // ignore if import.meta is not available\n  }\n  \n  const nodeEnv = (typeof process !== 'undefined' && process.env) ? process.env : {};\n\n  const candidates = [name, ...fallbackNames];\n  for (const key of candidates) {\n    if (viteEnv?.[key]) return viteEnv[key];\n    if (nodeEnv?.[key]) return nodeEnv[key];\n  }\n  return undefined;\n}\n\n// Environment configuration for SoundSwapp\nexport const getAppUrl = (): string => {\n  const envUrl = readEnv('VITE_APP_URL', ['APP_URL', 'BASE_URL']);\n  \n  console.log('[env] getAppUrl() debug:', {\n    envUrl,\n    hasWindow: typeof window !== 'undefined',\n    windowOrigin: typeof window !== 'undefined' ? window.location.origin : 'N/A',\n    fallback: 'https://soundswapp.firebaseapp.com'\n  });\n  \n  if (envUrl && envUrl.length > 0) {\n    console.log('[env] Using environment app URL:', envUrl);\n    return envUrl;\n  }\n  \n  // Use current window location if available (for both firebaseapp.com and web.app domains)\n  if (typeof window !== 'undefined' && window.location.origin) {\n    console.log('[env] Using window location origin:', window.location.origin);\n    return window.location.origin;\n  }\n  \n  // Fallback to firebaseapp.com to match the actual deployment\n  console.log('[env] Using fallback app URL: https://soundswapp.firebaseapp.com');\n  return 'https://soundswapp.firebaseapp.com';\n};\n\nexport const getCallbackUrl = (): string => {\n  const envCallback = readEnv('VITE_CALLBACK_URL', ['CALLBACK_URL']);\n  if (envCallback) {\n    return envCallback;\n  }\n  \n  // Use the exact callback URL specified in environment\n  return `${getAppUrl()}/callback`;\n};\n\nexport const getSpotifyCallbackUrl = (): string => {\n  const envRedirect = readEnv('VITE_SPOTIFY_REDIRECT_URI', ['SPOTIFY_REDIRECT_URI']);\n  if (envRedirect) {\n    console.log('[env] Using environment Spotify redirect URI:', envRedirect);\n    return envRedirect;\n  }\n  \n  // Get the app URL and construct callback\n  const appUrl = getAppUrl();\n  const callbackUrl = `${appUrl}/callback`;\n  \n  console.log('[env] Constructed Spotify callback URL:', {\n    appUrl,\n    callbackUrl,\n    currentLocation: typeof window !== 'undefined' ? window.location.href : 'N/A'\n  });\n  \n  // Ensure we have a valid URL\n  if (!appUrl || appUrl === 'undefined' || callbackUrl.includes('undefined')) {\n    const fallbackUrl = 'https://soundswapp.web.app/callback';\n    console.warn('[env] Invalid app URL detected, using fallback:', fallbackUrl);\n    return fallbackUrl;\n  }\n  \n  return callbackUrl;\n};\n\nexport const getYouTubeCallbackUrl = (): string => {\n  const envRedirect = readEnv('VITE_YOUTUBE_REDIRECT_URI', ['YOUTUBE_REDIRECT_URI']);\n  if (envRedirect) {\n    return envRedirect;\n  }\n  // Default to the specific URL format you're using\n  return `${getAppUrl()}/youtube-callback`;\n};\n\n// Zod schema for env validation (optional to support Node and various builds)\nconst EnvSchema = z.object({\n  VITE_SPOTIFY_CLIENT_ID: z.string().optional(),\n  VITE_SPOTIFY_CLIENT_SECRET: z.string().optional(),\n  VITE_YOUTUBE_CLIENT_ID: z.string().optional(),\n  VITE_YOUTUBE_CLIENT_SECRET: z.string().optional(),\n  VITE_YOUTUBE_REDIRECT_URI: z.string().optional(),\n  VITE_SENTRY_DSN: z.string().optional(),\n  VITE_APP_URL: z.string().optional(),\n});\n\nlet envToValidate: any = {};\ntry {\n  // @ts-ignore - import.meta may not exist in Node\n  envToValidate = import.meta?.env || {};\n} catch (e) {\n  // ignore if import.meta is not available\n}\n\nconst parsedEnv = EnvSchema.safeParse(envToValidate);\nif (!parsedEnv.success) {\n  const issues = parsedEnv.error.issues.map((i: z.ZodIssue) => i.message).join('; ');\n  const isProduction = envToValidate.PROD || process.env.NODE_ENV === 'production';\n  if (isProduction) {\n    console.warn(`Env validation warnings: ${issues}`);\n  }\n}\n\n// Firebase configuration (temporarily hardcoded to ensure it works)\nexport const firebaseConfig = {\n  apiKey: 'AIzaSyCSjfXh6sHtx1rr1-WLR4ffFHf5lB8gFEA',\n  authDomain: 'soundswapp.firebaseapp.com',\n  projectId: 'soundswapp',\n  storageBucket: 'soundswapp.firebasestorage.app',\n  messagingSenderId: '968024909043',\n  appId: '1:968024909043:web:9509472d462be5d3e70386',\n  measurementId: 'G-F3T0GDR2ZV'\n};\n\n// Spotify configuration (with fallback for redirect URI to ensure it's always valid)\nexport const spotifyConfig = {\n  clientId: '7a6f0eca3eb64dd49809a47d19d0cd13',\n  clientSecret: '9e88e567c0104528a76b31bf4d8b067b',\n  redirectUri: (() => {\n    const envRedirect = readEnv('VITE_SPOTIFY_REDIRECT_URI', ['SPOTIFY_REDIRECT_URI']);\n    if (envRedirect) {\n      console.log('[Spotify Config] Using environment redirect URI:', envRedirect);\n      return envRedirect;\n    }\n    \n    // Use known working callback URL\n    const callbackUrl = 'https://soundswapp.web.app/callback';\n    console.log('[Spotify Config] Using hardcoded callback URL:', callbackUrl);\n    return callbackUrl;\n  })(),\n  scope: 'user-read-private user-read-email playlist-read-private playlist-read-collaborative playlist-modify-public playlist-modify-private'\n};\n\n// YouTube fallback configuration\nconst YOUTUBE_FALLBACK_CONFIG = {\n  clientId: '968024909043-qv0sceqajnebc6m3088eoq519n3epbua.apps.googleusercontent.com',\n  clientSecret: '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',\n  redirectUri: 'https://soundswapp.firebaseapp.com/youtube-callback'\n};\n\n// YouTube configuration\nexport const youtubeConfig = {\n  clientId: readEnv('VITE_YOUTUBE_CLIENT_ID', ['YOUTUBE_CLIENT_ID', 'VITE_GOOGLE_CLIENT_ID']) || YOUTUBE_FALLBACK_CONFIG.clientId,\n  clientSecret: readEnv('VITE_YOUTUBE_CLIENT_SECRET', ['YOUTUBE_CLIENT_SECRET', 'VITE_GOOGLE_CLIENT_SECRET']) || YOUTUBE_FALLBACK_CONFIG.clientSecret,\n  redirectUri: getYouTubeCallbackUrl(),\n  scope: 'https://www.googleapis.com/auth/youtube.readonly https://www.googleapis.com/auth/youtube.force-ssl'\n};\n\n// Debug YouTube configuration loading\nconsole.log('[YouTube Config] Environment variables debug:', {\n  VITE_YOUTUBE_CLIENT_ID: import.meta.env?.VITE_YOUTUBE_CLIENT_ID ? 'SET' : 'MISSING',\n  VITE_GOOGLE_CLIENT_ID: import.meta.env?.VITE_GOOGLE_CLIENT_ID ? 'SET' : 'MISSING',\n  VITE_YOUTUBE_CLIENT_SECRET: import.meta.env?.VITE_YOUTUBE_CLIENT_SECRET ? 'SET' : 'MISSING',\n  VITE_GOOGLE_CLIENT_SECRET: import.meta.env?.VITE_GOOGLE_CLIENT_SECRET ? 'SET' : 'MISSING',\n  VITE_YOUTUBE_REDIRECT_URI: import.meta.env?.VITE_YOUTUBE_REDIRECT_URI ? 'SET' : 'MISSING',\n  resolved_clientId: youtubeConfig.clientId ? `${youtubeConfig.clientId.substring(0, 10)}...` : 'MISSING',\n  resolved_clientSecret: youtubeConfig.clientSecret ? 'SET' : 'MISSING',\n  resolved_redirectUri: youtubeConfig.redirectUri\n});","import { initializeApp } from 'firebase/app';\nimport { getAuth, GoogleAuthProvider, signInWithPopup } from 'firebase/auth';\nimport { getFirestore } from 'firebase/firestore';\nimport { getStorage } from 'firebase/storage';\nimport { firebaseConfig } from './env';\n\n// Use centralized Firebase configuration from env.ts\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\n\n// Initialize Firebase services (explicitly exclude Analytics)\nexport const auth = getAuth(app);\nexport const db = getFirestore(app);\nexport const storage = getStorage(app);\n\n// Explicitly disable Analytics to prevent Google Analytics errors\nif (typeof window !== 'undefined') {\n  // Prevent Firebase from auto-initializing Analytics\n  (window as any).__FIREBASE_DEFAULTS__ = {\n    ...(window as any).__FIREBASE_DEFAULTS__,\n    analytics: false\n  };\n}\n\n// Auth providers\nexport const googleProvider = new GoogleAuthProvider();\n\n// Stubs to satisfy imports from legacy code\nexport const reconnectFirestore = async () => true;\nexport const conversionConverter = {\n  toFirestore: (doc: any) => doc,\n  fromFirestore: (snapshot: any) => ({ id: snapshot.id, ...(snapshot.data?.() || {}) })\n};\n\n// Additional exports for legacy code compatibility\nexport const waitForFirestore = async () => db;\nexport const handleFirestoreError = (error: any) => {\n  console.error('Firestore error:', error);\n  return error;\n};\n\nexport const saveUserInsights = async (userId: string, insights: any) => {\n  // Stub implementation\n  console.log('Saving user insights:', { userId, insights });\n  return true;\n};\n\nexport const getUserInsights = async (userId: string) => {\n  // Stub implementation\n  console.log('Getting user insights for:', userId);\n  return null;\n};\n\nexport const signInWithGoogle = async () => {\n  try {\n    const result = await signInWithPopup(auth, googleProvider);\n    return result.user;\n  } catch (error) {\n    console.error('Google sign-in error:', error);\n    throw error;\n  }\n};\n\nexport default app; ","import React, { createContext, useContext, useState, useEffect } from 'react';\nimport { \n  User as FirebaseUser,\n  onAuthStateChanged,\n  signInWithEmailAndPassword,\n  createUserWithEmailAndPassword,\n  signInWithPopup,\n  signOut as firebaseSignOut,\n  updateProfile\n} from 'firebase/auth';\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\nimport { auth, db, googleProvider } from './firebase';\n\ninterface UserProfile {\n  uid: string;\n  email: string;\n  displayName: string;\n  photoURL?: string;\n  isProvider: boolean;\n  phoneNumber?: string;\n  location?: string;\n  rating?: number;\n  completedTasks?: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\ninterface AuthContextType {\n  user: FirebaseUser | null;\n  userProfile: UserProfile | null;\n  loading: boolean;\n  isAuthenticated: boolean;\n  isProvider: boolean;\n  error: string | null;\n  \n  // Authentication functions\n  signInWithEmail: (email: string, password: string) => Promise<void>;\n  signUpWithEmail: (email: string, password: string, displayName: string, isProvider: boolean) => Promise<void>;\n  signInWithGoogle: () => Promise<void>;\n  signOut: () => Promise<void>;\n  updateUserProfile: (updates: Partial<UserProfile>) => Promise<void>;\n  \n  // Clear error\n  clearError: () => void;\n  \n  // Platform authentication properties\n  hasSpotifyAuth: boolean;\n  hasYouTubeAuth: boolean;\n  setHasSpotifyAuth: (hasAuth: boolean) => void;\n  setHasYouTubeAuth: (hasAuth: boolean) => void;\n  disconnectFromSpotify: () => Promise<void>;\n  disconnectFromYouTube: () => Promise<void>;\n  isConnectingSpotify: boolean;\n  isConnectingYouTube: boolean;\n  spotifyError: string | null;\n  youtubeError: string | null;\n  spotifyUserProfile: any | null;\n  youtubeUserProfile: any | null;\n  \n  // Platform profile fetching\n  fetchSpotifyProfile: () => Promise<void>;\n  fetchYouTubeProfile: () => Promise<void>;\n  checkYouTubeAuth: () => Promise<boolean>;\n  \n  // Generic sign in method\n  signIn: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [user, setUser] = useState<FirebaseUser | null>(null);\n  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  \n  // Platform authentication state\n  const [hasSpotifyAuth, setHasSpotifyAuth] = useState(false);\n  const [hasYouTubeAuth, setHasYouTubeAuth] = useState(false);\n  const [isConnectingSpotify, setIsConnectingSpotify] = useState(false);\n  const [isConnectingYouTube, setIsConnectingYouTube] = useState(false);\n  const [spotifyError, setSpotifyError] = useState<string | null>(null);\n  const [youtubeError, setYoutubeError] = useState<string | null>(null);\n  const [spotifyUserProfile, setSpotifyUserProfile] = useState<any | null>(null);\n  const [youtubeUserProfile, setYoutubeUserProfile] = useState<any | null>(null);\n\n  // Fetch user profile from Firestore\n  const fetchUserProfile = async (uid: string): Promise<UserProfile | null> => {\n    try {\n      const userDoc = await getDoc(doc(db, 'users', uid));\n      if (userDoc.exists()) {\n        const data = userDoc.data();\n        return {\n          uid,\n          email: data.email,\n          displayName: data.displayName,\n          photoURL: data.photoURL,\n          isProvider: data.isProvider || false,\n          phoneNumber: data.phoneNumber,\n          location: data.location,\n          rating: data.rating,\n          completedTasks: data.completedTasks || 0,\n          createdAt: data.createdAt?.toDate() || new Date(),\n          updatedAt: data.updatedAt?.toDate() || new Date(),\n        };\n      }\n      return null;\n    } catch (err) {\n      console.error('Error fetching user profile:', err);\n      return null;\n    }\n  };\n\n  // Create or update user profile\n  const createUserProfile = async (user: FirebaseUser, isProvider: boolean = false): Promise<UserProfile> => {\n    const profile: UserProfile = {\n      uid: user.uid,\n      email: user.email || '',\n      displayName: user.displayName || '',\n      photoURL: user.photoURL || undefined,\n      isProvider,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n\n    try {\n      await setDoc(doc(db, 'users', user.uid), profile);\n      return profile;\n    } catch (err) {\n      console.error('Error creating user profile:', err);\n      throw err;\n    }\n  };\n\n  // Update user profile\n  const updateUserProfile = async (updates: Partial<UserProfile>): Promise<void> => {\n    if (!user) throw new Error('No user logged in');\n\n    try {\n      const updatedProfile = {\n        ...userProfile,\n        ...updates,\n        updatedAt: new Date(),\n      };\n\n      await setDoc(doc(db, 'users', user.uid), updatedProfile, { merge: true });\n      setUserProfile(updatedProfile as UserProfile);\n    } catch (err) {\n      console.error('Error updating user profile:', err);\n      throw err;\n    }\n  };\n\n  // Sign in with email and password\n  const signInWithEmail = async (email: string, password: string): Promise<void> => {\n    try {\n      setError(null);\n      const result = await signInWithEmailAndPassword(auth, email, password);\n      setUser(result.user);\n      \n      // Fetch user profile\n      const profile = await fetchUserProfile(result.user.uid);\n      setUserProfile(profile);\n    } catch (err: any) {\n      setError(err.message || 'Failed to sign in');\n      throw err;\n    }\n  };\n\n  // Sign up with email and password\n  const signUpWithEmail = async (email: string, password: string, displayName: string, isProvider: boolean): Promise<void> => {\n    try {\n      setError(null);\n      const result = await createUserWithEmailAndPassword(auth, email, password);\n      \n      // Update display name\n      await updateProfile(result.user, { displayName });\n      \n      // Create user profile\n      const profile = await createUserProfile(result.user, isProvider);\n      \n      setUser(result.user);\n      setUserProfile(profile);\n    } catch (err: any) {\n      setError(err.message || 'Failed to create account');\n      throw err;\n    }\n  };\n\n  // Sign in with Google\n  const signInWithGoogle = async (): Promise<void> => {\n    try {\n      setError(null);\n      const result = await signInWithPopup(auth, googleProvider);\n      setUser(result.user);\n      \n      // Check if user profile exists, create if not\n      let profile = await fetchUserProfile(result.user.uid);\n      if (!profile) {\n        profile = await createUserProfile(result.user, false);\n      }\n      setUserProfile(profile);\n    } catch (err: any) {\n      setError(err.message || 'Failed to sign in with Google');\n      throw err;\n    }\n  };\n\n  // Sign out\n  const signOut = async (): Promise<void> => {\n    try {\n      await firebaseSignOut(auth);\n      setUser(null);\n      setUserProfile(null);\n    } catch (err: any) {\n      setError(err.message || 'Failed to sign out');\n      throw err;\n    }\n  };\n\n  // Clear error\n  const clearError = () => setError(null);\n  \n  // Platform authentication functions\n  const disconnectFromSpotify = async (): Promise<void> => {\n    try {\n      setHasSpotifyAuth(false);\n      setSpotifyUserProfile(null);\n      setSpotifyError(null);\n      // Additional cleanup logic can be added here\n    } catch (err: any) {\n      setSpotifyError(err.message || 'Failed to disconnect from Spotify');\n      throw err;\n    }\n  };\n  \n  const disconnectFromYouTube = async (): Promise<void> => {\n    try {\n      setHasYouTubeAuth(false);\n      setYoutubeUserProfile(null);\n      setYoutubeError(null);\n      // Additional cleanup logic can be added here\n    } catch (err: any) {\n      setYoutubeError(err.message || 'Failed to disconnect from YouTube');\n      throw err;\n    }\n  };\n\n  // Platform profile fetching methods\n  const fetchSpotifyProfile = async (): Promise<void> => {\n    try {\n      console.log('[AuthContext] 🎵 Fetching Spotify user profile...');\n      \n      // Import both profile functions\n      const { getDetailedSpotifyProfile, getSpotifyUserProfile } = await import('../lib/spotifyAuth');\n      \n      try {\n        // Try detailed profile first\n        const profileData = await getDetailedSpotifyProfile();\n        \n        if (profileData) {\n          console.log('[AuthContext] ✅ Detailed Spotify profile fetched:', {\n            displayName: profileData.displayName,\n            hasImage: !!profileData.imageUrl,\n            id: profileData.id,\n            savedTracks: profileData.savedTracks,\n            totalPlaylists: profileData.totalPlaylists,\n            product: profileData.product\n          });\n          \n          setSpotifyUserProfile({\n            // Basic profile (compatible with existing code)\n            displayName: profileData.displayName || 'Spotify User',\n            imageUrl: profileData.imageUrl,\n            images: profileData.imageUrl ? [{ url: profileData.imageUrl }] : [], // Add images array for compatibility\n            id: profileData.id,\n            email: profileData.email,\n            externalUrls: profileData.externalUrls,\n            \n            // Extended real data\n            country: profileData.country,\n            product: profileData.product,\n            followers: profileData.followers,\n            publicPlaylists: profileData.publicPlaylists,\n            privatePlaylists: profileData.privatePlaylists,\n            collaborativePlaylists: profileData.collaborativePlaylists,\n            totalPlaylists: profileData.totalPlaylists,\n            followingArtists: profileData.followingArtists,\n            savedTracks: profileData.savedTracks,\n            savedAlbums: profileData.savedAlbums,\n            topGenres: profileData.topGenres,\n            accountType: profileData.accountType,\n            explicitContentFilter: profileData.explicitContentFilter,\n            audioQuality: profileData.audioQuality,\n            offlineDownloads: profileData.offlineDownloads,\n            deviceLimit: profileData.deviceLimit,\n            lastActive: profileData.lastActive,\n            listeningTime: profileData.listeningTime,\n            monthlyListeners: profileData.monthlyListeners,\n            nextBilling: profileData.nextBilling,\n            crossfade: profileData.crossfade,\n            equalizer: profileData.equalizer\n          });\n          \n          setSpotifyError(null);\n          return; // Success with detailed profile\n        }\n      } catch (detailedError) {\n        console.warn('[AuthContext] ⚠️ Detailed profile failed, falling back to basic profile:', detailedError);\n      }\n      \n      // Fallback to basic profile if detailed fails\n      console.log('[AuthContext] 🔄 Falling back to basic Spotify profile...');\n      const basicProfileData = await getSpotifyUserProfile();\n      \n      if (basicProfileData) {\n        console.log('[AuthContext] ✅ Basic Spotify profile fetched:', {\n          displayName: basicProfileData.displayName,\n          hasImage: !!basicProfileData.imageUrl,\n          id: basicProfileData.id\n        });\n        \n        setSpotifyUserProfile({\n          // Basic profile data\n          displayName: basicProfileData.displayName || 'Spotify User',\n          imageUrl: basicProfileData.imageUrl,\n          images: basicProfileData.imageUrl ? [{ url: basicProfileData.imageUrl }] : [],\n          id: basicProfileData.id,\n          email: basicProfileData.email,\n          externalUrls: basicProfileData.externalUrls,\n          \n          // Default/unavailable values for restricted accounts\n          country: 'Not available',\n          product: 'Restricted account',\n          followers: 0,\n          publicPlaylists: 0,\n          privatePlaylists: 0,\n          collaborativePlaylists: 0,\n          totalPlaylists: 0,\n          followingArtists: 0,\n          savedTracks: 0,\n          savedAlbums: 0,\n          topGenres: ['Account restricted'],\n          accountType: 'Restricted',\n          explicitContentFilter: 'Not available',\n          audioQuality: 'Not available',\n          offlineDownloads: 'Not available',\n          deviceLimit: 1,\n          lastActive: 'Not available',\n          listeningTime: 'Not available',\n          monthlyListeners: 'Not available',\n          nextBilling: 'Not available',\n          crossfade: 'Not available',\n          equalizer: 'Not available'\n        });\n        \n        setSpotifyError('Limited profile data (account restrictions)');\n      } else {\n        console.warn('[AuthContext] ⚠️ No Spotify profile data available');\n        setSpotifyUserProfile(null);\n        setSpotifyError('Unable to fetch Spotify profile');\n      }\n    } catch (err: any) {\n      console.error('[AuthContext] ❌ Error fetching Spotify profile:', err);\n      setSpotifyError(err.message || 'Failed to fetch Spotify profile');\n      setSpotifyUserProfile(null);\n      throw err;\n    }\n  };\n\n  const fetchYouTubeProfile = async (): Promise<void> => {\n    try {\n      console.log('[AuthContext] 🎥 Fetching YouTube user profile...');\n      \n      // Import token manager to get YouTube token\n      const TokenManager = (await import('../lib/tokenManager')).default;\n      \n      // Get YouTube access token\n      const tokens = await TokenManager.getTokens('youtube');\n      if (!tokens?.accessToken) {\n        throw new Error('No YouTube access token available');\n      }\n      \n      // Fetch YouTube profile using Google People API\n      const response = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {\n        headers: {\n          'Authorization': `Bearer ${tokens.accessToken}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      \n      if (!response.ok) {\n        if (response.status === 401) {\n          // Token expired, try to refresh\n          console.log('[AuthContext] YouTube token expired, attempting refresh...');\n          const refreshedTokens = await TokenManager.refreshTokensPublic('youtube', tokens.refreshToken);\n          if (refreshedTokens) {\n            // Retry with refreshed token\n            const retryResponse = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {\n              headers: {\n                'Authorization': `Bearer ${refreshedTokens.accessToken}`,\n                'Content-Type': 'application/json'\n              }\n            });\n            \n            if (!retryResponse.ok) {\n              throw new Error(`YouTube profile fetch failed: ${retryResponse.status}`);\n            }\n            \n            const profileData = await retryResponse.json();\n            console.log('[AuthContext] ✅ YouTube profile fetched (after refresh):', {\n              name: profileData.name,\n              hasImage: !!profileData.picture,\n              id: profileData.id\n            });\n            \n            setYoutubeUserProfile({\n              displayName: profileData.name || 'YouTube User',\n              imageUrl: profileData.picture,\n              picture: profileData.picture, // Also store as 'picture' for compatibility\n              id: profileData.id,\n              email: profileData.email,\n              locale: profileData.locale\n            });\n            \n            setYoutubeError(null);\n            return;\n          } else {\n            throw new Error('Failed to refresh YouTube token');\n          }\n        } else {\n          throw new Error(`YouTube profile fetch failed: ${response.status}`);\n        }\n      }\n      \n      const profileData = await response.json();\n      console.log('[AuthContext] ✅ YouTube profile fetched:', {\n        name: profileData.name,\n        hasImage: !!profileData.picture,\n        id: profileData.id\n      });\n      \n      setYoutubeUserProfile({\n        displayName: profileData.name || 'YouTube User',\n        imageUrl: profileData.picture,\n        picture: profileData.picture, // Also store as 'picture' for compatibility\n        id: profileData.id,\n        email: profileData.email,\n        locale: profileData.locale\n      });\n      \n      setYoutubeError(null);\n      \n    } catch (err: any) {\n      console.error('[AuthContext] ❌ Error fetching YouTube profile:', err);\n      setYoutubeError(err.message || 'Failed to fetch YouTube profile');\n      setYoutubeUserProfile(null);\n      throw err;\n    }\n  };\n\n  const checkYouTubeAuth = async (): Promise<boolean> => {\n    try {\n      // This would typically check if YouTube auth token is valid\n      // For now, return the current state\n      return hasYouTubeAuth;\n    } catch (err: any) {\n      setYoutubeError(err.message || 'Failed to check YouTube auth');\n      return false;\n    }\n  };\n\n  // Generic sign in method (defaults to Google sign in)\n  const signIn = async (): Promise<void> => {\n    return signInWithGoogle();\n  };\n\n  // Check platform authentication status on app load\n  const checkPlatformAuthStatus = async (firebaseUser: any) => {\n    try {\n      // Dynamically import to avoid circular dependencies\n      const { isSpotifyAuthenticated } = await import('../lib/spotifyAuth');\n      const TokenManager = (await import('../lib/tokenManager')).default;\n      \n      console.log('[AuthContext] Checking platform auth status...');\n      \n      // Check Spotify authentication\n      try {\n        const spotifyAuth = await isSpotifyAuthenticated();\n        console.log('[AuthContext] Spotify auth status:', spotifyAuth);\n        setHasSpotifyAuth(spotifyAuth);\n        \n        // Fetch Spotify profile if authenticated\n        if (spotifyAuth) {\n          try {\n            console.log('[AuthContext] 🎵 Fetching Spotify profile on app load...');\n            await fetchSpotifyProfile();\n          } catch (profileError) {\n            console.warn('[AuthContext] ⚠️ Failed to fetch Spotify profile on app load:', profileError);\n            // Don't fail the auth check if profile fetch fails\n          }\n        }\n      } catch (error) {\n        console.warn('[AuthContext] Error checking Spotify auth:', error);\n        setHasSpotifyAuth(false);\n      }\n\n      // Check YouTube authentication\n      try {\n        const youtubeTokens = await TokenManager.getTokens('youtube');\n        const hasYouTubeTokens = !!youtubeTokens?.accessToken;\n        console.log('[AuthContext] YouTube auth status:', hasYouTubeTokens);\n        setHasYouTubeAuth(hasYouTubeTokens);\n        \n        // Fetch YouTube profile if authenticated\n        if (hasYouTubeTokens) {\n          try {\n            console.log('[AuthContext] 🎥 Fetching YouTube profile on app load...');\n            await fetchYouTubeProfile();\n          } catch (profileError) {\n            console.warn('[AuthContext] ⚠️ Failed to fetch YouTube profile on app load:', profileError);\n            // Don't fail the auth check if profile fetch fails\n          }\n        }\n      } catch (error) {\n        console.warn('[AuthContext] Error checking YouTube auth:', error);\n        setHasYouTubeAuth(false);\n      }\n    } catch (error) {\n      console.error('[AuthContext] Error in checkPlatformAuthStatus:', error);\n    }\n  };\n\n  // Listen for auth state changes\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (firebaseUser) => {\n      setUser(firebaseUser);\n      \n      if (firebaseUser) {\n        // Fetch user profile\n        const profile = await fetchUserProfile(firebaseUser.uid);\n        setUserProfile(profile);\n        \n        // Check platform authentication status\n        await checkPlatformAuthStatus(firebaseUser);\n      } else {\n        setUserProfile(null);\n        // Clear platform auth states when user signs out\n        setHasSpotifyAuth(false);\n        setHasYouTubeAuth(false);\n      }\n      \n      setLoading(false);\n    });\n\n    return unsubscribe;\n  }, []);\n\n  // Listen for platform authentication events\n  useEffect(() => {\n    const handleSpotifyAuthChange = async (event: Event) => {\n      const customEvent = event as CustomEvent;\n      console.log('[AuthContext] Spotify auth changed:', customEvent.detail);\n      setHasSpotifyAuth(customEvent.detail.authenticated);\n      setSpotifyError(null); // Clear any previous errors\n      \n      // Fetch profile when authentication succeeds\n      if (customEvent.detail.authenticated) {\n        try {\n          console.log('[AuthContext] 🎵 Spotify authenticated, fetching profile...');\n          await fetchSpotifyProfile();\n        } catch (error) {\n          console.warn('[AuthContext] ⚠️ Failed to fetch Spotify profile after auth:', error);\n          // Don't fail the auth process if profile fetch fails\n        }\n      } else {\n        // Clear profile when disconnected\n        setSpotifyUserProfile(null);\n      }\n    };\n\n    const handleYouTubeAuthChange = async (event: Event) => {\n      const customEvent = event as CustomEvent;\n      console.log('[AuthContext] YouTube auth changed:', customEvent.detail);\n      setHasYouTubeAuth(customEvent.detail.authenticated);\n      setYoutubeError(null); // Clear any previous errors\n      \n      // Fetch profile when authentication succeeds\n      if (customEvent.detail.authenticated) {\n        try {\n          console.log('[AuthContext] 🎥 YouTube authenticated, fetching profile...');\n          await fetchYouTubeProfile();\n        } catch (error) {\n          console.warn('[AuthContext] ⚠️ Failed to fetch YouTube profile after auth:', error);\n          // Don't fail the auth process if profile fetch fails\n        }\n      } else {\n        // Clear profile when disconnected\n        setYoutubeUserProfile(null);\n      }\n    };\n\n    // Add event listeners\n    window.addEventListener('spotify-auth-changed', handleSpotifyAuthChange);\n    window.addEventListener('youtube-auth-changed', handleYouTubeAuthChange);\n\n    console.log('[AuthContext] Added platform auth event listeners');\n\n    // Cleanup event listeners\n    return () => {\n      window.removeEventListener('spotify-auth-changed', handleSpotifyAuthChange);\n      window.removeEventListener('youtube-auth-changed', handleYouTubeAuthChange);\n      console.log('[AuthContext] Removed platform auth event listeners');\n    };\n  }, []);\n\n  const value: AuthContextType = {\n      user,\n    userProfile,\n      loading,\n      isAuthenticated: !!user,\n    isProvider: userProfile?.isProvider || false,\n    error,\n      signInWithEmail,\n    signUpWithEmail,\n    signInWithGoogle,\n      signOut,\n    updateUserProfile,\n    clearError,\n    hasSpotifyAuth,\n    hasYouTubeAuth,\n    setHasSpotifyAuth,\n    setHasYouTubeAuth,\n    disconnectFromSpotify,\n    disconnectFromYouTube,\n    isConnectingSpotify,\n    isConnectingYouTube,\n    spotifyError,\n    youtubeError,\n    spotifyUserProfile,\n    youtubeUserProfile,\n    \n    // Platform profile fetching\n    fetchSpotifyProfile,\n    fetchYouTubeProfile,\n    checkYouTubeAuth,\n    \n    // Generic sign in method\n    signIn,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = (): AuthContextType => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}; ","import { auth, db } from './firebase';\nimport { doc, setDoc, getDoc, deleteDoc } from 'firebase/firestore';\nimport { spotifyConfig, youtubeConfig } from './env';\n\ninterface ServiceTokens {\n  accessToken: string;\n  refreshToken: string;\n  expiresAt: number;\n  scope?: string;\n}\n\ninterface TokenStatus {\n  isValid: boolean;\n  expiresIn: number; // seconds until expiration\n  needsRefresh: boolean;\n}\n\nexport class TokenManager {\n  private static readonly REFRESH_BUFFER = 5 * 60; // 5 minutes before expiration\n  private static readonly CHECK_INTERVAL = 60 * 1000; // Check every minute\n  private static refreshTimers: Map<string, NodeJS.Timeout> = new Map();\n  private static listeners: Map<string, Set<(status: TokenStatus) => void>> = new Map();\n  private static readonly LOCAL_STORAGE_PREFIX = 'soundswapp_tokens_';\n  private static readonly FIRESTORE_RETRY_ATTEMPTS = 3;\n  private static readonly FIRESTORE_RETRY_DELAY = 1000; // 1 second\n\n  // Enhanced token storage with better error handling\n  static async storeTokens(service: 'spotify' | 'youtube', tokens: ServiceTokens): Promise<void> {\n    const user = auth.currentUser;\n    if (!user) {\n      console.error('[TokenManager] No authenticated user');\n      throw new Error('No authenticated user');\n    }\n\n    console.log(`[TokenManager] Storing ${service} tokens for user:`, user.uid);\n    \n    // Always store in localStorage first as immediate fallback\n    this.storeTokensLocally(service, tokens);\n    console.log(`[TokenManager] ✅ Tokens stored locally for ${service}`);\n\n    // Try Firestore with retries and graceful failure\n    try {\n      await this.storeTokensInFirestore(service, tokens, user.uid);\n      console.log(`[TokenManager] ✅ Tokens stored in Firestore for ${service}`);\n    } catch (error) {\n      console.warn(`[TokenManager] ⚠️ Failed to store ${service} tokens in Firestore, using localStorage fallback:`, error);\n      // Don't throw error - localStorage fallback is already in place\n    }\n  }\n\n  /**\n   * Store tokens in localStorage as fallback\n   */\n  private static storeTokensLocally(service: 'spotify' | 'youtube', tokens: ServiceTokens): void {\n    try {\n      const key = `${this.LOCAL_STORAGE_PREFIX}${service}`;\n      const tokenData = {\n        ...tokens,\n        storedAt: Date.now()\n      };\n      localStorage.setItem(key, JSON.stringify(tokenData));\n      console.log(`[TokenManager] 🔍 localStorage storage test for ${service}:`, {\n        key,\n        hasAccessToken: !!tokens.accessToken,\n        hasRefreshToken: !!tokens.refreshToken,\n        expiresAt: tokens.expiresAt\n      });\n    } catch (error) {\n      console.error(`[TokenManager] Failed to store ${service} tokens in localStorage:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Store tokens in Firestore with retry logic\n   */\n  private static async storeTokensInFirestore(service: 'spotify' | 'youtube', tokens: ServiceTokens, userId: string): Promise<void> {\n    for (let attempt = 1; attempt <= this.FIRESTORE_RETRY_ATTEMPTS; attempt++) {\n      try {\n        const tokenDoc = doc(db, 'users', userId, 'tokens', service);\n        await setDoc(tokenDoc, {\n          ...tokens,\n          updatedAt: new Date().toISOString()\n        });\n        return; // Success\n      } catch (error: any) {\n        console.warn(`[TokenManager] Firestore attempt ${attempt}/${this.FIRESTORE_RETRY_ATTEMPTS} failed for ${service}:`, error);\n        \n        if (attempt === this.FIRESTORE_RETRY_ATTEMPTS) {\n          throw error; // Final attempt failed\n        }\n        \n        // Wait before retry\n        await new Promise(resolve => setTimeout(resolve, this.FIRESTORE_RETRY_DELAY * attempt));\n      }\n    }\n  }\n\n  // Enhanced token retrieval with automatic refresh\n  static async getTokens(service: 'spotify' | 'youtube'): Promise<ServiceTokens | null> {\n    const user = auth.currentUser;\n    if (!user) {\n      console.error('[TokenManager] No authenticated user');\n      return null;\n    }\n\n    console.log(`[TokenManager] Getting ${service} tokens for user:`, user.uid);\n\n    let tokens: ServiceTokens | null = null;\n\n    // Try Firestore first\n    try {\n      tokens = await this.getTokensFromFirestore(service, user.uid);\n      if (tokens) {\n        console.log(`[TokenManager] ✅ Retrieved ${service} tokens from Firestore`);\n      }\n    } catch (error) {\n      console.warn(`[TokenManager] ⚠️ Failed to get ${service} tokens from Firestore, trying localStorage:`, error);\n    }\n\n    // Fallback to localStorage\n    if (!tokens) {\n      try {\n        tokens = this.getTokensFromLocalStorage(service);\n        if (tokens) {\n          console.log(`[TokenManager] ✅ Retrieved ${service} tokens from localStorage fallback`);\n        }\n      } catch (error) {\n        console.warn(`[TokenManager] Failed to get ${service} tokens from localStorage:`, error);\n      }\n    }\n\n    if (!tokens) {\n      console.log(`[TokenManager] No ${service} tokens found in either Firestore or localStorage`);\n      return null;\n    }\n\n    // Check if token needs refresh\n    const status = this.getTokenStatus(tokens);\n    if (status.needsRefresh && tokens.refreshToken) {\n      console.log(`[TokenManager] Token for ${service} needs refresh, attempting automatic refresh`);\n      try {\n        const refreshedTokens = await this.refreshTokens(service, tokens.refreshToken);\n        if (refreshedTokens) {\n          // Store refreshed tokens (with fallback handling)\n          await this.storeTokens(service, refreshedTokens);\n          return refreshedTokens;\n        }\n      } catch (error) {\n        console.warn(`[TokenManager] Failed to refresh tokens for ${service}:`, error);\n        // Return existing tokens even if refresh failed\n      }\n    }\n\n    return tokens;\n  }\n\n  /**\n   * Get tokens from Firestore\n   */\n  private static async getTokensFromFirestore(service: 'spotify' | 'youtube', userId: string): Promise<ServiceTokens | null> {\n    const tokenDoc = doc(db, 'users', userId, 'tokens', service);\n    const docSnapshot = await getDoc(tokenDoc);\n    return docSnapshot.exists() ? docSnapshot.data() as ServiceTokens : null;\n  }\n\n  /**\n   * Get tokens from localStorage\n   */\n  private static getTokensFromLocalStorage(service: 'spotify' | 'youtube'): ServiceTokens | null {\n    try {\n      const key = `${this.LOCAL_STORAGE_PREFIX}${service}`;\n      const stored = localStorage.getItem(key);\n      console.log(`[TokenManager] 🔍 localStorage retrieval test for ${service}:`, {\n        key,\n        hasStoredData: !!stored,\n        storedDataLength: stored?.length || 0\n      });\n      \n      if (stored) {\n        const data = JSON.parse(stored);\n        console.log(`[TokenManager] 🔍 Retrieved token data for ${service}:`, {\n          hasAccessToken: !!data.accessToken,\n          hasRefreshToken: !!data.refreshToken,\n          expiresAt: data.expiresAt,\n          storedAt: data.storedAt\n        });\n        \n        // Check if tokens are not too old (optional validation)\n        if (data.storedAt && Date.now() - data.storedAt > 7 * 24 * 60 * 60 * 1000) { // 7 days\n          console.warn(`[TokenManager] ${service} tokens in localStorage are older than 7 days`);\n        }\n        return data;\n      }\n    } catch (error) {\n      console.error(`[TokenManager] Error reading ${service} tokens from localStorage:`, error);\n    }\n    return null;\n  }\n\n  // Proactive token status checking\n  static getTokenStatus(tokens: ServiceTokens): TokenStatus {\n    const now = Math.floor(Date.now() / 1000);\n    const expiresIn = tokens.expiresAt - now;\n    const needsRefresh = expiresIn <= this.REFRESH_BUFFER;\n\n    return {\n      isValid: expiresIn > 0,\n      expiresIn,\n      needsRefresh\n    };\n  }\n\n  // Automatic background token monitoring\n  private static startTokenMonitoring(service: 'spotify' | 'youtube', tokens: ServiceTokens): void {\n    // Clear existing timer\n    const existingTimer = this.refreshTimers.get(service);\n    if (existingTimer) {\n      clearTimeout(existingTimer);\n    }\n\n    const status = this.getTokenStatus(tokens);\n    const timeUntilRefresh = Math.max(0, (status.expiresIn - this.REFRESH_BUFFER) * 1000);\n\n    console.log(`[TokenManager] Starting monitoring for ${service}, refresh in ${Math.round(timeUntilRefresh / 1000)}s`);\n\n    const timer = setTimeout(async () => {\n      console.log(`[TokenManager] Auto-refreshing tokens for ${service}`);\n      const refreshedTokens = await this.refreshTokens(service, tokens.refreshToken);\n      if (refreshedTokens) {\n        await this.storeTokens(service, refreshedTokens);\n        this.notifyListeners(service, this.getTokenStatus(refreshedTokens));\n      } else {\n        console.error(`[TokenManager] Auto-refresh failed for ${service}`);\n        this.notifyListeners(service, { isValid: false, expiresIn: 0, needsRefresh: false });\n      }\n    }, timeUntilRefresh);\n\n    this.refreshTimers.set(service, timer);\n  }\n\n  // Enhanced token refresh with retry mechanism\n  private static async refreshTokens(service: 'spotify' | 'youtube', refreshToken: string): Promise<ServiceTokens | null> {\n    const maxRetries = 3;\n    let lastError: Error | null = null;\n\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        console.log(`[TokenManager] Refreshing ${service} tokens, attempt ${attempt}/${maxRetries}`);\n        \n        let response: Response;\n        \n        if (service === 'spotify') {\n          // Use direct Spotify API with correct credentials\n          console.log('[TokenManager] Refreshing Spotify tokens with credentials:', {\n            clientId: spotifyConfig.clientId ? `${spotifyConfig.clientId.substring(0, 10)}...` : 'MISSING',\n            hasClientSecret: !!spotifyConfig.clientSecret\n          });\n          response = await fetch('https://accounts.spotify.com/api/token', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n            },\n            body: new URLSearchParams({\n              grant_type: 'refresh_token',\n              refresh_token: refreshToken,\n              client_id: spotifyConfig.clientId,\n              client_secret: spotifyConfig.clientSecret\n            }).toString()\n          });\n        } else if (service === 'youtube') {\n          // Use direct Google API with correct credentials\n          console.log('[TokenManager] Refreshing YouTube tokens with credentials:', {\n            clientId: youtubeConfig.clientId ? `${youtubeConfig.clientId.substring(0, 10)}...` : 'MISSING',\n            hasClientSecret: !!youtubeConfig.clientSecret\n          });\n          \n          // Check for missing YouTube client secret\n          if (!youtubeConfig.clientSecret) {\n            throw new Error('YouTube client secret is missing from environment variables. Add VITE_YOUTUBE_CLIENT_SECRET to your .env file.');\n          }\n          \n          response = await fetch('https://oauth2.googleapis.com/token', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n            },\n            body: new URLSearchParams({\n              grant_type: 'refresh_token',\n              refresh_token: refreshToken,\n              client_id: youtubeConfig.clientId,\n              client_secret: youtubeConfig.clientSecret\n            }).toString()\n          });\n        } else {\n          throw new Error(`Unsupported service: ${service}`);\n        }\n\n        if (response.ok) {\n          const data = await response.json();\n          const newTokens: ServiceTokens = {\n            accessToken: data.access_token,\n            refreshToken: data.refresh_token || refreshToken, // Keep old refresh token if new one not provided\n            expiresAt: Math.floor(Date.now() / 1000) + data.expires_in,\n            scope: data.scope\n          };\n\n          console.log(`[TokenManager] Successfully refreshed ${service} tokens`);\n          return newTokens;\n        } else {\n          const errorData = await response.json().catch(() => ({}));\n          const errorMessage = errorData.error || 'Unknown error';\n          \n          // Handle specific error cases\n          if (response.status === 400 && errorMessage === 'invalid_grant') {\n            console.log(`[TokenManager] Invalid grant for ${service}, tokens are permanently invalid`);\n            // Clear tokens immediately for invalid_grant\n            await this.deleteTokens(service);\n            throw new Error(`HTTP ${response.status}: ${errorMessage} - Tokens are permanently invalid`);\n          }\n          \n          if (response.status === 400 && errorMessage === 'invalid_client') {\n            console.log(`[TokenManager] Invalid client error for ${service} - likely corrupted token format, clearing tokens`);\n            // Clear tokens immediately for invalid_client (corrupted token format)\n            await this.deleteTokens(service);\n            throw new Error(`HTTP ${response.status}: ${errorMessage} - Tokens are corrupted and have been cleared`);\n          }\n          \n          throw new Error(`HTTP ${response.status}: ${errorMessage}`);\n        }\n      } catch (error) {\n        lastError = error as Error;\n        console.warn(`[TokenManager] Refresh attempt ${attempt} failed for ${service}:`, error);\n        \n        if (attempt < maxRetries) {\n          // Exponential backoff\n          await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));\n        }\n      }\n    }\n\n    console.error(`[TokenManager] All refresh attempts failed for ${service}:`, lastError);\n    return null;\n  }\n\n  // Public method to refresh tokens\n  static async refreshTokensPublic(service: 'spotify' | 'youtube', refreshToken: string): Promise<ServiceTokens | null> {\n    return this.refreshTokens(service, refreshToken);\n  }\n\n  // Debug method to test token storage and retrieval\n  static async testTokenStorage(service: 'spotify' | 'youtube'): Promise<void> {\n    console.log(`[TokenManager] 🧪 Testing token storage and retrieval for ${service}`);\n    \n    const user = auth.currentUser;\n    if (!user) {\n      console.error('[TokenManager] No authenticated user for test');\n      return;\n    }\n\n    // Test tokens\n    const testTokens: ServiceTokens = {\n      accessToken: 'test_access_token_123',\n      refreshToken: 'test_refresh_token_456',\n      expiresAt: Math.floor(Date.now() / 1000) + 3600 // 1 hour from now\n    };\n\n    console.log(`[TokenManager] 🧪 Storing test tokens...`);\n    await this.storeTokens(service, testTokens);\n\n    console.log(`[TokenManager] 🧪 Retrieving test tokens...`);\n    const retrieved = await this.getTokens(service);\n\n    console.log(`[TokenManager] 🧪 Test results:`, {\n      stored: testTokens,\n      retrieved,\n      matches: retrieved?.accessToken === testTokens.accessToken && \n               retrieved?.refreshToken === testTokens.refreshToken\n    });\n  }\n\n  // Debug method to check current token storage state\n  static async debugTokenStorage(): Promise<void> {\n    const user = auth.currentUser;\n    if (!user) {\n      console.log('[TokenManager] 🔍 No authenticated user');\n      return;\n    }\n\n    console.log(`[TokenManager] 🔍 Debug token storage for user: ${user.uid}`);\n    \n    // Check localStorage\n    const spotifyKey = `${this.LOCAL_STORAGE_PREFIX}spotify`;\n    const youtubeKey = `${this.LOCAL_STORAGE_PREFIX}youtube`;\n    \n    const spotifyLocal = localStorage.getItem(spotifyKey);\n    const youtubeLocal = localStorage.getItem(youtubeKey);\n    \n    console.log(`[TokenManager] 🔍 localStorage contents:`, {\n      spotifyKey,\n      hasSpotifyData: !!spotifyLocal,\n      spotifyDataLength: spotifyLocal?.length || 0,\n      youtubeKey,\n      hasYoutubeData: !!youtubeLocal,\n      youtubeDataLength: youtubeLocal?.length || 0\n    });\n\n    // Check Firestore\n    try {\n      const spotifyFirestore = await this.getTokensFromFirestore('spotify', user.uid);\n      const youtubeFirestore = await this.getTokensFromFirestore('youtube', user.uid);\n      \n      console.log(`[TokenManager] 🔍 Firestore contents:`, {\n        hasSpotifyTokens: !!spotifyFirestore,\n        hasYoutubeTokens: !!youtubeFirestore,\n        spotifyHasRefreshToken: !!spotifyFirestore?.refreshToken,\n        youtubeHasRefreshToken: !!youtubeFirestore?.refreshToken\n      });\n    } catch (error) {\n      console.error(`[TokenManager] 🔍 Error checking Firestore:`, error);\n    }\n  }\n\n  // Manual cleanup function for corrupted tokens\n  static async clearAllCorruptedTokens(): Promise<void> {\n    console.log('[TokenManager] 🧹 Clearing all potentially corrupted tokens...');\n    \n    try {\n      await this.deleteTokens('spotify');\n      console.log('[TokenManager] ✅ Cleared Spotify tokens');\n    } catch (error) {\n      console.warn('[TokenManager] ⚠️ Failed to clear Spotify tokens:', error);\n    }\n    \n    try {\n      await this.deleteTokens('youtube');\n      console.log('[TokenManager] ✅ Cleared YouTube tokens');\n    } catch (error) {\n      console.warn('[TokenManager] ⚠️ Failed to clear YouTube tokens:', error);\n    }\n    \n    console.log('[TokenManager] 🎉 Token cleanup complete! Please reconnect your accounts.');\n  }\n\n  // Token status listeners for UI updates\n  static addTokenListener(service: 'spotify' | 'youtube', callback: (status: TokenStatus) => void): () => void {\n    if (!this.listeners.has(service)) {\n      this.listeners.set(service, new Set());\n    }\n    \n    this.listeners.get(service)!.add(callback);\n    \n    // Return unsubscribe function\n    return () => {\n      this.listeners.get(service)?.delete(callback);\n    };\n  }\n\n  private static notifyListeners(service: 'spotify' | 'youtube', status: TokenStatus): void {\n    this.listeners.get(service)?.forEach(callback => {\n      try {\n        callback(status);\n      } catch (error) {\n        console.error(`[TokenManager] Error in token listener for ${service}:`, error);\n      }\n    });\n  }\n\n  /**\n   * Delete tokens with Firestore and localStorage cleanup\n   */\n  static async deleteTokens(service: 'spotify' | 'youtube'): Promise<void> {\n    const user = auth.currentUser;\n    if (!user) {\n      console.error('[TokenManager] No authenticated user');\n      return;\n    }\n\n    console.log(`[TokenManager] Deleting ${service} tokens for user:`, user.uid);\n\n    // Delete from localStorage\n    try {\n      const key = `${this.LOCAL_STORAGE_PREFIX}${service}`;\n      localStorage.removeItem(key);\n      console.log(`[TokenManager] ✅ Deleted ${service} tokens from localStorage`);\n    } catch (error) {\n      console.warn(`[TokenManager] Failed to delete ${service} tokens from localStorage:`, error);\n    }\n\n    // Try to delete from Firestore (don't fail if Firestore is down)\n    try {\n      const tokenDoc = doc(db, 'users', user.uid, 'tokens', service);\n      await deleteDoc(tokenDoc);\n      console.log(`[TokenManager] ✅ Deleted ${service} tokens from Firestore`);\n    } catch (error) {\n      console.warn(`[TokenManager] ⚠️ Failed to delete ${service} tokens from Firestore (service may be down):`, error);\n      // Don't throw - localStorage cleanup succeeded\n    }\n  }\n\n  // Legacy method for backward compatibility\n  static clearTokens(service: 'spotify' | 'youtube'): void {\n    console.warn(`[TokenManager] clearTokens is deprecated, use deleteTokens instead`);\n    this.deleteTokens(service).catch((error: any) => {\n      console.error(`[TokenManager] Error in clearTokens for ${service}:`, error);\n    });\n  }\n\n  // Get current token status for UI\n  static async getCurrentTokenStatus(service: 'spotify' | 'youtube'): Promise<TokenStatus | null> {\n    const tokens = await this.getTokens(service);\n    if (!tokens) {\n      return null;\n    }\n    return this.getTokenStatus(tokens);\n  }\n\n  // Check if valid tokens exist for a service\n  static async hasValidTokens(service: 'spotify' | 'youtube'): Promise<boolean> {\n    const tokens = await this.getTokens(service);\n    if (!tokens) {\n      return false;\n    }\n    const status = this.getTokenStatus(tokens);\n    return status.isValid;\n  }\n\n  // Initialize monitoring for all services\n  static async initializeMonitoring(): Promise<void> {\n    const services: ('spotify' | 'youtube')[] = ['spotify', 'youtube'];\n    \n    for (const service of services) {\n      const tokens = await this.getTokens(service);\n      if (tokens) {\n        this.startTokenMonitoring(service, tokens);\n      }\n    }\n  }\n}\n\n// Expose debug methods globally for testing\nif (typeof window !== 'undefined') {\n  (window as any).TokenManagerDebug = {\n    testStorage: TokenManager.testTokenStorage,\n    debugStorage: TokenManager.debugTokenStorage,\n    getTokens: TokenManager.getTokens,\n    clearCorruptedTokens: TokenManager.clearAllCorruptedTokens\n  };\n}\n\nexport default TokenManager; ","import { db as firebaseDb } from './firebase';\nimport { doc, setDoc, getDoc, Firestore } from 'firebase/firestore';\nimport { spotifyConfig } from './env';\n// import { getSpotifyToken, getSpotifyTokenSync } from './spotifyAuth';\nimport TokenManager from './tokenManager';\n\n// Type assertion for Firestore db\nconst db = firebaseDb as Firestore;\n\n// Constants\nconst ENDPOINTS = {\n  AUTH: 'https://accounts.spotify.com/authorize',\n  TOKEN: 'https://accounts.spotify.com/api/token',\n  BASE: 'https://api.spotify.com/v1'\n};\n\nconst SPOTIFY_CONFIG = {\n  CLIENT_ID: spotifyConfig.clientId,\n  CLIENT_SECRET: spotifyConfig.clientSecret,\n  REDIRECT_URI: spotifyConfig.redirectUri,\n  SCOPES: [\n  'user-read-private',\n  'user-read-email',\n  'playlist-read-private',\n    'playlist-read-collaborative',\n    'playlist-modify-public',\n    'playlist-modify-private'\n  ]\n};\n\n// Cache management\nconst CACHE = {\n  DURATION: {\n    PLAYLISTS: 3600000, // 1 hour in milliseconds\n    TRACKS: 3600000,    // 1 hour in milliseconds\n    ARTISTS: 86400000   // 24 hours in milliseconds\n  },\n  KEYS: {\n    PLAYLISTS: 'spotify_playlists_cache',\n    PLAYLISTS_TTL: 'spotify_playlists_cache_ttl',\n    TRACKS_PREFIX: 'spotify_tracks_cache_',\n    TRACKS_TTL_PREFIX: 'spotify_tracks_cache_ttl_',\n    ARTISTS_PREFIX: 'spotify_artist_cache_',\n    ARTISTS_TTL_PREFIX: 'spotify_artist_cache_ttl_',\n    CODE_VERIFIER: 'spotify_code_verifier',\n    TOKEN: 'spotify_access_token',\n    TOKEN_EXPIRES: 'spotify_token_expires_at'\n  }\n};\n\n// Types\nexport interface SpotifyTokens {\n  accessToken: string;\n  refreshToken: string;\n  expiresAt: number;\n}\n\nexport interface SpotifyPlaylist {\n  id: string;\n  name: string;\n  description: string;\n  imageUrl: string;\n  trackCount: number;\n  owner: string;\n  url?: string;\n}\n\nexport interface SpotifyTrack {\n  id: string;\n  name: string;\n  artists: string[];\n  artistIds: string[];\n  artistImages: string[];\n  genres: string[];\n  album: string;\n  duration_ms: number;\n  popularity: number;\n  explicit: boolean;\n  releaseYear: string;\n  searchQuery: string;\n}\n\ninterface SpotifyErrorResponse {\n  error?: {\n    status?: number;\n    message?: string;\n  };\n}\n\n/**\n * Crypto helper functions for PKCE auth flow\n */\nclass CryptoHelper {\n  static generateRandomString(length: number): string {\n  const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  const values = crypto.getRandomValues(new Uint8Array(length));\n  return Array.from(values)\n    .map(x => possible[x % possible.length])\n    .join('');\n  }\n\n  static async sha256(plain: string): Promise<ArrayBuffer> {\n  const encoder = new TextEncoder();\n    const data = encoder.encode(plain);\n    return await crypto.subtle.digest('SHA-256', data);\n  }\n  \n  static base64UrlEncode(buffer: ArrayBuffer): string {\n    return btoa(String.fromCharCode(...new Uint8Array(buffer)))\n    .replace(/=/g, '')\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_');\n  }\n\n  static generateCodeVerifier(): string {\n    return this.generateRandomString(64);\n  }\n\n  static async generateCodeChallenge(verifier: string): Promise<string> {\n    const hashed = await this.sha256(verifier);\n    return this.base64UrlEncode(hashed);\n  }\n}\n\n/**\n * Cache management utility class\n */\nclass CacheManager {\n  static get<T>(key: string): T | null {\n    const data = localStorage.getItem(key);\n    return data ? JSON.parse(data) : null;\n  }\n\n  static set<T>(key: string, data: T): void {\n    localStorage.setItem(key, JSON.stringify(data));\n  }\n\n  static getTtl(key: string): number | null {\n    const ttl = localStorage.getItem(key);\n    return ttl ? Number(ttl) : null;\n  }\n\n  static setTtl(key: string, duration: number): void {\n    localStorage.setItem(key, (Date.now() + duration).toString());\n  }\n\n  static isValid(key: string): boolean {\n    const ttl = this.getTtl(key);\n    return ttl !== null && Date.now() < ttl;\n  }\n\n  static getCached<T>(dataKey: string, ttlKey: string): T | null {\n    if (this.isValid(ttlKey)) {\n      return this.get<T>(dataKey);\n    }\n    return null;\n  }\n\n  static setWithTtl<T>(dataKey: string, ttlKey: string, data: T, duration: number): void {\n    this.set(dataKey, data);\n    this.setTtl(ttlKey, duration);\n  }\n\n  static invalidate(dataKey: string, ttlKey: string): void {\n    localStorage.removeItem(dataKey);\n    localStorage.removeItem(ttlKey);\n  }\n}\n\n/**\n * API request handler with built-in retries and token refresh\n */\nclass SpotifyApiClient {\n  private static readonly MAX_RETRIES = 2;\n  private static readonly REQUEST_TIMEOUT_MS = 15000;\n  private static inFlight = 0;\n  private static readonly MAX_CONCURRENT = 4;\n  private static async acquireSlot() {\n    while (SpotifyApiClient.inFlight >= SpotifyApiClient.MAX_CONCURRENT) {\n      await new Promise(r => setTimeout(r, 50));\n    }\n    SpotifyApiClient.inFlight++;\n  }\n  private static releaseSlot() {\n    SpotifyApiClient.inFlight = Math.max(0, SpotifyApiClient.inFlight - 1);\n  }\n  private static backoffDelay(attempt: number) {\n    return Math.min(2000 * Math.pow(2, attempt), 8000);\n  }\n  public static artistCache: Record<string, any> = {};\n\n  static async request<T>(\n    url: string, \n    options: RequestInit = {}, \n    retryCount = 0\n  ): Promise<T> {\n    console.log(`[DEBUG] SpotifyApiClient.request(${url}) called, retry: ${retryCount}`);\n    await this.acquireSlot();\n    \n    // Try both ways to get a token\n    let accessToken: string | undefined = (await (await import('./spotifyAuth')).getSpotifyTokenSync()) || undefined;\n    if (import.meta.env.DEV) console.log(`[DEBUG] Token from getSpotifyTokenSync():`, accessToken ? 'Found' : 'Not found');\n    \n    if (!accessToken) {\n      if (import.meta.env.DEV) console.log(`[DEBUG] Trying async getSpotifyToken()...`);\n      accessToken = (await (await import('./spotifyAuth')).getSpotifyToken()) || undefined;\n      if (import.meta.env.DEV) console.log(`[DEBUG] Token from getSpotifyToken():`, accessToken ? 'Found' : 'Not found');\n    }\n    \n    if (!accessToken) {\n      console.error(`[DEBUG] No valid Spotify access token available`);\n      this.releaseSlot();\n      throw new Error('No valid Spotify access token available. Please reconnect.');\n    }\n    if (import.meta.env.DEV) console.log(`[DEBUG] Using token: ${accessToken.substring(0, 8)}...`);\n\n    // Ensure headers exist and convert to plain object if it's Headers instance\n    const headers: Record<string, string> = {};\n    \n    // Copy existing headers if any\n    if (options.headers) {\n      if (options.headers instanceof Headers) {\n        options.headers.forEach((value, key) => {\n          headers[key] = value;\n        });\n      } else if (typeof options.headers === 'object') {\n        Object.assign(headers, options.headers);\n      }\n    }\n    \n    // Add authorization header if not explicitly provided\n    if (!Object.keys(headers).some(key => key.toLowerCase() === 'authorization')) {\n      headers['Authorization'] = `Bearer ${accessToken}`;\n    }\n    \n    // Replace the headers in options\n    options.headers = headers;\n    \n    try {\n      console.log(`[DEBUG] Making request to: ${url}`);\n      const controller = new AbortController();\n      const timeout = setTimeout(() => controller.abort(), this.REQUEST_TIMEOUT_MS);\n      const response = await fetch(url, { ...options, signal: controller.signal });\n      clearTimeout(timeout);\n      console.log(`[DEBUG] Response status: ${response.status} ${response.statusText}`);\n      \n      // Handle successful response\n      if (response.ok) {\n        console.log(`[DEBUG] Request successful`);\n        this.releaseSlot();\n        return await response.json();\n      }\n      \n      // Handle token expiration with refresh\n      if (response.status === 401 && retryCount < this.MAX_RETRIES) {\n        console.log(`[DEBUG] Access token expired (401), refreshing...`);\n        \n        try {\n          // Get current tokens from TokenManager\n          const currentTokens = await TokenManager.getTokens('spotify');\n          if (currentTokens?.refreshToken) {\n            // Try to refresh using TokenManager\n            const refreshedTokens = await TokenManager.refreshTokensPublic('spotify', currentTokens.refreshToken);\n            if (refreshedTokens) {\n              console.log(`[DEBUG] Retrying request after token refresh`);\n              // Retry the original request with updated token\n              const result = await SpotifyApiClient.request<T>(url, options, retryCount + 1);\n              this.releaseSlot();\n              return result;\n            }\n          }\n        } catch (refreshError) {\n          console.error(`[DEBUG] Token refresh failed:`, refreshError);\n        }\n      }\n      \n      // If we get a 429 rate limit or 5xx, retry with backoff\n      if ((response.status === 429 || (response.status >= 500 && response.status < 600)) && retryCount < this.MAX_RETRIES) {\n        const delay = this.backoffDelay(retryCount);\n        console.log(`[DEBUG] Rate limited or server error, retrying in ${delay}ms`);\n        await new Promise(resolve => setTimeout(resolve, delay));\n        const result = await SpotifyApiClient.request<T>(url, options, retryCount + 1);\n        this.releaseSlot();\n        return result;\n      }\n      \n      // For other error statuses, throw with detailed message\n      const errorText = await response.text();\n      console.error(`[DEBUG] Request failed: ${response.status} ${response.statusText} - ${errorText}`);\n      this.releaseSlot();\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    } catch (error) {\n      if (error instanceof DOMException && error.name === 'AbortError') {\n        console.error(`[DEBUG] Request timed out after ${this.REQUEST_TIMEOUT_MS}ms`);\n        this.releaseSlot();\n        throw new Error('Request timed out. Please try again.');\n      }\n      this.releaseSlot();\n      throw error;\n    }\n  }\n\n  static async parseErrorResponse(response: Response): Promise<string> {\n    let errorMessage = `HTTP error! Status: ${response.status}`;\n    \n    try {\n      const errorData: SpotifyErrorResponse = await response.json();\n      \n      if (errorData?.error?.message) {\n        errorMessage = `Spotify API Error: ${errorData.error.message}`;\n      } else if (errorData?.error?.status) {\n        // Provide more helpful messages for common error codes\n        switch (errorData.error.status) {\n          case 401:\n            errorMessage = 'Authentication failed. Please reconnect to Spotify.';\n            break;\n          case 403:\n            errorMessage = 'You do not have permission to access this resource.';\n            break;\n          case 404:\n            errorMessage = 'Resource not found. It might be private or deleted.';\n            break;\n          case 429:\n            errorMessage = 'Rate limit exceeded. Please try again later.';\n            break;\n          case 500:\n          case 502:\n          case 503:\n            errorMessage = 'Spotify service is currently unavailable. Please try again later.';\n            break;\n        }\n      }\n    } catch (e) {\n      // If we can't parse the JSON, use the original error\n      console.warn('Failed to parse Spotify error response:', e);\n    }\n    \n    return errorMessage;\n  }\n  \n  /**\n   * Helper method for handling paginated results\n   */\n  static async getPaginated<T>(initialUrl: string, accessToken?: string): Promise<T[]> {\n    let allItems: T[] = [];\n    let nextUrl: string | undefined = initialUrl;\n    \n    while (nextUrl) {\n      try {\n        const options: RequestInit = {\n          headers: {\n            'Content-Type': 'application/json'\n          } as Record<string, string>\n        };\n        \n        // Add authorization if provided\n        if (accessToken) {\n          (options.headers as Record<string, string>)['Authorization'] = `Bearer ${accessToken}`;\n        }\n        \n        const data: { items: T[]; next: string | null } = await this.request<{ items: T[]; next: string | null }>(nextUrl, options);\n        allItems = [...allItems, ...data.items];\n        nextUrl = (data.next === null ? undefined : data.next) as string | undefined;\n      } catch (error) {\n        throw error;\n      }\n    }\n    \n    return allItems;\n  }\n  \n  /**\n   * Get cached artist data or fetch from API\n   */\n  static async getArtistDetails(artistId: string, forceRefresh = false): Promise<any> {\n    // Use in-memory cache first (fastest)\n    if (!forceRefresh && this.artistCache[artistId]) {\n      return this.artistCache[artistId];\n    }\n    \n    // Try persistent cache next\n    const cacheKey = `${CACHE.KEYS.ARTISTS_PREFIX}${artistId}`;\n    const cacheTtlKey = `${CACHE.KEYS.ARTISTS_TTL_PREFIX}${artistId}`;\n    \n    if (!forceRefresh) {\n      const cachedData = CacheManager.getCached<any>(cacheKey, cacheTtlKey);\n      if (cachedData) {\n        // Update in-memory cache\n        this.artistCache[artistId] = cachedData;\n        return cachedData;\n      }\n    }\n    \n    // Fetch from API\n    try {\n      const data = await this.request<any>(`${ENDPOINTS.BASE}/artists/${artistId}`);\n      \n      // Process artist data\n      const processedData = {\n        ...data,\n        // Get the highest quality image available\n        images: data.images?.sort((a: any, b: any) => b.width - a.width) || [],\n        // Add a direct image URL for easier access\n        imageUrl: data.images?.length > 0 ? data.images[0].url : null\n      };\n      \n      // Save to both caches\n      this.artistCache[artistId] = processedData;\n      CacheManager.setWithTtl(cacheKey, cacheTtlKey, processedData, CACHE.DURATION.ARTISTS);\n      \n      return processedData;\n    } catch (error) {\n      console.error(`Error fetching artist ${artistId}:`, error);\n      return null; // Return null instead of throwing to avoid cascading failures\n    }\n  }\n}\n\n/**\n * Authorization code flow with PKCE\n */\nexport class SpotifyAuth {\n  /**\n   * Generate the Spotify authorization URL with PKCE\n   */\n  static async getAuthUrl(): Promise<string> {\n    const codeVerifier = CryptoHelper.generateCodeVerifier();\n    localStorage.setItem(CACHE.KEYS.CODE_VERIFIER, codeVerifier);\n    \n    // Generate code challenge using S256 method (more secure)\n    const codeChallenge = await CryptoHelper.generateCodeChallenge(codeVerifier);\n  \n  const params = new URLSearchParams({\n      client_id: SPOTIFY_CONFIG.CLIENT_ID,\n    response_type: 'code',\n      redirect_uri: SPOTIFY_CONFIG.REDIRECT_URI,\n      scope: SPOTIFY_CONFIG.SCOPES.join(' '),\n      code_challenge_method: 'S256',\n      code_challenge: codeChallenge,\n    show_dialog: 'true'\n  });\n  \n    return `${ENDPOINTS.AUTH}?${params.toString()}`;\n  }\n\n/**\n * Exchange authorization code for access token using PKCE\n */\n  static async getAccessToken(code: string): Promise<any> {\n    const codeVerifier = localStorage.getItem(CACHE.KEYS.CODE_VERIFIER);\n  \n  if (!codeVerifier) {\n    throw new Error('Code verifier not found. Please try authenticating again.');\n  }\n  \n    const authString = btoa(`${SPOTIFY_CONFIG.CLIENT_ID}:${SPOTIFY_CONFIG.CLIENT_SECRET}`);\n  \n  const params = new URLSearchParams({\n    grant_type: 'authorization_code',\n    code,\n      redirect_uri: SPOTIFY_CONFIG.REDIRECT_URI,\n    code_verifier: codeVerifier\n  });\n  \n    const response = await fetch(ENDPOINTS.TOKEN, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Authorization': `Basic ${authString}`\n      },\n      body: params.toString()\n    });\n    \n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      console.error('Spotify token error response:', errorData);\n      throw new Error(`Authentication failed: ${response.status}`);\n    }\n    \n    const data = await response.json();\n    \n    // Store the token with expiration\n    localStorage.setItem(CACHE.KEYS.TOKEN, data.access_token);\n    localStorage.setItem(CACHE.KEYS.TOKEN_EXPIRES, \n                         (Date.now() + (data.expires_in * 1000)).toString());\n    \n    return data;\n  }\n\n/**\n * Save Spotify tokens to Firestore for a user\n */\n  static async saveTokens(userId: string, tokens: any): Promise<void> {\n  try {\n    await setDoc(doc(db, 'users', userId, 'tokens', 'spotify'), {\n      accessToken: tokens.access_token,\n      refreshToken: tokens.refresh_token,\n      expiresAt: Date.now() + tokens.expires_in * 1000,\n    });\n  } catch (error) {\n    console.error('Error saving Spotify tokens:', error);\n    throw error;\n  }\n  }\n\n/**\n * Get Spotify tokens from Firestore for a user\n */\n  static async getTokens(userId: string): Promise<SpotifyTokens> {\n  try {\n    const docSnap = await getDoc(doc(db, 'users', userId, 'tokens', 'spotify'));\n    \n    if (docSnap.exists()) {\n      const data = docSnap.data();\n      \n      // Check if token is expired and needs refresh\n      if (data.expiresAt < Date.now()) {\n          return await this.refreshToken(userId, data.refreshToken);\n      }\n      \n      return {\n        accessToken: data.accessToken,\n        refreshToken: data.refreshToken,\n        expiresAt: data.expiresAt\n      };\n    }\n    \n    throw new Error('No Spotify tokens found');\n  } catch (error) {\n      // Don't log permission errors during initial setup\n    if (!(error instanceof Error && error.message.includes('Missing or insufficient permissions'))) {\n      console.error('Error getting Spotify tokens:', error);\n    }\n    throw error;\n  }\n  }\n\n/**\n * Refresh Spotify access token\n */\n  static async refreshToken(userId: string, refreshToken: string): Promise<SpotifyTokens> {\n  const params = new URLSearchParams({\n    grant_type: 'refresh_token',\n    refresh_token: refreshToken,\n      client_id: SPOTIFY_CONFIG.CLIENT_ID,\n  });\n    \n    const authString = btoa(`${SPOTIFY_CONFIG.CLIENT_ID}:${SPOTIFY_CONFIG.CLIENT_SECRET}`);\n  \n  try {\n      const response = await fetch(ENDPOINTS.TOKEN, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n          'Authorization': `Basic ${authString}`\n      },\n      body: params.toString()\n    });\n    \n    if (!response.ok) {\n        throw new Error(`Token refresh failed: ${response.status}`);\n    }\n    \n    const data = await response.json();\n    \n      // Maintain the previous refresh token if a new one isn't provided\n      const newRefreshToken = data.refresh_token || refreshToken;\n      \n      // Calculate the expiration time\n      const expiresAt = Date.now() + data.expires_in * 1000;\n      \n      // Store in localStorage for getSpotifyTokenSync\n      localStorage.setItem(CACHE.KEYS.TOKEN, data.access_token);\n      localStorage.setItem(CACHE.KEYS.TOKEN_EXPIRES, expiresAt.toString());\n      \n      // Save to Firestore\n    await setDoc(doc(db, 'users', userId, 'tokens', 'spotify'), {\n      accessToken: data.access_token,\n        refreshToken: newRefreshToken,\n        expiresAt\n    });\n    \n    return {\n      accessToken: data.access_token,\n        refreshToken: newRefreshToken,\n        expiresAt\n    };\n  } catch (error) {\n    console.error('Error refreshing Spotify token:', error);\n    throw error;\n  }\n  }\n}\n\n/**\n * Spotify API service for user data and playlists\n */\nexport class SpotifyService {\n  private static searchCache: Map<string, any> = new Map();\n  private static SEARCH_CACHE_MAX = 200;\n  private static lastSearchAt = 0;\n  private static MIN_SEARCH_INTERVAL_MS = 150;\n  private static getSearchCacheKey(query: string, limit: number) {\n    return `${query.trim().toLowerCase()}::${limit}`;\n  }\n  /**\n   * Get user's Spotify profile\n   */\n  static async getProfile(): Promise<any> {\n    return SpotifyApiClient.request(`${ENDPOINTS.BASE}/me`);\n  }\n\n  /**\n   * Get user's Spotify playlists with caching\n   */\n  static async getPlaylists(forceRefresh = false): Promise<any> {\n    // Use cache if available and not forcing refresh\n    if (!forceRefresh) {\n      const cached = CacheManager.getCached<any>(\n        CACHE.KEYS.PLAYLISTS, \n        CACHE.KEYS.PLAYLISTS_TTL\n      );\n      \n      if (cached) {\n        console.log('Using cached Spotify playlists');\n        return cached;\n      }\n    }\n    \n    console.log('Fetching Spotify playlists from API');\n    const data = await SpotifyApiClient.request<any>(\n      `${ENDPOINTS.BASE}/me/playlists?limit=50`\n    );\n    \n    // Cache successful results\n    CacheManager.setWithTtl(\n      CACHE.KEYS.PLAYLISTS,\n      CACHE.KEYS.PLAYLISTS_TTL,\n      data,\n      CACHE.DURATION.PLAYLISTS\n    );\n    \n    return data;\n  }\n\n/**\n * Get tracks from a Spotify playlist\n */\n  static async getPlaylistTracks(playlistId: string, forceRefresh = false): Promise<any[]> {\n    // Check input\n    if (!playlistId || typeof playlistId !== 'string') {\n      throw new Error('Invalid playlist ID');\n    }\n    \n    // Sanitize playlist ID (remove any URL parts)\n    const cleanPlaylistId = playlistId.split(/[/?#]/)[0];\n    \n    // Use cache if available and not forcing refresh\n    const cacheKey = `${CACHE.KEYS.TRACKS_PREFIX}${cleanPlaylistId}`;\n    const cacheTtlKey = `${CACHE.KEYS.TRACKS_TTL_PREFIX}${cleanPlaylistId}`;\n    \n    if (!forceRefresh) {\n      const cached = CacheManager.getCached<any[]>(cacheKey, cacheTtlKey);\n      if (cached) {\n        console.log('Using cached Spotify tracks for playlist:', cleanPlaylistId);\n        return cached;\n      }\n    }\n    \n    // Use pagination helper to get all tracks\n    const tracksEndpoint = `${ENDPOINTS.BASE}/playlists/${cleanPlaylistId}/tracks?limit=100`;\n    const allTracks = await SpotifyApiClient.getPaginated<any>(tracksEndpoint);\n    \n    if (allTracks.length === 0) {\n      throw new Error('No tracks found in this playlist. It might be empty or you may not have access to it.');\n    }\n    \n    // Cache valid results\n    CacheManager.setWithTtl(cacheKey, cacheTtlKey, allTracks, CACHE.DURATION.TRACKS);\n    \n    return allTracks;\n  }\n\n  /**\n   * Extract and enrich track data for matching and insights\n   */\n  static async extractTrackData(spotifyTracks: any[]): Promise<SpotifyTrack[]> {\n    // Process in parallel with limit (to avoid rate limiting)\n    const BATCH_SIZE = 5;\n    const results: SpotifyTrack[] = [];\n    \n    for (let i = 0; i < spotifyTracks.length; i += BATCH_SIZE) {\n      const batch = spotifyTracks.slice(i, i + BATCH_SIZE);\n      const batchPromises = batch.map(async (item) => {\n        try {\n          const track = item.track;\n          if (!track || !track.id) {\n            console.warn('Invalid track data:', item);\n            return null;\n          }\n          \n          // Create basic track data first\n          const basicTrack: SpotifyTrack = {\n            id: track.id,\n            name: track.name,\n            artists: track.artists.map((artist: any) => artist.name),\n            artistIds: track.artists.map((artist: any) => artist.id),\n            artistImages: [],\n            genres: [],\n            album: track.album.name,\n            duration_ms: track.duration_ms,\n            popularity: track.popularity,\n            explicit: track.explicit,\n            releaseYear: track.album && track.album.release_date ? track.album.release_date.slice(0, 4) : '',\n            searchQuery: `${track.name} ${track.artists.map((a: any) => a.name).join(' ')}`\n          };\n          \n          // Try to enrich with artist details, but don't fail if it doesn't work\n          try {\n            const artistIds = track.artists.map((artist: any) => artist.id);\n            const artistPromises = artistIds.map((id: string) => \n              SpotifyApiClient.getArtistDetails(id).catch(err => {\n                console.warn(`Failed to get artist details for ${id}:`, err);\n                return null;\n              })\n            );\n            \n            // Process artists in parallel with timeout\n            const timeoutPromise = new Promise<any[]>((_, reject) => \n              setTimeout(() => reject(new Error('Artist details request timed out')), 10000)\n            );\n            \n            const artistsData = await Promise.race([\n              Promise.all(artistPromises),\n              timeoutPromise\n            ]);\n            \n            // Collect genres and images from artist data\n            const genres: string[] = [];\n            const artistImages: string[] = [];\n            \n            artistsData.forEach(artist => {\n              if (artist) {\n                if (artist.genres && artist.genres.length) {\n                  genres.push(...artist.genres);\n                }\n                if (artist.images && artist.images.length) {\n                  artistImages.push(artist.images[0].url);\n                }\n              }\n            });\n            \n            // Update the track with enriched data\n            basicTrack.artistImages = artistImages;\n            basicTrack.genres = Array.from(new Set(genres)); // Remove duplicates\n          } catch (artistError) {\n            console.warn('Failed to enrich track with artist details:', artistError);\n            // Continue with basic track data\n          }\n          \n          return basicTrack;\n        } catch (error) {\n          console.error('Error processing track:', error);\n          return null;\n        }\n      });\n      \n      const batchResults = await Promise.all(batchPromises);\n      results.push(...batchResults.filter(Boolean) as SpotifyTrack[]);\n    }\n    \n    return results;\n  }\n\n  /**\n   * Get a single Spotify playlist by ID\n   */\n  static async getPlaylistById(playlistId: string): Promise<SpotifyPlaylist> {\n    const data = await SpotifyApiClient.request<any>(\n      `${ENDPOINTS.BASE}/playlists/${playlistId}`\n    );\n    \n    return {\n      id: data.id,\n      name: data.name,\n      description: data.description || '',\n      imageUrl: data.images && data.images[0] ? data.images[0].url : '',\n      trackCount: data.tracks ? data.tracks.total : 0,\n      owner: data.owner ? data.owner.display_name : '',\n      url: data.external_urls?.spotify\n    };\n  }\n\n  /**\n   * Create a new Spotify playlist\n   */\n  static async createPlaylist(\n    name: string, \n    description: string = '', \n    isPublic: boolean = false\n  ): Promise<SpotifyPlaylist> {\n    // Get the user's Spotify ID\n    const profile = await SpotifyService.getProfile();\n    const userId = profile.id;\n    \n    const response = await SpotifyApiClient.request<SpotifyPlaylist>(\n      `${ENDPOINTS.BASE}/users/${userId}/playlists`,\n      {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          name,\n          description,\n          public: isPublic\n        })\n      }\n    );\n    \n    return response;\n  }\n\n  /**\n   * Search for tracks on Spotify\n   */\n  static async searchTracks(query: string, limit: number = 5): Promise<any> {\n    const cacheKey = SpotifyService.getSearchCacheKey(query, limit);\n    if (SpotifyService.searchCache.has(cacheKey)) {\n      return SpotifyService.searchCache.get(cacheKey);\n    }\n\n    // Throttle rapid searches to avoid 429\n    const now = Date.now();\n    const elapsed = now - SpotifyService.lastSearchAt;\n    if (elapsed < SpotifyService.MIN_SEARCH_INTERVAL_MS) {\n      await new Promise(r => setTimeout(r, SpotifyService.MIN_SEARCH_INTERVAL_MS - elapsed));\n    }\n\n    const params = new URLSearchParams({\n      q: query,\n      type: 'track',\n      limit: limit.toString(),\n      market: 'US' // You might want to make this configurable\n    });\n    \n    let response: any;\n    try {\n      response = await SpotifyApiClient.request<any>(\n        `${ENDPOINTS.BASE}/search?${params.toString()}`\n      );\n    } catch (err: any) {\n      // Simple backoff on 429/rate errors\n      const msg = String(err?.message || err);\n      if (msg.includes('429') || msg.toLowerCase().includes('rate')) {\n        await new Promise(r => setTimeout(r, 500));\n        response = await SpotifyApiClient.request<any>(\n          `${ENDPOINTS.BASE}/search?${params.toString()}`\n        );\n      } else {\n        throw err;\n      }\n    }\n    SpotifyService.lastSearchAt = Date.now();\n    \n    // cache result\n    SpotifyService.searchCache.set(cacheKey, response);\n    if (SpotifyService.searchCache.size > SpotifyService.SEARCH_CACHE_MAX) {\n      const iterator = SpotifyService.searchCache.keys().next();\n      if (!iterator.done && iterator.value) {\n        SpotifyService.searchCache.delete(iterator.value as string);\n      }\n    }\n    return response;\n  }\n\n  /**\n   * Add tracks to a Spotify playlist in optimized batches\n   */\n  static async addTracksToPlaylist(playlistId: string, trackUris: string[]): Promise<boolean> {\n    // Validate inputs\n    if (!playlistId) {\n      throw new Error('Invalid playlist ID');\n    }\n    \n    if (!trackUris || !trackUris.length) {\n      console.warn('No tracks to add');\n      return true;\n    }\n    \n    // Add tracks in batches of 100 (Spotify API limit)\n    const batchSize = 100;\n    const totalBatches = Math.ceil(trackUris.length / batchSize);\n    \n    for (let i = 0; i < trackUris.length; i += batchSize) {\n      const batchNumber = Math.floor(i / batchSize) + 1;\n      console.log(`Adding tracks batch ${batchNumber}/${totalBatches}`);\n      \n      const batch = trackUris.slice(i, i + batchSize);\n      \n      await SpotifyApiClient.request(\n        `${ENDPOINTS.BASE}/playlists/${playlistId}/tracks`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            uris: batch\n          })\n        }\n      );\n      \n      // Add a small delay between batches to avoid rate limits\n      if (batchNumber < totalBatches) {\n        await new Promise(resolve => setTimeout(resolve, 100));\n      }\n    }\n    \n    return true;\n  }\n  \n  /**\n   * Clear cache for this service\n   */\n  static clearCache(): void {\n    // Clear playlist cache\n    CacheManager.invalidate(CACHE.KEYS.PLAYLISTS, CACHE.KEYS.PLAYLISTS_TTL);\n    \n    // Clear track caches (using prefix pattern matching)\n    Object.keys(localStorage).forEach(key => {\n      if (key.startsWith(CACHE.KEYS.TRACKS_PREFIX) || \n          key.startsWith(CACHE.KEYS.TRACKS_TTL_PREFIX) ||\n          key.startsWith(CACHE.KEYS.ARTISTS_PREFIX) ||\n          key.startsWith(CACHE.KEYS.ARTISTS_TTL_PREFIX)) {\n        localStorage.removeItem(key);\n      }\n    });\n    \n    // Clear in-memory artist cache\n    (SpotifyApiClient as any).artistCache = {};\n    \n    console.log('Spotify caches cleared');\n  }\n\n  /**\n   * Find an existing user playlist by exact name\n   */\n  static async findUserPlaylistByName(name: string): Promise<SpotifyPlaylist | null> {\n    const data = await SpotifyApiClient.request<any>(`${ENDPOINTS.BASE}/me/playlists?limit=50`);\n    const match = (data.items || []).find((p: any) => (p?.name || '').trim().toLowerCase() === name.trim().toLowerCase());\n    if (!match) return null;\n    return {\n      id: match.id,\n      name: match.name,\n      description: match.description || '',\n      imageUrl: match.images && match.images[0] ? match.images[0].url : '',\n      trackCount: match.tracks ? match.tracks.total : 0,\n      owner: match.owner ? match.owner.display_name : ''\n    } as SpotifyPlaylist;\n  }\n}\n\n// Backward compatibility exports\nexport const getSpotifyAuthUrl = async (): Promise<string> => {\n  return SpotifyAuth.getAuthUrl();\n};\n\nexport const getSpotifyAccessToken = SpotifyAuth.getAccessToken;\nexport const saveSpotifyTokens = SpotifyAuth.saveTokens;\nexport const getSpotifyTokens = SpotifyAuth.getTokens;\nexport const refreshSpotifyToken = SpotifyAuth.refreshToken;\nexport const getSpotifyProfile = SpotifyService.getProfile;\nexport const getSpotifyPlaylists = async (accessToken: string): Promise<SpotifyPlaylist[]> => {\n  try {\n    const response = await fetch('https://api.spotify.com/v1/me/playlists?limit=50', {\n      headers: {\n        'Authorization': `Bearer ${accessToken}`,\n        'Content-Type': 'application/json'\n      }\n    });\n\n    if (!response.ok) {\n      if (response.status === 401) {\n        console.log('Spotify token expired in getSpotifyPlaylists, attempting refresh...');\n        \n        // Try to refresh the token\n        const tokens = await TokenManager.getTokens('spotify');\n        if (tokens) {\n          const refreshedTokens = await TokenManager.refreshTokensPublic('spotify', tokens.refreshToken);\n          if (refreshedTokens) {\n            // Retry with refreshed token\n            const retryResponse = await fetch('https://api.spotify.com/v1/me/playlists?limit=50', {\n              headers: {\n                'Authorization': `Bearer ${refreshedTokens.accessToken}`,\n                'Content-Type': 'application/json'\n              }\n            });\n            \n            if (!retryResponse.ok) {\n              if (retryResponse.status === 401) {\n                // Refresh failed, clear tokens\n                await TokenManager.deleteTokens('spotify');\n                throw new Error('Your Spotify session has expired. Please reconnect your Spotify account.');\n              } else if (retryResponse.status === 403) {\n                throw new Error('You do not have permission to access Spotify playlists. Please check your account settings and try reconnecting.');\n              } else {\n                throw new Error(`Failed to fetch playlists: ${retryResponse.status} ${retryResponse.statusText}`);\n              }\n            }\n            \n            const data = await retryResponse.json();\n            return data.items || [];\n          } else {\n            // Refresh failed, clear tokens\n            await TokenManager.deleteTokens('spotify');\n            throw new Error('Your Spotify session has expired. Please reconnect your Spotify account.');\n          }\n        } else {\n          throw new Error('Your Spotify session has expired. Please reconnect your Spotify account.');\n        }\n      } else if (response.status === 403) {\n        throw new Error('You do not have permission to access Spotify playlists. Please check your account settings and try reconnecting.');\n      } else {\n        throw new Error(`Failed to fetch playlists: ${response.status} ${response.statusText}`);\n      }\n    }\n\n    const data = await response.json();\n    return data.items || [];\n  } catch (error) {\n    console.error('Error fetching Spotify playlists:', error);\n    throw error;\n  }\n};\nexport const getSpotifyPlaylistTracks = SpotifyService.getPlaylistTracks;\nexport const extractTrackData = SpotifyService.extractTrackData;\nexport const createSpotifyPlaylist = SpotifyService.createPlaylist;\nexport const addTracksToSpotifyPlaylist = SpotifyService.addTracksToPlaylist;\nexport const getSpotifyPlaylistById = SpotifyService.getPlaylistById;\nexport const searchSpotifyTracks = SpotifyService.searchTracks;\nexport const findUserPlaylistByName = SpotifyService.findUserPlaylistByName;\nexport const generateCodeVerifier = CryptoHelper.generateCodeVerifier.bind(CryptoHelper);\nexport const generateCodeChallenge = CryptoHelper.generateCodeChallenge.bind(CryptoHelper);\nexport const saveCodeVerifier = (codeVerifier: string): void => {\n  localStorage.setItem(CACHE.KEYS.CODE_VERIFIER, codeVerifier);\n};\nexport const getCodeVerifier = (): string | null => {\n  return localStorage.getItem(CACHE.KEYS.CODE_VERIFIER);\n}; \n\nexport const ensureSpotifyToken = async (): Promise<string | null> => {\n  const { getSpotifyToken } = await import('./spotifyAuth');\n  return getSpotifyToken();\n};\n\nexport const ensureSpotifyTokenSync = async (): Promise<string | null> => {\n  const { getSpotifyTokenSync } = await import('./spotifyAuth');\n  return getSpotifyTokenSync();\n}; ","import { config } from './config';\n\n// YouTube API base URL\nconst YOUTUBE_API_BASE_URL = 'https://www.googleapis.com/youtube/v3';\n\nconst YOUTUBE_AUTH_STORAGE_KEY = 'youtube_auth_state';\nconst YOUTUBE_TOKEN_STORAGE_KEY = 'youtube_tokens';\n\ninterface YouTubeTokens {\n  access_token: string;\n  refresh_token: string;\n  expiry_date: number;\n}\n\n// Helper function to extract detailed error information from YouTube API responses\nconst extractYouTubeErrorDetails = async (response: Response): Promise<string> => {\n  try {\n    const errorData = await response.json();\n    console.error('YouTube API error details:', errorData);\n    \n    // Handle specific YouTube API error types\n    if (errorData.error?.errors) {\n      const errors = errorData.error.errors;\n      const errorMessages = errors.map((err: any) => {\n        switch (err.reason) {\n          case 'quotaExceeded':\n            return 'YouTube API quota exceeded. Please try again later.';\n          case 'dailyLimitExceeded':\n            return 'YouTube API daily limit exceeded. Please try again tomorrow.';\n          case 'userRateLimitExceeded':\n            return 'YouTube API rate limit exceeded. Please wait a moment and try again.';\n          case 'insufficientPermissions':\n            return 'Insufficient permissions. Please check your YouTube account settings.';\n          case 'invalidCredentials':\n            return 'Invalid YouTube credentials. Please reconnect your YouTube account.';\n          case 'tokenExpired':\n            return 'YouTube authentication expired. Please reconnect your YouTube account.';\n          default:\n            return err.message || 'YouTube API error occurred.';\n        }\n      });\n      return errorMessages.join(' ');\n    }\n    \n    // Fallback error messages based on status code\n    switch (response.status) {\n      case 400:\n        return 'Invalid request to YouTube API. Please try again.';\n      case 401:\n        return 'YouTube authentication expired. Please reconnect your YouTube account.';\n      case 403:\n        return 'YouTube API quota exceeded or insufficient permissions. Please try again later.';\n      case 404:\n        return 'YouTube resource not found. Please check your playlist URL.';\n      case 429:\n        return 'YouTube API rate limit exceeded. Please wait a moment and try again.';\n      case 500:\n        return 'YouTube API server error. Please try again later.';\n      default:\n        return errorData.error?.message || `YouTube API error (${response.status})`;\n    }\n  } catch (parseError) {\n    console.error('Failed to parse YouTube error response:', parseError);\n    return `YouTube API error (${response.status}): ${response.statusText}`;\n  }\n};\n\n/**\n * Get user's YouTube playlists\n */\nexport const getYouTubePlaylists = async (retryCount = 0): Promise<any> => {\n  const maxRetries = 3;\n  const baseDelay = 1000; // 1 second\n  \n  try {\n    const { getYouTubeToken, refreshYouTubeToken } = await import('./youtubeAuth');\n    let accessToken = await getYouTubeToken();\n    \n    if (!accessToken) {\n      // Attempt one refresh cycle before failing\n      const refreshed = await refreshYouTubeToken();\n      if (refreshed) {\n        accessToken = await getYouTubeToken();\n      }\n      if (!accessToken) {\n        console.error('Cannot fetch YouTube playlists: No valid access token');\n        throw new Error('No valid YouTube access token available. Please reconnect your YouTube account from the Connections panel.');\n      }\n    }\n\n    const params = new URLSearchParams({\n      part: 'snippet,status,contentDetails',\n      mine: 'true',\n      maxResults: '50'\n    });\n\n    let response = await fetch(`${YOUTUBE_API_BASE_URL}/playlists?${params.toString()}`, {\n      headers: { 'Authorization': `Bearer ${accessToken}` }\n    });\n\n    if (!response.ok) {\n      const errorMessage = await extractYouTubeErrorDetails(response);\n      console.error(`YouTube playlists error (${response.status}):`, errorMessage);\n      \n      // Handle specific error types\n      if (response.status === 401) {\n        // Try a single token refresh on unauthorized\n        const refreshed = await refreshYouTubeToken();\n        if (refreshed) {\n          const newToken = await getYouTubeToken();\n          if (newToken) {\n            response = await fetch(`${YOUTUBE_API_BASE_URL}/playlists?${params.toString()}`, {\n              headers: { 'Authorization': `Bearer ${newToken}` }\n            });\n            if (response.ok) {\n              const data = await response.json();\n              console.log('YouTube playlists fetched successfully (after refresh)');\n              return data;\n            }\n          }\n        }\n        throw new Error('YouTube authentication expired. Please reconnect your YouTube account.');\n      } else if (response.status === 403) {\n        throw new Error('YouTube API quota exceeded. Please try again later or check your YouTube account permissions.');\n      } else if (response.status === 429 && retryCount < maxRetries) {\n        // Rate limit exceeded, retry with exponential backoff\n        const delay = baseDelay * Math.pow(2, retryCount);\n        console.log(`YouTube API rate limited, retrying in ${delay}ms (attempt ${retryCount + 1}/${maxRetries})`);\n        await new Promise(resolve => setTimeout(resolve, delay));\n        return getYouTubePlaylists(retryCount + 1);\n      } else {\n        throw new Error(errorMessage);\n      }\n    }\n\n    const data = await response.json();\n    console.log('YouTube playlists fetched successfully');\n    return data;\n  } catch (error) {\n    console.error('Error fetching YouTube playlists:', error);\n    \n    // Retry on network errors or 5xx errors\n    if (retryCount < maxRetries && (\n      error instanceof TypeError || // Network error\n      (error instanceof Error && error.message.includes('fetch')) ||\n      (error instanceof Error && error.message.includes('500'))\n    )) {\n      const delay = baseDelay * Math.pow(2, retryCount);\n      console.log(`Retrying YouTube playlists fetch in ${delay}ms (attempt ${retryCount + 1}/${maxRetries})`);\n      await new Promise(resolve => setTimeout(resolve, delay));\n      return getYouTubePlaylists(retryCount + 1);\n    }\n    \n    throw error;\n  }\n};\n\n/**\n * Fetch all tracks from a YouTube playlist\n */\nexport const fetchAllYouTubePlaylistItems = async (playlistId: string, accessToken: string) => {\n  try {\n    console.log('Fetching YouTube playlist items for playlist:', playlistId);\n    \n    const allItems: any[] = [];\n    let nextPageToken: string | undefined;\n    \n    do {\n      const params = new URLSearchParams({\n        part: 'snippet,contentDetails',\n        playlistId: playlistId,\n        maxResults: '50'\n      });\n      \n      if (nextPageToken) {\n        params.append('pageToken', nextPageToken);\n      }\n      \n      const response = await fetch(`${YOUTUBE_API_BASE_URL}/playlistItems?${params.toString()}`, {\n        headers: {\n          'Authorization': `Bearer ${accessToken}`\n        }\n      });\n      \n      if (!response.ok) {\n        const errorMessage = await extractYouTubeErrorDetails(response);\n        throw new Error(errorMessage);\n      }\n      \n      const data = await response.json();\n      \n      if (data.items && data.items.length > 0) {\n        allItems.push(...data.items);\n      }\n      \n      nextPageToken = data.nextPageToken;\n    } while (nextPageToken);\n    \n    console.log('Fetched YouTube playlist items:', allItems.length);\n    return allItems;\n  } catch (error: unknown) {\n    console.error('Error fetching YouTube playlist items:', error);\n    throw error instanceof Error ? error : new Error(String(error));\n  }\n};\n\n/**\n * Find an existing playlist with the same title or create a new one\n */\nexport const findOrCreatePlaylist = async (_userId: string, title: string, description: string, privacyStatus: 'public' | 'private' | 'unlisted' = 'private') => {\n  try {\n    // First, try to find an existing playlist with the same title\n    const accessToken = await ensureYouTubeToken();\n    \n    if (!accessToken) {\n      console.error('Cannot create YouTube playlist: No valid access token');\n      throw new Error('No valid YouTube access token available. Please reconnect your YouTube account.');\n    }\n    \n    // For now, we'll just create a new playlist\n    // In the future, we could search for existing playlists with the same title\n    const playlist = await createYouTubePlaylist(_userId, title, description, privacyStatus);\n    return playlist;\n  } catch (error) {\n    console.error('Error finding or creating playlist:', error);\n    throw error;\n  }\n};\n\n/**\n * Search YouTube for a track\n */\nexport const searchYouTube = async (_userId: string, query: string) => {\n  // Check if we should use mock data\n  const useMockData = localStorage.getItem('use_mock_youtube_data') === 'true';\n  \n  if (useMockData) {\n    console.log(`Using mock data for YouTube search: \"${query}\"`);\n    return generateMockSearchResults(query);\n  }\n  \n  try {\n    let accessToken = await ensureYouTubeToken();\n    \n    if (!accessToken) {\n      const refreshed = await ensureYouTubeRefresh();\n      if (refreshed) {\n        accessToken = await ensureYouTubeToken();\n      }\n      if (!accessToken) {\n        console.error('Cannot search YouTube: No valid access token');\n        throw new Error('No valid YouTube access token available. Please reconnect your YouTube account.');\n      }\n    }\n    \n    // Log the search being performed\n    console.log(`Searching YouTube for: \"${query}\"`);\n    \n    const params = new URLSearchParams({\n      part: 'snippet',\n      q: query,\n      type: 'video',\n      maxResults: '5',\n      videoEmbeddable: 'true',\n      videoSyndicated: 'true'\n    });\n    \n    // Make the API request with a timeout to prevent hanging\n    const abortController = new AbortController();\n    const timeoutId = setTimeout(() => abortController.abort(), 10000); // 10 second timeout\n    \n    try {\n      let response = await fetch(`${YOUTUBE_API_BASE_URL}/search?${params.toString()}`, {\n        headers: {\n          'Authorization': `Bearer ${accessToken}`\n        },\n        signal: abortController.signal\n      });\n      \n      // Clear the timeout since the request completed\n      clearTimeout(timeoutId);\n      \n      // Handle response\n      if (!response.ok) {\n        // On 401, try one refresh and retry\n        if (response.status === 401) {\n          const refreshed = await ensureYouTubeRefresh();\n          if (refreshed) {\n            const newToken = await ensureYouTubeToken();\n            if (newToken) {\n              response = await fetch(`${YOUTUBE_API_BASE_URL}/search?${params.toString()}`, {\n                headers: { 'Authorization': `Bearer ${newToken}` },\n                signal: abortController.signal\n              });\n              if (response.ok) {\n                const data = await response.json();\n                console.log(`YouTube search successful after refresh, found ${data.items?.length || 0} results`);\n                return data;\n              }\n            }\n          }\n        }\n        const errorMessage = await extractYouTubeErrorDetails(response);\n        console.error(`YouTube search error (${response.status}):`, errorMessage);\n        \n        // Check for specific error codes\n        if (response.status === 403) {\n          // Could be quota exceeded or permission issues\n          console.log('Falling back to mock data due to API quota or permission issue');\n          return generateMockSearchResults(query);\n        }\n        \n        throw new Error(errorMessage);\n      }\n      \n      const data = await response.json();\n      console.log(`YouTube search successful, found ${data.items?.length || 0} results`);\n      return data;\n    } catch (fetchError: unknown) {\n      // Clear the timeout in case of error\n      clearTimeout(timeoutId);\n      \n      // Check if this was a timeout or abort\n      if (fetchError instanceof DOMException && fetchError.name === 'AbortError') {\n        console.error('YouTube search request timed out after 10 seconds');\n        throw new Error('YouTube search request timed out. Please try again later.');\n      }\n      \n      // Network errors (like ERR_CONNECTION_CLOSED)\n      if (fetchError instanceof TypeError && 'message' in fetchError && \n          typeof fetchError.message === 'string' && fetchError.message.includes('fetch')) {\n        console.error('Network error during YouTube search:', fetchError);\n        console.log('Falling back to mock data due to network error');\n        return generateMockSearchResults(query);\n      }\n      \n      // Rethrow other errors\n      throw fetchError;\n    }\n  } catch (error) {\n    console.error('Error searching YouTube:', error);\n    \n    // For development, fall back to mock data when errors occur\n    if (process.env.NODE_ENV !== 'production') {\n      console.log('Falling back to mock data in development mode');\n      return generateMockSearchResults(query);\n    }\n    \n    // In production, let the error propagate\n    throw error instanceof Error ? error : new Error(String(error));\n  }\n};\n\n/**\n * Generate mock search results for development and testing\n */\nconst generateMockSearchResults = (query: string) => {\n  // Create a deterministic but fake video ID based on query\n  const hashString = (str: string) => {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash;\n    }\n    return Math.abs(hash).toString(16).padStart(8, '0');\n  };\n  \n  // Parse out artist and track title if possible\n  const parts = query.split('-').map(p => p.trim());\n  const title = parts.length > 1 ? parts[1] : query;\n  const artist = parts.length > 1 ? parts[0] : 'Artist';\n  \n  // Create mock items (3-5 results)\n  const itemCount = 3 + Math.floor(Math.random() * 3);\n  const items = [];\n  \n  for (let i = 0; i < itemCount; i++) {\n    const suffix = i === 0 ? '(Official Video)' : \n                 i === 1 ? '(Lyric Video)' : \n                 i === 2 ? '(Audio)' : \n                 '(Cover)';\n    \n    const videoId = `mock-${hashString(query)}-${i}`;\n    \n    items.push({\n      kind: 'youtube#searchResult',\n      etag: `mock-etag-${videoId}`,\n      id: {\n        kind: 'youtube#video',\n        videoId\n      },\n      snippet: {\n        publishedAt: new Date().toISOString(),\n        channelId: `UC${hashString(artist)}`,\n        title: `${title} ${suffix}`,\n        description: `Mock result for \"${query}\"`,\n        thumbnails: {\n          default: {\n            url: `https://via.placeholder.com/120x90.png?text=${encodeURIComponent(title)}`,\n            width: 120,\n            height: 90\n          },\n          medium: {\n            url: `https://via.placeholder.com/320x180.png?text=${encodeURIComponent(title)}`,\n            width: 320,\n            height: 180\n          },\n          high: {\n            url: `https://via.placeholder.com/480x360.png?text=${encodeURIComponent(title)}`,\n            width: 480,\n            height: 360\n          }\n        },\n        channelTitle: artist,\n        liveBroadcastContent: 'none'\n      }\n    });\n  }\n  \n  return {\n    kind: 'youtube#searchListResponse',\n    etag: `mock-etag-${hashString(query)}`,\n    nextPageToken: 'mockNextPageToken',\n    regionCode: 'US',\n    pageInfo: {\n      totalResults: itemCount,\n      resultsPerPage: itemCount\n    },\n    items,\n    _isMock: true\n  };\n};\n\n/**\n * Create a YouTube playlist\n */\nexport const createYouTubePlaylist = async (_userId: string, title: string, description: string, privacyStatus: 'public' | 'private' | 'unlisted' = 'private') => {\n  try {\n    const accessToken = await ensureYouTubeToken();\n    \n    if (!accessToken) {\n      throw new Error('No valid YouTube access token available. Please reconnect your YouTube account.');\n    }\n    \n    const response = await fetch(`${YOUTUBE_API_BASE_URL}/playlists?part=snippet,status`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${accessToken}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        snippet: {\n          title,\n          description\n        },\n        status: {\n          privacyStatus\n        }\n      })\n    });\n    \n    if (!response.ok) {\n      const errorMessage = await extractYouTubeErrorDetails(response);\n      throw new Error(errorMessage);\n    }\n    \n    return await response.json();\n  } catch (error: unknown) {\n    console.error('Error creating YouTube playlist:', error);\n    // Don't provide mock data, let the error propagate\n    throw error instanceof Error ? error : new Error(String(error));\n  }\n};\n\n/**\n * Add a video to a YouTube playlist\n */\nexport const addToYouTubePlaylist = async (_userId: string, playlistId: string, videoId: string) => {\n  try {\n    const accessToken = await ensureYouTubeToken();\n    \n    if (!accessToken) {\n      console.error('Cannot add to YouTube playlist: No valid access token');\n      throw new Error('No valid YouTube access token available. Please reconnect your YouTube account.');\n    }\n    \n    const response = await fetch(`${YOUTUBE_API_BASE_URL}/playlistItems?part=snippet`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${accessToken}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        snippet: {\n          playlistId: playlistId,\n          resourceId: {\n            kind: 'youtube#video',\n            videoId: videoId\n          }\n        }\n      })\n    });\n\n    if (!response.ok) {\n      const errorMessage = await extractYouTubeErrorDetails(response);\n      console.error(`YouTube add to playlist error (${response.status}):`, errorMessage);\n      throw new Error(errorMessage);\n    }\n\n    const data = await response.json();\n    console.log(`Successfully added video ${videoId} to playlist ${playlistId}`);\n    return data;\n  } catch (error) {\n    console.error('Error adding to YouTube playlist:', error);\n    throw error;\n  }\n};\n\n/**\n * Make a YouTube API request with automatic token refresh and retry logic\n */\nexport const makeYouTubeApiRequest = async (\n  endpoint: string, \n  options: RequestInit = {}, \n  retryCount = 0\n): Promise<Response> => {\n  const maxRetries = 2;\n  \n  try {\n    // Get current access token\n    const accessToken = await ensureYouTubeToken();\n    \n    if (!accessToken) {\n      throw new Error('No valid YouTube access token available. Please reconnect your YouTube account.');\n    }\n    \n    // Add authorization header\n    const requestOptions: RequestInit = {\n      ...options,\n      headers: {\n        'Authorization': `Bearer ${accessToken}`,\n        'Content-Type': 'application/json',\n        ...options.headers\n      }\n    };\n    \n    const response = await fetch(endpoint, requestOptions);\n    \n    // If we get a 401, try to refresh the token and retry\n    if (response.status === 401 && retryCount < maxRetries) {\n      console.log('YouTube API returned 401, attempting token refresh...');\n      \n      const refreshSuccess = await ensureYouTubeRefresh();\n      if (refreshSuccess) {\n        console.log('Token refreshed successfully, retrying request...');\n        return makeYouTubeApiRequest(endpoint, options, retryCount + 1);\n      } else {\n        throw new Error('Failed to refresh YouTube token. Please reconnect your YouTube account.');\n      }\n    }\n    \n    return response;\n  } catch (error) {\n    console.error('YouTube API request failed:', error);\n    throw error;\n  }\n};\n\nexport const generateAuthUrl = () => {\n  const state = Math.random().toString(36).substring(7);\n  localStorage.setItem(YOUTUBE_AUTH_STORAGE_KEY, state);\n\n  const params = new URLSearchParams({\n    client_id: config.youtube.clientId,\n    redirect_uri: config.youtube.redirectUri,\n    response_type: 'code',\n    scope: config.youtube.scope,\n    state: state,\n    access_type: 'offline',\n    prompt: 'consent'\n  });\n\n  return `https://accounts.google.com/o/oauth2/v2/auth?${params.toString()}`;\n};\n\nexport const handleAuthCallback = async (code: string, state: string): Promise<YouTubeTokens> => {\n  const storedState = localStorage.getItem(YOUTUBE_AUTH_STORAGE_KEY);\n  if (state !== storedState) {\n    throw new Error('Invalid state parameter');\n  }\n\n  const params = new URLSearchParams({\n    code,\n    client_id: config.youtube.clientId,\n    client_secret: config.youtube.clientSecret,\n    redirect_uri: config.youtube.redirectUri,\n    grant_type: 'authorization_code'\n  });\n\n  const response = await fetch('https://oauth2.googleapis.com/token', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    },\n    body: params.toString()\n  });\n\n  if (!response.ok) {\n    const error = await response.text();\n    console.error('Token exchange failed:', error);\n    throw new Error(`Token exchange failed: ${response.status}`);\n  }\n\n  const tokens = await response.json();\n  const expiryDate = Date.now() + (tokens.expires_in * 1000);\n  \n  const tokenData: YouTubeTokens = {\n    access_token: tokens.access_token,\n    refresh_token: tokens.refresh_token,\n    expiry_date: expiryDate\n  };\n\n  localStorage.setItem(YOUTUBE_TOKEN_STORAGE_KEY, JSON.stringify(tokenData));\n  return tokenData;\n};\n\nexport const refreshAccessToken = async (refresh_token: string): Promise<YouTubeTokens> => {\n  const params = new URLSearchParams({\n    client_id: config.youtube.clientId,\n    client_secret: config.youtube.clientSecret,\n    refresh_token: refresh_token,\n    grant_type: 'refresh_token'\n  });\n\n  const response = await fetch('https://oauth2.googleapis.com/token', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    },\n    body: params.toString()\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to refresh token');\n  }\n\n  const tokens = await response.json();\n  const expiryDate = Date.now() + (tokens.expires_in * 1000);\n\n  const tokenData: YouTubeTokens = {\n    access_token: tokens.access_token,\n    refresh_token: refresh_token, // Keep the existing refresh token\n    expiry_date: expiryDate\n  };\n\n  localStorage.setItem(YOUTUBE_TOKEN_STORAGE_KEY, JSON.stringify(tokenData));\n  return tokenData;\n};\n\nexport const getStoredTokens = (): YouTubeTokens | null => {\n  const tokens = localStorage.getItem(YOUTUBE_TOKEN_STORAGE_KEY);\n  return tokens ? JSON.parse(tokens) : null;\n};\n\nexport const isTokenExpired = (tokens: YouTubeTokens): boolean => {\n  return Date.now() >= tokens.expiry_date;\n};\n\nexport const clearStoredTokens = () => {\n  localStorage.removeItem(YOUTUBE_TOKEN_STORAGE_KEY);\n  localStorage.removeItem(YOUTUBE_AUTH_STORAGE_KEY);\n}; \n\nexport const ensureYouTubeToken = async (): Promise<string | null> => {\n  const { getYouTubeToken } = await import('./youtubeAuth');\n  return getYouTubeToken();\n};\n\nexport const ensureYouTubeRefresh = async (): Promise<boolean> => {\n  const { refreshYouTubeToken } = await import('./youtubeAuth');\n  return refreshYouTubeToken();\n};\n\nexport const ensureYouTubeLogout = async (): Promise<void> => {\n  const { clearYouTubeAuth } = await import('./youtubeAuth');\n  return clearYouTubeAuth();\n}; ","import { youtubeConfig } from './env';\nimport TokenManager from './tokenManager';\nimport { getAuth } from 'firebase/auth';\nimport { doc, setDoc } from 'firebase/firestore';\nimport { db } from './firebase';\n\n// YouTube OAuth endpoints\nconst YOUTUBE_AUTH_ENDPOINT = 'https://accounts.google.com/o/oauth2/v2/auth';\nconst YOUTUBE_TOKEN_ENDPOINT = 'https://oauth2.googleapis.com/token';\n\n// Fallback configuration if environment variables fail to load\nconst FALLBACK_CONFIG = {\n  clientId: '968024909043-qv0sceqajnebc6m3088eoq519n3epbua.apps.googleusercontent.com',\n  clientSecret: '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',\n  redirectUri: 'https://soundswapp.firebaseapp.com/youtube-callback'\n};\n\n// YouTube API credentials with fallback\nconst YOUTUBE_CLIENT_ID = youtubeConfig.clientId || FALLBACK_CONFIG.clientId;\nconst YOUTUBE_CLIENT_SECRET = youtubeConfig.clientSecret || FALLBACK_CONFIG.clientSecret;\nconst YOUTUBE_REDIRECT_URI = youtubeConfig.redirectUri || FALLBACK_CONFIG.redirectUri;\n\n// Debug YouTube configuration\nconsole.log('[YouTube Auth] Configuration loaded:', {\n  clientId: YOUTUBE_CLIENT_ID ? `${YOUTUBE_CLIENT_ID.substring(0, 10)}...` : 'MISSING',\n  redirectUri: YOUTUBE_REDIRECT_URI,\n  hasClientSecret: !!YOUTUBE_CLIENT_SECRET,\n  usingFallback: !youtubeConfig.clientId\n});\n\n// Log environment variables for debugging\nconsole.log('[YouTube Auth] Environment variables:', {\n  VITE_YOUTUBE_CLIENT_ID: import.meta.env.VITE_YOUTUBE_CLIENT_ID ? `${import.meta.env.VITE_YOUTUBE_CLIENT_ID.substring(0, 10)}...` : 'MISSING',\n  VITE_GOOGLE_CLIENT_ID: import.meta.env.VITE_GOOGLE_CLIENT_ID ? `${import.meta.env.VITE_GOOGLE_CLIENT_ID.substring(0, 10)}...` : 'MISSING',\n  VITE_YOUTUBE_REDIRECT_URI: import.meta.env.VITE_YOUTUBE_REDIRECT_URI || 'MISSING'\n});\n\n// YouTube API scopes\nconst YOUTUBE_SCOPES = [\n  'https://www.googleapis.com/auth/youtube',\n  'https://www.googleapis.com/auth/youtube.readonly',\n  'https://www.googleapis.com/auth/youtube.force-ssl',\n  'https://www.googleapis.com/auth/userinfo.email',\n  'openid',\n  'profile'\n];\n\n// Storage keys\nconst STORAGE_KEYS = {\n  AUTH_STATE: 'youtube_auth_state',\n  RETURN_PATH: 'youtube_auth_return_path',\n  CALLBACK_URL: 'youtube_callback_url'\n};\n\n/**\n * Generate a random state parameter to protect against CSRF attacks\n */\nconst generateStateParam = (): string => {\n  // Generate a random string for state parameter\n  const randomBytes = new Uint8Array(16);\n  window.crypto.getRandomValues(randomBytes);\n  const state = Array.from(randomBytes)\n    .map(byte => byte.toString(16).padStart(2, '0'))\n    .join('');\n  \n  // Save state in localStorage for better persistence\n  localStorage.setItem(STORAGE_KEYS.AUTH_STATE, state);\n  \n  // Also log the state for debugging\n  console.log(\"Generated YouTube auth state:\", state.substring(0, 5) + \"...\");\n  \n  return state;\n};\n\n/**\n * Generate the YouTube authorization URL for Authorization Code Flow\n */\nexport const getYouTubeAuthUrl = (): string => {\n  const state = generateStateParam();\n  \n  console.log('[YouTube Auth] Building auth URL with params:', {\n    client_id: YOUTUBE_CLIENT_ID ? `${YOUTUBE_CLIENT_ID.substring(0, 10)}...` : 'MISSING',\n    redirect_uri: YOUTUBE_REDIRECT_URI,\n    state: state ? `${state.substring(0, 5)}...` : 'MISSING',\n    scope: YOUTUBE_SCOPES.join(' ')\n  });\n  \n  // Validate required parameters before creating URL\n  if (!YOUTUBE_CLIENT_ID) {\n    console.error('[YouTube Auth] CRITICAL ERROR: client_id is missing!');\n    throw new Error('YouTube client_id is not configured. Please check your environment variables.');\n  }\n  \n  if (!YOUTUBE_REDIRECT_URI) {\n    console.error('[YouTube Auth] CRITICAL ERROR: redirect_uri is missing!');\n    throw new Error('YouTube redirect_uri is not configured. Please check your environment variables.');\n  }\n  \n  const params = new URLSearchParams({\n    client_id: YOUTUBE_CLIENT_ID,\n    redirect_uri: YOUTUBE_REDIRECT_URI,\n    response_type: 'code', // Using authorization code flow instead of implicit\n    scope: YOUTUBE_SCOPES.join(' '),\n    include_granted_scopes: 'true',\n    state: state,\n    access_type: 'offline', // Get a refresh token\n    prompt: 'consent'\n  }).toString();\n\n  const authUrl = `${YOUTUBE_AUTH_ENDPOINT}?${params}`;\n  console.log('[YouTube Auth] Generated auth URL:', authUrl.substring(0, 100) + '...');\n  \n  return authUrl;\n};\n\n/**\n * Initialize YouTube authentication flow\n */\nexport const initYouTubeAuth = async (): Promise<{ success: boolean; error?: string }> => {\n  try {\n    // Generate auth URL\n    const authUrl = getYouTubeAuthUrl();\n    \n    // Store current path to return to after auth\n    localStorage.setItem(STORAGE_KEYS.RETURN_PATH, window.location.pathname);\n    \n    // Use full page redirect for all devices\n    console.log('Using full page redirect for YouTube authentication');\n    window.location.href = authUrl;\n    \n    return { success: true };\n  } catch (error) {\n    console.error('Failed to initialize YouTube auth:', error);\n    return {\n      success: false,\n      error: 'Failed to initialize YouTube authentication'\n    };\n  }\n};\n\n/**\n * Exchange authorization code for access token\n * @param code The authorization code returned from the auth server\n */\nexport const exchangeCodeForToken = async (code: string): Promise<{\n  access_token: string;\n  refresh_token?: string;\n  expires_in: number;\n}> => {\n  try {\n    console.log(\"Exchanging code for token...\");\n    // Log URL for debugging\n    console.log(\"Token endpoint:\", YOUTUBE_TOKEN_ENDPOINT);\n    console.log(\"Redirect URI:\", YOUTUBE_REDIRECT_URI);\n    \n    const requestData = {\n      client_id: YOUTUBE_CLIENT_ID,\n      client_secret: YOUTUBE_CLIENT_SECRET,\n      code: code,\n      grant_type: 'authorization_code',\n      redirect_uri: YOUTUBE_REDIRECT_URI\n    };\n    \n    // Log request data (sanitized)\n    console.log(\"Request data:\", {\n      ...requestData,\n      client_secret: \"[REDACTED]\",\n      code: \"[REDACTED]\"\n    });\n    \n    const response = await fetch(YOUTUBE_TOKEN_ENDPOINT, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: new URLSearchParams(requestData).toString()\n    });\n\n    console.log(\"Token response status:\", response.status);\n    const responseText = await response.text();\n\n    if (!response.ok) {\n      try {\n        const errorData = JSON.parse(responseText);\n        console.error(\"Token exchange failed:\", errorData);\n        throw new Error(`Token exchange failed: ${errorData.error_description || errorData.error || 'Unknown error'}`);\n      } catch (parseError) {\n        console.error(\"Failed to parse error response:\", responseText);\n        throw new Error(`Token exchange failed: ${response.status} ${response.statusText}`);\n      }\n    }\n\n    try {\n      const data = JSON.parse(responseText);\n      console.log(\"Token exchange successful, got tokens:\", {\n        has_access_token: !!data.access_token,\n        has_refresh_token: !!data.refresh_token,\n        expires_in: data.expires_in\n      });\n      \n      return {\n        access_token: data.access_token,\n        refresh_token: data.refresh_token,\n        expires_in: data.expires_in || 3600 // Default to 1 hour if not specified\n      };\n    } catch (parseError) {\n      console.error(\"Failed to parse success response:\", responseText);\n      throw new Error(`Failed to parse token response`);\n    }\n  } catch (error) {\n    console.error('Error exchanging code for token:', error);\n    throw error;\n  }\n};\n\n/**\n * Handle YouTube OAuth callback with proper error handling\n * This should be called in the YouTube callback page component\n */\nexport const handleYouTubeCallback = async (): Promise<void> => {\n  try {\n    console.log(\"YouTube callback handling started\");\n    \n    // Get URL parameters\n    const urlParams = new URLSearchParams(window.location.search);\n    const authCode = urlParams.get('code');\n    const state = urlParams.get('state');\n    const error = urlParams.get('error');\n\n    console.log(\"URL parameters:\", { \n      hasCode: !!authCode, \n      hasState: !!state, \n      error: error || 'none' \n    });\n    \n    // Check for errors in the callback\n    if (error) {\n      throw new Error(`Authorization error: ${error}`);\n    }\n    \n    // Validate state parameter to prevent CSRF attacks\n    const savedState = localStorage.getItem(STORAGE_KEYS.AUTH_STATE);\n    \n    console.log(\"State validation:\", { \n      savedState: savedState?.substring(0, 5) + \"...\", \n      receivedState: state?.substring(0, 5) + \"...\" \n    });\n    \n    // Clean up state\n    localStorage.removeItem(STORAGE_KEYS.AUTH_STATE);\n    \n    // Special case: if we have no saved state at all, this is likely a returning\n    // user after browser restart - we'll proceed with a warning but not fail\n    if (!savedState) {\n      console.warn(\"No saved state found, proceeding with authentication anyway\");\n    } else if (!state || state !== savedState) {\n      console.error(\"State validation failed\", { receivedState: state, savedState });\n      throw new Error('Invalid state parameter. Authentication attempt may have been compromised.');\n    }\n    \n    if (!authCode) {\n      throw new Error('No authorization code found in the callback URL');\n    }\n    \n    console.log(\"Starting token exchange with code:\", authCode.substring(0, 5) + \"...\");\n    \n    // Exchange code for tokens\n    const tokenData = await exchangeCodeForToken(authCode);\n    console.log(\"Token data received from Google:\", tokenData);\n    \n    if (!tokenData.access_token) {\n      throw new Error('No access token received from token exchange');\n    }\n    \n    console.log(\"Saving tokens to TokenManager\");\n    \n    // Save tokens using the TokenManager with Firestore resilience\n    try {\n      await TokenManager.storeTokens('youtube', {\n        accessToken: tokenData.access_token,\n        refreshToken: tokenData.refresh_token || '',\n        expiresAt: Date.now() + (tokenData.expires_in * 1000)\n      });\n      console.log(\"✅ YouTube tokens saved successfully\");\n    } catch (error) {\n      console.error(\"⚠️ Failed to save YouTube tokens, but localStorage fallback should work:\", error);\n      // Continue execution - the TokenManager has localStorage fallback\n    }\n    \n    // Backward compatibility: keep legacy key for any consumers still reading it\n    localStorage.setItem('soundswapp_youtube_access_token', tokenData.access_token);\n    console.log(\"YouTube authentication completed with token storage\");\n    \n    // Update Firestore to mark YouTube as connected (with resilience)\n    try {\n      const auth = getAuth();\n      const userId = auth.currentUser?.uid;\n      \n      if (userId) {\n        console.log(\"Attempting to update Firestore user document...\");\n        \n        // Try to update the user document to indicate YouTube is connected\n        const userRef = doc(db, 'users', userId);\n        await setDoc(userRef, {\n          youtubeConnected: true,\n          lastUpdated: new Date()\n        }, { merge: true });\n        \n        console.log(\"✅ Successfully updated Firestore with YouTube connection status\");\n      } else {\n        console.warn(\"No user ID available to update Firestore\");\n      }\n    } catch (firestoreError: any) {\n      console.warn(\"⚠️ Failed to update Firestore user document (service may be down):\", firestoreError);\n      \n      // Store connection status in localStorage as fallback\n      try {\n        localStorage.setItem('soundswapp_youtube_connected', 'true');\n        localStorage.setItem('soundswapp_youtube_connected_at', new Date().toISOString());\n        console.log(\"✅ Stored YouTube connection status in localStorage as fallback\");\n      } catch (localError) {\n        console.error(\"Failed to store connection status in localStorage:\", localError);\n      }\n      \n      // Don't throw - authentication is still successful\n    }\n    \n    // Dispatch event to notify about authentication success\n    window.dispatchEvent(new CustomEvent('youtube-auth-changed', { \n      detail: { authenticated: true } \n    }));\n    \n    console.log(\"YouTube authentication successful\");\n  } catch (error: unknown) {\n    console.error('YouTube authentication error:', error);\n    // Don't redirect automatically - let the component handle the error\n    throw error;\n  }\n};\n\n/**\n * Refresh the access token using a refresh token\n */\nexport const refreshYouTubeToken = async (): Promise<boolean> => {\n  const tokens = await TokenManager.getTokens('youtube');\n  const refreshToken = tokens?.refreshToken;\n  \n  if (!refreshToken) {\n    console.log('No refresh token available for YouTube');\n    return false;\n  }\n  \n  try {\n    console.log('Attempting to refresh YouTube token...');\n    \n    const response = await fetch(YOUTUBE_TOKEN_ENDPOINT, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: new URLSearchParams({\n        client_id: YOUTUBE_CLIENT_ID,\n        client_secret: YOUTUBE_CLIENT_SECRET,\n        refresh_token: refreshToken,\n        grant_type: 'refresh_token'\n      }).toString()\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error('YouTube token refresh failed:', {\n        status: response.status,\n        statusText: response.statusText,\n        error: errorText\n      });\n      \n      // If refresh token is invalid, clear all auth data\n      if (response.status === 400 || response.status === 401) {\n        console.log('Refresh token is invalid, clearing YouTube auth data');\n        clearYouTubeAuth();\n      }\n      \n      throw new Error(`Failed to refresh token: ${response.status} ${response.statusText}`);\n    }\n\n    const data = await response.json();\n    console.log('YouTube token refreshed successfully');\n    \n    // Update tokens using TokenManager\n    TokenManager.storeTokens('youtube', {\n      accessToken: data.access_token,\n      refreshToken: refreshToken, // Keep the existing refresh token\n      expiresAt: Date.now() + (data.expires_in * 1000)\n    });\n    // Backward compatibility: keep legacy localStorage key in sync\n    localStorage.setItem('soundswapp_youtube_access_token', data.access_token);\n    \n    return true;\n  } catch (error) {\n    console.error('Error refreshing YouTube token:', error);\n    \n    // Clear invalid auth data on any error\n    clearYouTubeAuth();\n    return false;\n  }\n};\n\n/**\n * Check if user is authenticated with YouTube\n */\nexport const isYouTubeAuthenticated = async (): Promise<boolean> => {\n  // First check if we have a valid token\n  return TokenManager.hasValidTokens('youtube');\n};\n\n/**\n * Get YouTube access token with auto-refresh if needed\n */\nexport const getYouTubeToken = async (): Promise<string | null> => {\n  try {\n    const tokens = await TokenManager.getTokens('youtube');\n    \n    if (tokens?.accessToken) {\n      // Check if token is expired and refresh if needed\n      if (tokens.expiresAt && Date.now() >= tokens.expiresAt) {\n        console.log(\"YouTube token expired, attempting to refresh...\");\n        const refreshSuccess = await refreshYouTubeToken();\n        if (refreshSuccess) {\n          const refreshedTokens = await TokenManager.getTokens('youtube');\n          return refreshedTokens?.accessToken || null;\n        } else {\n          console.log(\"Failed to refresh YouTube token\");\n          return null;\n        }\n      }\n      \n      return tokens.accessToken;\n    }\n    \n    // If no valid token, we'll need to refresh asynchronously\n    // but for this synchronous function, we return null\n    console.log(\"No valid YouTube token found, needs refresh\");\n    return null;\n  } catch (error) {\n    console.error(\"Error in getYouTubeToken:\", error);\n    return null;\n  }\n};\n\n/**\n * Clear YouTube authentication data\n */\nexport const clearYouTubeAuth = (): void => {\n  TokenManager.clearTokens('youtube');\n  localStorage.removeItem(STORAGE_KEYS.AUTH_STATE);\n  localStorage.removeItem(STORAGE_KEYS.RETURN_PATH);\n  localStorage.removeItem(STORAGE_KEYS.CALLBACK_URL);\n  localStorage.removeItem('soundswapp_youtube_access_token');\n}; ","/**\n * Cryptographic utility functions for OAuth and PKCE\n */\n\n/**\n * Generate a random string of specified length\n */\nexport function generateRandomString(length: number): string {\n  const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  const values = crypto.getRandomValues(new Uint8Array(length));\n  return Array.from(values)\n    .map(x => possible[x % possible.length])\n    .join('');\n}\n\n/**\n * Generate a code verifier for PKCE\n * Returns a random string between 43 and 128 characters long\n */\nexport function generateCodeVerifier(): string {\n  return generateRandomString(96); // Using 96 for good security while staying well within limits\n}\n\n/**\n * Generate a code challenge from a code verifier using SHA-256\n */\nexport async function generateCodeChallenge(codeVerifier: string): Promise<string> {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(codeVerifier);\n  const hash = await crypto.subtle.digest('SHA-256', data);\n  \n  return base64UrlEncode(hash);\n}\n\n/**\n * Encode an ArrayBuffer as a base64url string\n */\nexport function base64UrlEncode(buffer: ArrayBuffer): string {\n  const bytes = new Uint8Array(buffer);\n  const base64 = btoa(String.fromCharCode(...bytes));\n  \n  return base64\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=+$/, '');\n}\n\n/**\n * Generate a secure state parameter for OAuth\n */\nexport function generateOAuthState(): string {\n  return generateRandomString(32);\n}\n\n/**\n * Hash a string using SHA-256\n */\nexport async function sha256Hash(input: string): Promise<string> {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(input);\n  const hash = await crypto.subtle.digest('SHA-256', data);\n  \n  return base64UrlEncode(hash);\n}\n\n/**\n * Validate the format of a code verifier\n */\nexport function isValidCodeVerifier(verifier: string): boolean {\n  return /^[A-Za-z0-9_-]{43,128}$/.test(verifier);\n}\n\n/**\n * Calculates SHA-256 hash of string\n */\nexport const sha256 = async (plain: string): Promise<ArrayBuffer> => {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(plain);\n  return window.crypto.subtle.digest('SHA-256', data);\n};\n\n/**\n * Base64 URL encoding of ArrayBuffer\n * This is a URL-safe version of base64 encoding\n */\nexport const base64urlencode = (arrayBuffer: ArrayBuffer): string => {\n  // Convert the ArrayBuffer to a string using Uint8 Array\n  const bytes = new Uint8Array(arrayBuffer);\n  let base64 = btoa(String.fromCharCode(...bytes));\n  \n  // Make the string URL-safe:\n  // 1. Replace \"+\" with \"-\"\n  // 2. Replace \"/\" with \"_\"\n  // 3. Remove trailing \"=\"\n  return base64\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=+$/, '');\n}; ","import { generateRandomString, generateCodeVerifier, generateCodeChallenge } from './cryptoUtils';\nimport { isMobileDevice } from './utils';\nimport { spotifyConfig } from './env';\nimport { db } from './firebase';\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\nimport { getAuth } from 'firebase/auth';\nimport TokenManager from './tokenManager';\n\n// Spotify API configuration\nconst SPOTIFY_CONFIG = {\n  CLIENT_ID: spotifyConfig.clientId,\n  CLIENT_SECRET: spotifyConfig.clientSecret,\n  REDIRECT_URI: spotifyConfig.redirectUri,\n  AUTH_ENDPOINT: 'https://accounts.spotify.com/authorize',\n  TOKEN_ENDPOINT: 'https://accounts.spotify.com/api/token',\n  // Full scopes for standard accounts\n  SCOPES: [\n    'user-read-private',\n    'user-read-email',\n    'playlist-read-private',\n    'playlist-read-collaborative',\n    'playlist-modify-public',\n    'playlist-modify-private'\n  ],\n  // Fallback scopes for family accounts (read-only)\n  FAMILY_FRIENDLY_SCOPES: [\n    'user-read-private',\n    'user-read-email',\n    'playlist-read-private',\n    'playlist-read-collaborative'\n  ]\n};\n\n// Debug Spotify configuration\nconsole.log('[Spotify Auth] Configuration loaded:', {\n  clientId: SPOTIFY_CONFIG.CLIENT_ID ? `${SPOTIFY_CONFIG.CLIENT_ID.substring(0, 10)}...` : 'MISSING',\n  redirectUri: SPOTIFY_CONFIG.REDIRECT_URI,\n  hasClientSecret: !!SPOTIFY_CONFIG.CLIENT_SECRET\n});\n\n// Log environment variables for debugging  \nconsole.log('[Spotify Auth] Environment variables:', {\n  VITE_SPOTIFY_CLIENT_ID: import.meta.env.VITE_SPOTIFY_CLIENT_ID ? `${import.meta.env.VITE_SPOTIFY_CLIENT_ID.substring(0, 10)}...` : 'MISSING',\n  VITE_SPOTIFY_REDIRECT_URI: import.meta.env.VITE_SPOTIFY_REDIRECT_URI || 'MISSING'\n});\n\n// Types\ninterface SpotifyTokens {\n  access_token: string;\n  refresh_token: string;\n  expires_in: number;\n  token_type: string;\n  scope: string;\n}\n\ninterface AuthState {\n  state: string;\n  codeVerifier: string;\n  returnPath: string;\n}\n\n// Storage keys\nconst STORAGE_KEYS = {\n  AUTH_STATE: 'spotify_auth_state',\n  CODE_VERIFIER: 'spotify_code_verifier',\n  RETURN_PATH: 'spotify_auth_return_path',\n  ACCESS_TOKEN: 'spotify_access_token',\n  REFRESH_TOKEN: 'spotify_refresh_token',\n  EXPIRES_AT: 'spotify_token_expires_at',\n  REDIRECT_URI: 'spotify_redirect_uri'\n};\n\n/**\n * Check if user is authenticated before starting Spotify auth\n */\nexport const ensureUserAuthenticated = (): { isAuthenticated: boolean; error?: string } => {\n  const auth = getAuth();\n  const currentUser = auth.currentUser;\n\n  if (!currentUser) {\n    return {\n      isAuthenticated: false,\n      error: 'You need to be signed in to connect your Spotify account'\n    };\n  }\n\n  return { isAuthenticated: true };\n};\n\n/**\n * Initialize Spotify authentication flow using PKCE\n */\nexport const initSpotifyAuth = async (): Promise<{ success: boolean; error?: string }> => {\n  try {\n    // Check if user is authenticated first\n    const { isAuthenticated, error: authError } = ensureUserAuthenticated();\n    \n    if (!isAuthenticated) {\n      return {\n        success: false,\n        error: authError || 'Authentication required'\n      };\n    }\n\n    // Generate auth URL with PKCE\n    const authUrl = await getSpotifyAuthUrl();\n    \n    // Store current path to return to after auth\n    localStorage.setItem('spotify_auth_return_path', window.location.pathname);\n    \n    // Use full page redirect for all devices (more reliable)\n    console.log('Using full page redirect for Spotify authentication');\n    window.location.href = authUrl;\n    \n    return { success: true };\n  } catch (error) {\n    console.error('Failed to initialize Spotify auth:', error);\n    return {\n      success: false,\n      error: 'Failed to initialize Spotify authentication'\n    };\n  }\n};\n\n/**\n * Handle the OAuth callback from Spotify\n */\nexport const handleSpotifyCallback = async (): Promise<{ success: boolean; error?: string }> => {\n  try {\n    // Get URL parameters\n    const urlParams = new URLSearchParams(window.location.search);\n    const code = urlParams.get('code');\n    const state = urlParams.get('state');\n    const error = urlParams.get('error');\n    \n    // Log parameters for debugging\n    console.log(\"Callback parameters:\", {\n      hasCode: !!code,\n      hasState: !!state,\n      error: error || 'none'\n    });\n  \n    // Handle OAuth errors\n  if (error) {\n    return { \n      success: false, \n      error: `Spotify authorization error: ${error}`\n    };\n  }\n  \n    if (!code || !state) {\n      return { \n        success: false, \n        error: 'Missing required authorization parameters' \n      };\n    }\n    \n    // Get stored auth state\n    const storedAuthState = getStoredAuthState();\n    if (!storedAuthState) {\n      return { \n        success: false, \n        error: 'No authentication state found' \n      };\n    }\n    \n    // Validate state parameter\n    if (state !== storedAuthState.state) {\n    return { \n      success: false, \n        error: 'Invalid state parameter' \n      };\n    }\n    \n    // Get the redirect URI that was used for the initial request\n    const usedRedirectUri = localStorage.getItem(STORAGE_KEYS.REDIRECT_URI) || SPOTIFY_CONFIG.REDIRECT_URI;\n    \n    // Exchange code for tokens using the same redirect URI\n    const tokens = await exchangeCodeForTokens(code, usedRedirectUri);\n    if (!tokens) {\n      return { \n        success: false, \n        error: 'Failed to exchange authorization code for tokens' \n      };\n    }\n    \n    // Store tokens securely\n    await storeTokens(tokens);\n    \n    // Clean up auth state\n    clearAuthState();\n    localStorage.removeItem(STORAGE_KEYS.REDIRECT_URI);\n    \n    // Dispatch event to notify application of successful authentication\n    window.dispatchEvent(new CustomEvent('spotify-auth-changed', { \n      detail: { authenticated: true } \n    }));\n    \n    console.log(\"Spotify authentication successful, dispatched spotify-auth-changed event\");\n    \n    return { success: true };\n  } catch (error) {\n    console.error('Spotify callback error:', error);\n    return { \n      success: false, \n      error: 'Failed to complete authentication' \n    };\n  }\n};\n\n/**\n * Exchange authorization code for tokens\n */\nasync function exchangeCodeForTokens(code: string, redirectUri: string): Promise<SpotifyTokens | null> {\n  try {\n    // Get stored auth state to retrieve code verifier\n    const storedAuthState = getStoredAuthState();\n    if (!storedAuthState?.codeVerifier) {\n      console.error('No code verifier found in stored auth state');\n      return null;\n    }\n\n    // Debug log the token exchange parameters\n    console.log('[Spotify Auth] Token exchange parameters:', {\n      client_id: SPOTIFY_CONFIG.CLIENT_ID ? `${SPOTIFY_CONFIG.CLIENT_ID.substring(0, 10)}...` : 'MISSING',\n      redirect_uri: redirectUri,\n      grant_type: 'authorization_code',\n      has_code: !!code,\n      has_code_verifier: !!storedAuthState.codeVerifier,\n      has_client_secret: !!SPOTIFY_CONFIG.CLIENT_SECRET\n    });\n\n    const tokenParams = new URLSearchParams({\n      client_id: SPOTIFY_CONFIG.CLIENT_ID,\n      client_secret: SPOTIFY_CONFIG.CLIENT_SECRET,\n      grant_type: 'authorization_code',\n      code,\n      redirect_uri: redirectUri,\n      code_verifier: storedAuthState.codeVerifier\n    });\n\n    console.log('[Spotify Auth] Making token exchange request to:', SPOTIFY_CONFIG.TOKEN_ENDPOINT);\n\n    const response = await fetch(SPOTIFY_CONFIG.TOKEN_ENDPOINT, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: tokenParams.toString()\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => null);\n      console.error('[Spotify Auth] Token exchange failed:', {\n        status: response.status,\n        statusText: response.statusText,\n        error: errorData,\n        requestParams: {\n          client_id: SPOTIFY_CONFIG.CLIENT_ID ? `${SPOTIFY_CONFIG.CLIENT_ID.substring(0, 10)}...` : 'MISSING',\n          redirect_uri: redirectUri,\n          grant_type: 'authorization_code'\n        }\n      });\n      \n      // If it's a redirect URI mismatch, provide helpful error message\n      if (response.status === 400 && errorData?.error === 'invalid_grant') {\n        console.error('[Spotify Auth] REDIRECT URI MISMATCH - Check your Spotify app settings!');\n        console.error('[Spotify Auth] Expected redirect URI in Spotify settings:', redirectUri);\n      }\n      \n      return null;\n    }\n\n    const tokens = await response.json();\n    console.log('[Spotify Auth] Token exchange successful');\n    return tokens;\n  } catch (error) {\n    console.error('[Spotify Auth] Failed to exchange code for tokens:', error);\n    return null;\n  }\n}\n\n/**\n * Get the current user ID from Firebase Auth\n */\nfunction getUserId(): string | null {\n  const auth = getAuth();\n  return auth.currentUser?.uid || null;\n}\n\n/**\n * Store tokens securely in both localStorage and Firestore\n */\nasync function storeTokens(tokens: SpotifyTokens): Promise<void> {\n  try {\n    // Convert to Unix timestamp in seconds (not milliseconds)\n    const expiresAt = Math.floor(Date.now() / 1000) + tokens.expires_in;\n    \n    // Store using TokenManager\n    TokenManager.storeTokens('spotify', {\n      accessToken: tokens.access_token,\n      refreshToken: tokens.refresh_token,\n      expiresAt\n    });\n    \n    // Store in Firestore for persistence\n    const userId = getUserId();\n    if (userId) {\n      try {\n        const userTokenRef = doc(db, 'users', userId, 'tokens', 'spotify');\n        await setDoc(userTokenRef, {\n          accessToken: tokens.access_token,\n          refreshToken: tokens.refresh_token,\n          expiresAt, // Already in seconds format\n          scope: tokens.scope || undefined\n        });\n        \n        // Also update the user document to indicate Spotify is connected\n        const userRef = doc(db, 'users', userId);\n        await setDoc(userRef, {\n          spotifyConnected: true,\n          lastUpdated: new Date()\n        }, { merge: true });\n        \n      } catch (firestoreError) {\n        console.error('Failed to store tokens in Firestore:', firestoreError);\n        // Continue execution - localStorage backup is still available\n      }\n    }\n    \n    // Dispatch event to notify about token update\n    window.dispatchEvent(new CustomEvent('spotify-auth-changed', {\n      detail: { authenticated: true }\n    }));\n  } catch (error) {\n    console.error('Failed to store tokens:', error);\n    throw error;\n  }\n}\n\n/**\n * Get stored auth state from either localStorage or sessionStorage\n */\nfunction getStoredAuthState(): AuthState | null {\n  const localState = localStorage.getItem(STORAGE_KEYS.AUTH_STATE);\n  const sessionState = sessionStorage.getItem(STORAGE_KEYS.AUTH_STATE);\n  \n  try {\n    return JSON.parse(localState || sessionState || 'null');\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Clear authentication state from storage\n */\nfunction clearAuthState(): void {\n  localStorage.removeItem(STORAGE_KEYS.AUTH_STATE);\n  sessionStorage.removeItem(STORAGE_KEYS.AUTH_STATE);\n}\n\n/**\n * Check if the current Spotify access token is valid\n */\nexport async function isSpotifyAuthenticated(): Promise<boolean> {\n  console.log('[DEBUG] isSpotifyAuthenticated() called');\n  return await TokenManager.hasValidTokens('spotify');\n}\n\n/**\n * Get the current access token, refreshing if necessary\n */\nexport async function getSpotifyToken(): Promise<string | null> {\n  try {\n    console.log('[DEBUG] getSpotifyToken() called');\n    \n    // Use TokenManager to get tokens\n    const tokens = await TokenManager.getTokens('spotify');\n    console.log('[DEBUG] Tokens from TokenManager:', tokens ? 'Found' : 'Not found');\n    \n    if (tokens) {\n      console.log('[DEBUG] Returning valid token from TokenManager');\n      return tokens.accessToken;\n    }\n    \n    console.log('[DEBUG] No valid tokens found, attempting refresh...');\n    \n    // If no valid tokens, try to refresh using TokenManager\n    const storedTokens = await TokenManager.getTokens('spotify');\n    if (storedTokens?.refreshToken) {\n      console.log('[DEBUG] Found refresh token in TokenManager, attempting refresh...');\n      const newTokens = await refreshAccessToken(storedTokens.refreshToken);\n      if (newTokens) {\n        console.log('[DEBUG] Token refresh successful, storing new tokens...');\n        \n        // Store using TokenManager\n        TokenManager.storeTokens('spotify', {\n          accessToken: newTokens.access_token,\n          refreshToken: newTokens.refresh_token,\n          expiresAt: Date.now() + (newTokens.expires_in * 1000)\n        });\n        \n        console.log('[DEBUG] New tokens stored successfully');\n        return newTokens.access_token;\n      } else {\n        console.error('[DEBUG] Token refresh failed');\n      }\n    } else {\n      console.log('[DEBUG] No refresh token available');\n    }\n    \n    console.log('[DEBUG] No valid token available');\n    return null;\n  } catch (error) {\n    console.error('[DEBUG] Error in getSpotifyToken:', error);\n    return null;\n  }\n}\n\n/**\n * Refresh the access token using the refresh token\n */\nasync function refreshAccessToken(refreshToken: string): Promise<SpotifyTokens | null> {\n  try {\n    const response = await fetch(SPOTIFY_CONFIG.TOKEN_ENDPOINT, {\n          method: 'POST',\n          headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n          },\n          body: new URLSearchParams({\n            grant_type: 'refresh_token',\n        refresh_token: refreshToken,\n        client_id: SPOTIFY_CONFIG.CLIENT_ID,\n        client_secret: SPOTIFY_CONFIG.CLIENT_SECRET\n      }).toString()\n    });\n\n    if (!response.ok) {\n      return null;\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Failed to refresh access token:', error);\n    return null;\n  }\n}\n\n/**\n * Log out from Spotify by clearing all tokens and state\n */\nexport function logoutFromSpotify(): void {\n  // Clear tokens using TokenManager\n  TokenManager.clearTokens('spotify');\n  \n  // Clear legacy storage keys for backward compatibility\n  Object.values(STORAGE_KEYS).forEach(key => {\n    localStorage.removeItem(key);\n    sessionStorage.removeItem(key);\n  });\n}\n\n/**\n * Check the current authentication status\n */\nasync function checkAuthStatus(): Promise<void> {\n  const isAuthed = await isSpotifyAuthenticated();\n  if (!isAuthed) {\n    // Trigger auth state change in your app\n    window.dispatchEvent(new CustomEvent('spotify-auth-changed', { \n      detail: { authenticated: false } \n    }));\n  }\n}\n\n// Add this new function\nexport const getSpotifyAuthUrl = async (scopes: string[] = SPOTIFY_CONFIG.SCOPES): Promise<string> => {\n  // Generate PKCE and state values\n  const state = generateRandomString(32);\n  const codeVerifier = generateCodeVerifier();\n  const codeChallenge = await generateCodeChallenge(codeVerifier);\n  \n  // Store auth state securely\n  const authState: AuthState = {\n    state,\n    codeVerifier,\n    returnPath: window.location.pathname\n  };\n  \n  // Store in both storages for redundancy\n  localStorage.setItem(STORAGE_KEYS.AUTH_STATE, JSON.stringify(authState));\n  sessionStorage.setItem(STORAGE_KEYS.AUTH_STATE, JSON.stringify(authState));\n  \n  // Store the current redirect URI being used\n  localStorage.setItem(STORAGE_KEYS.REDIRECT_URI, SPOTIFY_CONFIG.REDIRECT_URI);\n  \n  // Build authorization URL with PKCE\n  const authUrl = new URL(SPOTIFY_CONFIG.AUTH_ENDPOINT);\n  const params = {\n    client_id: SPOTIFY_CONFIG.CLIENT_ID,\n    response_type: 'code',\n    redirect_uri: SPOTIFY_CONFIG.REDIRECT_URI,\n    code_challenge_method: 'S256',\n    code_challenge: codeChallenge,\n    state: state,\n    scope: scopes.join(' ')\n  };\n  \n  Object.entries(params).forEach(([key, value]) => {\n    authUrl.searchParams.append(key, value);\n  });\n  \n  // Log the auth URL for debugging\n  console.log('Spotify Auth URL:', authUrl.toString());\n  \n  return authUrl.toString();\n};\n\n// Add this new function\nexport const getSpotifyUserProfile = async (): Promise<any | null> => {\n  try {\n    const token = await getSpotifyToken();\n    if (!token) {\n      console.log('[Spotify Auth] No Spotify token available for fetching user profile.');\n      return null;\n    }\n\n    console.log('[Spotify Auth] 🎵 Fetching Spotify user profile...');\n    const response = await fetch('https://api.spotify.com/v1/me', {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n\n    if (!response.ok) {\n      console.warn('[Spotify Auth] Profile fetch failed:', response.status, response.statusText);\n      \n      // Check content type before trying to parse as JSON\n      const contentType = response.headers.get('content-type');\n      const isJson = contentType && contentType.includes('application/json');\n      \n      let errorInfo = `HTTP ${response.status}`;\n      if (isJson) {\n        try {\n          const errorData = await response.json();\n          errorInfo = errorData.error?.message || errorData.message || errorInfo;\n        } catch (parseError) {\n          console.warn('[Spotify Auth] Failed to parse error response as JSON:', parseError);\n        }\n      } else {\n        // Non-JSON response (likely HTML error page)\n        const errorText = await response.text();\n        console.warn('[Spotify Auth] Received non-JSON error response:', errorText.substring(0, 200) + '...');\n      }\n      \n      console.error('[Spotify Auth] Error fetching Spotify user profile:', response.status, errorInfo);\n      \n      // Handle specific error cases\n      if (response.status === 401) {\n        console.log('[Spotify Auth] Token expired or invalid, clearing auth...');\n        logoutFromSpotify();\n      } else if (response.status === 403) {\n        console.log('[Spotify Auth] Access forbidden - likely account restrictions');\n        // Don't logout for 403 as it might be account restrictions, not invalid token\n      }\n      \n      return null;\n    }\n\n    let data;\n    try {\n      data = await response.json();\n    } catch (parseError) {\n      console.error('[Spotify Auth] Failed to parse profile response as JSON:', parseError);\n      return null;\n    }\n    \n    console.log('[Spotify Auth] ✅ Profile fetched successfully:', {\n      displayName: data.display_name,\n      hasImages: !!(data.images && data.images.length > 0),\n      id: data.id\n    });\n    \n    // We are interested in display_name and images[0].url\n    return {\n      displayName: data.display_name,\n      imageUrl: data.images && data.images.length > 0 ? data.images[0].url : null,\n      id: data.id,\n      email: data.email,\n      externalUrls: data.external_urls?.spotify\n    };\n  } catch (error) {\n    console.error('[Spotify Auth] Exception fetching Spotify user profile:', error);\n    return null;\n  }\n}; \n\n/**\n * Get the current access token synchronously (no refresh)\n */\nexport async function getSpotifyTokenSync(): Promise<string | null> {\n  console.log('[DEBUG] getSpotifyTokenSync() called');\n  const tokens = await TokenManager.getTokens('spotify');\n  const token = tokens?.accessToken || null;\n  console.log('[DEBUG] getSpotifyTokenSync result:', token ? 'Found' : 'Not found');\n  return token;\n} \n\n/**\n * Detect if account is a family plan account with restrictions\n */\nexport async function detectAccountType(accessToken: string): Promise<{\n  accountType: 'premium' | 'free' | 'family_child' | 'family_restricted' | 'unknown';\n  hasPlaylistAccess: boolean;\n  canCreatePlaylists: boolean;\n  recommendations: string[];\n}> {\n  try {\n    // Validate token before making API calls\n    if (!accessToken || accessToken.trim() === '') {\n      console.warn('[Spotify Auth] No access token provided to detectAccountType');\n      return {\n        accountType: 'unknown',\n        hasPlaylistAccess: false,\n        canCreatePlaylists: false,\n        recommendations: ['No access token available. Please reconnect your Spotify account.']\n      };\n    }\n\n    console.log('[Spotify Auth] 🔍 Detecting account type...');\n    \n    // Get user profile with better error handling\n    const profileResponse = await fetch('https://api.spotify.com/v1/me', {\n      headers: { 'Authorization': `Bearer ${accessToken}` }\n    });\n    \n    if (!profileResponse.ok) {\n      console.warn('[Spotify Auth] Profile request failed:', profileResponse.status, profileResponse.statusText);\n      \n      if (profileResponse.status === 403) {\n        // 403 suggests account restrictions or invalid permissions\n        return {\n          accountType: 'family_restricted',\n          hasPlaylistAccess: false,\n          canCreatePlaylists: false,\n          recommendations: [\n            'Your Spotify account has restricted permissions (403 Forbidden)',\n            'This is common with family plan child accounts',\n            'Try using public playlist URLs for conversion instead',\n            'Contact your family plan administrator for full access'\n          ]\n        };\n      } else if (profileResponse.status === 401) {\n        // 401 suggests expired or invalid token\n        return {\n          accountType: 'unknown',\n          hasPlaylistAccess: false,\n          canCreatePlaylists: false,\n          recommendations: [\n            'Your Spotify access token has expired or is invalid',\n            'Please reconnect your Spotify account',\n            'Try signing out and signing back in'\n          ]\n        };\n      }\n      \n      // Other errors\n      return {\n        accountType: 'unknown',\n        hasPlaylistAccess: false,\n        canCreatePlaylists: false,\n        recommendations: [`Unable to access Spotify profile (${profileResponse.status}). Please try reconnecting.`]\n      };\n    }\n    \n    let profile;\n    try {\n      profile = await profileResponse.json();\n    } catch (parseError) {\n      console.error('[Spotify Auth] Failed to parse profile response as JSON:', parseError);\n      return {\n        accountType: 'unknown',\n        hasPlaylistAccess: false,\n        canCreatePlaylists: false,\n        recommendations: [\n          'Received invalid response from Spotify',\n          'This may indicate account restrictions',\n          'Please try reconnecting your account'\n        ]\n      };\n    }\n    \n    // Test playlist access with better error handling\n    const playlistResponse = await fetch('https://api.spotify.com/v1/me/playlists?limit=1', {\n      headers: { 'Authorization': `Bearer ${accessToken}` }\n    });\n    \n    const hasPlaylistAccess = playlistResponse.ok;\n    let canCreatePlaylists = false;\n    \n    // Only test playlist creation if we have playlist access\n    if (hasPlaylistAccess) {\n      // Test playlist creation capability (dry run)\n      const createTestResponse = await fetch('https://api.spotify.com/v1/me/playlists', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${accessToken}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          name: 'SoundSwapp Test (Will be deleted)',\n          description: 'Test playlist for permissions - will be deleted immediately',\n          public: false\n        })\n      });\n      \n      canCreatePlaylists = createTestResponse.ok;\n      \n      // If test playlist was created, delete it immediately\n      if (createTestResponse.ok) {\n        try {\n          const testPlaylist = await createTestResponse.json();\n          await fetch(`https://api.spotify.com/v1/playlists/${testPlaylist.id}/followers`, {\n            method: 'DELETE',\n            headers: { 'Authorization': `Bearer ${accessToken}` }\n          });\n        } catch (cleanupError) {\n          console.warn('[Spotify Auth] Failed to cleanup test playlist:', cleanupError);\n          // Don't fail the detection for cleanup issues\n        }\n      }\n    }\n    \n    // Determine account type and recommendations\n    let accountType: 'premium' | 'free' | 'family_child' | 'family_restricted' | 'unknown' = 'unknown';\n    const recommendations: string[] = [];\n    \n    if (profile.product === 'premium') {\n      if (hasPlaylistAccess && canCreatePlaylists) {\n        accountType = 'premium';\n        console.log('[Spotify Auth] ✅ Full Premium account detected');\n      } else if (hasPlaylistAccess && !canCreatePlaylists) {\n        accountType = 'family_restricted';\n        recommendations.push('Your account has playlist creation restrictions');\n        recommendations.push('You can still convert playlists using public playlist URLs');\n        recommendations.push('Ask the family plan admin to enable playlist creation');\n        console.log('[Spotify Auth] ⚠️ Family restricted account detected');\n      } else {\n        accountType = 'family_child';\n        recommendations.push('Your account appears to be a family plan child account');\n        recommendations.push('Contact your family plan administrator for playlist access');\n        recommendations.push('You can still use public playlist URLs for conversion');\n        console.log('[Spotify Auth] ⚠️ Family child account detected');\n      }\n    } else {\n      accountType = 'free';\n      recommendations.push('Consider upgrading to Spotify Premium for full playlist features');\n      recommendations.push('You can still convert public playlists using URLs');\n      console.log('[Spotify Auth] ℹ️ Free account detected');\n    }\n    \n    console.log('[Spotify Auth] Account type detected:', {\n      accountType,\n      product: profile.product,\n      hasPlaylistAccess,\n      canCreatePlaylists,\n      country: profile.country\n    });\n    \n    return {\n      accountType,\n      hasPlaylistAccess,\n      canCreatePlaylists,\n      recommendations\n    };\n    \n  } catch (error) {\n    console.error('[Spotify Auth] Error detecting account type:', error);\n    return {\n      accountType: 'unknown',\n      hasPlaylistAccess: false,\n      canCreatePlaylists: false,\n      recommendations: [\n        'Unable to detect account type due to an error',\n        'Please try reconnecting your Spotify account',\n        'You can still use public playlist URLs for conversion'\n      ]\n    };\n  }\n}\n\n/**\n * Initialize progressive Spotify authentication (try full scopes, fallback to read-only)\n */\nexport const initProgressiveSpotifyAuth = async (useReadOnlyFallback = false): Promise<{\n  success: boolean;\n  error?: string;\n  accountType?: string;\n  recommendations?: string[];\n}> => {\n  try {\n    // Check if user is authenticated first\n    const { isAuthenticated, error: authError } = ensureUserAuthenticated();\n    \n    if (!isAuthenticated) {\n      return {\n        success: false,\n        error: authError || 'Authentication required'\n      };\n    }\n\n    // Choose scopes based on fallback flag\n    const scopes = useReadOnlyFallback ? SPOTIFY_CONFIG.FAMILY_FRIENDLY_SCOPES : SPOTIFY_CONFIG.SCOPES;\n    \n    console.log(`[Spotify Auth] Initiating auth with ${useReadOnlyFallback ? 'family-friendly' : 'full'} scopes:`, scopes);\n\n    // Generate auth URL with appropriate scopes\n    const authUrl = await getSpotifyAuthUrl(scopes);\n    \n    // Store auth attempt type\n    localStorage.setItem('spotify_auth_type', useReadOnlyFallback ? 'family_friendly' : 'full');\n    localStorage.setItem('spotify_auth_return_path', window.location.pathname);\n    \n    // Use full page redirect\n    window.location.href = authUrl;\n    \n    return { success: true };\n  } catch (error) {\n    console.error('Failed to initialize progressive Spotify auth:', error);\n    return {\n      success: false,\n      error: 'Failed to initialize Spotify authentication'\n    };\n  }\n}; \n\n/**\n * Get comprehensive Spotify user profile data\n */\nexport const getDetailedSpotifyProfile = async (): Promise<any | null> => {\n  try {\n    const token = await getSpotifyToken();\n    if (!token) {\n      console.warn('[Spotify Auth] No access token available for detailed profile');\n      return null;\n    }\n\n    console.log('[Spotify Auth] 🔍 Fetching detailed Spotify profile data...');\n\n    // Fetch multiple endpoints in parallel\n    const [\n      profileResponse,\n      playlistsResponse, \n      followingResponse,\n      topArtistsResponse,\n      savedTracksResponse,\n      savedAlbumsResponse\n    ] = await Promise.allSettled([\n      // User profile\n      fetch('https://api.spotify.com/v1/me', {\n        headers: { 'Authorization': `Bearer ${token}` }\n      }),\n      // User playlists\n      fetch('https://api.spotify.com/v1/me/playlists?limit=50', {\n        headers: { 'Authorization': `Bearer ${token}` }\n      }),\n      // Following (artists)\n      fetch('https://api.spotify.com/v1/me/following?type=artist&limit=50', {\n        headers: { 'Authorization': `Bearer ${token}` }\n      }),\n      // Top artists (for genres)\n      fetch('https://api.spotify.com/v1/me/top/artists?limit=20&time_range=medium_term', {\n        headers: { 'Authorization': `Bearer ${token}` }\n      }),\n      // Saved tracks count (first page to get total)\n      fetch('https://api.spotify.com/v1/me/tracks?limit=1', {\n        headers: { 'Authorization': `Bearer ${token}` }\n      }),\n      // Saved albums count (first page to get total)  \n      fetch('https://api.spotify.com/v1/me/albums?limit=1', {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n    ]);\n\n    // Parse profile data\n    let profile = null;\n    if (profileResponse.status === 'fulfilled' && profileResponse.value.ok) {\n      try {\n        profile = await profileResponse.value.json();\n      } catch (e) {\n        console.warn('[Spotify Auth] Failed to parse profile response');\n      }\n    }\n\n    if (!profile) {\n      console.warn('[Spotify Auth] Could not fetch basic profile data');\n      return null;\n    }\n\n    // Parse playlists data (handle 403 gracefully)\n    let playlistsData = { public: 0, private: 0, collaborative: 0, total: 0 };\n    if (playlistsResponse.status === 'fulfilled' && playlistsResponse.value.ok) {\n      try {\n        const playlists = await playlistsResponse.value.json();\n        playlistsData.total = playlists.total || 0;\n        \n        // Count playlist types\n        if (playlists.items) {\n          playlists.items.forEach((playlist: any) => {\n            if (playlist.collaborative) {\n              playlistsData.collaborative++;\n            } else if (playlist.public) {\n              playlistsData.public++;\n            } else {\n              playlistsData.private++;\n            }\n          });\n        }\n      } catch (e) {\n        console.warn('[Spotify Auth] Failed to parse playlists response');\n      }\n    } else if (playlistsResponse.status === 'fulfilled' && playlistsResponse.value.status === 403) {\n      console.warn('[Spotify Auth] Playlists access forbidden (403) - likely account restrictions');\n    }\n\n    // Parse following data (handle 403 gracefully)\n    let followingCount = 0;\n    if (followingResponse.status === 'fulfilled' && followingResponse.value.ok) {\n      try {\n        const following = await followingResponse.value.json();\n        followingCount = following.artists?.total || 0;\n      } catch (e) {\n        console.warn('[Spotify Auth] Failed to parse following response');\n      }\n    } else if (followingResponse.status === 'fulfilled' && followingResponse.value.status === 403) {\n      console.warn('[Spotify Auth] Following artists access forbidden (403) - likely account restrictions');\n    }\n\n    // Parse top artists for genres (handle 403 gracefully)\n    let topGenres: string[] = [];\n    if (topArtistsResponse.status === 'fulfilled' && topArtistsResponse.value.ok) {\n      try {\n        const topArtists = await topArtistsResponse.value.json();\n        if (topArtists.items) {\n          const genreCount: { [key: string]: number } = {};\n          topArtists.items.forEach((artist: any) => {\n            if (artist.genres) {\n              artist.genres.forEach((genre: string) => {\n                genreCount[genre] = (genreCount[genre] || 0) + 1;\n              });\n            }\n          });\n          \n          // Get top 3 genres\n          topGenres = Object.entries(genreCount)\n            .sort(([,a], [,b]) => b - a)\n            .slice(0, 3)\n            .map(([genre]) => genre.charAt(0).toUpperCase() + genre.slice(1));\n        }\n      } catch (e) {\n        console.warn('[Spotify Auth] Failed to parse top artists response');\n      }\n    } else if (topArtistsResponse.status === 'fulfilled' && topArtistsResponse.value.status === 403) {\n      console.warn('[Spotify Auth] Top artists access forbidden (403) - likely account restrictions');\n    }\n\n    // Parse saved tracks count (handle 403 gracefully)\n    let savedTracksCount = 0;\n    if (savedTracksResponse.status === 'fulfilled' && savedTracksResponse.value.ok) {\n      try {\n        const savedTracks = await savedTracksResponse.value.json();\n        savedTracksCount = savedTracks.total || 0;\n      } catch (e) {\n        console.warn('[Spotify Auth] Failed to parse saved tracks response');\n      }\n    } else if (savedTracksResponse.status === 'fulfilled' && savedTracksResponse.value.status === 403) {\n      console.warn('[Spotify Auth] Saved tracks access forbidden (403) - likely account restrictions');\n    }\n\n    // Parse saved albums count (handle 403 gracefully)\n    let savedAlbumsCount = 0;\n    if (savedAlbumsResponse.status === 'fulfilled' && savedAlbumsResponse.value.ok) {\n      try {\n        const savedAlbums = await savedAlbumsResponse.value.json();\n        savedAlbumsCount = savedAlbums.total || 0;\n      } catch (e) {\n        console.warn('[Spotify Auth] Failed to parse saved albums response');\n      }\n    } else if (savedAlbumsResponse.status === 'fulfilled' && savedAlbumsResponse.value.status === 403) {\n      console.warn('[Spotify Auth] Saved albums access forbidden (403) - likely account restrictions');\n    }\n\n    // Build comprehensive profile\n    const detailedProfile = {\n      // Basic profile info (real)\n      displayName: profile.display_name || 'Spotify User',\n      imageUrl: profile.images && profile.images.length > 0 ? profile.images[0].url : null,\n      id: profile.id,\n      email: profile.email,\n      country: profile.country,\n      product: profile.product, // free, premium, etc.\n      followers: profile.followers?.total || 0,\n      \n      // Real playlist data\n      publicPlaylists: playlistsData.public,\n      privatePlaylists: playlistsData.private,\n      collaborativePlaylists: playlistsData.collaborative,\n      totalPlaylists: playlistsData.total,\n      \n      // Real following data\n      followingArtists: followingCount,\n      \n      // Real saved content\n      savedTracks: savedTracksCount,\n      savedAlbums: savedAlbumsCount,\n      \n      // Real genres (derived from top artists)\n      topGenres: topGenres.length > 0 ? topGenres : ['Music Lover'],\n      \n      // Account details (real where available)\n      accountType: profile.product === 'premium' ? 'Premium' : 'Free',\n      explicitContentFilter: profile.explicit_content?.filter_enabled ? 'Enabled' : 'Disabled',\n      \n      // Technical details that are standard for account type\n      audioQuality: profile.product === 'premium' ? 'High (320kbps)' : 'Normal (160kbps)',\n      offlineDownloads: profile.product === 'premium' ? 'Available' : 'Not Available',\n      deviceLimit: profile.product === 'premium' ? 5 : 1,\n      \n      // Data we can't get from API (remove from display or mark as unavailable)\n      lastActive: 'Real-time data not available via API',\n      listeningTime: 'Real-time data not available via API',\n      monthlyListeners: 'Not available for user accounts',\n      nextBilling: 'Billing info not available via API',\n      crossfade: 'Settings not available via API',\n      equalizer: 'Settings not available via API'\n    };\n\n    console.log('[Spotify Auth] ✅ Detailed profile fetched:', {\n      displayName: detailedProfile.displayName,\n      hasImage: !!detailedProfile.imageUrl,\n      product: detailedProfile.product,\n      savedTracks: detailedProfile.savedTracks,\n      totalPlaylists: detailedProfile.totalPlaylists,\n      topGenres: detailedProfile.topGenres\n    });\n\n    return detailedProfile;\n\n  } catch (error) {\n    console.error('[Spotify Auth] Exception fetching detailed Spotify profile:', error);\n    return null;\n  }\n}; ","import { SpotifyTrack } from './ConversionContext';\r\n\r\n// Helper to normalize strings: lowercase, remove punctuation/diacritics\r\nconst normalize = (str: string) =>\r\n  str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/\\p{Diacritic}+/gu, '')\r\n    .replace(/[“”\"'`]/g, '')\r\n    .replace(/\\s+/g, ' ')\r\n    .replace(/[^\\p{L}\\p{N}\\s]/gu, '')\r\n    .trim();\r\n\r\n// Helper to clean YouTube/track titles\r\nexport const parseYouTubeTitle = (videoTitle: string, channelTitle: string) => {\r\n  // Remove common YouTube suffixes\r\n  const cleanTitle = videoTitle\r\n    .replace(/\\s*\\([^)]*\\)/g, '')\r\n    .replace(/\\s*\\[[^\\]]*\\]/g, '')\r\n    .replace(/\\s*\\|[^|]*$/g, '')\r\n    .replace(/\\s*【[^】]*】/g, '')\r\n    .replace(/\\s*feat\\./gi, ' ft. ')\r\n    .replace(/\\s*ft\\./gi, ' ft. ')\r\n    .trim();\r\n\r\n  const separators = [' - ', ' – ', ': ', ' \"', \" '\", ' // ', ' | '];\r\n  let artist = channelTitle;\r\n  let song = cleanTitle;\r\n\r\n  for (const separator of separators) {\r\n    if (cleanTitle.includes(separator)) {\r\n      const parts = cleanTitle.split(separator);\r\n      if (parts.length >= 2) {\r\n        artist = parts[0].trim();\r\n        song = parts\r\n          .slice(1)\r\n          .join(separator)\r\n          .replace(/^['\"]/, '')\r\n          .replace(/['\"]$/, '')\r\n          .trim();\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Clean up the song title\r\n  song = song\r\n    .replace(/^\\d+\\s*[-–]\\s*/, '')\r\n    .replace(/\\s*\\([^)]*\\)/g, '')\r\n    .replace(/\\s*\\[[^\\]]*\\]/g, '')\r\n    .trim();\r\n\r\n  return { artist, song };\r\n};\r\n\r\n// Improved similarity calculation for YouTube to Spotify conversion\r\nexport const calculateTrackSimilarity = (originalTrack: SpotifyTrack, spotifyTrack: any): number => {\r\n  let score = 0;\r\n\r\n  const stripFeaturing = (s: string) => s.replace(/\\s+(ft\\.|feat\\.|featuring)\\s+.*$/i, '').trim();\r\n\r\n  const originalTitle = normalize(stripFeaturing(originalTrack.name));\r\n  const originalArtist = normalize(stripFeaturing(originalTrack.artists[0]));\r\n  const spotifyTitle = normalize(stripFeaturing(spotifyTrack.name));\r\n  const spotifyArtist = normalize(stripFeaturing(spotifyTrack.artists[0].name));\r\n\r\n  // Title similarity (45% weight)\r\n  if (originalTitle === spotifyTitle) {\r\n    score += 0.45;\r\n  } else if (spotifyTitle.includes(originalTitle) || originalTitle.includes(spotifyTitle)) {\r\n    score += 0.35;\r\n  } else {\r\n    const titleWords = originalTitle.split(' ');\r\n    const spotifyTitleWords = spotifyTitle.split(' ');\r\n    const commonWords = titleWords.filter((word) => spotifyTitleWords.includes(word));\r\n    if (commonWords.length > 0) {\r\n      score += (commonWords.length / Math.max(titleWords.length, spotifyTitleWords.length)) * 0.25;\r\n    }\r\n  }\r\n\r\n  // Artist similarity (45% weight)\r\n  if (originalArtist === spotifyArtist) {\r\n    score += 0.45;\r\n  } else if (spotifyArtist.includes(originalArtist) || originalArtist.includes(spotifyArtist)) {\r\n    score += 0.35;\r\n  } else {\r\n    const artistWords = originalArtist.split(' ');\r\n    const spotifyArtistWords = spotifyArtist.split(' ');\r\n    const commonWords = artistWords.filter((word) => spotifyArtistWords.includes(word));\r\n    if (commonWords.length > 0) {\r\n      score += (commonWords.length / Math.max(artistWords.length, spotifyArtistWords.length)) * 0.2;\r\n    }\r\n  }\r\n\r\n  // Duration tolerance (10% weight)\r\n  if (originalTrack.duration_ms && spotifyTrack.duration_ms) {\r\n    const diff = Math.abs(originalTrack.duration_ms - spotifyTrack.duration_ms);\r\n    const toleranceMs = Math.max(8000, Math.floor(originalTrack.duration_ms * 0.05));\r\n    const durationSimilarity = diff <= toleranceMs ? 1 : Math.max(0, 1 - diff / (originalTrack.duration_ms * 2));\r\n    score += durationSimilarity * 0.1;\r\n  }\r\n\r\n  // Bonus for official/non-live when names match\r\n  const titleRaw = (spotifyTrack.name || '').toLowerCase();\r\n  if (titleRaw.includes('live') || titleRaw.includes('remix')) {\r\n    score -= 0.05;\r\n  }\r\n  score = Math.max(0, Math.min(score, 1));\r\n  return score;\r\n};\r\n\r\n// Generate better search queries for YouTube to Spotify conversion\r\nexport const generateSearchQueries = (track: SpotifyTrack) => {\r\n  const artist = stripFeaturingSafe(track.artists[0]);\r\n  const song = stripFeaturingSafe(track.name);\r\n\r\n  const cleanSong = song\r\n    .replace(/^\\d+\\s*[-–]\\s*/, '')\r\n    .replace(/\\s*\\([^)]*\\)/g, '')\r\n    .replace(/\\s*\\[[^\\]]*\\]/g, '')\r\n    .trim();\r\n\r\n  const cleanArtist = artist\r\n    .replace(/\\s*\\([^)]*\\)/g, '')\r\n    .replace(/\\s*\\[[^\\]]*\\]/g, '')\r\n    .trim();\r\n\r\n  return [\r\n    `${cleanArtist} ${cleanSong}`,\r\n    `${cleanSong} ${cleanArtist}`,\r\n    cleanSong,\r\n    `${cleanArtist} - ${cleanSong}`,\r\n    `${cleanArtist} \"${cleanSong}\"`,\r\n    `${cleanArtist} ${cleanSong} official`,\r\n    `${cleanArtist} ${cleanSong} audio`,\r\n    `${cleanSong} by ${cleanArtist}`,\r\n    cleanSong.replace(/\\s*ft\\.?\\s*[^,\\s]+/gi, '').trim(),\r\n    `${cleanArtist} ${cleanSong.replace(/\\s*ft\\.?\\s*[^,\\s]+/gi, '').trim()}`,\r\n    `${artist} ${song}`,\r\n    `${song} ${artist}`,\r\n    song,\r\n  ].filter((q) => q.length > 0);\r\n};\r\n\r\nconst stripFeaturingSafe = (s: string) => s.replace(/\\s+(ft\\.|feat\\.|featuring)\\s+.*$/i, '').trim(); ","// Custom toast function that matches the project's toast system\r\nconst showToast = (type: 'success' | 'error' | 'warning' | 'info', message: string) => {\r\n  // Dispatch a custom event that the app can listen to\r\n  window.dispatchEvent(new CustomEvent('show-toast', {\r\n    detail: { type, message }\r\n  }));\r\n};\r\n\r\ninterface NetworkError {\r\n  type: 'firebase' | 'analytics' | 'api' | 'general';\r\n  message: string;\r\n  retryable: boolean;\r\n  retryCount?: number;\r\n}\r\n\r\nclass NetworkResilienceService {\r\n  private static instance: NetworkResilienceService;\r\n  private retryDelays = [1000, 2000, 4000, 8000]; // Exponential backoff\r\n  private maxRetries = 3;\r\n\r\n  static getInstance(): NetworkResilienceService {\r\n    if (!NetworkResilienceService.instance) {\r\n      NetworkResilienceService.instance = new NetworkResilienceService();\r\n    }\r\n    return NetworkResilienceService.instance;\r\n  }\r\n\r\n  /**\r\n   * Handle Firebase/Firestore connection errors gracefully\r\n   */\r\n  handleFirebaseError(error: any, context: string = 'Firebase operation'): NetworkError {\r\n    const errorMessage = error?.message || error?.toString() || 'Unknown error';\r\n    \r\n    // Check if it's a network-related error\r\n    const isNetworkError = \r\n      errorMessage.includes('ERR_QUIC_PROTOCOL_ERROR') ||\r\n      errorMessage.includes('ERR_CONNECTION_TIMED_OUT') ||\r\n      errorMessage.includes('ERR_CONNECTION_ABORTED') ||\r\n      errorMessage.includes('ERR_NETWORK_CHANGED') ||\r\n      errorMessage.includes('firestore.googleapis.com') ||\r\n      errorMessage.includes('firebaseapp.com');\r\n\r\n    if (isNetworkError) {\r\n      console.warn(`Network error in ${context}:`, errorMessage);\r\n      \r\n      // Don't show toast for network errors to avoid spam\r\n      return {\r\n        type: 'firebase',\r\n        message: errorMessage,\r\n        retryable: true\r\n      };\r\n    }\r\n\r\n    // For other Firebase errors, show a user-friendly message\r\n    console.error(`Firebase error in ${context}:`, error);\r\n    \r\n    return {\r\n      type: 'firebase',\r\n      message: 'Unable to connect to our servers. Please check your internet connection.',\r\n      retryable: true\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handle API errors with retry logic\r\n   */\r\n  async withRetry<T>(\r\n    operation: () => Promise<T>,\r\n    context: string = 'API operation',\r\n    maxRetries: number = this.maxRetries\r\n  ): Promise<T> {\r\n    let lastError: any;\r\n\r\n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\r\n      try {\r\n        return await operation();\r\n      } catch (error) {\r\n        lastError = error;\r\n        \r\n        const networkError = this.handleFirebaseError(error, context);\r\n        \r\n        if (!networkError.retryable || attempt === maxRetries) {\r\n          // Final attempt failed or error is not retryable\r\n          if (attempt > 0) {\r\n            showToast('error', `Failed after ${attempt + 1} attempts. Please try again later.`);\r\n          } else {\r\n            showToast('error', networkError.message);\r\n          }\r\n          throw error;\r\n        }\r\n\r\n        // Wait before retrying\r\n        const delay = this.retryDelays[Math.min(attempt, this.retryDelays.length - 1)];\r\n        console.log(`Retrying ${context} in ${delay}ms (attempt ${attempt + 1}/${maxRetries + 1})`);\r\n        \r\n        await new Promise(resolve => setTimeout(resolve, delay));\r\n      }\r\n    }\r\n\r\n    throw lastError;\r\n  }\r\n\r\n  /**\r\n   * Check if the user is online\r\n   */\r\n  isOnline(): boolean {\r\n    return navigator.onLine;\r\n  }\r\n\r\n  /**\r\n   * Monitor network status and show appropriate messages\r\n   */\r\n  setupNetworkMonitoring(): void {\r\n    window.addEventListener('online', () => {\r\n      console.log('Network connection restored');\r\n      showToast('success', 'Connection restored!');\r\n    });\r\n\r\n    window.addEventListener('offline', () => {\r\n      console.log('Network connection lost');\r\n      showToast('error', 'No internet connection. Some features may be unavailable.');\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Suppress specific console errors that are expected\r\n   */\r\n  suppressExpectedErrors(): void {\r\n    const originalConsoleError = console.error;\r\n    const originalConsoleWarn = console.warn;\r\n\r\n    console.error = function(...args) {\r\n      const message = args.join(' ');\r\n      \r\n      // Suppress expected network errors\r\n      if (message.includes('ERR_QUIC_PROTOCOL_ERROR') ||\r\n          message.includes('ERR_CONNECTION_TIMED_OUT') ||\r\n          message.includes('ERR_CONNECTION_ABORTED') ||\r\n          message.includes('ERR_NETWORK_CHANGED') ||\r\n          message.includes('firestore.googleapis.com') ||\r\n          message.includes('google-analytics.com') ||\r\n          message.includes('mp/collect?measurement_id=')) {\r\n        return;\r\n      }\r\n      \r\n      // Swallow noisy React element checks from third-party extensions\r\n      if (message.includes(\"Cannot read properties of undefined (reading 'isElement')\")) {\r\n        return;\r\n      }\r\n      \r\n      originalConsoleError.apply(console, args);\r\n    };\r\n\r\n    console.warn = function(...args) {\r\n      const message = args.join(' ');\r\n      \r\n      // Suppress expected warnings\r\n      if (message.includes('firestore.googleapis.com') ||\r\n          message.includes('google-analytics.com') ||\r\n          message.includes('mp/collect?measurement_id=')) {\r\n        return;\r\n      }\r\n      \r\n      originalConsoleWarn.apply(console, args);\r\n    };\r\n\r\n    // Also attach a window-level error handler to prevent bubbling\r\n    window.addEventListener('error', (event) => {\r\n      const msg = String(event?.error?.message || event?.message || '');\r\n      if (msg.includes(\"Cannot read properties of undefined (reading 'isElement')\")) {\r\n        event.preventDefault();\r\n      }\r\n      if (msg.includes('google-analytics.com') || msg.includes('mp/collect?measurement_id=')) {\r\n        event.preventDefault();\r\n      }\r\n    });\r\n\r\n    window.addEventListener('unhandledrejection', (event) => {\r\n      const reason = String((event as any)?.reason?.message || (event as any)?.reason || '');\r\n      if (reason.includes(\"Cannot read properties of undefined (reading 'isElement')\") ||\r\n          reason.includes('google-analytics.com') ||\r\n          reason.includes('mp/collect?measurement_id=')) {\r\n        event.preventDefault();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize the network resilience service\r\n   */\r\n  initialize(): void {\r\n    this.setupNetworkMonitoring();\r\n    this.suppressExpectedErrors();\r\n    console.log('Network resilience service initialized');\r\n  }\r\n}\r\n\r\nexport const networkResilience = NetworkResilienceService.getInstance();\r\nexport default networkResilience; ","import { PlatformKey } from '../components/MobileConverter';\r\nimport { db, storage, auth } from '../lib/firebase';\r\nimport { doc, getDoc, setDoc, updateDoc, collection, query, where, orderBy, limit, getDocs, deleteDoc } from 'firebase/firestore';\r\nimport { getAuth, updateProfile } from 'firebase/auth';\r\nimport { ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage';\r\nimport networkResilience from './networkResilience';\r\n\r\nexport interface UserProfile {\r\n  id: string;\r\n  displayName: string;\r\n  email: string;\r\n  photoURL?: string;\r\n  bio?: string;\r\n  location?: string;\r\n  website?: string;\r\n  phone?: string;\r\n  birthDate?: string;\r\n  favoriteGenre?: string;\r\n  favoriteArtist?: string;\r\n  isPremium: boolean;\r\n  createdAt: Date;\r\n  lastActive: Date;\r\n}\r\n\r\nexport interface UserStats {\r\n  conversions: number;\r\n  tracks: number;\r\n  monthlyUsage: number;\r\n  monthlyLimit: number;\r\n  platformUsage: {\r\n    spotify: number;\r\n    youtube: number;\r\n    soundcloud: number;\r\n  };\r\n  successRate: number;\r\n  totalPlaylists: number;\r\n}\r\n\r\nexport interface ProfileSettings {\r\n  theme: 'light' | 'dark' | 'auto';\r\n  notifications: {\r\n    email: boolean;\r\n    push: boolean;\r\n    conversionComplete: boolean;\r\n    weeklyReport: boolean;\r\n  };\r\n  privacy: {\r\n    shareStats: boolean;\r\n    publicProfile: boolean;\r\n    showEmail: boolean;\r\n    showLocation: boolean;\r\n    showStats: boolean;\r\n  };\r\n}\r\n\r\nexport class ProfileService {\r\n  private static instance: ProfileService;\r\n\r\n  public static getInstance(): ProfileService {\r\n    if (!ProfileService.instance) {\r\n      ProfileService.instance = new ProfileService();\r\n    }\r\n    return ProfileService.instance;\r\n  }\r\n\r\n  // Get user stats from Firestore or calculate from real data\r\n  async getUserStats(userId: string): Promise<UserStats> {\r\n    try {\r\n      console.log('Fetching user stats for:', userId);\r\n      \r\n      // First, try to calculate real stats from conversion history\r\n      const realStats = await this.calculateRealStats(userId);\r\n      \r\n      // If we have real conversion data, use it\r\n      if (realStats.conversions > 0) {\r\n        console.log('Using real stats from conversion history:', realStats);\r\n        return realStats;\r\n      }\r\n      \r\n      // Fallback to stored stats if no conversion history exists\r\n      const userDoc = await getDoc(doc(db, 'users', userId));\r\n      \r\n      if (userDoc.exists()) {\r\n        const userData = userDoc.data();\r\n        console.log('User data from Firestore:', userData);\r\n        \r\n        const stats = userData.stats || {\r\n          conversions: 0,\r\n          tracks: 0,\r\n          monthlyUsage: 0,\r\n          monthlyLimit: 50,\r\n          platformUsage: {\r\n            spotify: 0,\r\n            youtube: 0,\r\n            soundcloud: 0\r\n          },\r\n          successRate: 0,\r\n          totalPlaylists: 0\r\n        };\r\n        \r\n        console.log('Processed stats:', stats);\r\n        return stats;\r\n      }\r\n      \r\n      console.log('No user document found, returning default stats');\r\n      // Return default stats for users without documents\r\n      return {\r\n        conversions: 0,\r\n        tracks: 0,\r\n        monthlyUsage: 0,\r\n        monthlyLimit: 50,\r\n        platformUsage: {\r\n          spotify: 0,\r\n          youtube: 0,\r\n          soundcloud: 0\r\n        },\r\n        successRate: 0,\r\n        totalPlaylists: 0\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting user stats:', error);\r\n      // Return default stats on error\r\n      return {\r\n        conversions: 0,\r\n        tracks: 0,\r\n        monthlyUsage: 0,\r\n        monthlyLimit: 50,\r\n        platformUsage: {\r\n          spotify: 0,\r\n          youtube: 0,\r\n          soundcloud: 0\r\n        },\r\n        successRate: 0,\r\n        totalPlaylists: 0\r\n      };\r\n    }\r\n  }\r\n\r\n  // Update user statistics in Firestore\r\n  async updateUserStats(userId: string, stats: Partial<UserStats>): Promise<UserStats> {\r\n    try {\r\n      const userRef = doc(db, 'users', userId);\r\n      await updateDoc(userRef, {\r\n        'stats': stats,\r\n        'lastUpdated': new Date()\r\n      });\r\n      \r\n      return await this.getUserStats(userId);\r\n    } catch (error) {\r\n      console.error('Error updating user stats:', error);\r\n      throw new Error('Failed to update user statistics');\r\n    }\r\n  }\r\n\r\n  // Get user profile from Firebase Auth and Firestore\r\n  async getUserProfile(userId: string): Promise<UserProfile | null> {\r\n    return networkResilience.withRetry(async () => {\r\n      const auth = getAuth();\r\n      const currentUser = auth.currentUser;\r\n      \r\n      if (!currentUser) {\r\n        throw new Error('No authenticated user found');\r\n      }\r\n\r\n      // Get additional profile data from Firestore\r\n      const userDoc = await getDoc(doc(db, 'users', userId));\r\n      const firestoreData = userDoc.exists() ? userDoc.data() : {};\r\n      \r\n      const profile: UserProfile = {\r\n        id: userId,\r\n        displayName: currentUser.displayName || firestoreData.displayName || 'User',\r\n        email: currentUser.email || '',\r\n        photoURL: currentUser.photoURL || firestoreData.photoURL,\r\n        bio: firestoreData.bio || '',\r\n        isPremium: firestoreData.isPremium || false,\r\n        createdAt: firestoreData.createdAt ? new Date(firestoreData.createdAt.toDate()) : new Date(currentUser.metadata.creationTime || Date.now()),\r\n        lastActive: new Date()\r\n      };\r\n      \r\n      return profile;\r\n    }, 'getUserProfile');\r\n  }\r\n\r\n  // Update user profile in Firebase Auth and Firestore\r\n  async updateUserProfile(userId: string, profile: Partial<UserProfile>): Promise<UserProfile> {\r\n    return networkResilience.withRetry(async () => {\r\n      const auth = getAuth();\r\n      const currentUser = auth.currentUser;\r\n      \r\n      if (!currentUser) {\r\n        throw new Error('No authenticated user found');\r\n      }\r\n\r\n      // Update Firebase Auth profile\r\n      if (profile.displayName || profile.photoURL) {\r\n        await updateProfile(currentUser, {\r\n          displayName: profile.displayName || currentUser.displayName,\r\n          photoURL: profile.photoURL || currentUser.photoURL\r\n        });\r\n      }\r\n\r\n      // Update Firestore profile data\r\n      const userRef = doc(db, 'users', userId);\r\n      const updateData: any = {\r\n        lastUpdated: new Date()\r\n      };\r\n      \r\n      if (profile.displayName) updateData.displayName = profile.displayName;\r\n      if (profile.photoURL) updateData.photoURL = profile.photoURL;\r\n      if (profile.bio !== undefined) updateData.bio = profile.bio;\r\n      if (profile.isPremium !== undefined) updateData.isPremium = profile.isPremium;\r\n      \r\n      await updateDoc(userRef, updateData);\r\n      \r\n      return await this.getUserProfile(userId) as UserProfile;\r\n    }, 'updateUserProfile');\r\n  }\r\n\r\n  // Upload profile image to Firebase Storage\r\n  async uploadProfileImage(userId: string, file: File): Promise<string> {\r\n    try {\r\n      \r\n      // Check if user is authenticated\r\n      const currentUser = auth.currentUser;\r\n      if (!currentUser || currentUser.uid !== userId) {\r\n        throw new Error('Authentication required. Please sign in again.');\r\n      }\r\n      \r\n      // Validate file\r\n      if (!file) {\r\n        throw new Error('No file provided');\r\n      }\r\n      \r\n      // Check file size (max 5MB)\r\n      const maxSize = 5 * 1024 * 1024; // 5MB\r\n      if (file.size > maxSize) {\r\n        throw new Error('File size too large. Please select an image under 5MB.');\r\n      }\r\n      \r\n      // Check file type\r\n      if (!file.type.startsWith('image/')) {\r\n        throw new Error('Please select a valid image file.');\r\n      }\r\n      \r\n      // Create a unique filename\r\n      const timestamp = Date.now();\r\n      const fileExtension = (file.name.split('.').pop() || 'jpg').toLowerCase();\r\n      const fileName = `profile-images/${userId}/${timestamp}-${crypto.randomUUID?.() || Math.random().toString(36).slice(2)}.${fileExtension}`;\r\n      \r\n      // Create storage reference\r\n      const storageRef = ref(storage, fileName);\r\n      \r\n      // Upload file resumably with metadata\r\n      console.log(`[ProfileService] Uploading profile image for user ${userId}`);\r\n      const metadata = { contentType: file.type, cacheControl: 'public,max-age=31536000' } as const;\r\n      const uploadTask = uploadBytesResumable(storageRef, file, metadata);\r\n      await new Promise<void>((resolve, reject) => {\r\n        uploadTask.on('state_changed', undefined, (err) => {\r\n          try {\r\n            console.error('[ProfileService] Upload error payload:', {\r\n              code: (err as any)?.code,\r\n              serverResponse: (err as any)?.serverResponse,\r\n              message: (err as any)?.message,\r\n            });\r\n          } catch {}\r\n          reject(err);\r\n        }, () => resolve());\r\n      });\r\n      \r\n      // Get download URL\r\n      const downloadURL = await getDownloadURL(storageRef);\r\n      \r\n      console.log(`[ProfileService] Profile image uploaded successfully: ${downloadURL}`);\r\n      return downloadURL;\r\n      \r\n    } catch (error) {\r\n      console.error('[ProfileService] Error uploading profile image:', error);\r\n      \r\n      if (error instanceof Error) {\r\n        if ((error as any)?.code === 'storage/unauthorized') {\r\n          throw new Error('You do not have permission to upload images. Please sign in again.');\r\n        }\r\n        if ((error as any)?.code === 'storage/canceled') {\r\n          throw new Error('Upload canceled. Please try again.');\r\n        }\r\n        if ((error as any)?.code === 'storage/retry-limit-exceeded' || (error as any)?.code === 'storage/cannot-slice-blob') {\r\n          throw new Error('Upload failed due to connection issues. Please try again.');\r\n        }\r\n        if ((error as any)?.serverResponse && String((error as any).serverResponse).includes('PreconditionFailed')) {\r\n          throw new Error('Upload failed due to a precondition error. Please retry.');\r\n        }\r\n        throw new Error(`Upload failed: ${error.message}`);\r\n      }\r\n      \r\n      throw new Error('Failed to upload profile image. Please try again.');\r\n    }\r\n  }\r\n\r\n  // Get profile settings from Firestore\r\n  async getProfileSettings(userId: string): Promise<ProfileSettings> {\r\n    try {\r\n      const userDoc = await getDoc(doc(db, 'users', userId));\r\n      \r\n      if (userDoc.exists()) {\r\n        const userData = userDoc.data();\r\n        return userData.settings || {\r\n          theme: 'dark',\r\n          notifications: {\r\n            email: true,\r\n            push: true,\r\n            conversionComplete: true,\r\n            weeklyReport: false\r\n          },\r\n          privacy: {\r\n            shareStats: false,\r\n            publicProfile: false,\r\n            showEmail: false,\r\n            showLocation: false,\r\n            showStats: true\r\n          }\r\n        };\r\n      }\r\n      \r\n      // Return default settings\r\n      return {\r\n        theme: 'dark',\r\n        notifications: {\r\n          email: true,\r\n          push: true,\r\n          conversionComplete: true,\r\n          weeklyReport: false\r\n        },\r\n        privacy: {\r\n          shareStats: false,\r\n          publicProfile: false,\r\n          showEmail: false,\r\n          showLocation: false,\r\n          showStats: true\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting profile settings:', error);\r\n      throw new Error('Failed to load profile settings');\r\n    }\r\n  }\r\n\r\n  // Update profile settings in Firestore\r\n  async updateProfileSettings(userId: string, settings: Partial<ProfileSettings>): Promise<ProfileSettings> {\r\n    try {\r\n      const userRef = doc(db, 'users', userId);\r\n      await updateDoc(userRef, {\r\n        'settings': settings,\r\n        'lastUpdated': new Date()\r\n      });\r\n      \r\n      return await this.getProfileSettings(userId);\r\n    } catch (error) {\r\n      console.error('Error updating profile settings:', error);\r\n      throw new Error('Failed to update profile settings');\r\n    }\r\n  }\r\n\r\n  // Export user data\r\n  async exportUserData(userId: string): Promise<any> {\r\n    try {\r\n      const [profile, stats, settings, conversionHistory] = await Promise.all([\r\n        this.getUserProfile(userId),\r\n        this.getUserStats(userId),\r\n        this.getProfileSettings(userId),\r\n        this.getConversionHistory(userId, 1000) // Get all conversions\r\n      ]);\r\n\r\n      const exportData = {\r\n        exportDate: new Date().toISOString(),\r\n        user: {\r\n          profile,\r\n          stats,\r\n          settings\r\n        },\r\n        conversionHistory,\r\n        exportFormat: 'json',\r\n        version: '1.0'\r\n      };\r\n\r\n      return exportData;\r\n    } catch (error) {\r\n      console.error('Error exporting user data:', error);\r\n      throw new Error('Failed to export user data');\r\n    }\r\n  }\r\n\r\n  // Delete user account and all associated data\r\n  async deleteUserAccount(userId: string): Promise<boolean> {\r\n    try {\r\n      // Import Firebase Storage functions for cleanup\r\n      const { ref, listAll, deleteObject } = await import('firebase/storage');\r\n      const { storage } = await import('../lib/firebase');\r\n      \r\n      // Delete profile images from Storage\r\n      try {\r\n        const profileImagesRef = ref(storage, `profile-images/${userId}`);\r\n        const imageList = await listAll(profileImagesRef);\r\n        await Promise.all(imageList.items.map(item => deleteObject(item)));\r\n      } catch (storageError) {\r\n        console.warn('Could not delete profile images:', storageError);\r\n      }\r\n\r\n      // Delete user document and all subcollections\r\n      const userRef = doc(db, 'users', userId);\r\n      await deleteDoc(userRef);\r\n\r\n      // Delete conversion history\r\n      const conversionsRef = collection(db, 'users', userId, 'conversions');\r\n      const conversionsSnapshot = await getDocs(conversionsRef);\r\n      await Promise.all(conversionsSnapshot.docs.map(doc => deleteDoc(doc.ref)));\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting user account:', error);\r\n      throw new Error('Failed to delete user account');\r\n    }\r\n  }\r\n\r\n  // Get conversion history from Firestore\r\n  async getConversionHistory(userId: string, limitCount: number = 10): Promise<any[]> {\r\n    try {\r\n      const conversionsRef = collection(db, 'conversions');\r\n      const q = query(\r\n        conversionsRef,\r\n        where('userId', '==', userId),\r\n        orderBy('createdAt', 'desc'),\r\n        limit(limitCount)\r\n      );\r\n      \r\n      const querySnapshot = await getDocs(q);\r\n      const conversions = querySnapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n        createdAt: doc.data().createdAt?.toDate ? doc.data().createdAt.toDate() : new Date()\r\n      }));\r\n      \r\n      return conversions;\r\n    } catch (error) {\r\n      console.error('Error getting conversion history:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // Get platform usage statistics\r\n  async getPlatformUsage(userId: string): Promise<{ [key in PlatformKey]: number }> {\r\n    try {\r\n      const stats = await this.getUserStats(userId);\r\n      return {\r\n        spotify: stats.platformUsage.spotify,\r\n        youtube: stats.platformUsage.youtube,\r\n        soundcloud: stats.platformUsage.soundcloud\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting platform usage:', error);\r\n      return { spotify: 0, youtube: 0, soundcloud: 0 };\r\n    }\r\n  }\r\n\r\n  // Check if user has premium features\r\n  async hasPremiumFeatures(userId: string): Promise<boolean> {\r\n    try {\r\n      const profile = await this.getUserProfile(userId);\r\n      return profile?.isPremium || false;\r\n    } catch (error) {\r\n      console.error('Error checking premium features:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Upgrade user to premium\r\n  async upgradeToPremium(userId: string): Promise<boolean> {\r\n    try {\r\n      await this.updateUserProfile(userId, { isPremium: true });\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error upgrading to premium:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Get monthly usage statistics\r\n  async getMonthlyUsage(userId: string, month: number, year: number): Promise<{ used: number; limit: number }> {\r\n    try {\r\n      const stats = await this.getUserStats(userId);\r\n      return {\r\n        used: stats.monthlyUsage,\r\n        limit: stats.monthlyLimit\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting monthly usage:', error);\r\n      return { used: 0, limit: 50 };\r\n    }\r\n  }\r\n\r\n  // Reset monthly usage\r\n  async resetMonthlyUsage(userId: string): Promise<void> {\r\n    try {\r\n      await this.updateUserStats(userId, { monthlyUsage: 0 });\r\n    } catch (error) {\r\n      console.error('Error resetting monthly usage:', error);\r\n    }\r\n  }\r\n\r\n  // Add a conversion to user stats with platform tracking\r\n  async addConversion(userId: string, tracksConverted: number = 1, platformDirection?: 'spotify-to-youtube' | 'youtube-to-spotify'): Promise<void> {\r\n    try {\r\n      const stats = await this.getUserStats(userId);\r\n      \r\n      // Calculate new success rate based on total conversions and tracks\r\n      const newTotalTracks = stats.tracks + tracksConverted;\r\n      const newSuccessRate = newTotalTracks > 0 ? ((stats.conversions * 100) / newTotalTracks) : 0;\r\n      \r\n      // Update platform usage based on conversion direction\r\n      const platformUsage = { ...stats.platformUsage };\r\n      if (platformDirection === 'spotify-to-youtube') {\r\n        platformUsage.spotify = (platformUsage.spotify || 0) + 1;\r\n      } else if (platformDirection === 'youtube-to-spotify') {\r\n        platformUsage.youtube = (platformUsage.youtube || 0) + 1;\r\n      }\r\n      \r\n      await this.updateUserStats(userId, {\r\n        conversions: stats.conversions + 1,\r\n        tracks: newTotalTracks,\r\n        monthlyUsage: stats.monthlyUsage + 1,\r\n        successRate: Math.round(newSuccessRate),\r\n        platformUsage: platformUsage\r\n      });\r\n      \r\n      console.log(`Updated user stats: +1 conversion, +${tracksConverted} tracks, success rate: ${Math.round(newSuccessRate)}%, platform usage updated`);\r\n    } catch (error) {\r\n      console.error('Error adding conversion:', error);\r\n    }\r\n  }\r\n\r\n  // Calculate and update success rate\r\n  async getSuccessRate(userId: string): Promise<number> {\r\n    try {\r\n      const stats = await this.getUserStats(userId);\r\n      return stats.successRate;\r\n    } catch (error) {\r\n      console.error('Error getting success rate:', error);\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  // Calculate real stats from conversion history\r\n  async calculateRealStats(userId: string): Promise<UserStats> {\r\n    try {\r\n      console.log('[ProfileService] Calculating real stats for user:', userId);\r\n      \r\n      const { collection, query, where, getDocs, orderBy } = await import('firebase/firestore');\r\n      const { db } = await import('../lib/firebase');\r\n      \r\n      // Get conversion history from Firestore\r\n      const conversionsRef = collection(db, 'users', userId, 'conversions');\r\n      \r\n      // Try without orderBy first to avoid index issues\r\n      let q;\r\n      try {\r\n        q = query(conversionsRef, orderBy('convertedAt', 'desc'));\r\n      } catch (indexError) {\r\n        console.warn('[ProfileService] OrderBy failed, trying without ordering:', indexError);\r\n        q = query(conversionsRef);\r\n      }\r\n      \r\n      const querySnapshot = await getDocs(q);\r\n      console.log('[ProfileService] Found', querySnapshot.size, 'conversions in Firestore');\r\n      \r\n      let totalConversions = 0;\r\n      let totalTracks = 0;\r\n      let spotifyConversions = 0;\r\n      let youtubeConversions = 0;\r\n      let currentMonthUsage = 0;\r\n      const currentMonth = new Date().getMonth();\r\n      const currentYear = new Date().getFullYear();\r\n      \r\n      querySnapshot.forEach((doc) => {\r\n        const data = doc.data();\r\n        console.log('[ProfileService] Processing conversion:', {\r\n          id: doc.id,\r\n          tracksMatched: data.tracksMatched,\r\n          spotifyPlaylistId: data.spotifyPlaylistId,\r\n          youtubePlaylistId: data.youtubePlaylistId,\r\n          convertedAt: data.convertedAt\r\n        });\r\n        \r\n        const convertedAt = data.convertedAt?.toDate ? data.convertedAt.toDate() : new Date(data.convertedAt);\r\n        \r\n        // Count conversions\r\n        totalConversions++;\r\n        \r\n        // Count tracks - use totalTracks field as fallback\r\n        const tracksCount = data.tracksMatched || data.totalTracks || 0;\r\n        totalTracks += tracksCount;\r\n        \r\n        // Count platform usage based on conversion type\r\n        if (data.spotifyPlaylistId && data.youtubePlaylistId) {\r\n          // This is a cross-platform conversion\r\n          if (data.spotifyPlaylistName) {\r\n            // Spotify to YouTube conversion\r\n            spotifyConversions++;\r\n          } else if (data.youtubePlaylistId) {\r\n            // YouTube to Spotify conversion\r\n            youtubeConversions++;\r\n          }\r\n        } else if (data.spotifyPlaylistId) {\r\n          // Spotify conversion\r\n          spotifyConversions++;\r\n        } else if (data.youtubePlaylistId) {\r\n          // YouTube conversion\r\n          youtubeConversions++;\r\n        }\r\n        \r\n        // Count monthly usage\r\n        if (convertedAt.getMonth() === currentMonth && convertedAt.getFullYear() === currentYear) {\r\n          currentMonthUsage++;\r\n        }\r\n      });\r\n      \r\n      // Calculate success rate\r\n      const successRate = totalConversions > 0 ? Math.round((totalTracks / totalConversions) * 100) : 0;\r\n      \r\n      const calculatedStats = {\r\n        conversions: totalConversions,\r\n        tracks: totalTracks,\r\n        monthlyUsage: currentMonthUsage,\r\n        monthlyLimit: 50,\r\n        platformUsage: {\r\n          spotify: spotifyConversions,\r\n          youtube: youtubeConversions,\r\n          soundcloud: 0 // Not implemented yet\r\n        },\r\n        successRate: successRate,\r\n        totalPlaylists: totalConversions // Each conversion represents a playlist\r\n      };\r\n      \r\n      console.log('[ProfileService] Calculated stats:', calculatedStats);\r\n      return calculatedStats;\r\n      \r\n    } catch (error) {\r\n      console.error('[ProfileService] Error calculating real stats:', error);\r\n      // Return default stats if calculation fails\r\n      return {\r\n        conversions: 0,\r\n        tracks: 0,\r\n        monthlyUsage: 0,\r\n        monthlyLimit: 50,\r\n        platformUsage: {\r\n          spotify: 0,\r\n          youtube: 0,\r\n          soundcloud: 0\r\n        },\r\n        successRate: 0,\r\n        totalPlaylists: 0\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const profileService = ProfileService.getInstance(); ","export type PlatformKey = 'spotify' | 'youtube' | 'soundcloud';\r\n\r\nexport interface TrackData {\r\n  id: string;\r\n  name: string;\r\n  artists: string[];\r\n  artistIds?: string[];\r\n  artistImages?: string[];\r\n  genres?: string[];\r\n  album?: string;\r\n  duration_ms: number;\r\n  popularity: number;\r\n  explicit?: boolean;\r\n  releaseYear?: string;\r\n  searchQuery?: string;\r\n  videoId?: string;\r\n}\r\n\r\nexport interface ConversionTrack {\r\n  name: string;\r\n  artists: string[];\r\n  popularity?: number;\r\n  duration_ms?: number;\r\n  explicit?: boolean;\r\n  album?: string;\r\n  releaseYear?: string | number;\r\n  genres?: string[];\r\n  artistImages?: string[];\r\n}\r\n\r\nexport interface Track {\r\n  name: string;\r\n  artists: string[];\r\n  popularity?: number;\r\n  duration_ms?: number;\r\n  explicit?: boolean;\r\n  album?: string;\r\n  releaseYear?: string | number;\r\n  genres?: string[];\r\n  artistImages?: string[];\r\n  id?: string;\r\n  searchQuery?: string;\r\n}\r\n\r\nexport interface YouTubePlaylist {\r\n  id: string;\r\n  snippet?: {\r\n    title?: string;\r\n    thumbnails?: {\r\n      default?: {\r\n        url: string;\r\n      };\r\n    };\r\n    channelTitle?: string;\r\n  };\r\n  contentDetails?: {\r\n    itemCount?: number;\r\n  };\r\n}\r\n\r\nexport type ConversionStep = 'select-source' | 'select-destination' | 'select-playlist' | 'converting';\r\n\r\nexport type ActiveTab = 'connections' | 'converter' | 'history' | 'profile';\r\n\r\nexport type ToastType = \"success\" | \"error\" | \"warning\" | \"info\";\r\n\r\nexport interface ConversionState {\r\n  sourcePlatform: PlatformKey | null;\r\n  destinationPlatform: PlatformKey | null;\r\n  playlistUrl: string;\r\n  playlistData: any;\r\n  conversionStep: ConversionStep;\r\n  isConverting: boolean;\r\n  conversionProgress: number;\r\n  failedTracks: any[];\r\n  conversionHistory: any[];\r\n}\r\n\r\nexport interface UIState {\r\n  activeTab: ActiveTab;\r\n  showEditProfile: boolean;\r\n  isLoading: boolean;\r\n  isInitialized: boolean;\r\n}\r\n\r\nexport enum ConversionStatus {\r\n  IDLE = 'idle',\r\n  LOADING_PLAYLISTS = 'loading_playlists',\r\n  SELECTING_PLAYLIST = 'selecting_playlist',\r\n  LOADING_TRACKS = 'loading_tracks',\r\n  MATCHING_TRACKS = 'matching_tracks',\r\n  CREATING_PLAYLIST = 'creating_playlist',\r\n  SUCCESS = 'success',\r\n  ERROR = 'error',\r\n} ","import React, { createContext, useContext, useReducer, useCallback } from 'react';\nimport { useAuth } from './AuthContext';\nimport { \n  getSpotifyPlaylists, \n  getSpotifyPlaylistTracks, \n  extractTrackData, \n  getSpotifyPlaylistById,\n  createSpotifyPlaylist,\n  addTracksToSpotifyPlaylist,\n  searchSpotifyTracks,\n  findUserPlaylistByName\n} from './spotifyApi';\nimport { \n  getYouTubePlaylists, \n  searchYouTube,\n  fetchAllYouTubePlaylistItems,\n  addToYouTubePlaylist,\n  findOrCreatePlaylist\n} from './youtubeApi';\nimport { getYouTubeToken } from './youtubeAuth';\nimport { collection, addDoc, getDocs, query, orderBy, Timestamp, Firestore, QuerySnapshot, doc, setDoc } from 'firebase/firestore';\nimport { db as firebaseDb, auth, reconnectFirestore } from './firebase';\nimport { isSpotifyAuthenticated, getSpotifyToken } from './spotifyAuth';\nimport TokenManager from './tokenManager';\nimport { checkForExistingPlaylist, generateUniquePlaylistName, ConversionLock } from './duplicatePrevention';\nimport { parseYouTubeTitle, calculateTrackSimilarity, generateSearchQueries } from './improvedConversion';\nimport { profileService } from '../services/profileService';\nimport { conversionConverter } from './firebase';\n\n// Type assertion for the Firestore db\nconst db = firebaseDb as Firestore;\n\n// Extend Window interface to add our custom property\ndeclare global {\n  interface Window {\n    _firebaseErrorLogged?: boolean;\n    _firestoreUsingOfflineMode?: boolean;\n  }\n}\n\n// === TYPES ===\nexport interface SpotifyPlaylist {\n  id: string;\n  name: string;\n  description: string;\n  imageUrl: string;\n  trackCount: number;\n  owner: string;\n}\n\nexport interface SpotifyTrack {\n  id: string;\n  name: string;\n  artists: string[];\n  album: string;\n  duration_ms: number;\n  popularity: number;\n  explicit: boolean;\n  searchQuery: string;\n  releaseYear?: string;\n  genres?: string[];\n  artistImages?: string[];\n}\n\nexport interface YouTubeMatch {\n  videoId: string;\n  title: string;\n  channelTitle: string;\n  thumbnailUrl: string;\n  score: number;\n  matchDetails: {\n    titleMatch: number;\n    artistMatch: number;\n    lengthScore: number;\n  };\n\n}\n\nexport interface ConversionResult {\n  id: string;\n  spotifyPlaylistId: string;\n  spotifyPlaylistName: string;\n  spotifyPlaylistUrl?: string;\n  youtubePlaylistId: string;\n  youtubePlaylistUrl: string;\n  tracksMatched: number;\n  tracksFailed: number;\n  totalTracks: number;\n  convertedAt: Date;\n\n  failedTracks?: FailedTrack[]; // Add failed tracks details\n}\n\n// New interface for tracking failed tracks\nexport interface FailedTrack {\n  name: string;\n  artists: string[];\n  reason: string;\n  searchQueries: string[];\n  bestMatchScore?: number;\n  bestMatchTitle?: string;\n  bestMatchArtist?: string;\n}\n\n// === STATE MANAGEMENT ===\nimport { ConversionStatus } from '../types/conversion';\n\ntype ConversionState = {\n  status: ConversionStatus;\n  error: string | null;\n  isLoading: boolean;\n  accountType: string | null;\n  spotifyPlaylists: SpotifyPlaylist[];\n  youtubePlaylists: any[];\n  selectedPlaylistId: string | null;\n  tracks: SpotifyTrack[];\n  matches: Map<string, YouTubeMatch | null>;\n  currentStep: number;\n  totalSteps: number;\n  youtubePlaylistId: string | null;\n  youtubePlaylistUrl: string | null;\n  spotifyPlaylistId: string | null;\n  spotifyPlaylistUrl: string | null;\n  conversionHistory: ConversionResult[];\n  matchingProgress: number;\n};\n\ntype ConversionAction =\n  | { type: 'SET_STATUS'; payload: ConversionStatus }\n  | { type: 'SET_ERROR'; payload: string | null }\n  | { type: 'SET_LOADING'; payload: boolean }\n  | { type: 'SET_ACCOUNT_TYPE'; payload: string | null }\n  | { type: 'SET_SPOTIFY_PLAYLISTS'; payload: SpotifyPlaylist[] }\n  | { type: 'SET_YOUTUBE_PLAYLISTS'; payload: any[] }\n  | { type: 'SELECT_PLAYLIST'; payload: string }\n  | { type: 'SET_TRACKS'; payload: SpotifyTrack[] }\n  | { type: 'SET_MATCHES'; payload: Map<string, YouTubeMatch | null> }\n  | { type: 'UPDATE_MATCHING_PROGRESS'; payload: number }\n  | { type: 'SET_YOUTUBE_PLAYLIST'; payload: { id: string; url: string } }\n  | { type: 'SET_SPOTIFY_PLAYLIST'; payload: { id: string; url: string } }\n  | { type: 'SET_CONVERSION_HISTORY'; payload: ConversionResult[] }\n  | { type: 'RESET' };\n\nconst initialState: ConversionState = {\n  status: ConversionStatus.IDLE,\n  error: null,\n  isLoading: false,\n  accountType: null,\n  spotifyPlaylists: [],\n  youtubePlaylists: [],\n  selectedPlaylistId: null,\n  tracks: [],\n  matches: new Map(),\n  currentStep: 0,\n  totalSteps: 4, // Connect to Spotify, Process Tracks, Match on YouTube, Create Playlist\n  youtubePlaylistId: null,\n  youtubePlaylistUrl: null,\n  spotifyPlaylistId: null,\n  spotifyPlaylistUrl: null,\n  conversionHistory: [],\n  matchingProgress: 0,\n};\n\nconst conversionReducer = (state: ConversionState, action: ConversionAction): ConversionState => {\n  switch (action.type) {\n    case 'SET_STATUS':\n      return { ...state, status: action.payload };\n    case 'SET_ERROR':\n      return { ...state, error: action.payload, status: action.payload ? ConversionStatus.ERROR : state.status };\n    case 'SET_LOADING':\n      return { ...state, isLoading: action.payload };\n    case 'SET_ACCOUNT_TYPE':\n      return { ...state, accountType: action.payload };\n    case 'SET_SPOTIFY_PLAYLISTS':\n      return { ...state, spotifyPlaylists: action.payload };\n    case 'SET_YOUTUBE_PLAYLISTS':\n      return { ...state, youtubePlaylists: action.payload };\n    case 'SELECT_PLAYLIST':\n      return { ...state, selectedPlaylistId: action.payload };\n    case 'SET_TRACKS':\n      return { ...state, tracks: action.payload };\n    case 'SET_MATCHES':\n      return { ...state, matches: action.payload };\n    case 'UPDATE_MATCHING_PROGRESS':\n      return { ...state, matchingProgress: action.payload };\n    case 'SET_YOUTUBE_PLAYLIST':\n      return { \n        ...state, \n        youtubePlaylistId: action.payload.id, \n        youtubePlaylistUrl: action.payload.url \n      };\n    case 'SET_SPOTIFY_PLAYLIST':\n      return { \n        ...state, \n        spotifyPlaylistId: action.payload.id, \n        spotifyPlaylistUrl: action.payload.url \n      };\n    case 'SET_CONVERSION_HISTORY':\n      return { ...state, conversionHistory: action.payload };\n    case 'RESET':\n      return { \n        ...initialState,\n        // Preserve the conversion history\n        conversionHistory: state.conversionHistory \n      };\n    default:\n      return state;\n  }\n};\n\n// === CONTEXT ===\ninterface ConversionContextType {\n  state: ConversionState;\n  fetchSpotifyPlaylists: () => Promise<void>;\n  fetchYouTubePlaylists: () => Promise<void>;\n  selectPlaylist: (playlistId: string) => void;\n  selectYouTubePlaylist: (playlistId: string) => void;\n  startConversion: () => Promise<void>;\n  convertFromPublicUrl: (playlistUrl: string, sourcePlatform: 'spotify' | 'youtube') => Promise<void>;\n  reconnectWithFamilyMode: () => Promise<void>;\n  resetConversion: () => void;\n  fetchConversionHistory: () => Promise<void>;\n\n  dispatch: React.Dispatch<ConversionAction>;\n}\n\nconst ConversionContext = createContext<ConversionContextType>({\n  state: initialState,\n  fetchSpotifyPlaylists: async () => {},\n  fetchYouTubePlaylists: async () => {},\n  selectPlaylist: () => {},\n  selectYouTubePlaylist: () => {},\n  startConversion: async () => {},\n  convertFromPublicUrl: async () => {},\n  reconnectWithFamilyMode: async () => {},\n  resetConversion: () => {},\n  fetchConversionHistory: async () => {},\n\n  dispatch: () => {},\n});\n\nexport const useConversion = () => useContext(ConversionContext);\n\n// Storage key for conversion history\nconst CONVERSION_HISTORY_KEY = 'playlist_converter_history';\n\n// Helper function to save conversion history to localStorage\nconst saveConversionHistoryToLocalStorage = (userId: string, history: ConversionResult[]) => {\n  try {\n    localStorage.setItem(`${CONVERSION_HISTORY_KEY}_${userId}`, JSON.stringify(history));\n  } catch (error) {\n    console.error('Error saving conversion history to localStorage:', error);\n  }\n};\n\n// Helper function to get conversion history from localStorage\nconst getConversionHistoryFromLocalStorage = (userId: string): ConversionResult[] => {\n  try {\n    const storedHistory = localStorage.getItem(`${CONVERSION_HISTORY_KEY}_${userId}`);\n    if (storedHistory) {\n      const parsedHistory = JSON.parse(storedHistory);\n      // Convert date strings back to Date objects\n      return parsedHistory.map((item: any) => ({\n        ...item,\n        convertedAt: new Date(item.convertedAt)\n      }));\n    }\n  } catch (error) {\n    console.error('Error retrieving conversion history from localStorage:', error);\n  }\n  return [];\n};\n\n// Helper function to check if error is a Firestore permissions error\nconst isFirestorePermissionError = (error: any): boolean => {\n  if (!error) return false;\n  \n  // Check for different ways permission errors might be represented\n  if (typeof error === 'object') {\n    // Direct code check\n    if (error.code === 'permission-denied') return true;\n    \n    // Message content check\n    if (typeof error.message === 'string') {\n      const message = error.message.toLowerCase();\n      return (\n        message.includes('missing or insufficient permissions') ||\n        message.includes('permission denied') ||\n        message.includes('unauthorized') ||\n        message.includes('access denied')\n      );\n    }\n  } else if (typeof error === 'string') {\n    const message = error.toLowerCase();\n    return (\n      message.includes('missing or insufficient permissions') ||\n      message.includes('permission denied') ||\n      message.includes('unauthorized') ||\n      message.includes('access denied')\n    );\n  }\n  \n  return false;\n};\n\n// New helper function to log detailed information about Firestore errors for debugging\nconst logFirestoreError = (context: string, error: any, userId?: string) => {\n  console.error(`[Firestore Error in ${context}]`, {\n    message: error?.message || 'Unknown error',\n    code: error?.code || 'No error code',\n    name: error?.name || 'No error name',\n    userId: userId || 'No user ID',\n    timestamp: new Date().toISOString(),\n    // Add any other useful debugging information\n    userAuth: auth?.currentUser ? 'User is authenticated' : 'No authenticated user',\n    firestoreConnected: typeof db !== 'undefined' ? 'Firestore is initialized' : 'Firestore not initialized'\n  });\n  \n  // Add special handling for permission errors\n  if (isFirestorePermissionError(error)) {\n    console.warn('[PERMISSION ERROR DETECTED] This is likely a Firestore security rules issue');\n    console.warn('Rules should allow access to collections: users/{userId}/conversions, users/{userId}/tokens, users/{userId}/history');\n    \n    // Attempt to help recovery by reconnecting\n    try {\n      reconnectFirestore().catch((error: Error | unknown) => console.warn('Failed to reconnect after permission error:', error));\n    } catch (error: unknown) {\n      // Ignore reconnect errors\n    }\n  }\n};\n\n// Helper function to check if error is a Firestore channel termination error\nconst isFirestoreChannelTerminationError = (error: any): boolean => {\n  return error && \n    typeof error.message === 'string' && \n    (error.message.includes('Listen/channel') || \n     error.message.includes('terminated') || \n     error.message.includes('Failed to load resource: the server responded with a status of 400'));\n};\n\n// Add this function to handle Firestore recovery\nconst handleFirestoreRecovery = async (error: any): Promise<boolean> => {\n  if (isFirestoreChannelTerminationError(error)) {\n    console.log('Attempting to recover from Firestore channel termination error');\n    try {\n      // Attempt to reconnect Firestore\n      await reconnectFirestore();\n      return true;\n    } catch (reconnectError) {\n      console.error('Error recovering Firestore connection:', reconnectError);\n    }\n  }\n  return false;\n};\n\nexport const ConversionProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [state, dispatch] = useReducer(conversionReducer, initialState);\n  const { user } = useAuth();\n\n  \n  // Helper function for showing toasts\n  const showToast = (type: 'success' | 'info' | 'warning' | 'error', message: string) => {\n    console.log(`[${type.toUpperCase()}] ${message}`);\n    // In a real app, you would show a toast notification here\n  };\n  \n  // Helper function to refresh authentication state\n  const refreshAuthState = useCallback(async () => {\n    const isSpotifyAuthed = await isSpotifyAuthenticated();\n    console.log('Refreshing auth state:', { \n      user: user?.uid, \n      isSpotifyAuthed,\n      hasSpotifyAuth: isSpotifyAuthed\n    });\n    \n    // Dispatch event to notify auth state change\n    if (isSpotifyAuthed) {\n      window.dispatchEvent(new CustomEvent('spotify-auth-changed', { \n        detail: { authenticated: true } \n      }));\n    }\n  }, [user]);\n  \n  const fetchSpotifyPlaylists = useCallback(async () => {\n    // First check if user is authenticated\n    if (!user) {\n      dispatch({ type: 'SET_ERROR', payload: 'Please sign in to continue' });\n      return;\n    }\n\n    dispatch({ type: 'SET_LOADING', payload: true });\n    dispatch({ type: 'SET_ERROR', payload: null });\n\n    let accountInfo: any = null;\n\n    try {\n      console.log('[ConversionContext] 🎵 Fetching Spotify playlists...');\n      const isAuthed = await isSpotifyAuthenticated();\n      const spotifyTokens = await TokenManager.getTokens('spotify');\n      console.log('Spotify auth check:', {\n        user: user.uid,\n        isAuthed,\n        hasTokensFromTokenManager: !!spotifyTokens,\n        hasAccessToken: !!spotifyTokens?.accessToken,\n        hasRefreshToken: !!spotifyTokens?.refreshToken,\n        tokenExpiresAt: spotifyTokens?.expiresAt\n      });\n\n      if (!isAuthed || !spotifyTokens?.accessToken) {\n        dispatch({ \n          type: 'SET_ERROR', \n          payload: 'Spotify not connected. Please connect your Spotify account first.' \n        });\n        return;\n      }\n\n      // Import detect account type function\n      const { detectAccountType } = await import('../lib/spotifyAuth');\n      \n      // Detect account type and permissions\n      accountInfo = await detectAccountType(spotifyTokens.accessToken);\n      console.log('[ConversionContext] Account type detected:', accountInfo);\n\n      // Store account type for later use\n      dispatch({ type: 'SET_ACCOUNT_TYPE', payload: accountInfo.accountType });\n      \n      // For restricted accounts, we'll still try to fetch playlists\n      // Sometimes restricted accounts can still read their own playlists\n      if (!accountInfo.hasPlaylistAccess) {\n        console.log('[ConversionContext] ⚠️ Account has restricted playlist access, but attempting to fetch anyway...');\n      }\n\n      // Fetch playlists normally\n      const token = await getSpotifyToken();\n      if (!token) {\n        dispatch({ \n          type: 'SET_ERROR', \n          payload: 'Failed to get Spotify access token. Please reconnect your account.' \n        });\n        return;\n      }\n\n      const playlists = await getSpotifyPlaylists(token);\n      console.log('[ConversionContext] ✅ Fetched Spotify playlists:', playlists.length);\n      \n      dispatch({ type: 'SET_SPOTIFY_PLAYLISTS', payload: playlists });\n      dispatch({ type: 'SET_STATUS', payload: ConversionStatus.SELECTING_PLAYLIST });\n      \n    } catch (error) {\n      console.error('[ConversionContext] ❌ Failed to fetch playlists:', error);\n      \n      // If playlist fetching failed and account has restrictions, show family account guidance\n      if (accountInfo && !accountInfo.hasPlaylistAccess && (error as Error).message.includes('permission')) {\n        let familyErrorMessage = `🚫 **Spotify Family Account Detected**\\n\\n`;\n        \n        if (accountInfo.accountType === 'family_child') {\n          familyErrorMessage += `Your account appears to be a **family plan child account** with restricted permissions.\\n\\n`;\n        } else if (accountInfo.accountType === 'family_restricted') {\n          familyErrorMessage += `Your account has **family plan restrictions** on playlist access.\\n\\n`;\n        } else {\n          familyErrorMessage += `Your account has **limited playlist permissions**.\\n\\n`;\n        }\n\n        familyErrorMessage += `**🔄 Alternative Solutions:**\\n`;\n        familyErrorMessage += `• **Use Public Playlist URLs**: You can still convert playlists by pasting public Spotify playlist URLs\\n`;\n        familyErrorMessage += `• **Ask Family Admin**: Request the family plan administrator to enable playlist permissions\\n`;\n        familyErrorMessage += `• **Try Read-Only Mode**: Click \"Try Family-Friendly Connection\" below\\n`;\n        familyErrorMessage += `• **Use Different Account**: Sign in with a personal Premium account\\n\\n`;\n        \n        if (accountInfo.recommendations && accountInfo.recommendations.length > 0) {\n          familyErrorMessage += `**💡 Specific Recommendations:**\\n`;\n          accountInfo.recommendations.forEach((rec: string) => {\n            familyErrorMessage += `• ${rec}\\n`;\n          });\n        }\n\n        dispatch({ type: 'SET_ERROR', payload: familyErrorMessage });\n        return;\n      }\n      \n      // For other errors, show generic error\n      console.error('Error fetching Spotify playlists:', error);\n      \n      // Enhanced error handling with family account support\n      let errorMessage = 'Failed to fetch Spotify playlists';\n      \n      if (error instanceof Error) {\n        if (error.message.includes('401') || error.message.includes('Authentication')) {\n          errorMessage = 'Spotify authentication expired. Please reconnect your Spotify account.';\n        } else if (error.message.includes('403') || error.message.includes('permission')) {\n          // Family account specific error\n          errorMessage = `🚫 **Spotify Family Account Issue**\\n\\n`;\n          errorMessage += `Your account doesn't have permission to access playlists. This is common with:\\n\\n`;\n          errorMessage += `**👨‍👩‍👧‍👦 Family Plan Accounts:**\\n`;\n          errorMessage += `• Child accounts often have restricted permissions\\n`;\n          errorMessage += `• Some family plans limit playlist access\\n`;\n          errorMessage += `• Regional restrictions may apply\\n\\n`;\n          errorMessage += `**🔄 Solutions to Try:**\\n`;\n          errorMessage += `• **Use Public URLs**: Paste any public Spotify playlist URL for conversion\\n`;\n          errorMessage += `• **Try Family Mode**: Use the \"Family-Friendly Connection\" option below\\n`;\n          errorMessage += `• **Contact Admin**: Ask your family plan administrator for permissions\\n`;\n          errorMessage += `• **Different Account**: Try with a personal Premium account\\n`;\n          errorMessage += `• **Check Settings**: Review your Spotify privacy settings\\n\\n`;\n          errorMessage += `**💡 Tip**: You can convert any public playlist by pasting its URL!`;\n        } else if (error.message.includes('429')) {\n          errorMessage = 'Rate limit exceeded. Please try again in a few minutes.';\n        } else {\n          errorMessage = error.message;\n        }\n      }\n      \n      dispatch({ type: 'SET_ERROR', payload: errorMessage });\n    } finally {\n      dispatch({ type: 'SET_LOADING', payload: false });\n    }\n  }, [user, dispatch]);\n  \n  // Fetch YouTube playlists\n  const fetchYouTubePlaylists = useCallback(async () => {\n    if (!user) {\n      dispatch({ type: 'SET_ERROR', payload: 'You need to authenticate with YouTube first' });\n      return;\n    }\n    dispatch({ type: 'SET_STATUS', payload: ConversionStatus.LOADING_PLAYLISTS });\n    \n    try {\n      // Call the YouTube API to get playlists\n      const response = await getYouTubePlaylists();\n      \n      if (response && response.items) {\n        // Filter out playlists with invalid thumbnails and clean the data\n        const cleanedPlaylists = response.items.map((playlist: any) => {\n          // Check if thumbnail URL is invalid\n          const thumbnailUrl = playlist.snippet?.thumbnails?.default?.url;\n          if (thumbnailUrl) {\n            console.log('Processing YouTube playlist thumbnail:', {\n              playlistName: playlist.snippet?.title,\n              thumbnailUrl: thumbnailUrl\n            });\n            \n            // Only remove truly invalid thumbnails, not all default ones\n            if (thumbnailUrl.includes('no_thumbnail.jpg')) {\n              console.log('Removing invalid thumbnail for playlist:', playlist.snippet?.title);\n              // Remove the invalid thumbnail\n              if (playlist.snippet?.thumbnails?.default) {\n                delete playlist.snippet.thumbnails.default;\n              }\n            }\n          }\n          return playlist;\n        });\n        \n        // Store the cleaned playlists in state\n        console.log(`Processed ${cleanedPlaylists.length} YouTube playlists`);\n        dispatch({ type: 'SET_YOUTUBE_PLAYLISTS', payload: cleanedPlaylists });\n      } else {\n        dispatch({ type: 'SET_YOUTUBE_PLAYLISTS', payload: [] });\n      }\n      \n      dispatch({ type: 'SET_STATUS', payload: ConversionStatus.IDLE });\n    } catch (error) {\n      console.error('Error fetching YouTube playlists:', error);\n      // Simplified error handling\n      dispatch({\n        type: 'SET_ERROR',\n        payload: error instanceof Error ? error.message : 'Failed to load YouTube playlists'\n      });\n    }\n  }, [user, dispatch]);\n  \n  const selectPlaylist = useCallback(async (playlistId: string) => {\n    console.log('[selectPlaylist] Called with playlistId:', playlistId); // Debug log\n    // Try to find the playlist in the user's library first\n    let playlist = state.spotifyPlaylists.find(p => p.id === playlistId);\n    if (!playlist) {\n      // If not found, try to fetch it directly (public playlist)\n      try {\n        playlist = await getSpotifyPlaylistById(playlistId);\n        // Add it to the list if not already present\n        dispatch({ type: 'SET_SPOTIFY_PLAYLISTS', payload: [...state.spotifyPlaylists, playlist] });\n      } catch (error) {\n        console.error('[selectPlaylist] Could not fetch playlist details:', error);\n        dispatch({ type: 'SET_ERROR', payload: 'Could not fetch playlist details. It may be private, unavailable, or you do not have access.' });\n        return;\n      }\n    }\n    dispatch({ type: 'SELECT_PLAYLIST', payload: playlistId });\n\n    // Fetch tracks immediately after selecting playlist\n    try {\n      console.log('[selectPlaylist] Fetching tracks for playlistId:', playlistId);\n      const tracksData = await getSpotifyPlaylistTracks(playlistId);\n      console.log('[selectPlaylist] Tracks API response:', tracksData);\n      const tracks = await extractTrackData(tracksData);\n      dispatch({ type: 'SET_TRACKS', payload: tracks });\n    } catch (error) {\n      console.error('[selectPlaylist] Could not fetch playlist tracks:', error);\n      dispatch({ type: 'SET_ERROR', payload: 'Could not fetch playlist tracks. The playlist may be private, unavailable, or you do not have access.' });\n    }\n  }, [state.spotifyPlaylists, dispatch]);\n  \n  // Add YouTube playlist selection function\n  const selectYouTubePlaylist = useCallback(async (playlistId: string) => {\n    console.log('[selectYouTubePlaylist] Called with playlistId:', playlistId);\n    \n    // Find the playlist in YouTube playlists\n    const playlist = state.youtubePlaylists.find((p: any) => p.id === playlistId);\n    if (!playlist) {\n      console.error('[selectYouTubePlaylist] Playlist not found in state');\n      dispatch({ type: 'SET_ERROR', payload: 'Selected playlist not found. Please refresh and try again.' });\n      return;\n    }\n    \n    dispatch({ type: 'SELECT_PLAYLIST', payload: playlistId });\n    \n    // Update the playlist name in the UI\n    const playlistName = playlist.snippet?.title || 'YouTube Playlist';\n    console.log('[selectYouTubePlaylist] Selected playlist:', playlistName);\n    \n    // Fetch tracks immediately after selecting playlist\n    try {\n      console.log('[selectYouTubePlaylist] Fetching tracks for playlistId:', playlistId);\n      \n      // Get YouTube access token\n      const accessToken = await getYouTubeToken();\n      if (!accessToken) {\n        throw new Error('YouTube authentication token not found. Please reconnect to YouTube.');\n      }\n      \n      const allItems = await fetchAllYouTubePlaylistItems(playlistId, accessToken);\n      \n      if (!allItems || allItems.length === 0) {\n        throw new Error('No tracks found in this YouTube playlist.');\n      }\n      \n      // Get video details to fetch durations for preview\n      const videoIds = allItems.map((item: any) => \n        item.snippet?.resourceId?.videoId || item.contentDetails?.videoId\n      ).filter(Boolean);\n      \n      console.log('Fetching video details for preview:', videoIds.length, 'videos');\n      \n      // Fetch video details in batches to get durations\n      const videoDetails: any[] = [];\n      const BATCH_SIZE = 50; // YouTube API limit\n      \n      for (let i = 0; i < videoIds.length; i += BATCH_SIZE) {\n        const batch = videoIds.slice(i, i + BATCH_SIZE);\n        const batchIds = batch.join(',');\n        \n        const videoResponse = await fetch(\n          `https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails&id=${batchIds}`,\n          {\n            headers: {\n              'Authorization': `Bearer ${accessToken}`\n            }\n          }\n        );\n        \n        if (videoResponse.ok) {\n          const videoData = await videoResponse.json();\n          if (videoData.items) {\n            videoDetails.push(...videoData.items);\n          }\n        }\n        \n        // Small delay to avoid rate limiting\n        await new Promise(resolve => setTimeout(resolve, 100));\n      }\n      \n      // Create a map of video details for quick lookup\n      const videoDetailsMap = new Map();\n      videoDetails.forEach(video => {\n        videoDetailsMap.set(video.id, video);\n      });\n      \n      // Process tracks with durations for preview\n      const tracks = allItems.map((item: any) => {\n        const videoId = item.snippet?.resourceId?.videoId || item.contentDetails?.videoId;\n        const videoDetail = videoDetailsMap.get(videoId);\n        \n        const videoTitle = item.snippet?.title || '';\n        const channelTitle = item.snippet?.videoOwnerChannelTitle || item.snippet?.channelTitle || 'Unknown';\n        \n        // Smart parsing of video titles\n        let artists = [channelTitle];\n        let title = videoTitle;\n        \n        const separators = [' - ', ' – ', ': ', ' \"', \" '\", ' // ', ' | '];\n        for (const separator of separators) {\n          if (videoTitle.includes(separator)) {\n            const parts = videoTitle.split(separator);\n            if (parts.length >= 2) {\n              artists = [parts[0].trim()];\n              title = parts.slice(1).join(separator).trim()\n                .replace(/^['\"]/, '')\n                .replace(/['\"]$/, '');\n              break;\n            }\n          }\n        }\n        \n        // Get duration from video details\n        let duration_ms = 0;\n        if (videoDetail?.contentDetails?.duration) {\n          // Parse ISO 8601 duration format (PT4M13S -> 253000ms)\n          const duration = videoDetail.contentDetails.duration;\n          const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\n          if (match) {\n            const hours = parseInt(match[1] || '0');\n            const minutes = parseInt(match[2] || '0');\n            const seconds = parseInt(match[3] || '0');\n            duration_ms = (hours * 3600 + minutes * 60 + seconds) * 1000;\n          }\n        }\n        \n        return {\n          id: item.id || `yt-${Math.random().toString(36).substring(2, 9)}`,\n          name: title,\n          artists: artists,\n          album: channelTitle,\n          duration_ms: duration_ms,\n          popularity: 0,\n          explicit: false,\n          searchQuery: `${artists[0]} ${title}`,\n          videoId: videoId\n        };\n      });\n      \n      dispatch({ type: 'SET_TRACKS', payload: tracks });\n    } catch (error) {\n      console.error('[selectYouTubePlaylist] Could not fetch playlist tracks:', error);\n      dispatch({ type: 'SET_ERROR', payload: 'Could not fetch playlist tracks. The playlist may be private, unavailable, or you do not have access.' });\n    }\n  }, [state.youtubePlaylists, dispatch]);\n  \n  // Add safe URL creation functions\n  const createYouTubePlaylistUrl = (playlistId: string | undefined): string => {\n    if (!playlistId) {\n      return '';\n    }\n    return `https://www.youtube.com/playlist?list=${playlistId}`;\n  };\n\n  // Helper function to calculate track similarity score\n  const calculateTrackSimilarity = (originalTrack: SpotifyTrack, spotifyTrack: any): number => {\n    let score = 0;\n    \n    // Normalize strings for comparison\n    const normalize = (str: string) => str.toLowerCase().replace(/[^\\w\\s]/g, '').trim();\n    \n    const originalTitle = normalize(originalTrack.name);\n    const originalArtist = normalize(originalTrack.artists[0]);\n    const spotifyTitle = normalize(spotifyTrack.name);\n    const spotifyArtist = normalize(spotifyTrack.artists[0].name);\n    \n    // Title similarity (40% weight)\n    if (originalTitle === spotifyTitle) {\n      score += 0.4;\n    } else if (spotifyTitle.includes(originalTitle) || originalTitle.includes(spotifyTitle)) {\n      score += 0.3;\n    } else {\n      // Calculate partial similarity\n      const titleWords = originalTitle.split(' ');\n      const spotifyTitleWords = spotifyTitle.split(' ');\n      const commonWords = titleWords.filter(word => spotifyTitleWords.includes(word));\n      if (commonWords.length > 0) {\n        score += (commonWords.length / Math.max(titleWords.length, spotifyTitleWords.length)) * 0.2;\n      }\n    }\n    \n    // Artist similarity (40% weight)\n    if (originalArtist === spotifyArtist) {\n      score += 0.4;\n    } else if (spotifyArtist.includes(originalArtist) || originalArtist.includes(spotifyArtist)) {\n      score += 0.3;\n    } else {\n      // Calculate partial similarity\n      const artistWords = originalArtist.split(' ');\n      const spotifyArtistWords = spotifyArtist.split(' ');\n      const commonWords = artistWords.filter(word => spotifyArtistWords.includes(word));\n      if (commonWords.length > 0) {\n        score += (commonWords.length / Math.max(artistWords.length, spotifyArtistWords.length)) * 0.2;\n      }\n    }\n    \n    // Duration similarity (20% weight) - if we have duration data\n    if (originalTrack.duration_ms && spotifyTrack.duration_ms) {\n      const durationDiff = Math.abs(originalTrack.duration_ms - spotifyTrack.duration_ms);\n      const maxDiff = Math.max(originalTrack.duration_ms, spotifyTrack.duration_ms);\n      const durationSimilarity = Math.max(0, 1 - (durationDiff / maxDiff));\n      score += durationSimilarity * 0.2;\n    }\n    \n    return Math.min(score, 1.0); // Cap at 1.0\n  };\n\n  // Helper function to calculate YouTube video similarity score\n  const calculateYouTubeSimilarity = (spotifyTrack: SpotifyTrack, youtubeVideo: any): number => {\n    let score = 0;\n    \n    // Normalize strings for comparison\n    const normalize = (str: string) => str.toLowerCase().replace(/[^\\w\\s]/g, '').trim();\n    \n    const spotifyTitle = normalize(spotifyTrack.name);\n    const spotifyArtist = normalize(spotifyTrack.artists[0]);\n    const youtubeTitle = normalize(youtubeVideo.snippet.title);\n    const youtubeChannel = normalize(youtubeVideo.snippet.channelTitle);\n    \n    // Title similarity (50% weight)\n    if (spotifyTitle === youtubeTitle) {\n      score += 0.5;\n    } else if (youtubeTitle.includes(spotifyTitle) || spotifyTitle.includes(youtubeTitle)) {\n      score += 0.4;\n    } else {\n      // Calculate partial similarity\n      const titleWords = spotifyTitle.split(' ');\n      const youtubeTitleWords = youtubeTitle.split(' ');\n      const commonWords = titleWords.filter(word => youtubeTitleWords.includes(word));\n      if (commonWords.length > 0) {\n        score += (commonWords.length / Math.max(titleWords.length, youtubeTitleWords.length)) * 0.3;\n      }\n    }\n    \n    // Artist similarity (40% weight)\n    if (spotifyArtist === youtubeChannel) {\n      score += 0.4;\n    } else if (youtubeChannel.includes(spotifyArtist) || spotifyArtist.includes(youtubeChannel)) {\n      score += 0.3;\n    } else {\n      // Calculate partial similarity\n      const artistWords = spotifyArtist.split(' ');\n      const channelWords = youtubeChannel.split(' ');\n      const commonWords = artistWords.filter(word => channelWords.includes(word));\n      if (commonWords.length > 0) {\n        score += (commonWords.length / Math.max(artistWords.length, channelWords.length)) * 0.2;\n      }\n    }\n    \n    // Duration similarity (10% weight) - if we have duration data\n    if (spotifyTrack.duration_ms && youtubeVideo.contentDetails?.duration) {\n      // Parse YouTube duration\n      const duration = youtubeVideo.contentDetails.duration;\n      const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\n      if (match) {\n        const hours = parseInt(match[1] || '0');\n        const minutes = parseInt(match[2] || '0');\n        const seconds = parseInt(match[3] || '0');\n        const youtubeDuration = (hours * 3600 + minutes * 60 + seconds) * 1000;\n        \n        const durationDiff = Math.abs(spotifyTrack.duration_ms - youtubeDuration);\n        const maxDiff = Math.max(spotifyTrack.duration_ms, youtubeDuration);\n        const durationSimilarity = Math.max(0, 1 - (durationDiff / maxDiff));\n        score += durationSimilarity * 0.1;\n      }\n    }\n    \n    return Math.min(score, 1.0); // Cap at 1.0\n  };\n\n  // Add duplicate prevention\n  const checkForExistingPlaylist = async (playlistName: string, accessToken: string) => {\n    try {\n      // This function is no longer needed as SpotifyService is removed.\n      // The logic for checking existing playlists is now handled directly\n      // by the Spotify API calls or by the user's own Spotify account.\n      // For now, we'll return null, meaning no existing playlist found.\n      return null;\n    } catch (error) {\n      console.warn('Error checking for existing playlist:', error);\n      return null;\n    }\n  };\n\n  const startConversion = useCallback(async () => {\n    // Prevent multiple simultaneous conversions\n    if (state.status === ConversionStatus.MATCHING_TRACKS || \n        state.status === ConversionStatus.CREATING_PLAYLIST) {\n      console.log('Conversion already in progress, ignoring duplicate request');\n      return;\n    }\n\n    if (!state.selectedPlaylistId) {\n      dispatch({ type: 'SET_ERROR', payload: 'No playlist selected' });\n      return;\n    }\n    \n    try {\n      if (!user) {\n        throw new Error('You must be logged in to convert playlists');\n      }\n\n      const playlistId = state.selectedPlaylistId;\n      if (!playlistId) {\n        throw new Error('Please select a playlist to convert');\n      }\n\n      // Reset state for the new conversion\n      dispatch({ type: 'SET_ERROR', payload: null });\n      dispatch({ type: 'SET_STATUS', payload: ConversionStatus.LOADING_TRACKS });\n      dispatch({ type: 'UPDATE_MATCHING_PROGRESS', payload: 0 });\n\n      // Determine source and destination platforms - infer from playlist ID if localStorage is unreliable\n      let sourcePlatform = localStorage.getItem('source_platform') || 'spotify';\n      let destinationPlatform = localStorage.getItem('destination_platform') || 'youtube';\n      \n      // CRITICAL FIX: Validate platform based on playlist ID format\n      if (playlistId.startsWith('PL') && playlistId.length > 20) {\n        // YouTube playlist ID format (starts with \"PL\" and is long)\n        sourcePlatform = 'youtube';\n        destinationPlatform = 'spotify';\n        console.log('[ConversionContext] 🔍 Auto-detected YouTube playlist ID, setting source=youtube, destination=spotify');\n      } else if (playlistId.length === 22 && !playlistId.startsWith('PL')) {\n        // Spotify playlist ID format (22 characters, base62, no \"PL\" prefix)\n        sourcePlatform = 'spotify';\n        destinationPlatform = 'youtube';\n        console.log('[ConversionContext] 🔍 Auto-detected Spotify playlist ID, setting source=spotify, destination=youtube');\n      }\n      \n      console.log('[ConversionContext] Platform determination:', {\n        playlistId,\n        detectedSource: sourcePlatform,\n        detectedDestination: destinationPlatform,\n        storedSource: localStorage.getItem('source_platform'),\n        storedDestination: localStorage.getItem('destination_platform')\n      });\n\n      let tracks: SpotifyTrack[] = [];\n      let matches = new Map();\n\n      // ---- OPTIMIZATION 1: Use cached data when possible ----\n      const cacheKey = `${sourcePlatform}_${playlistId}_tracks`;\n      const cachedTracks = sessionStorage.getItem(cacheKey);\n      \n      if (cachedTracks && state.tracks.length > 0) {\n        console.log('Using cached tracks data');\n        tracks = state.tracks;\n      } else {\n        // Fetch fresh tracks if not cached\n        if (sourcePlatform === 'spotify') {\n          try {\n            console.log('Fetching tracks from Spotify for playlist:', playlistId);\n            \n            // Add a timeout promise for getting tracks\n            const tracksPromise = getSpotifyPlaylistTracks(playlistId);\n            const timeoutPromise = new Promise<any>((_, reject) => \n              setTimeout(() => reject(new Error('Spotify tracks request timed out')), 15000)\n            );\n            \n            const tracksData = await Promise.race([tracksPromise, timeoutPromise]);\n            console.log('Raw tracks data received:', {\n              itemsCount: tracksData?.items?.length || 0,\n              total: tracksData?.total || 0\n            });\n            \n            tracks = await extractTrackData(tracksData);\n            console.log('Processed tracks:', tracks.length);\n            \n            // Cache for future use\n            sessionStorage.setItem(cacheKey, JSON.stringify(tracks));\n          } catch (error: any) {\n            console.error('Error fetching Spotify tracks:', error);\n            let errorMessage = 'Failed to load tracks from Spotify';\n            if (error instanceof Error) {\n              errorMessage = `Spotify error: ${error.message}`;\n              if (error.message.includes('Authentication') || error.message.includes('token')) {\n                errorMessage += '. Try reconnecting to Spotify.';\n              } else if (error.message.includes('timed out')) {\n                errorMessage = 'Spotify request timed out. Please try again with a better connection.';\n              } else if (error.message.includes('403') || error.message.includes('Forbidden')) {\n                errorMessage = 'Access denied. The playlist may be private or you may not have permission to access it.';\n              } else if (error.message.includes('404') || error.message.includes('Not Found')) {\n                errorMessage = 'Playlist not found. It may have been deleted or made private.';\n              }\n            }\n            throw new Error(errorMessage);\n          }\n        } else if (sourcePlatform === 'youtube') {\n          // YouTube tracks loading logic\n          try {\n            console.log('Fetching tracks from YouTube for playlist:', playlistId);\n            \n                         // Get YouTube access token\n             const accessToken = await getYouTubeToken();\n             if (!accessToken) {\n               throw new Error('YouTube authentication token not found. Please reconnect to YouTube.');\n             }\n            \n            // Fetch all playlist items with timeout\n            const tracksPromise = fetchAllYouTubePlaylistItems(playlistId, accessToken);\n            const timeoutPromise = new Promise<any>((_, reject) => \n              setTimeout(() => reject(new Error('YouTube tracks request timed out')), 15000)\n            );\n            \n            const allItems = await Promise.race([tracksPromise, timeoutPromise]);\n            console.log('Raw YouTube tracks data received:', {\n              itemsCount: allItems?.length || 0\n            });\n            \n            if (!allItems || allItems.length === 0) {\n              throw new Error('No tracks found in this YouTube playlist. It might be empty, private, or you may not have access to it.');\n            }\n            \n            // Get video details to fetch durations and better metadata\n            const videoIds = allItems.map((item: any) => \n              item.snippet?.resourceId?.videoId || item.contentDetails?.videoId\n            ).filter(Boolean);\n            \n            console.log('Fetching video details for', videoIds.length, 'videos');\n            \n            // Fetch video details in batches to get durations\n            const videoDetails: any[] = [];\n            const BATCH_SIZE = 50; // YouTube API limit\n            \n            for (let i = 0; i < videoIds.length; i += BATCH_SIZE) {\n              const batch = videoIds.slice(i, i + BATCH_SIZE);\n              const batchIds = batch.join(',');\n              \n              const videoResponse = await fetch(\n                `https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails&id=${batchIds}`,\n                {\n                  headers: {\n                    'Authorization': `Bearer ${accessToken}`\n                  }\n                }\n              );\n              \n              if (videoResponse.ok) {\n                const videoData = await videoResponse.json();\n                if (videoData.items) {\n                  videoDetails.push(...videoData.items);\n                }\n              }\n              \n              // Small delay to avoid rate limiting\n              await new Promise(resolve => setTimeout(resolve, 100));\n            }\n            \n            // Create a map of video details for quick lookup\n            const videoDetailsMap = new Map();\n            videoDetails.forEach(video => {\n              videoDetailsMap.set(video.id, video);\n            });\n            \n            // Process YouTube tracks into the expected format with better metadata\n            tracks = allItems.map((item: any) => {\n              const videoId = item.snippet?.resourceId?.videoId || item.contentDetails?.videoId;\n              const videoDetail = videoDetailsMap.get(videoId);\n              \n              const videoTitle = item.snippet?.title || '';\n              const channelTitle = item.snippet?.videoOwnerChannelTitle || item.snippet?.channelTitle || 'Unknown';\n              \n              // Smart parsing of video titles to extract artist and title\n              let artists = [channelTitle];\n              let title = videoTitle;\n              \n              const separators = [' - ', ' – ', ': ', ' \"', \" '\", ' // ', ' | '];\n              for (const separator of separators) {\n                if (videoTitle.includes(separator)) {\n                  const parts = videoTitle.split(separator);\n                  if (parts.length >= 2) {\n                    artists = [parts[0].trim()];\n                    title = parts.slice(1).join(separator).trim()\n                      .replace(/^['\"]/, '')\n                      .replace(/['\"]$/, '');\n                    break;\n                  }\n                }\n              }\n              \n              // Get duration from video details\n              let duration_ms = 0;\n              if (videoDetail?.contentDetails?.duration) {\n                // Parse ISO 8601 duration format (PT4M13S -> 253000ms)\n                const duration = videoDetail.contentDetails.duration;\n                const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\n                if (match) {\n                  const hours = parseInt(match[1] || '0');\n                  const minutes = parseInt(match[2] || '0');\n                  const seconds = parseInt(match[3] || '0');\n                  duration_ms = (hours * 3600 + minutes * 60 + seconds) * 1000;\n                }\n              }\n              \n              return {\n                id: item.id || `yt-${Math.random().toString(36).substring(2, 9)}`,\n                name: title,\n                artists: artists,\n                album: channelTitle,\n                duration_ms: duration_ms,\n                popularity: 0,\n                explicit: false,\n                searchQuery: `${artists[0]} ${title}`,\n                videoId: videoId\n              };\n            });\n            \n            console.log('Processed YouTube tracks:', tracks.length);\n            \n            // Cache for future use\n            sessionStorage.setItem(cacheKey, JSON.stringify(tracks));\n          } catch (error: any) {\n            console.error('Error fetching YouTube tracks:', error);\n            let errorMessage = 'Failed to load tracks from YouTube';\n            if (error instanceof Error) {\n              errorMessage = `YouTube error: ${error.message}`;\n              if (error.message.includes('Authentication') || error.message.includes('token')) {\n                errorMessage += '. Try reconnecting to YouTube.';\n              } else if (error.message.includes('timed out')) {\n                errorMessage = 'YouTube request timed out. Please try again with a better connection.';\n              } else if (error.message.includes('403') || error.message.includes('Forbidden')) {\n                errorMessage = 'Access denied. The playlist may be private or you may not have permission to access it.';\n              } else if (error.message.includes('404') || error.message.includes('Not Found')) {\n                errorMessage = 'Playlist not found. It may have been deleted or made private.';\n              }\n            }\n            throw new Error(errorMessage);\n          }\n        }\n      }\n\n      if (!tracks || tracks.length === 0) {\n        console.error('No tracks found after processing. Debug info:', {\n          playlistId,\n          sourcePlatform,\n          cachedTracks: !!cachedTracks,\n          stateTracksLength: state.tracks.length\n        });\n        throw new Error('No tracks found in the selected playlist. This might be due to authentication issues or the playlist being empty.');\n      }\n\n      // Always update UI with tracks\n      dispatch({ type: 'SET_TRACKS', payload: tracks });\n      dispatch({ type: 'SET_STATUS', payload: ConversionStatus.MATCHING_TRACKS });\n      \n      // ---- OPTIMIZATION 2: Parallel processing for matching ----\n      if (destinationPlatform === 'youtube') {\n        // Spotify → YouTube conversion\n        const BATCH_SIZE = 5; // Process 5 tracks at once\n        const batchCount = Math.ceil(tracks.length / BATCH_SIZE);\n        \n        for (let batchIndex = 0; batchIndex < batchCount; batchIndex++) {\n          const batchStart = batchIndex * BATCH_SIZE;\n          const batchEnd = Math.min(batchStart + BATCH_SIZE, tracks.length);\n          const currentBatch = tracks.slice(batchStart, batchEnd);\n          \n          // Process batch in parallel\n          const batchPromises = currentBatch.map(async (track) => {\n            try {\n              // Create multiple search queries for better matching\n              const searchQueries = [\n                `${track.artists[0]} ${track.name}`,\n                `${track.name} ${track.artists[0]}`,\n                track.name,\n                `${track.artists[0]} - ${track.name}`,\n                `${track.artists[0]} \"${track.name}\"`\n              ];\n              \n              let bestMatch = null;\n              let bestScore = 0;\n              \n              // Try each search query\n              for (const query of searchQueries) {\n                const videoSearchResults = await searchYouTube(user.uid, query);\n                \n                if (videoSearchResults && videoSearchResults.items && videoSearchResults.items.length > 0) {\n                  // Score each result based on similarity\n                  for (const result of videoSearchResults.items) {\n                    const score = calculateYouTubeSimilarity(track, result);\n                    \n                    if (score > bestScore) {\n                      bestScore = score;\n                      bestMatch = result;\n                    }\n                  }\n                }\n                \n                // If we found a good match (score > 0.7), stop searching\n                if (bestScore > 0.7) {\n                  break;\n                }\n              }\n              \n              if (bestMatch && bestScore > 0.5) {\n                return { \n                  trackId: track.id, \n                  match: {\n                    videoId: bestMatch.id.videoId,\n                    title: bestMatch.snippet.title,\n                    channelTitle: bestMatch.snippet.channelTitle,\n                    thumbnailUrl: bestMatch.snippet.thumbnails?.default?.url && \n                                 !bestMatch.snippet.thumbnails.default.url.includes('no_thumbnail') \n                                 ? bestMatch.snippet.thumbnails.default.url \n                                 : 'https://via.placeholder.com/120x90/666666/FFFFFF?text=No+Thumbnail',\n                    score: Math.round(bestScore * 100),\n                    matchDetails: {\n                      titleMatch: Math.round(bestScore * 100),\n                      artistMatch: Math.round(bestScore * 100),\n                      lengthScore: Math.round(bestScore * 100)\n                    },\n\n                  }\n                };\n              }\n              return { trackId: track.id, match: null };\n            } catch (err) {\n              console.warn('Error matching track:', track.name, err);\n              return { trackId: track.id, match: null };\n            }\n          });\n          \n          // Wait for all tracks in this batch to be processed\n          const batchResults = await Promise.all(batchPromises);\n          \n          // Update matches with batch results\n          batchResults.forEach(({ trackId, match }) => {\n            matches.set(trackId, match);\n          });\n          \n          // Update progress after each batch\n          const progress = Math.min(((batchIndex + 1) * BATCH_SIZE / tracks.length) * 100, 100);\n          dispatch({ type: 'UPDATE_MATCHING_PROGRESS', payload: progress });\n          \n          // Small delay to allow UI updates\n          await new Promise(resolve => setTimeout(resolve, 10));\n      }\n      \n      dispatch({ type: 'SET_MATCHES', payload: matches });\n      \n        // ---- Move to creating playlist with better progress indication ----\n      dispatch({ type: 'SET_STATUS', payload: ConversionStatus.CREATING_PLAYLIST });\n      \n        // Get the selected playlist details\n        const selectedPlaylist = state.spotifyPlaylists.find(p => p.id === playlistId);\n      if (!selectedPlaylist) {\n          throw new Error('Selected playlist details not found');\n        }\n        \n        // Create a more descriptive YouTube playlist name\n        const youtubePlaylistName = `${selectedPlaylist.name} (Converted)`;\n        const youtubePlaylistDescription = `Converted from spotify using Playlist Converter`;\n        \n        try {\n          // Set a timeout for the YouTube playlist creation\n          const createPlaylistPromise = findOrCreatePlaylist(user.uid, youtubePlaylistName, youtubePlaylistDescription);\n          \n          const timeoutPromise = new Promise<any>((_, reject) => \n            setTimeout(() => reject(new Error('YouTube playlist creation timed out')), 20000)\n          );\n          \n          // Race the playlist creation against a timeout\n          const newPlaylist = await Promise.race([createPlaylistPromise, timeoutPromise]);\n          \n          if (!newPlaylist || !newPlaylist.id) {\n            throw new Error('Failed to create YouTube playlist');\n          }\n          \n          const youtubePlaylistId = newPlaylist.id;\n          const youtubePlaylistUrl = createYouTubePlaylistUrl(youtubePlaylistId);\n          \n          console.log(`Created YouTube playlist: ${youtubePlaylistId}`);\n          \n          // Save the YouTube playlist ID to state\n      dispatch({ \n        type: 'SET_YOUTUBE_PLAYLIST', \n        payload: { \n              id: youtubePlaylistId, \n              url: youtubePlaylistUrl\n            } \n          });\n          \n          // Add videos to the playlist with improved error handling and progress updates\n          let successCount = 0;\n          let failureCount = 0;\n          let totalVideos = 0;\n          let failedTracks: FailedTrack[] = []; // Track failed tracks\n          \n          // Count how many videos we'll be adding (excluding null matches)\n          for (const match of matches.values()) {\n            if (match && match.videoId) {\n              totalVideos++;\n            }\n          }\n          \n          if (totalVideos === 0) {\n            throw new Error('No matching videos found for the tracks in this playlist');\n          }\n          \n          let processedVideos = 0;\n          const matchEntries = Array.from(matches.entries());\n          \n          console.log(`Starting to add ${totalVideos} videos to YouTube playlist ${youtubePlaylistId}`);\n          \n          // Process videos one at a time with delays to avoid rate limits\n          for (let i = 0; i < matchEntries.length; i++) {\n            const [trackId, match] = matchEntries[i];\n            const track = tracks.find(t => t.id === trackId);\n            \n            if (!match || !match.videoId) {\n              processedVideos++;\n              failureCount++;\n              \n              // Track the failed track\n              if (track) {\n                const failedTrack: FailedTrack = {\n                  name: track.name,\n                  artists: track.artists,\n                  reason: 'No YouTube match found',\n                  searchQueries: [`${track.artists[0]} ${track.name}`, track.name],\n                  bestMatchScore: 0,\n                  bestMatchTitle: 'None',\n                  bestMatchArtist: 'None'\n                };\n                failedTracks.push(failedTrack);\n              }\n              continue;\n            }\n            \n            try {\n              // Add retry mechanism with exponential backoff\n              let attempts = 0;\n              let success = false;\n              let lastError = null;\n              \n              while (attempts < 3 && !success) {\n                try {\n                  console.log(`Adding video ${match.videoId} to YouTube playlist (attempt ${attempts + 1}/3)`);\n                  \n                  // Add a significant delay between each video addition\n                  await new Promise(resolve => setTimeout(resolve, 1000 + (attempts * 1000)));\n                  \n                  await addToYouTubePlaylist(user.uid, youtubePlaylistId, match.videoId);\n                  \n                  success = true;\n                  successCount++;\n                  console.log(`Successfully added video ${match.videoId} to YouTube playlist`);\n                } catch (err) {\n                  attempts++;\n                  lastError = err;\n                  console.warn(`Attempt ${attempts} failed for video ${match.videoId}:`, err);\n                  \n                  // Add longer delay before retrying\n                  if (attempts < 3) {\n                    await new Promise(resolve => setTimeout(resolve, attempts * 2000));\n                  }\n                }\n              }\n              \n              if (!success) {\n                failureCount++;\n                console.error(`Failed to add video ${match.videoId} after multiple attempts:`, lastError);\n                \n                // Track the failed track\n                if (track) {\n                  const failedTrack: FailedTrack = {\n                    name: track.name,\n                    artists: track.artists,\n                    reason: `Failed to add to YouTube playlist after ${attempts} attempts: ${lastError instanceof Error ? lastError.message : 'Unknown error'}`,\n                    searchQueries: [`${track.artists[0]} ${track.name}`],\n                    bestMatchScore: match.score / 100,\n                    bestMatchTitle: match.title,\n                    bestMatchArtist: match.channelTitle\n                  };\n                  failedTracks.push(failedTrack);\n                }\n              }\n            } catch (error) {\n              failureCount++;\n              console.error(`Error adding video ${match.videoId} to playlist:`, error);\n              \n              // Track the failed track\n              if (track) {\n                const failedTrack: FailedTrack = {\n                  name: track.name,\n                  artists: track.artists,\n                  reason: error instanceof Error ? error.message : 'Unknown error',\n                  searchQueries: [`${track.artists[0]} ${track.name}`],\n                  bestMatchScore: match.score / 100,\n                  bestMatchTitle: match.title,\n                  bestMatchArtist: match.channelTitle\n                };\n                failedTracks.push(failedTrack);\n              }\n            }\n            \n            // Update progress after each video\n            processedVideos++;\n            dispatch({\n              type: 'UPDATE_MATCHING_PROGRESS', \n              payload: Math.min((processedVideos / matchEntries.length) * 100, 100)\n            });\n            \n            // Check if we need to update the user that we're still working\n            if (i % 5 === 0 && i > 0) {\n              console.log(`Progress update: Added ${successCount} videos, ${failureCount} failed, ${processedVideos}/${matchEntries.length} processed`);\n            }\n          }\n          \n          // Update user stats when conversion is successful\n          if (user?.uid) {\n            try {\n              // Determine platform direction based on conversion type\n              const platformDirection = 'youtube-to-spotify' as const; // YouTube to Spotify conversion\n              await profileService.addConversion(user.uid, successCount, platformDirection);\n              console.log('Successfully updated user stats for conversion');\n            } catch (error) {\n              console.error('Failed to update user stats:', error);\n            }\n          }\n          \n          // Update state to indicate success\n          dispatch({ type: 'SET_STATUS', payload: ConversionStatus.SUCCESS });\n          \n          // Provide detailed feedback about the conversion\n          const missingTracks = tracks.length - successCount;\n          let feedbackMessage = `Successfully converted ${successCount} tracks`;\n          \n          if (missingTracks > 0) {\n            feedbackMessage += ` (${missingTracks} tracks not found on Spotify)`;\n            \n            // Show a toast with helpful information\n            if (typeof window !== 'undefined' && window.dispatchEvent) {\n              window.dispatchEvent(new CustomEvent('show-toast', {\n                detail: {\n                  type: 'info',\n                  title: 'Conversion Complete',\n                  message: `${successCount} tracks converted successfully. ${missingTracks} tracks were not found on Spotify and were skipped.`,\n                  duration: 8000\n                }\n              }));\n            }\n          }\n          \n          console.log(feedbackMessage);\n          \n          // Save the conversion to history\n          const conversionResult: ConversionResult = {\n            id: `conversion_${Date.now()}`,\n            spotifyPlaylistId: playlistId,\n            spotifyPlaylistName: selectedPlaylist.name,\n            spotifyPlaylistUrl: `https://open.spotify.com/playlist/${playlistId}`,\n            youtubePlaylistId,\n            youtubePlaylistUrl,\n            tracksMatched: successCount,\n            tracksFailed: failureCount,\n            totalTracks: tracks.length,\n            convertedAt: new Date(),\n            failedTracks: failedTracks // Include failed tracks in history\n          };\n\n          // Update conversion history in state\n          dispatch({\n            type: 'SET_CONVERSION_HISTORY',\n            payload: [conversionResult, ...state.conversionHistory]\n          });\n\n          // Save to local storage\n          saveConversionHistoryToLocalStorage(user.uid, [conversionResult, ...state.conversionHistory]);\n\n          // Try to save to Firestore with enhanced error handling\n          try {\n            console.log('Attempting to save conversion to Firestore:', {\n              userId: user.uid,\n              conversionId: conversionResult.id,\n              playlistName: conversionResult.spotifyPlaylistName\n            });\n\n            const conversionsRef = collection(db, 'users', user.uid, 'conversions').withConverter(conversionConverter as any);\n            \n            // Use the same ID for Firestore document\n            const docRef = doc(conversionsRef, conversionResult.id);\n            \n            // Add retry logic for Firestore save\n            let attempts = 0;\n            const maxAttempts = 3;\n            let success = false;\n\n            while (attempts < maxAttempts && !success) {\n              try {\n                await setDoc(docRef, {\n                  ...conversionResult,\n                  convertedAt: Timestamp.fromDate(conversionResult.convertedAt),\n                  userId: user.uid,\n                  tracks: tracks.map(track => ({\n                    name: track.name ?? 'Unknown',\n                    artists: Array.isArray(track.artists) ? track.artists : [],\n                    album: track.album ?? '',\n                    duration_ms: track.duration_ms ?? 0,\n                    popularity: track.popularity ?? 0,\n                    explicit: track.explicit ?? false,\n                    ...(track.releaseYear ? { releaseYear: track.releaseYear } : {}),\n                    genres: Array.isArray(track.genres) ? track.genres : [],\n                    artistImages: Array.isArray(track.artistImages) ? track.artistImages : []\n                  })),\n                  failedTracks: failedTracks // Save failed tracks to Firestore\n                });\n\n                console.log('Successfully saved conversion to Firestore:', docRef.id);\n                success = true;\n                break;\n              } catch (saveError) {\n                attempts++;\n                console.warn(`Failed to save conversion (attempt ${attempts}/${maxAttempts}):`, saveError);\n                \n                if (attempts < maxAttempts) {\n                  // Wait before retrying with exponential backoff\n                  await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempts) * 1000));\n                } else {\n                  throw saveError;\n                }\n              }\n            }\n          } catch (firestoreError) {\n            console.error('Failed to save conversion history to Firestore:', firestoreError);\n            \n            // Log detailed error information\n            logFirestoreError('saveConversion', firestoreError, user.uid);\n            \n            // Show a toast notification to the user\n            if (typeof window !== 'undefined' && window.dispatchEvent) {\n              window.dispatchEvent(new CustomEvent('show-toast', {\n                detail: {\n                  type: 'warning',\n                  title: 'Backup Save Only',\n                  message: 'Your conversion was successful but could not be saved online. It is saved locally only.',\n                  duration: 5000\n                }\n              }));\n            }\n          }\n          \n        } catch (playlistError) {\n          console.error('Error during YouTube playlist creation or population:', playlistError);\n          let errorMessage = 'Failed to create or update YouTube playlist';\n          \n          if (playlistError instanceof Error) {\n            if (playlistError.message.includes('timed out')) {\n              errorMessage = 'YouTube request timed out. Your playlist may have been created but not fully populated. Please check your YouTube account.';\n            } else if (playlistError.message.includes('quota')) {\n              errorMessage = 'YouTube API quota exceeded. Please try again later.';\n            } else {\n              errorMessage = `YouTube error: ${playlistError.message}`;\n            }\n          }\n          \n          throw new Error(errorMessage);\n        }\n      } else if (destinationPlatform === 'spotify') {\n                // YouTube → Spotify conversion\n        console.log('=== Starting YouTube to Spotify conversion ===');\n        // Show creating playlist step explicitly for better UI feedback\n        dispatch({ type: 'SET_STATUS', payload: ConversionStatus.CREATING_PLAYLIST });\n        // Nudge progress so users see movement while creating playlist\n        dispatch({ type: 'UPDATE_MATCHING_PROGRESS', payload: 5 });\n        console.log('Source platform:', sourcePlatform);\n        console.log('Destination platform:', destinationPlatform);\n        console.log('Playlist ID:', playlistId);\n        console.log('Tracks count:', tracks.length);\n        \n        // Check if user has Spotify authentication\n        const isSpotifyAuthed = await isSpotifyAuthenticated();\n        console.log('Spotify authentication status:', isSpotifyAuthed);\n        \n        if (!isSpotifyAuthed) {\n          throw new Error('Spotify authentication required. Please reconnect your Spotify account.');\n        }\n        \n        // Get the selected playlist details (fallback to fetch by ID when not in state)\n        let selectedPlaylist: any = state.youtubePlaylists.find((p: any) => p.id === playlistId);\n        console.log('Selected YouTube playlist (from state):', selectedPlaylist);\n        \n        if (!selectedPlaylist) {\n          try {\n            const accessToken = await getYouTubeToken();\n            if (accessToken) {\n              const res = await fetch(`https://www.googleapis.com/youtube/v3/playlists?part=snippet&id=${playlistId}` , {\n                headers: { Authorization: `Bearer ${accessToken}` }\n              });\n              if (res.ok) {\n                const data = await res.json();\n                if (data.items && data.items.length > 0) {\n                  selectedPlaylist = data.items[0];\n                  console.log('Fetched YouTube playlist details by ID:', selectedPlaylist);\n                }\n              } else {\n                console.warn('Failed to fetch YouTube playlist details:', res.status, res.statusText);\n              }\n            }\n          } catch (e) {\n            console.warn('Error fetching YouTube playlist details:', e);\n          }\n        }\n        \n        if (!selectedPlaylist) {\n          // As a last resort, proceed with a minimal fallback\n          selectedPlaylist = { id: playlistId, snippet: { title: 'YouTube Playlist' } };\n          console.warn('Using minimal fallback playlist details');\n        }\n        \n        // Create a descriptive Spotify playlist name\n        const rawTitle = selectedPlaylist.snippet?.title || 'YouTube Playlist';\n        const baseName = rawTitle.replace(/\\s*\\(Converted\\)+$/i, '').trim();\n        const convertedSuffix = '(Converted)';\n        const spotifyPlaylistName = baseName.endsWith(convertedSuffix)\n          ? baseName\n          : `${baseName} ${convertedSuffix}`;\n        const spotifyPlaylistDescription = `Converted from YouTube using SoundSwapp`;\n        \n        console.log('Spotify playlist name:', spotifyPlaylistName);\n        console.log('Spotify playlist description:', spotifyPlaylistDescription);\n        \n                  try {\n            // Create the Spotify playlist\n            console.log('Creating Spotify playlist:', spotifyPlaylistName);\n            console.log('Playlist description:', spotifyPlaylistDescription);\n            \n            // Idempotency: check if a playlist with the same name already exists\n            let newSpotifyPlaylist = await findUserPlaylistByName(spotifyPlaylistName);\n            if (!newSpotifyPlaylist) {\n              newSpotifyPlaylist = await createSpotifyPlaylist(\n                spotifyPlaylistName, \n                `${spotifyPlaylistDescription} • tag:converted-by-soundswapp`,\n              );\n            }\n          \n          if (!newSpotifyPlaylist || !newSpotifyPlaylist.id) {\n            throw new Error('Failed to create Spotify playlist');\n          }\n          \n          const spotifyPlaylistId = newSpotifyPlaylist.id;\n          const spotifyPlaylistUrl = `https://open.spotify.com/playlist/${spotifyPlaylistId}`;\n          \n          console.log(`Created Spotify playlist: ${spotifyPlaylistId}`);\n          \n          // Save the Spotify playlist ID to state\n          dispatch({ \n            type: 'SET_SPOTIFY_PLAYLIST', \n            payload: { \n              id: spotifyPlaylistId, \n              url: spotifyPlaylistUrl\n            } \n          });\n          \n          // Search for tracks on Spotify and add them to the playlist\n          dispatch({ type: 'SET_STATUS', payload: ConversionStatus.MATCHING_TRACKS });\n          let successCount = 0;\n          let failureCount = 0;\n          let totalTracks = tracks.length;\n          let failedTracks: FailedTrack[] = []; // Track failed tracks\n          \n          console.log(`Starting to add ${totalTracks} tracks to Spotify playlist ${spotifyPlaylistId}`);\n          console.log('First few tracks:', tracks.slice(0, 3).map(t => ({ name: t.name, artists: t.artists })));\n          \n                     // Process tracks one by one with progress updates\n           if (!Array.isArray(tracks) || tracks.length === 0) {\n             throw new Error('No tracks available to convert. Please re-select the playlist.');\n           }\n          for (let i = 0; i < tracks.length; i++) {\n            const track = tracks[i];\n            \n            try {\n              console.log(`\\n--- Processing track ${i + 1}/${totalTracks}: \"${track.name}\" by ${track.artists[0]} ---`);\n              \n              // Use improved search queries\n              const searchQueries = generateSearchQueries(track);\n              console.log('Generated search queries:', searchQueries);\n              \n              let bestMatch = null;\n              let bestScore = 0;\n              let bestMatchTitle = '';\n              let bestMatchArtist = '';\n              \n              // Try each search query\n              for (const searchQuery of searchQueries) {\n                console.log(`Searching Spotify for: \"${searchQuery}\"`);\n                \n                try {\n                  console.log(`Searching Spotify for: \"${searchQuery}\"`);\n                  const searchResults = await searchSpotifyTracks(searchQuery, 20); // Get more results\n                  \n                  console.log(`Search results for \"${searchQuery}\":`, searchResults ? 'Found results' : 'No results');\n                  \n                  if (searchResults && searchResults.tracks && searchResults.tracks.items && searchResults.tracks.items.length > 0) {\n                    console.log(`Found ${searchResults.tracks.items.length} results for \"${searchQuery}\"`);\n                    \n                    // Score each result based on similarity\n                    for (const result of searchResults.tracks.items) {\n                      const score = calculateTrackSimilarity(track, result);\n                      console.log(`  Result: \"${result.name}\" by ${result.artists[0].name} - Score: ${score.toFixed(2)}`);\n                      \n                      if (score > bestScore) {\n                        bestScore = score;\n                        bestMatch = result;\n                        bestMatchTitle = result.name;\n                        bestMatchArtist = result.artists[0].name;\n                      }\n                    }\n                  } else {\n                    console.log(`No search results found for \"${searchQuery}\"`);\n                  }\n                } catch (searchError) {\n                  console.error(`Error searching for \"${searchQuery}\":`, searchError);\n                }\n                \n                // If we found a good match (score > 0.6), stop searching\n                if (bestScore > 0.6) {\n                  console.log(`Found good match with score ${bestScore.toFixed(2)}, stopping search`);\n                  break;\n                }\n              }\n              \n                             // Lower the threshold for better matching - from 0.5 to 0.25\n                             if (bestMatch && bestScore > 0.25) {\n                const trackUri = bestMatch.uri;\n                \n                console.log(`Found Spotify track: ${bestMatch.name} by ${bestMatch.artists[0].name} (score: ${bestScore.toFixed(2)})`);\n                console.log(`Adding track URI: ${trackUri} to playlist ${spotifyPlaylistId}`);\n                \n                try {\n                  // Add the track to the Spotify playlist\n                  await addTracksToSpotifyPlaylist(spotifyPlaylistId, [trackUri]);\n                  console.log(`Successfully added track ${i + 1}/${totalTracks}`);\n                  successCount++;\n                } catch (addError) {\n                  console.error(`Error adding track to playlist:`, addError);\n                  failureCount++;\n                  \n                  // Track the failed track with details\n                  const failedTrack: FailedTrack = {\n                    name: track.name,\n                    artists: track.artists,\n                    reason: `Failed to add to playlist: ${addError instanceof Error ? addError.message : 'Unknown error'}`,\n                    searchQueries: searchQueries,\n                    bestMatchScore: bestScore,\n                    bestMatchTitle: bestMatchTitle || 'None',\n                    bestMatchArtist: bestMatchArtist || 'None'\n                  };\n                  failedTracks.push(failedTrack);\n                }\n              } else {\n                failureCount++;\n                console.log(`No good Spotify match found for: \"${track.name}\" by ${track.artists[0]} (best score: ${bestScore.toFixed(2)})`);\n                \n                // Track the failed track with details\n                const failedTrack: FailedTrack = {\n                  name: track.name,\n                  artists: track.artists,\n                  reason: bestScore > 0 ? `Best match score (${bestScore.toFixed(2)}) below threshold (0.3)` : 'No matches found',\n                  searchQueries: searchQueries,\n                  bestMatchScore: bestScore,\n                  bestMatchTitle: bestMatchTitle || 'None',\n                  bestMatchArtist: bestMatchArtist || 'None'\n                };\n                failedTracks.push(failedTrack);\n              }\n            } catch (error) {\n              failureCount++;\n              console.error(`Error processing track \"${track.name}\":`, error);\n              \n              // Track the failed track with error details\n              const failedTrack: FailedTrack = {\n                name: track.name,\n                artists: track.artists,\n                reason: error instanceof Error ? error.message : 'Unknown error',\n                searchQueries: [\n                  `${track.artists[0]} ${track.name}`,\n                  `${track.name} ${track.artists[0]}`,\n                  track.name,\n                  `${track.artists[0]} - ${track.name}`,\n                  `${track.artists[0]} \"${track.name}\"`\n                ],\n                bestMatchScore: 0,\n                bestMatchTitle: 'Error occurred',\n                bestMatchArtist: 'Error occurred'\n              };\n              failedTracks.push(failedTrack);\n            }\n            \n            // Update progress after each track\n            const progress = Math.min(((i + 1) / totalTracks) * 100, 100);\n            dispatch({ type: 'UPDATE_MATCHING_PROGRESS', payload: progress });\n            \n            // Small delay to avoid rate limiting\n            await new Promise(resolve => setTimeout(resolve, 500));\n          }\n          \n          console.log(`\\n--- Conversion Summary ---`);\n          console.log(`Total tracks: ${totalTracks}`);\n          console.log(`Successfully converted: ${successCount}`);\n          console.log(`Failed to convert: ${failureCount}`);\n          console.log(`Success rate: ${((successCount / totalTracks) * 100).toFixed(1)}%`);\n          \n          if (failedTracks.length > 0) {\n            console.log('Failed tracks:', failedTracks);\n          }\n          \n          // Update user stats when conversion is successful\n          if (user?.uid) {\n            try {\n              // Determine platform direction based on conversion type\n              const platformDirection = 'spotify-to-youtube' as const; // Spotify to YouTube conversion\n              await profileService.addConversion(user.uid, successCount, platformDirection);\n              console.log('Successfully updated user stats for conversion');\n            } catch (error) {\n              console.error('Failed to update user stats:', error);\n            }\n          }\n          \n                     // Update state to indicate success\n           dispatch({ type: 'SET_STATUS', payload: ConversionStatus.SUCCESS });\n           dispatch({ type: 'UPDATE_MATCHING_PROGRESS', payload: 100 });\n          \n          // Save the conversion to history\n          const conversionResult: ConversionResult = {\n            id: `conversion_${Date.now()}`,\n            spotifyPlaylistId,\n            spotifyPlaylistName,\n            spotifyPlaylistUrl,\n            youtubePlaylistId: playlistId,\n            youtubePlaylistUrl: `https://www.youtube.com/playlist?list=${playlistId}`,\n            tracksMatched: successCount,\n            tracksFailed: failureCount,\n            totalTracks: tracks.length,\n            convertedAt: new Date(),\n            failedTracks: failedTracks // Include failed tracks in history\n          };\n\n          // Update conversion history in state\n          dispatch({\n            type: 'SET_CONVERSION_HISTORY',\n            payload: [conversionResult, ...state.conversionHistory]\n          });\n\n          // Save to local storage\n          saveConversionHistoryToLocalStorage(user.uid, [conversionResult, ...state.conversionHistory]);\n\n          // Try to save to Firestore with enhanced error handling\n          try {\n            console.log('Attempting to save conversion to Firestore:', {\n              userId: user.uid,\n              conversionId: conversionResult.id,\n              playlistName: conversionResult.spotifyPlaylistName\n            });\n\n            const conversionsRef = collection(db, 'users', user.uid, 'conversions').withConverter(conversionConverter as any);\n            const docRef = doc(conversionsRef, conversionResult.id);\n            \n            await setDoc(docRef, {\n              ...conversionResult,\n              convertedAt: Timestamp.fromDate(conversionResult.convertedAt),\n              userId: user.uid,\n              tracks: tracks.map(track => ({\n                name: track.name ?? 'Unknown',\n                artists: Array.isArray(track.artists) ? track.artists : [],\n                album: track.album ?? '',\n                duration_ms: track.duration_ms ?? 0,\n                popularity: track.popularity ?? 0,\n                explicit: track.explicit ?? false,\n                ...(track.releaseYear ? { releaseYear: track.releaseYear } : {}),\n                genres: Array.isArray(track.genres) ? track.genres : [],\n                artistImages: Array.isArray(track.artistImages) ? track.artistImages : []\n              })),\n              ...(Array.isArray(failedTracks) ? { failedTracks } : {})\n            });\n\n            console.log('Successfully saved conversion to Firestore:', docRef.id);\n          } catch (firestoreError) {\n            console.error('Failed to save conversion history to Firestore:', firestoreError);\n            logFirestoreError('saveConversion', firestoreError, user.uid);\n          }\n          \n        } catch (playlistError) {\n          console.error('Error during Spotify playlist creation or population:', playlistError);\n          let errorMessage = 'Failed to create or update Spotify playlist';\n          \n          if (playlistError instanceof Error) {\n            if (playlistError.message.includes('Authentication') || playlistError.message.includes('token')) {\n              errorMessage = 'Spotify authentication expired. Please reconnect your Spotify account.';\n            } else if (playlistError.message.includes('quota')) {\n              errorMessage = 'Spotify API quota exceeded. Please try again later.';\n            } else {\n              errorMessage = `Spotify error: ${playlistError.message}`;\n            }\n          }\n          \n          throw new Error(errorMessage);\n        }\n      }\n      } catch (error) {\n      console.error('Conversion error:', error);\n      \n      // Provide a helpful error message based on the error type\n      let userErrorMessage = 'An error occurred during conversion';\n      \n      if (error instanceof Error) {\n        if (error.message.includes('timed out')) {\n          userErrorMessage = 'The request timed out. Your connection may be slow or unstable. The playlist may have been partially created.';\n        } else if (error.message.includes('quota')) {\n          userErrorMessage = 'YouTube API quota exceeded. Please try again later (usually after 24 hours).';\n        } else if (error.message.includes('Authentication') || error.message.includes('token')) {\n          userErrorMessage = 'Authentication issue. Please try reconnecting your accounts.';\n        } else {\n          // Use the error message directly if it's user-friendly\n          userErrorMessage = error.message;\n        }\n      }\n      \n      dispatch({ \n        type: 'SET_ERROR', \n        payload: userErrorMessage\n      });\n      dispatch({ type: 'SET_STATUS', payload: ConversionStatus.ERROR });\n    }\n  }, [state.spotifyPlaylists, state.youtubePlaylists, user, dispatch, state.tracks, state.selectedPlaylistId]);\n  \n  const resetConversion = () => {\n    dispatch({ type: 'RESET' });\n  };\n  \n  const fetchConversionHistory = async () => {\n    dispatch({ type: 'SET_ERROR', payload: null });\n    \n    if (!user) {\n      console.log('No authenticated user found, cannot fetch conversion history');\n      return;\n    }\n    \n    try {\n      // Try getting history from localStorage first\n      const localHistory = getConversionHistoryFromLocalStorage(user.uid);\n      console.log('Loaded from localStorage:', {\n        count: localHistory.length,\n        conversions: localHistory.map(c => ({\n          id: c.id,\n          tracksFailed: c.tracksFailed,\n          failedTracksLength: c.failedTracks?.length\n        }))\n      });\n      if (localHistory.length > 0) {\n        dispatch({ type: 'SET_CONVERSION_HISTORY', payload: localHistory });\n      }\n      \n      // Then try to get from Firestore and update if available\n      try {\n        console.log('Fetching conversion history from Firestore for user:', user.uid);\n        // Ensure db is defined and user is fully authenticated\n        if (!db) {\n          console.error('Firestore database not initialized');\n          throw new Error('Database not available');\n        }\n        \n        // Wait a moment to ensure auth token has propagated\n        await new Promise(resolve => setTimeout(resolve, 500));\n        \n      const conversionsRef = collection(db, 'users', user.uid, 'conversions').withConverter(conversionConverter as any);\n      const q = query(conversionsRef, orderBy('convertedAt', 'desc'));\n        \n        // Add timeout to the getDocs call\n        const queryPromise = getDocs(q);\n        const timeoutPromise = new Promise((_, reject) => \n          setTimeout(() => reject(new Error('Firestore query timeout')), 10000)\n        );\n        \n        const querySnapshot = await Promise.race([queryPromise, timeoutPromise]) as QuerySnapshot;\n        \n      if (!querySnapshot.empty) {\n        const history: ConversionResult[] = [];\n        \n        querySnapshot.forEach((doc) => {\n          const data = doc.data();\n          console.log('Loading conversion from Firestore:', {\n            id: doc.id,\n            tracksFailed: data.tracksFailed,\n            failedTracks: data.failedTracks,\n            failedTracksLength: data.failedTracks?.length\n          });\n          history.push({\n            id: doc.id,\n            spotifyPlaylistId: data.spotifyPlaylistId,\n            spotifyPlaylistName: data.spotifyPlaylistName,\n              spotifyPlaylistUrl: data.spotifyPlaylistUrl,\n            youtubePlaylistId: data.youtubePlaylistId,\n            youtubePlaylistUrl: data.youtubePlaylistUrl,\n            tracksMatched: data.tracksMatched,\n            tracksFailed: data.tracksFailed,\n            totalTracks: data.totalTracks,\n            convertedAt: data.convertedAt.toDate(),\n            failedTracks: data.failedTracks || [] // Load failed tracks from Firestore\n          });\n          });\n          \n          // Update the state with the Firestore history\n          dispatch({ type: 'SET_CONVERSION_HISTORY', payload: history });\n          \n          // Also update localStorage for offline access\n          saveConversionHistoryToLocalStorage(user.uid, history);\n        } else {\n          console.log('No conversion history found in Firestore');\n        }\n      } catch (firestoreError) {\n        // Use our enhanced error logging helper\n        logFirestoreError('fetchConversionHistory', firestoreError, user.uid);\n        \n        // Try to recover from Firestore channel termination error\n        if (await handleFirestoreRecovery(firestoreError)) {\n          // If recovery was successful, try to fetch again after a short delay\n          console.log('Firestore connection recovered, retrying fetch...');\n          setTimeout(() => fetchConversionHistory(), 1500);\n          return;\n        }\n        \n        // If we have local history, don't show an error to the user\n        if (localHistory.length === 0) {\n          if (isFirestorePermissionError(firestoreError)) {\n            console.log('Using offline mode for conversion history due to permission error');\n            \n            // Store this information so the UI can show an appropriate message\n            window._firestoreUsingOfflineMode = true;\n            \n            // Try to reconnect Firestore one more time\n            try {\n              const reconnected = await reconnectFirestore();\n              if (reconnected) {\n                console.log('Successfully reconnected Firestore after permission error');\n              }\n            } catch (e) {\n              console.log('Failed to reconnect Firestore:', e);\n        }\n      } else {\n            dispatch({ \n              type: 'SET_ERROR', \n              payload: 'Unable to retrieve conversion history. Using offline mode.' \n            });\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Error in fetchConversionHistory:', error);\n      dispatch({ \n        type: 'SET_ERROR', \n        payload: 'Failed to load conversion history. Please try again later.' \n      });\n    }\n  };\n  \n  // Add public playlist URL conversion function\n  const convertFromPublicUrl = useCallback(async (playlistUrl: string, sourcePlatform: 'spotify' | 'youtube') => {\n    dispatch({ type: 'SET_LOADING', payload: true });\n    dispatch({ type: 'SET_ERROR', payload: null });\n\n    try {\n      // Extract playlist ID from URL\n      let playlistId: string;\n      \n      if (sourcePlatform === 'spotify') {\n        // Spotify URL formats: \n        // https://open.spotify.com/playlist/37i9dQZF1DXcBWIGoYBM5M\n        // spotify:playlist:37i9dQZF1DXcBWIGoYBM5M\n        const spotifyMatch = playlistUrl.match(/(?:spotify:playlist:|playlist\\/)([a-zA-Z0-9]{22})/);\n        if (!spotifyMatch) {\n          throw new Error('Invalid Spotify playlist URL. Please paste a valid Spotify playlist link.');\n        }\n        playlistId = spotifyMatch[1];\n      } else {\n        // YouTube URL formats:\n        // https://www.youtube.com/playlist?list=PLrU1wdE2sKAhQfQl56b8pjBEuixrEP0A5\n        // https://music.youtube.com/playlist?list=PLrU1wdE2sKAhQfQl56b8pjBEuixrEP0A5\n        const youtubeMatch = playlistUrl.match(/[&?]list=([a-zA-Z0-9_-]+)/);\n        if (!youtubeMatch) {\n          throw new Error('Invalid YouTube playlist URL. Please paste a valid YouTube playlist link.');\n        }\n        playlistId = youtubeMatch[1];\n      }\n\n      console.log(`[ConversionContext] 🔗 Starting conversion from public ${sourcePlatform} URL:`, playlistId);\n\n      // Set the source and destination platforms in localStorage\n      localStorage.setItem('source_platform', sourcePlatform);\n      localStorage.setItem('destination_platform', sourcePlatform === 'spotify' ? 'youtube' : 'spotify');\n\n      // Set the playlist ID in state and start conversion\n      dispatch({ type: 'SELECT_PLAYLIST', payload: playlistId });\n      \n      // Start conversion with a slight delay to ensure state is updated\n      setTimeout(() => {\n        startConversion();\n      }, 100);\n\n    } catch (error) {\n      console.error('Error converting from public URL:', error);\n      let errorMessage = 'Failed to convert playlist from URL';\n      \n      if (error instanceof Error) {\n        errorMessage = error.message;\n      }\n      \n      dispatch({ type: 'SET_ERROR', payload: errorMessage });\n    } finally {\n      dispatch({ type: 'SET_LOADING', payload: false });\n    }\n  }, [dispatch]);\n\n  // Add family-friendly reconnection function\n  const reconnectWithFamilyMode = useCallback(async () => {\n    try {\n      dispatch({ type: 'SET_LOADING', payload: true });\n      dispatch({ type: 'SET_ERROR', payload: null });\n\n      // Import progressive auth function\n      const { initProgressiveSpotifyAuth } = await import('../lib/spotifyAuth');\n      \n      console.log('[ConversionContext] 👨‍👩‍👧‍👦 Attempting family-friendly Spotify connection...');\n      \n      // Try with read-only scopes\n      const result = await initProgressiveSpotifyAuth(true);\n      \n      if (!result.success) {\n        throw new Error(result.error || 'Failed to connect with family-friendly mode');\n      }\n\n      // Connection initiated, user will be redirected\n      \n    } catch (error) {\n      console.error('Error reconnecting with family mode:', error);\n      dispatch({ \n        type: 'SET_ERROR', \n        payload: error instanceof Error ? error.message : 'Failed to reconnect with family-friendly mode' \n      });\n    } finally {\n      dispatch({ type: 'SET_LOADING', payload: false });\n    }\n  }, [dispatch]);\n  \n  const contextValue: ConversionContextType = {\n    state,\n    fetchSpotifyPlaylists,\n    fetchYouTubePlaylists,\n    selectPlaylist,\n    selectYouTubePlaylist,\n    startConversion,\n    convertFromPublicUrl,\n    reconnectWithFamilyMode,\n    resetConversion,\n    fetchConversionHistory,\n    dispatch\n  };\n  \n  return (\n    <ConversionContext.Provider value={contextValue}>\n      {children}\n    </ConversionContext.Provider>\n  );\n}; ","import React, { createContext, useContext, useState, useEffect } from 'react';\nimport { useAuth } from '../lib/AuthContext';\n\ninterface User {\n  uid: string;\n  email: string | null;\n  displayName: string | null;\n}\n\ninterface UserContextType {\n  user: User | null;\n  loading: boolean;\n  error: string | null;\n  signInWithEmail: (email: string, password: string) => Promise<void>;\n  signInWithGoogle: () => Promise<void>;\n  signUpWithEmail: (email: string, password: string, displayName: string) => Promise<void>;\n  signOut: () => Promise<void>;\n}\n\nconst UserContext = createContext<UserContextType | undefined>(undefined);\n\nexport const UserProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const auth = useAuth();\n  const [error, setError] = useState<string | null>(null);\n\n  const signInWithEmail = async (email: string, password: string) => {\n    try {\n      setError(null);\n      await auth.signInWithEmail(email, password);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Authentication failed');\n      throw err;\n    }\n  };\n\n  const signInWithGoogle = async () => {\n    try {\n      setError(null);\n      await auth.signIn();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Google authentication failed');\n      throw err;\n    }\n  };\n\n  const signUpWithEmail = async (email: string, password: string, displayName: string) => {\n    try {\n      setError(null);\n      await auth.signUpWithEmail(email, password, displayName, false);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Sign up failed');\n      throw err;\n    }\n  };\n\n  const signOut = async () => {\n    try {\n      setError(null);\n      await auth.signOut();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Sign out failed');\n      throw err;\n    }\n  };\n\n  return (\n    <UserContext.Provider\n      value={{\n        user: auth.user ? {\n          uid: auth.user.uid,\n          email: auth.user.email,\n          displayName: auth.user.displayName\n        } : null,\n        loading: auth.loading,\n        error: error || auth.error,\n        signInWithEmail,\n        signInWithGoogle,\n        signUpWithEmail,\n        signOut\n      }}\n    >\n      {children}\n    </UserContext.Provider>\n  );\n};\n\nexport const useUser = () => {\n  const context = useContext(UserContext);\n  if (context === undefined) {\n    throw new Error('useUser must be used within a UserProvider');\n  }\n  return context;\n}; ","import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n} \n\n/**\n * Check if the current device is a mobile device\n */\nexport const isMobileDevice = (): boolean => {\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n};\n\n/**\n * Check if the device is specifically Android\n */\nexport const isAndroidDevice = (): boolean => {\n  return /Android/i.test(navigator.userAgent);\n};\n\n/**\n * Check if the device is iOS\n */\nexport const isIOSDevice = (): boolean => {\n  return /iPhone|iPad|iPod/i.test(navigator.userAgent);\n};\n\n/**\n * Detect connection quality for better mobile experience\n */\nexport const detectConnectionQuality = (): 'good' | 'slow' | 'limited' | 'offline' => {\n  if (!navigator.onLine) {\n    return 'offline';\n  }\n  \n  // Use Navigator Connection API if available\n  if ('connection' in navigator) {\n    const conn = (navigator as any).connection;\n    \n    if (conn) {\n      // Data saver mode\n      if (conn.saveData) {\n        return 'limited';\n      }\n      \n      // Detect slow connection\n      if (conn.effectiveType && ['slow-2g', '2g', '3g'].includes(conn.effectiveType)) {\n        return 'slow';\n      }\n    }\n  }\n  \n  return 'good';\n};\n\n// optimizeForMobile is temporarily disabled for debugging mobile rendering issues.\n// export const optimizeForMobile = () => {\n//   const isMobile = isMobileDevice() || window.innerWidth < 768;\n  \n//   if (isMobile) {\n//     // 1. Add mobile class to body\n//     document.body.classList.add('is-mobile');\n//     document.documentElement.classList.add('is-mobile-device');\n    \n//     // 2. Set viewport based on device\n//     if (isIOSDevice()) {\n//       // iOS-specific optimizations\n//       const viewportMeta = document.querySelector('meta[name=\"viewport\"]');\n//       if (viewportMeta) {\n//         viewportMeta.setAttribute('content', \n//           'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');\n//       }\n//     }\n    \n//     // 3. Reduce animation complexity\n//     // Reduce animation frame rate for complex animations\n//     const originalRequestAnimationFrame = window.requestAnimationFrame;\n//     window.requestAnimationFrame = (callback) => {\n//       // Only throttle if explicitly marked as complex\n//       if (document.documentElement.classList.contains('complex-animation-running')) {\n//         return window.setTimeout(() => callback(performance.now()), 33); // ~30fps\n//       }\n//       return originalRequestAnimationFrame(callback);\n//     };\n    \n//     // 4. Listen for orientation changes\n//     const updateOrientation = () => {\n//       const isPortrait = window.innerHeight > window.innerWidth;\n//       document.body.classList.toggle('portrait', isPortrait);\n//       document.body.classList.toggle('landscape', !isPortrait);\n      \n//       // Dispatch a custom event for components to react\n//       window.dispatchEvent(new CustomEvent('orientationchange', {\n//         detail: { isPortrait }\n//       }));\n//     };\n    \n//     // 5. Setup listeners\n//     window.addEventListener('resize', updateOrientation, { passive: true });\n//     updateOrientation();\n    \n//     // 6. Fix common mobile browser bugs\n//     // Fix for delayed focus on inputs\n//     document.addEventListener('touchend', (e) => {\n//       const target = e.target as HTMLElement;\n//       if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.tagName === 'SELECT') {\n//         // Small delay to prevent conflicts with other handlers\n//         setTimeout(() => {\n//           (target as HTMLInputElement).focus();\n//         }, 100);\n//       }\n//     }, { passive: true });\n    \n//     // 7. Optimize scroll performance\n//     document.documentElement.classList.add('smooth-scroll');\n    \n//     return {\n//       isMobile: true,\n//       cleanupFunction: () => {\n//         window.removeEventListener('resize', updateOrientation);\n//         // Restore original RAF\n//         window.requestAnimationFrame = originalRequestAnimationFrame;\n//       }\n//     };\n//   }\n  \n//   return { isMobile: false, cleanupFunction: () => {} };\n// };\n\n/**\n * Comprehensive mobile device detection and information\n */\nexport const getMobileInfo = () => {\n  const isMobile = isMobileDevice();\n  const isAndroid = isAndroidDevice();\n  const isIOS = isIOSDevice();\n  const isTablet = /iPad/i.test(navigator.userAgent) || \n                   (isAndroid && !/Mobile/i.test(navigator.userAgent));\n  \n  // Get orientation information\n  const isPortrait = window.innerHeight > window.innerWidth;\n  \n  // Check for specific mobile browser\n  const isMobileSafari = /iPhone|iPad|iPod/i.test(navigator.userAgent) && \n                         /WebKit/i.test(navigator.userAgent) && \n                         !/(CriOS|FxiOS)/i.test(navigator.userAgent);\n  const isMobileChrome = /Android/i.test(navigator.userAgent) && \n                         /Chrome/i.test(navigator.userAgent);\n  \n  // Viewport dimensions\n  const viewportWidth = window.innerWidth;\n  const viewportHeight = window.innerHeight;\n  \n  // Get touch support info\n  const hasTouchSupport = 'ontouchstart' in window || \n                         navigator.maxTouchPoints > 0 || \n                         (navigator as any).msMaxTouchPoints > 0;\n  \n  return {\n    isMobile,\n    isAndroid,\n    isIOS,\n    isTablet,\n    isPortrait,\n    isMobileSafari,\n    isMobileChrome,\n    viewportWidth,\n    viewportHeight,\n    hasTouchSupport,\n    connectionQuality: detectConnectionQuality()\n  };\n};\n\n/**\n * Check if the browser has support for passive event listeners \n * (important for touch performance)\n */\nexport const supportsPassiveEvents = (): boolean => {\n  let supportsPassive = false;\n  try {\n    // Test via a getter in the options object to see if the passive property is accessed\n    const opts = Object.defineProperty({}, 'passive', {\n      get: function() {\n        supportsPassive = true;\n        return true;\n      }\n    });\n\n    window.addEventListener('testPassive', null as any, opts);\n    window.removeEventListener('testPassive', null as any, opts);\n  } catch (e) {}\n  \n  return supportsPassive;\n};\n\n/**\n * Register events with passive listeners for better touch performance\n */\nexport const addPassiveEventListener = (\n  element: Element | Window | Document,\n  eventName: string,\n  handler: EventListener,\n  options: boolean | AddEventListenerOptions = {}\n) => {\n  try {\n    // Test if passive is supported\n    let supportsPassive = false;\n    const opts = Object.defineProperty({}, 'passive', {\n      get: function() {\n        supportsPassive = true;\n        return true;\n      }\n    });\n    window.addEventListener('testPassive', null as any, opts);\n    window.removeEventListener('testPassive', null as any, opts);\n\n    // Add event listener with passive option if supported\n    const listenerOptions = typeof options === 'boolean' ? { capture: options } : options;\n    element.addEventListener(eventName, handler, {\n      ...listenerOptions,\n      passive: supportsPassive && (listenerOptions.passive !== false)\n    });\n\n    // Return cleanup function\n    return () => {\n      element.removeEventListener(eventName, handler, typeof options === 'boolean' ? options : options.capture);\n    };\n  } catch (e) {\n    // Fallback to normal event listener if something goes wrong\n    element.addEventListener(eventName, handler, options);\n    return () => {\n      element.removeEventListener(eventName, handler, options);\n    };\n  }\n};\n\n/**\n * Helper to properly handle both touch and mouse events\n */\nexport const addTouchAndMouseEvent = (\n  element: HTMLElement,\n  eventType: 'start' | 'move' | 'end',\n  handler: (e: Event) => void\n): () => void => {\n  const touchMap = {\n    start: 'touchstart',\n    move: 'touchmove',\n    end: 'touchend'\n  };\n  \n  const mouseMap = {\n    start: 'mousedown',\n    move: 'mousemove',\n    end: 'mouseup'\n  };\n  \n  // For touch events, we want passive by default for better scrolling performance\n  // except for touchmove which might need to prevent default for custom gestures\n  const isPassive = eventType !== 'move';\n  \n  // Use proper typing for event listeners\n  addPassiveEventListener(element, touchMap[eventType], handler, isPassive);\n  element.addEventListener(mouseMap[eventType], handler);\n  \n  // Return a cleanup function\n  return () => {\n    element.removeEventListener(touchMap[eventType], handler);\n    element.removeEventListener(mouseMap[eventType], handler);\n  };\n};\n\n/**\n * Helper to check if touch is supported\n */\nexport const isTouchDevice = () => {\n  return 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n};\n\n/**\n * Helper to check if an element is scrollable\n */\nexport const isScrollable = (element: HTMLElement) => {\n  return element.scrollHeight > element.clientHeight;\n}; ","import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport { cn } from '../../lib/utils';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { \n  faMusic, faGuitar, faMicrophone, faHeadphones, \n  faDrum, faCompactDisc, faVolumeHigh \n} from '@fortawesome/free-solid-svg-icons';\nimport { faSpotify, faYoutube, faSoundcloud } from '@fortawesome/free-brands-svg-icons';\nimport { useTheme } from '../../lib/ThemeContext';\n\n// Musical notes and symbols\nconst MUSIC_NOTES = ['♪', '♫', '♬', '♭', '♮', '♯', '𝄞', '𝄢', '𝄪', '𝅘𝅥𝅮', '𝅘𝅥𝅯', '𝅘𝅥𝅰'];\n\n// Icon options\nconst MUSIC_ICONS = [\n  faMusic, faGuitar, faMicrophone, faHeadphones, faDrum, faCompactDisc, faVolumeHigh\n];\n\n// Platform icons\nconst PLATFORM_ICONS = [faSpotify, faYoutube, faSoundcloud];\n\n// Performance constants\nconst MOUSE_THROTTLE_MS = 16; // ~60fps\nconst PARTICLE_UPDATE_THROTTLE_MS = 32; // ~30fps\nconst REPULSION_RADIUS = 15; // Reduced from 20\nconst MAX_PARTICLES = 50; // Limit particle count\n\n// Types of particles\ntype ParticleType = 'note' | 'icon' | 'platform' | 'circle';\n\n// Particle element data structure\ninterface ParticleElement {\n  id: number;\n  type: ParticleType;\n  content: string | React.ReactNode;\n  x: number;\n  y: number;\n  startX: number; // Original X position\n  startY: number; // Original Y position\n  size: number;\n  color: string;\n  opacity: number;\n  rotation: number;\n  duration: number;\n  delay: number;\n  path: 'wave' | 'zigzag' | 'curve' | 'circle' | 'linear';\n}\n\ninterface ParticleFieldProps {\n  color?: string;\n  className?: string;\n  includeNotes?: boolean;\n  includeIcons?: boolean;\n  includePlatforms?: boolean;\n  includeCircles?: boolean;\n  animated?: boolean;\n  colorScheme?: 'monochrome' | 'colorful' | 'brand';\n  density?: 'low' | 'medium' | 'high';\n  speedFactor?: number;\n  interactive?: boolean;\n}\n\n// Utility functions\nconst random = (min: number, max: number) => Math.random() * (max - min) + min;\nconst randomInt = (min: number, max: number) => Math.floor(random(min, max));\nconst randomItem = <T,>(items: T[]): T => items[randomInt(0, items.length)];\nconst distance = (x1: number, y1: number, x2: number, y2: number): number => {\n  return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n};\n\n// Throttle function for performance\nconst throttle = (func: Function, limit: number) => {\n  let inThrottle: boolean;\n  return function(this: any, ...args: any[]) {\n    if (!inThrottle) {\n      func.apply(this, args);\n      inThrottle = true;\n      setTimeout(() => inThrottle = false, limit);\n    }\n  };\n};\n\nexport const ParticleField: React.FC<ParticleFieldProps> = React.memo(({ \n  color = \"#ffffff\", \n  className = \"\",\n  includeNotes = true,\n  includeIcons = true,\n  includePlatforms = true,\n  includeCircles = true,\n  animated = true,\n  colorScheme = 'colorful',\n  density = 'medium',\n  speedFactor = 1,\n  interactive = true\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [particles, setParticles] = useState<ParticleElement[]>([]);\n  const [particlePositions, setParticlePositions] = useState<{[key: number]: {x: number, y: number}}>({});\n  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });\n  const [isMouseMoving, setIsMouseMoving] = useState(false);\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\n  \n  // Performance refs to avoid state updates\n  const mousePositionRef = useRef({ x: 0, y: 0 });\n  const isMouseMovingRef = useRef(false);\n  const animationFrameRef = useRef<number>();\n  const mouseStopTimerRef = useRef<NodeJS.Timeout>();\n\n  // Memoized particle count based on density\n  const getParticleCount = useCallback(() => {\n    const baseCount = density === 'low' ? 15 : density === 'medium' ? 30 : 45;\n    return Math.min(baseCount, MAX_PARTICLES);\n  }, [density]);\n\n  // Memoized color generation\n  const getParticleColor = useCallback((type: ParticleType): string => {\n    if (colorScheme === 'monochrome') {\n      return color;\n    }\n    \n    const colors = {\n      note: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'],\n      icon: ['#A8E6CF', '#DCEDC8', '#FFD3B6', '#FFAAA5', '#FF8B94'],\n      platform: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'],\n      circle: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7']\n    };\n    \n    return randomItem(colors[type] || colors.note);\n  }, [colorScheme, color]);\n\n  // Memoized particle generation\n  const generateParticle = useCallback((id: number): ParticleElement => {\n    const types: ParticleType[] = [];\n    if (includeNotes) types.push('note');\n    if (includeIcons) types.push('icon');\n    if (includePlatforms) types.push('platform');\n    if (includeCircles) types.push('circle');\n    \n    const type = randomItem(types);\n    const paths: Array<'wave' | 'zigzag' | 'curve' | 'circle' | 'linear'> = ['wave', 'zigzag', 'curve', 'circle', 'linear'];\n    \n    const notes = ['♪', '♫', '♬', '♩', '♭', '♮', '♯'];\n    const icons = ['🎵', '🎶', '🎹', '🎸', '🎺', '🎷', '🎤', '🎧'];\n    const platforms = ['🎵', '🎶', '🎹', '🎸', '🎺', '🎷', '🎤', '🎧'];\n    \n    const contentMap = {\n      note: randomItem(notes),\n      icon: randomItem(icons),\n      platform: randomItem(platforms),\n      circle: ''\n    };\n    \n    return {\n      id,\n      type,\n      content: contentMap[type],\n      x: random(5, 95),\n      y: random(5, 95),\n      startX: random(5, 95),\n      startY: random(5, 95),\n      size: type === 'circle' ? random(4, 12) : random(12, 24),\n      color: getParticleColor(type),\n      opacity: random(0.1, type === 'circle' ? 0.3 : 0.6),\n      rotation: random(-30, 30),\n      duration: random(20, 40) / speedFactor,\n      delay: random(0, 15),\n      path: randomItem(paths) as 'wave' | 'zigzag' | 'curve' | 'circle' | 'linear'\n    };\n  }, [includeNotes, includeIcons, includePlatforms, includeCircles, getParticleColor, speedFactor]);\n\n  // Optimized particle generation with reduced dependencies\n  useEffect(() => {\n    const count = getParticleCount();\n    const newParticles = Array.from({ length: count }, (_, i) => generateParticle(i));\n    setParticles(newParticles);\n    \n    // Initialize particle positions\n    const initialPositions: {[key: number]: {x: number, y: number}} = {};\n    newParticles.forEach(particle => {\n      initialPositions[particle.id] = { \n        x: particle.x,\n        y: particle.y\n      };\n    });\n    setParticlePositions(initialPositions);\n  }, [getParticleCount, generateParticle]);\n\n  // Optimized resize handler\n  useEffect(() => {\n    const handleResize = throttle(() => {\n      setDimensions({\n        width: window.innerWidth,\n        height: window.innerHeight\n      });\n    }, 100);\n    \n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  // Memoized animation paths\n  const getAnimationForPath = useCallback((path: ParticleElement['path']) => {\n    const intensity = 80; // Reduced from 100\n    \n    switch (path) {\n      case 'wave':\n        return {\n          y: [0, -intensity, 0, intensity, 0],\n          x: [0, intensity/2, intensity, intensity/2, 0]\n        };\n      case 'zigzag':\n        return {\n          y: [0, -intensity, intensity, -intensity, 0],\n          x: [0, intensity, 0, -intensity, 0]\n        };\n      case 'curve':\n        return {\n          y: [0, -intensity/2, -intensity, -intensity/2, 0],\n          rotate: [0, 45, 0, -45, 0]\n        };\n      case 'circle':\n        return {\n          y: [0, -intensity, 0, intensity, 0],\n          x: [0, intensity, 0, -intensity, 0],\n          scale: [1, 1.05, 1, 0.95, 1]\n        };\n      case 'linear':\n      default:\n        return {\n          y: [0, -intensity*1.2, 0],\n          opacity: [0.2, 0.8, 0.2]\n        };\n    }\n  }, []);\n\n  // Throttled mouse movement handler\n  const handleMouseMove = useCallback(throttle((e: MouseEvent) => {\n    if (!containerRef.current || !interactive) return;\n    \n    const rect = containerRef.current.getBoundingClientRect();\n    const mouseX = ((e.clientX - rect.left) / rect.width) * 100;\n    const mouseY = ((e.clientY - rect.top) / rect.height) * 100;\n    \n    mousePositionRef.current = { x: mouseX, y: mouseY };\n    isMouseMovingRef.current = true;\n    \n    // Only update state occasionally to reduce re-renders\n    if (!isMouseMoving) {\n      setIsMouseMoving(true);\n    }\n    \n    // Apply repulsion effect with throttling\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    \n    animationFrameRef.current = requestAnimationFrame(() => {\n      const newPositions = { ...particlePositions };\n      let hasChanges = false;\n      \n      particles.forEach(particle => {\n        const dist = distance(particle.x, particle.y, mouseX, mouseY);\n        \n        if (dist < REPULSION_RADIUS) {\n          const repulsionStrength = (1 - dist / REPULSION_RADIUS) * 10; // Reduced from 15\n          const angle = Math.atan2(particle.y - mouseY, particle.x - mouseX);\n          \n          const newX = particle.x + Math.cos(angle) * repulsionStrength;\n          const newY = particle.y + Math.sin(angle) * repulsionStrength;\n          \n          const padding = 5;\n          const boundedX = Math.max(padding, Math.min(100 - padding, newX));\n          const boundedY = Math.max(padding, Math.min(100 - padding, newY));\n          \n          newPositions[particle.id] = { x: boundedX, y: boundedY };\n          hasChanges = true;\n        }\n      });\n      \n      if (hasChanges) {\n        setParticlePositions(newPositions);\n      }\n    });\n  }, MOUSE_THROTTLE_MS), [particles, particlePositions, interactive, isMouseMoving]);\n\n  // Mouse event handlers\n  useEffect(() => {\n    if (!interactive) return;\n    \n    document.addEventListener('mousemove', handleMouseMove);\n    \n    const handleMouseStop = throttle(() => {\n      isMouseMovingRef.current = false;\n      setIsMouseMoving(false);\n    }, 100);\n    \n    const resetMouseStopTimer = () => {\n      if (mouseStopTimerRef.current) {\n        clearTimeout(mouseStopTimerRef.current);\n      }\n      mouseStopTimerRef.current = setTimeout(handleMouseStop, 150);\n    };\n    \n    document.addEventListener('mousemove', resetMouseStopTimer);\n    \n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mousemove', resetMouseStopTimer);\n      if (mouseStopTimerRef.current) {\n        clearTimeout(mouseStopTimerRef.current);\n      }\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, [interactive, handleMouseMove]);\n\n  // Memoized particle rendering\n  const renderedParticles = useMemo(() => {\n    return particles.map(particle => {\n      const position = particlePositions[particle.id] || { x: particle.x, y: particle.y };\n      \n      return (\n        <motion.div\n          key={particle.id}\n          className=\"absolute\"\n          style={{\n            top: `${position.y}%`,\n            left: `${position.x}%`,\n            color: particle.color,\n            fontSize: `${particle.size}px`,\n            opacity: particle.opacity,\n            transform: `rotate(${particle.rotation}deg)`,\n            willChange: 'transform, opacity',\n            zIndex: particle.type === 'circle' ? 0 : 1,\n          }}\n          animate={position}\n          transition={{ type: 'spring', stiffness: 150, damping: 20 }}\n        >\n          {particle.type === 'circle' ? (\n            <motion.div\n              className=\"rounded-full\"\n              style={{\n                width: `${particle.size}px`,\n                height: `${particle.size}px`,\n                backgroundColor: particle.color,\n              }}\n              animate={isMouseMovingRef.current ? {} : animated ? {\n                y: [0, -30, 0, 30, 0],\n                opacity: [particle.opacity, particle.opacity * 1.3, particle.opacity]\n              } : {}}\n              transition={{\n                repeat: Infinity,\n                duration: particle.duration,\n                delay: particle.delay,\n                ease: \"easeInOut\"\n              }}\n            />\n          ) : (\n            <motion.div\n              animate={isMouseMovingRef.current ? {} : animated ? getAnimationForPath(particle.path) : {}}\n              transition={{\n                repeat: Infinity,\n                duration: particle.duration,\n                delay: particle.delay,\n                ease: \"easeInOut\"\n              }}\n              whileHover={interactive ? { scale: 1.2, opacity: 1 } : {}}\n            >\n              {particle.content}\n            </motion.div>\n          )}\n        </motion.div>\n      );\n    });\n  }, [particles, particlePositions, animated, interactive, getAnimationForPath]);\n\n  return (\n    <div\n      ref={containerRef}\n      className={`absolute inset-0 overflow-hidden pointer-events-none ${className}`}\n      style={{ willChange: 'transform' }}\n    >\n      <AnimatePresence>\n        {renderedParticles}\n      </AnimatePresence>\n\n      {/* Mouse position indicator for debugging (hidden in production) */}\n      {false && interactive && (\n        <motion.div \n          className=\"absolute w-3 h-3 bg-red-500 rounded-full\"\n          style={{\n            top: `${mousePosition.y}%`,\n            left: `${mousePosition.x}%`,\n            zIndex: 100,\n          }}\n        />\n      )}\n\n      <style>{`\n        @keyframes float-up {\n          0%, 100% { transform: translateY(0) rotate(0deg); }\n          50% { transform: translateY(-100px) rotate(10deg); }\n        }\n\n        @keyframes float-wave {\n          0%, 100% { transform: translateY(0) translateX(0) rotate(0deg); }\n          25% { transform: translateY(-30px) translateX(20px) rotate(5deg); }\n          50% { transform: translateY(0) translateX(40px) rotate(0deg); }\n          75% { transform: translateY(30px) translateX(20px) rotate(-5deg); }\n        }\n\n        @keyframes float-zigzag {\n          0%, 100% { transform: translateY(0) translateX(0); }\n          25% { transform: translateY(-40px) translateX(40px); }\n          50% { transform: translateY(0) translateX(0); }\n          75% { transform: translateY(40px) translateX(-40px); }\n        }\n      `}</style>\n    </div>\n  );\n});\n\nParticleField.displayName = 'ParticleField';","// src/components/ui/MorphingBlob.tsx\nimport React from 'react';\n\ninterface MorphingBlobProps {\n  color: string;\n  position: {\n    top?: string;\n    left?: string;\n    right?: string;\n    bottom?: string;\n  };\n  size: number;\n  animationDuration?: number;\n}\n\nexport const MorphingBlob: React.FC<MorphingBlobProps> = ({\n  color,\n  position,\n  size,\n  animationDuration = 20\n}) => {\n  const positionStyle = {\n    ...position,\n    width: `${size}px`,\n    height: `${size}px`\n  };\n  \n  return (\n    <div \n      className=\"absolute blur-3xl\"\n      style={{\n        ...positionStyle,\n        background: color,\n        borderRadius: \"40% 60% 60% 40% / 60% 30% 70% 40%\",\n        animation: `morph ${animationDuration}s ease-in-out infinite alternate`\n      }}\n    >\n      <style>\n        {`\n          @keyframes morph {\n            0% {\n              border-radius: 40% 60% 60% 40% / 60% 30% 70% 40%;\n              transform: translate(0, 0) rotate(0deg);\n            }\n            100% {\n              border-radius: 40% 60% 30% 70% / 50% 60% 30% 60%;\n              transform: translate(20px, 20px) rotate(15deg);\n            }\n          }\n        `}\n      </style>\n    </div>\n  );\n};","import React, { useState, useEffect } from 'react';\nimport { cn } from '../../lib/utils';\nimport { motion, AnimatePresence } from 'framer-motion';\n\ninterface FloatingElementsProps {\n  elements?: Array<{\n    icon?: React.ReactNode;\n    size?: number;\n    color?: string;\n  }>;\n  count?: number;\n  className?: string;\n}\n\ntype FloatingItem = {\n  id: number;\n  x: number;\n  y: number;\n  size: number;\n  duration: number;\n  delay: number;\n  color: string;\n  icon?: React.ReactNode;\n  dispersed: boolean;\n  respawnKey: number; // for AnimatePresence\n};\n\nexport const FloatingElements: React.FC<FloatingElementsProps> = ({\n  elements = [],\n  count = 10,\n  className\n}) => {\n  const [items, setItems] = useState<FloatingItem[]>([]);\n\n  // Helper to generate a random item\n  const generateItem = (id: number): FloatingItem => {\n    const elementIndex = elements.length > 0 ? Math.floor(Math.random() * elements.length) : -1;\n    const element = elementIndex >= 0 ? elements[elementIndex] : null;\n    return {\n      id,\n      x: Math.random() * 100,\n      y: Math.random() * 100,\n      size: element?.size || Math.random() * 20 + 10,\n      duration: Math.random() * 15 + 30,\n      delay: Math.random() * 5,\n      color: element?.color || \n        `hsla(${Math.random() * 360}, ${70 + Math.random() * 30}%, ${70 + Math.random() * 30}%, ${0.1 + Math.random() * 0.5})`,\n      icon: element?.icon,\n      dispersed: false,\n      respawnKey: 0,\n    };\n  };\n\n  // Generate random floating elements\n  useEffect(() => {\n    setItems(Array.from({ length: count }, (_, i) => generateItem(i)));\n    // eslint-disable-next-line\n  }, [count, elements]);\n\n  // Default icons if none provided\n  const defaultIcons = ['♪', '♫', '🎵', '🎶', '🎹', '🎸', '🎺', '🎷', '🎤'];\n\n  // Disperse handler with improved behavior\n  const disperse = (id: number) => {\n    setItems(prev => prev.map(item =>\n      item.id === id ? { ...item, dispersed: true } : item\n    ));\n    // Respawn after animation with longer duration for smoother effect\n    setTimeout(() => {\n      setItems(prev => prev.map(item =>\n        item.id === id\n          ? { ...generateItem(id), respawnKey: item.respawnKey + 1 }\n          : item\n      ));\n    }, 2600); // Increased to 2600ms to match the new 2.5s animation duration\n  };\n\n  // Add subtle floating animation to make elements appear more \"alive\" but slower\n  const floatingAnimation = {\n    y: [0, 10], // Simplified to only 2 keyframes as required by spring animations\n    transition: {\n      duration: 3,\n      repeat: Infinity,\n      repeatType: \"reverse\" as const,\n      ease: \"easeInOut\"\n    }\n  };\n\n  return (\n    <div className={cn(\"absolute inset-0 overflow-hidden pointer-events-auto\", className)}>\n      <AnimatePresence>\n        {items.map((item) => (\n          <motion.div\n            key={item.id + '-' + item.respawnKey}\n            className=\"absolute transform-gpu cursor-pointer pointer-events-auto\"\n            style={{\n              left: `${item.x}%`,\n              top: `${item.y}%`,\n              fontSize: `${item.size}px`,\n              color: item.color,\n              animationDuration: `${item.duration}s`,\n              animationDelay: `${item.delay}s`,\n              opacity: 0.7,\n              zIndex: 2,\n              userSelect: 'none',\n            }}\n            initial={{ scale: 1, opacity: 0.7, x: 0, y: 0 }}\n            animate={item.dispersed ? {\n              scale: 1.5,\n              opacity: 0,\n              x: (Math.random() - 0.5) * 200,\n              y: (Math.random() - 0.5) * 200,\n              transition: { \n                duration: 2.5,\n                ease: 'easeOut'\n              }\n            } : {\n              ...floatingAnimation,\n              scale: 1,\n              opacity: 0.7,\n              transition: { \n                type: 'spring', \n                stiffness: 50,\n                damping: 20 \n              }\n            }}\n            exit={{ opacity: 0, scale: 0.5, transition: { duration: 0.5 } }}\n            whileHover={{ \n              scale: 1.2,\n              opacity: 1,\n              transition: { duration: 0.3 } \n            }}\n            onClick={() => disperse(item.id)}\n            onMouseEnter={() => disperse(item.id)}\n          >\n            {item.icon || defaultIcons[Math.floor(Math.random() * defaultIcons.length)]}\n          </motion.div>\n        ))}\n      </AnimatePresence>\n    </div>\n  );\n}; ","import React, { useState, useEffect, useRef } from 'react';\nimport { cn } from '../../lib/utils';\n\ninterface TypingEffectProps {\n  text: string | string[];\n  speed?: number;\n  delay?: number;\n  cursor?: boolean;\n  loop?: boolean;\n  className?: string;\n  onComplete?: () => void;\n}\n\nexport const TypingEffect: React.FC<TypingEffectProps> = ({\n  text,\n  speed = 50,\n  delay = 1000,\n  cursor = true,\n  loop = false,\n  className,\n  onComplete\n}) => {\n  const [displayText, setDisplayText] = useState('');\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isTyping, setIsTyping] = useState(true);\n  const [currentTextIndex, setCurrentTextIndex] = useState(0);\n  const currentText = Array.isArray(text) ? text[currentTextIndex] : text;\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n\n    if (isTyping) {\n      // Add characters one by one\n      if (currentIndex < currentText.length) {\n        timeoutRef.current = setTimeout(() => {\n          setDisplayText(prev => prev + currentText[currentIndex]);\n          setCurrentIndex(prev => prev + 1);\n        }, speed);\n      } else {\n        // Reached end of current text\n        setIsTyping(false);\n        \n        if (Array.isArray(text) && loop) {\n          // Wait before starting to delete\n          timeoutRef.current = setTimeout(() => {\n            setIsTyping(false);\n          }, delay);\n        } else if (!Array.isArray(text) && onComplete) {\n          // Call onComplete if not an array\n          onComplete();\n        }\n      }\n    } else {\n      // Delete phase (only for array of texts)\n      if (Array.isArray(text)) {\n        if (displayText.length > 0) {\n          // Delete characters one by one\n          timeoutRef.current = setTimeout(() => {\n            setDisplayText(prev => prev.slice(0, -1));\n          }, speed / 2);\n        } else {\n          // Move to next text after deleting\n          const nextTextIndex = (currentTextIndex + 1) % text.length;\n          setCurrentTextIndex(nextTextIndex);\n          setCurrentIndex(0);\n          setIsTyping(true);\n          \n          // Check if we completed a full cycle\n          if (nextTextIndex === 0 && !loop && onComplete) {\n            onComplete();\n          }\n        }\n      }\n    }\n\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, [currentIndex, currentText, currentTextIndex, delay, displayText, isTyping, loop, onComplete, speed, text]);\n\n  return (\n    <span className={cn(\"inline-block\", className)}>\n      {displayText}\n      {cursor && (\n        <span className=\"inline-block w-[2px] h-[1.2em] bg-current ml-1 align-middle animate-blink\" />\n      )}\n    </span>\n  );\n};\n\n// Add required animation to tailwind config\n// Add to tailwind.config.js extend.animation:\n// blink: 'blink 1s step-end infinite'\n// Add to tailwind.config.js extend.keyframes:\n// blink: {\n//   '0%, 100%': { opacity: 1 },\n//   '50%': { opacity: 0 }\n// } ","// src/components/ui/GlowButton.tsx\nimport React, { ButtonHTMLAttributes, forwardRef } from 'react';\nimport { cn } from '../../lib/utils';\n\n/**\n * Enhanced GlowButton with gradient support and accessibility\n */\ninterface GlowButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: 'primary' | 'secondary' | 'soundswapp' | 'outline' | 'glass' | 'minimal';\n  size?: 'sm' | 'md' | 'lg';\n  fullWidth?: boolean;\n  isLoading?: boolean;\n  leftIcon?: React.ReactNode;\n  rightIcon?: React.ReactNode;\n  children: React.ReactNode;\n}\n\nconst variants = {\n  primary: \"bg-button-primary-bg text-button-primary-text hover:bg-button-primary-hover shadow-glow\",\n  secondary: \"bg-button-secondary-bg text-button-secondary-text hover:bg-button-secondary-hover shadow-glow\",\n  soundswapp: \"soundswapp-button shadow-glow\",\n  outline: \"bg-transparent text-content-primary border border-border-default hover:border-border-hover hover:bg-surface-elevated\",\n  glass: \"bg-surface-card/50 backdrop-blur-sm border border-border-default text-content-primary hover:bg-surface-card/70\",\n  minimal: \"bg-transparent text-content-secondary hover:text-content-primary hover:bg-surface-card/30\",\n};\n\nconst sizes = {\n  sm: \"py-1 px-3 text-sm\",\n  md: \"py-2 px-4\",\n  lg: \"py-3 px-6 text-lg\",\n};\n\nconst GlowButton = forwardRef<HTMLButtonElement, GlowButtonProps>(\n  ({\n    children,\n    className = '',\n    disabled = false,\n    variant = 'soundswapp',\n    size = 'md',\n    fullWidth = false,\n    isLoading = false,\n    leftIcon,\n    rightIcon,\n    ...props\n  }, ref) => {\n    return (\n      <button\n        ref={ref}\n        className={cn(\n          // Base styles\n          \"relative inline-flex items-center justify-center font-medium rounded-lg select-none\",\n          \"transition-all duration-200 ease-in-out focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-primary/50\",\n          \"active:scale-[0.98]\",\n          \n          // Variant styles\n          variants[variant],\n          \n          // Size styles\n          sizes[size],\n          \n          // Width styles\n          fullWidth ? \"w-full\" : \"\",\n          \n          // Disabled styles\n          disabled && \"opacity-60 pointer-events-none cursor-not-allowed\",\n          \n          // Custom styles\n          className\n        )}\n        disabled={disabled || isLoading}\n        {...props}\n      >\n        {/* Loading spinner */}\n        {isLoading && (\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <svg className=\"animate-spin h-5 w-5 text-current\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n              <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n              <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n            </svg>\n          </div>\n        )}\n        \n        {/* Content */}\n        <span className={cn(\"flex items-center justify-center gap-2\", isLoading && \"opacity-0\")}>\n          {leftIcon && <span className=\"inline-flex\">{leftIcon}</span>}\n          {children}\n          {rightIcon && <span className=\"inline-flex\">{rightIcon}</span>}\n        </span>\n      </button>\n    );\n  }\n);\n\nGlowButton.displayName = 'GlowButton';\n\nexport { GlowButton };","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { useRef } from 'react';\nimport { motion } from 'framer-motion';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faSpotify, faYoutube } from '@fortawesome/free-brands-svg-icons';\nimport { faArrowDown, faShuffle, faCompactDisc, faMusic, faHeadphones, faMicrophone, faWandMagicSparkles } from '@fortawesome/free-solid-svg-icons';\nimport { useTheme } from '../lib/ThemeContext';\nimport { cn } from '../lib/utils';\nimport { ParticleField } from './ui/ParticleField';\nimport { MorphingBlob } from './ui/MorphingBlob';\nimport { FloatingElements } from './ui/FloatingElements';\nimport { TypingEffect } from './ui/TypingEffect';\nimport { EnhancedGradientText } from './ui/EnhancedGradientText';\nimport { GlowButton } from './ui/GlowButton';\n\n// Define motion variants for coordinated animations\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: {\n      staggerChildren: 0.1,\n      delayChildren: 0.3\n    }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 20 },\n  visible: {\n    opacity: 1,\n    y: 0,\n    transition: { \n      type: \"spring\" as const,\n      stiffness: 100,\n      damping: 10\n    }\n  }\n};\n\nexport const EnhancedHeroSection = () => {\n  const { isDark, toggleTheme } = useTheme();\n  const heroRef = useRef<HTMLDivElement>(null);\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  \n  // Music platform icons with physics\n  const platformIcons = [\n    { icon: faSpotify, color: 'text-spotify', x: -20, y: -40, scale: 2.5, delay: 0, rotation: -5 },\n    { icon: 'youtube-logo', color: 'text-youtube', x: 30, y: 60, scale: 2.2, delay: 0.2, rotation: 5 },\n    { icon: faCompactDisc, color: 'text-brand-primary', x: 50, y: -50, scale: 1.8, delay: 0.6, rotation: 8 },\n    { icon: faMicrophone, color: 'text-brand-accent-pink', x: 70, y: 10, scale: 1.2, delay: 0.8, rotation: -8 },\n    { icon: faHeadphones, color: 'text-brand-secondary', x: -40, y: 70, scale: 1.3, delay: 1, rotation: 12 },\n    { icon: faMusic, color: 'text-brand-accent-pink', x: -80, y: -20, scale: 1, delay: 1.2, rotation: -15 },\n  ];\n\n  // Define SoundSwapp brand colors for particles and blobs\n  const particleColor = isDark ? \"var(--brand-accent-pink)\" : \"var(--brand-primary)\";\n  const morphingBlobColor1 = isDark ? \"rgba(255, 122, 89, 0.15)\" : \"rgba(255, 122, 89, 0.1)\"; // Coral\n  const morphingBlobColor2 = isDark ? \"rgba(255, 0, 122, 0.12)\" : \"rgba(255, 0, 122, 0.08)\"; // Pink\n  \n  const floatingElementColors = [\n    { color: isDark ? 'rgba(255, 122, 89, 0.3)' : 'rgba(255, 122, 89, 0.25)', size: 24 }, // Coral\n    { color: isDark ? 'rgba(255, 0, 122, 0.25)' : 'rgba(255, 0, 122, 0.2)', size: 20 }, // Pink\n    { color: isDark ? 'rgba(0, 196, 204, 0.25)' : 'rgba(0, 196, 204, 0.2)', size: 22 } // Teal\n  ];\n\n  return (\n    <div \n      ref={scrollContainerRef}\n      className=\"relative min-h-screen overflow-auto perspective-1000\"\n    >\n      {/* Navigation Header with SoundSwapp branding */}\n      <header className=\"absolute top-0 left-0 w-full z-50 bg-surface-glass/80 backdrop-blur-md border-b border-border-default/30\">\n        <div className=\"container mx-auto px-4 py-3 flex items-center justify-between\">\n          <motion.div \n            className=\"flex items-center\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ duration: 0.6 }}\n          >\n            <div className=\"mr-3 flex items-center gap-2\">\n              <svg width=\"36\" height=\"36\" viewBox=\"0 0 36 36\" className=\"text-brand-primary soundswapp-logo-hero\">\n                <defs>\n                  <linearGradient id=\"soundswapp-hero-grad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                    <stop offset=\"0%\" stopColor=\"var(--brand-primary)\" />\n                    <stop offset=\"35%\" stopColor=\"var(--brand-accent-pink)\" />\n                    <stop offset=\"100%\" stopColor=\"var(--brand-secondary)\" />\n                  </linearGradient>\n                  <filter id=\"hero-glow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n                    <feGaussianBlur stdDeviation=\"1.5\" result=\"blur\" />\n                    <feOffset dy=\"1\" result=\"offsetBlur\" />\n                    <feMerge>\n                      <feMergeNode in=\"offsetBlur\" />\n                      <feMergeNode in=\"SourceGraphic\" />\n                    </feMerge>\n                  </filter>\n                  <pattern id=\"hero-bg-pattern\" patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\">\n                     <path d=\"M-1,1 l2,-2 M0,10 l10,-10 M9,11 l2,-2\" stroke=\"rgba(255,255,255,0.03)\" strokeWidth=\"0.5\"/>\n                  </pattern>\n                </defs>\n                <motion.circle \n                  cx=\"18\" \n                  cy=\"18\" \n                  r=\"18\" \n                  fill=\"url(#soundswapp-hero-grad)\" \n                  initial={{opacity: 0.7}} \n                  animate={{opacity: 0.9}} \n                  transition={{\n                    duration: 1,\n                    repeat: Infinity,\n                    repeatType: \"reverse\"\n                  }} \n                />\n                <motion.circle \n                  cx=\"18\" \n                  cy=\"18\" \n                  r=\"18\" \n                  fill=\"url(#hero-bg-pattern)\" \n                  initial={{opacity: 0.3}} \n                  animate={{opacity: 0.5}} \n                  transition={{\n                    duration: 1,\n                    repeat: Infinity,\n                    repeatType: \"reverse\"\n                  }} \n                />\n                \n                <g filter=\"url(#hero-glow)\" transform=\"translate(0.5, 0.5)\">\n                  <motion.path \n                    className=\"ss-letter-main-hero\" \n                    d=\"M12.5 23.5 C10 23.5 8.5 21.5 9 19 C9.5 16.5 12.5 15.5 15 15.5 C17.5 15.5 19.5 14 19 11.5 C18.5 9 16.5 7.5 14 7.5\" \n                    stroke=\"white\" fill=\"none\" strokeWidth=\"2.2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"\n                    initial={{ pathLength: 0, opacity: 0 }}\n                    animate={{ pathLength: 1, opacity: 1 }}\n                    transition={{ duration: 1.2, ease: \"easeInOut\", delay: 0.2 }}\n                  />\n                  <motion.path \n                    className=\"ss-letter-highlight-hero\" \n                    d=\"M12.8 23 C10.5 23 9.3 21.3 9.7 19.2 C10.1 17.1 12.8 16.1 15 16.1 C17.2 16.1 18.8 14.7 18.4 12.5 C18.0 10.3 16.2 8.5 14 8.5\"\n                    stroke=\"rgba(255,255,255,0.5)\" fill=\"none\" strokeWidth=\"0.8\" strokeLinecap=\"round\" strokeLinejoin=\"round\"\n                    initial={{ pathLength: 0, opacity: 0 }}\n                    animate={{ pathLength: 1, opacity: 0.7 }}\n                    transition={{ duration: 1.2, ease: \"easeInOut\", delay: 0.4 }}\n                  />\n                  <motion.path \n                    className=\"ss-letter-main-hero\" \n                    d=\"M23.5 23.5 C26 23.5 27.5 21.5 27 19 C26.5 16.5 23.5 15.5 21 15.5 C18.5 15.5 16.5 14 17 11.5 C17.5 9 19.5 7.5 22 7.5\"\n                    stroke=\"white\" fill=\"none\" strokeWidth=\"2.2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"\n                    initial={{ pathLength: 0, opacity: 0 }}\n                    animate={{ pathLength: 1, opacity: 1 }}\n                    transition={{ duration: 1.2, ease: \"easeInOut\", delay: 0.35 }}\n                  />\n                  <motion.path \n                    className=\"ss-letter-highlight-hero\" \n                    d=\"M23.2 23 C25.5 23 26.7 21.3 26.3 19.2 C25.9 17.1 23.2 16.1 21 16.1 C18.8 16.1 17.2 14.7 17.6 12.5 C18.0 10.3 19.8 8.5 22 8.5\"\n                    stroke=\"rgba(255,255,255,0.5)\" fill=\"none\" strokeWidth=\"0.8\" strokeLinecap=\"round\" strokeLinejoin=\"round\"\n                    initial={{ pathLength: 0, opacity: 0 }}\n                    animate={{ pathLength: 1, opacity: 0.7 }}\n                    transition={{ duration: 1.2, ease: \"easeInOut\", delay: 0.55 }}\n                  />\n                </g>\n              </svg>\n              {/* Show official YouTube logo for dark backgrounds */}\n            </div>\n            <h1 className=\"text-2xl font-bold\">\n              <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-brand-primary via-brand-accent-pink to-brand-secondary\">\n                SoundSwapp\n              </span>\n            </h1>\n          </motion.div>\n\n          <div className=\"flex items-center gap-4\">\n            <motion.button \n              onClick={toggleTheme}\n              className={cn(\n                \"p-2 rounded-full backdrop-blur-md\",\n                \"bg-surface-alt hover:bg-surface-highlight text-content-primary\"\n              )}\n              whileHover={{ scale: 1.1 }}\n              whileTap={{ scale: 0.95 }}\n              transition={{ type: \"spring\", stiffness: 500, damping: 15 }}\n            >\n              <motion.div \n                initial={{ rotate: 0 }}\n                animate={{ rotate: isDark ? 180 : 0 }}\n                transition={{ type: \"spring\", stiffness: 200, damping: 10 }}\n                className=\"text-xl text-content-primary\"\n              >\n                {isDark ? '☀️' : '🌙'}\n              </motion.div>\n            </motion.button>\n          </div>\n        </div>\n      </header>\n\n      <div \n        ref={heroRef}\n        className={cn(\n          \"relative min-h-screen overflow-hidden flex flex-col items-center justify-center perspective-1000\",\n          \"bg-background\"\n        )}\n      >\n        {/* Particle background */}\n        <ParticleField \n          color={particleColor} \n          density=\"high\"\n          className=\"absolute inset-0\"\n        />\n        {/* Animated morphing shapes */}\n        <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n          <MorphingBlob \n            color={morphingBlobColor1} \n            position={{ top: '10%', left: '5%' }}\n            size={400}\n          />\n          <MorphingBlob \n            color={morphingBlobColor2} \n            position={{ bottom: '10%', right: '5%' }}\n            size={350}\n            animationDuration={25}\n          />\n          {/* Floating music notes and icons */}\n          <FloatingElements \n            count={15} \n            elements={floatingElementColors}\n          />\n        </div>\n        \n        {/* Floating platform icons with physics */}\n        <div ref={containerRef} className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n          {platformIcons.map((item, index) => (\n            <motion.div\n              key={index}\n              className={cn(\"absolute text-opacity-20\", item.color)}\n              initial={{ scale: 0, opacity: 0, rotate: item.rotation }}\n              animate={{ \n                scale: item.scale,\n                opacity: 0.15,\n                x: item.x,\n                y: item.y,\n                rotate: item.rotation\n              }}\n              transition={{\n                type: \"spring\",\n                stiffness: 60,\n                damping: 15,\n                delay: item.delay,\n              }}\n              style={{\n                left: `calc(50% + ${item.x * 5}px)`,\n                top: `calc(50% + ${item.y * 5}px)`,\n                transformStyle: \"preserve-3d\",\n                backfaceVisibility: \"hidden\",\n              }}\n              whileHover={{\n                scale: item.scale * 1.2,\n                opacity: 0.25,\n                transition: { duration: 0.3 }\n              }}\n            >\n              {typeof item.icon === 'string' ? (\n                <img\n                  src=\"/images/YouTube connection card logo.png\"\n                  alt=\"YouTube\"\n                  style={{ height: 40, width: 'auto', objectFit: 'contain', display: 'block' }}\n                />\n              ) : (\n                <FontAwesomeIcon icon={item.icon} className=\"text-4xl\" />\n              )}\n            </motion.div>\n          ))}\n        </div>\n        \n        {/* Main content with coordinated animations */}\n        <motion.div \n          className=\"relative z-10 flex flex-col items-center justify-center min-h-[60vh] pt-32 pb-16 px-4 text-center\"\n          initial=\"hidden\"\n          animate=\"visible\"\n          variants={containerVariants}\n        >\n          {/* Main Headline */}\n          <motion.h1\n            className=\"mb-4 drop-shadow-lg\"\n            variants={itemVariants}\n          >\n            <div className=\"text-5xl md:text-7xl font-bold leading-tight mb-4\">\n              <span \n                style={{ \n                  background: 'var(--soundswapp-gradient)',\n                  WebkitBackgroundClip: 'text',\n                  backgroundClip: 'text',\n                  color: 'transparent',\n                  display: 'inline-block',\n                  fontWeight: 800,\n                  textShadow: '0 0 30px rgba(255,122,89,0.3)'\n                }}\n                className=\"animated-gradient-text\"\n              >\n                SoundSwapp\n              </span>\n            </div>\n          </motion.h1>\n\n          {/* Animated Music Waveform */}\n          <motion.div\n            className=\"mb-6 flex justify-center\"\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.4, duration: 0.8 }}\n          >\n            <svg width=\"120\" height=\"32\" viewBox=\"0 0 120 32\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <g>\n                <motion.rect x=\"0\" y=\"12\" width=\"8\" height=\"8\" rx=\"4\" fill=\"var(--brand-accent-purple)\" animate={{ y: [12, 4, 12] }} transition={{ repeat: Infinity, duration: 1.2, delay: 0 }} />\n                <motion.rect x=\"16\" y=\"8\" width=\"8\" height=\"16\" rx=\"4\" fill=\"var(--brand-secondary)\" animate={{ y: [8, 0, 8] }} transition={{ repeat: Infinity, duration: 1.2, delay: 0.2 }} />\n                <motion.rect x=\"32\" y=\"4\" width=\"8\" height=\"24\" rx=\"4\" fill=\"var(--brand-accent-pink)\" animate={{ y: [4, 12, 4] }} transition={{ repeat: Infinity, duration: 1.2, delay: 0.4 }} />\n                <motion.rect x=\"48\" y=\"8\" width=\"8\" height=\"16\" rx=\"4\" fill=\"var(--brand-primary)\" animate={{ y: [8, 0, 8] }} transition={{ repeat: Infinity, duration: 1.2, delay: 0.6 }} />\n                <motion.rect x=\"64\" y=\"12\" width=\"8\" height=\"8\" rx=\"4\" fill=\"var(--brand-accent-yellow)\" animate={{ y: [12, 4, 12] }} transition={{ repeat: Infinity, duration: 1.2, delay: 0.8 }} />\n              </g>\n            </svg>\n          </motion.div>\n\n          {/* Animated Floating Music Notes */}\n          <div className=\"pointer-events-none select-none\">\n            <motion.span\n              className=\"absolute left-1/4 top-32 text-3xl text-brand-accent-purple opacity-70\"\n              animate={{ y: [0, -20, 0], opacity: [0.7, 1, 0.7] }}\n              transition={{ repeat: Infinity, duration: 3, delay: 0.2 }}\n            >🎵</motion.span>\n            <motion.span\n              className=\"absolute right-1/4 top-40 text-2xl text-brand-secondary opacity-60\"\n              animate={{ y: [0, -15, 0], opacity: [0.6, 1, 0.6] }}\n              transition={{ repeat: Infinity, duration: 2.5, delay: 0.7 }}\n            >🎶</motion.span>\n            <motion.span\n              className=\"absolute left-1/3 top-56 text-2xl text-brand-accent-pink opacity-60\"\n              animate={{ y: [0, -18, 0], opacity: [0.6, 1, 0.6] }}\n              transition={{ repeat: Infinity, duration: 2.8, delay: 1.1 }}\n            >🎼</motion.span>\n          </div>\n\n          {/* Subheadline */}\n          <motion.h2\n            className=\"text-2xl md:text-3xl font-medium mb-6 text-content-primary tracking-tight h-[3em] md:h-[2em]\"\n            variants={itemVariants}\n          >\n            <TypingEffect \n              text=\"Seamlessly sync your music across all platforms.\"\n              speed={50}\n              cursor={true}\n            />\n          </motion.h2>\n          {/* Description */}\n          <motion.p\n            className=\"max-w-2xl mx-auto mb-10 text-lg md:text-xl text-content-secondary\"\n            variants={itemVariants}\n          >\n            Transform playlists between Spotify, YouTube, and more with our intelligent, AI-powered music platform.\n          </motion.p>\n          {/* Hero Buttons */}\n          <motion.div\n            className=\"flex flex-col sm:flex-row gap-4 justify-center mb-12\"\n            variants={itemVariants}\n          >\n            <GlowButton\n              onClick={() => document.getElementById('converter')?.scrollIntoView({ behavior: 'smooth' })}\n              variant=\"soundswapp\"\n              size=\"lg\"\n              aria-label=\"Get Started\"\n            >\n              Get Started\n            </GlowButton>\n          </motion.div>\n        </motion.div>\n      </div>\n    </div>\n  );\n};","import React, { useEffect, useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '../../lib/utils';\nimport { useTheme } from '../../lib/ThemeContext';\n// import { getGlassmorphicStyles, getGlassmorphicHoverStyles } from '../../lib/glassmorphic'; // Assuming this is not used anymore or integrated\n\ninterface GlassmorphicCardProps {\n  children: React.ReactNode;\n  className?: string;\n  blurStrength?: number;\n  borderOpacity?: number; // Potentially deprecated if border is fully CSS var controlled\n  bgOpacity?: number; // Potentially deprecated if bg is fully CSS var controlled\n  hoverScale?: number;\n  gradientOverlay?: boolean;\n  rounded?: 'sm' | 'md' | 'lg' | 'xl' | '2xl' | 'full';\n  variant?: 'default' | 'primary' | 'secondary' | 'vibrant' | 'spotify' | 'youtube';\n  magneticEffect?: boolean;\n  glowIntensity?: 'none' | 'low' | 'medium' | 'high';\n}\n\nexport const GlassmorphicCard: React.FC<GlassmorphicCardProps> = ({\n  children,\n  className,\n  blurStrength = 10,\n  // borderOpacity = 0.2, // Deprecated by CSS vars\n  // bgOpacity = 0.2, // Deprecated by CSS vars\n  hoverScale = 1.02,\n  gradientOverlay = false,\n  rounded = 'xl',\n  variant = 'default',\n  magneticEffect = false,\n  glowIntensity = 'none'\n}) => {\n  const { isDark } = useTheme();\n  const [isMobile, setIsMobile] = useState(false);\n  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });\n  const [isHovered, setIsHovered] = useState(false);\n\n  useEffect(() => {\n    const checkMobile = () => {\n      const mobile = window.innerWidth < 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n      setIsMobile(mobile);\n      \n      if (mobile) {\n        document.documentElement.classList.add('has-glassmorphic-cards-mobile'); // More specific class for mobile cards\n      } else {\n        document.documentElement.classList.remove('has-glassmorphic-cards-mobile');\n      }\n    };\n    \n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n\n  const getGradientByVariant = () => {\n    switch (variant) {\n      case 'primary':\n        return 'linear-gradient(135deg, hsl(var(--brand-primary-light)), hsl(var(--brand-primary)), hsl(var(--brand-primary-dark)))';\n      case 'secondary':\n        return 'linear-gradient(135deg, hsl(var(--brand-secondary-light)), hsl(var(--brand-secondary)), hsl(var(--brand-secondary-dark)))';\n      case 'vibrant':\n        return 'var(--brand-gradient-vibrant)';\n      case 'spotify':\n        return 'linear-gradient(135deg, hsl(var(--brand-accent-green)), hsl(var(--brand-accent-green) / 0.8), hsl(var(--brand-accent-green) / 0.6))'; // Example with HSL\n      case 'youtube':\n        return 'linear-gradient(135deg, hsl(var(--youtube-base-color-hsl)), hsl(var(--youtube-base-color-hsl) / 0.8), hsl(var(--youtube-base-color-hsl) / 0.6))'; // Example with HSL\n      default:\n        return isDark\n          ? 'var(--default-card-gradient-dark)' \n          : 'var(--default-card-gradient-light)';\n    }\n  };\n\n  const getGlowColorForVariant = () => { // Renamed to avoid conflict with a potential CSS var\n    switch (variant) {\n      case 'primary':\n        return 'hsl(var(--button-primary-glow))';\n      case 'secondary':\n        return 'hsl(var(--button-secondary-glow))';\n      case 'vibrant':\n        return 'hsl(var(--brand-accent-yellow))';\n      case 'spotify':\n        return 'var(--spotify-glow-color)';\n      case 'youtube':\n        return 'var(--youtube-glow-color)';\n      default:\n        return isDark ? 'var(--surface-glow-color-dark)' : 'var(--surface-glow-color-light)';\n    }\n  };\n\n  const getShadowByGlowIntensity = () => {\n    if (glowIntensity === 'none') return '';\n    \n    const color = getGlowColorForVariant();\n    \n    // Enhanced glow effects for dark theme\n    if (isDark) {\n      const intensityMap = {\n        high: `0 0 30px ${color}, 0 0 15px ${color}80`,  // Double glow with opacity variation\n        medium: `0 0 20px ${color}, 0 0 10px ${color}60`, // Double glow with opacity variation\n        low: `0 0 12px ${color}80`, // Single subtle glow\n      };\n      return intensityMap[glowIntensity];\n    } else {\n      // Light theme uses more subtle glow\n      const intensityMap = {\n        high: '0 0 25px',\n        medium: '0 0 15px',\n        low: '0 0 8px',\n      };\n      return `${intensityMap[glowIntensity]} ${color}`;\n    }\n  };\n\n  // Mobile styles prioritize performance and use simpler variable-based styling\n  const cardStyles: React.CSSProperties = isMobile ? {\n    backgroundColor: 'hsl(var(--surface-card))',\n    boxShadow: 'var(--shadow-elevation-medium)',\n    padding: '16px',\n    margin: '0',\n    borderRadius: '12px',\n    border: '1px solid hsl(var(--border-default))',\n    overflow: 'hidden', // Ensure content respects border radius\n  } : {\n    // Apply backdrop filter based on theme and variant\n    backdropFilter: variant === 'default' && !isDark ? 'none' : `blur(${blurStrength}px)`,\n    WebkitBackdropFilter: variant === 'default' && !isDark ? 'none' : `blur(${blurStrength}px)`,\n    // For default variant in dark theme, use a transparent background to allow className styling to take effect\n    // For default variant in light theme, use surface-card for opacity\n    // For all other variants, use surface-glass\n    backgroundColor: variant === 'default' \n      ? !isDark \n        ? 'var(--surface-card)' \n        : 'transparent' // Allow bg color from className to show in dark theme\n      : 'var(--surface-glass)',\n    // Similar approach for border\n    border: variant === 'default'\n      ? !isDark\n        ? '1px solid var(--border-default)'\n        : '1px solid var(--surface-glass-border-dark, rgba(255,255,255,0.08))' // Fall back to a more visible border\n      : '1px solid var(--surface-glass-border)',\n    borderRadius: rounded === 'full' ? '9999px' : `var(--radius-${rounded}, 0.75rem)`,\n    boxShadow: getShadowByGlowIntensity() || 'var(--shadow-elevation-low)',\n    overflow: 'hidden',\n    position: 'relative',\n  };\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (!magneticEffect || isMobile) return;\n    const rect = e.currentTarget.getBoundingClientRect();\n    const x = (e.clientX - rect.left - rect.width / 2) / (rect.width / 2);\n    const y = (e.clientY - rect.top - rect.height / 2) / (rect.height / 2);\n    setMousePosition({ x, y });\n  };\n  \n  const roundedClass = `rounded-${rounded}`;\n\n  return (\n    <motion.div\n      className={cn(\n        roundedClass, \n        \"overflow-hidden relative glassmorphic-card\", // glassmorphic-card class for potential global mobile overrides\n        className\n      )}\n      style={cardStyles}\n      whileHover={!isMobile ? {\n        scale: hoverScale,\n        boxShadow: glowIntensity !== 'none' ? getShadowByGlowIntensity() : 'var(--shadow-elevation-medium)',\n        // rotateX: magneticEffect ? -mousePosition.y * 5 : 0, // Simplified, direct transform is better for perf\n        // rotateY: magneticEffect ? mousePosition.x * 5 : 0,\n      } : {}}\n      animate={magneticEffect && isHovered && !isMobile ? {\n        transform: `perspective(1000px) rotateX(${-mousePosition.y * 5}deg) rotateY(${mousePosition.x * 5}deg)`,\n      } : {\n        transform: 'perspective(1000px) rotateX(0deg) rotateY(0deg)',\n      }}\n      transition={{\n        type: \"spring\",\n        stiffness: magneticEffect ? 150 : 300,\n        damping: magneticEffect ? 15 : 20,\n        scale: { duration: 0.2 },\n      }}\n      onMouseMove={handleMouseMove}\n      onHoverStart={() => setIsHovered(true)}\n      onHoverEnd={() => {\n        setIsHovered(false);\n        if (magneticEffect) setMousePosition({ x: 0, y: 0 }); // Reset on hover end\n      }}\n    >\n      {gradientOverlay && !isMobile && (\n        <motion.div \n          className=\"absolute inset-0 opacity-20 pointer-events-none -z-10\" // Ensure it's behind content\n          style={{\n            background: getGradientByVariant(),\n            mixBlendMode: 'overlay'\n          }}\n          animate={{ opacity: isHovered && variant !== 'default' ? 0.35 : 0.15 }} // Adjusted opacities\n          transition={{ duration: 0.3 }}\n        />\n      )}\n      \n      {!isMobile && (variant === 'primary' || variant === 'secondary' || variant === 'vibrant') && (\n        <motion.div \n          className=\"absolute inset-0 pointer-events-none -z-10\" // Ensure it's behind content\n          style={{\n            background: 'linear-gradient(45deg, transparent 40%, var(--surface-shine-color, rgba(255,255,255,0.1)) 50%, transparent 60%)',\n            backgroundSize: '200% 100%',\n          }}\n          animate={{ backgroundPosition: isHovered ? ['0% 0%', '200% 0%'] : '0% 0%'}}\n          transition={{ duration: isHovered ? 0.8 : 0, ease: \"easeOut\" }}\n        />\n      )}\n      \n      <div className={cn(\"relative z-0\", {\n        \"p-4 md:p-6\": true // Default padding, can be overridden by className\n      })}>\n        {children}\n      </div>\n    </motion.div>\n  );\n}; ","import React, { useEffect, useState } from 'react';\nimport Confetti from 'react-confetti';\nimport { useWindowSize } from 'react-use';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTheme } from '../../lib/ThemeContext';\n\ninterface SuccessCelebrationProps {\n  isActive: boolean;\n  message?: string;\n  duration?: number;\n  onComplete?: () => void;\n}\n\nexport const SuccessCelebration: React.FC<SuccessCelebrationProps> = ({\n  isActive,\n  message = \"Successfully converted!\",\n  duration = 4000,\n  onComplete\n}) => {\n  const { width, height } = useWindowSize();\n  const { isDark } = useTheme();\n  const [showConfetti, setShowConfetti] = useState(false);\n  const [showMessage, setShowMessage] = useState(false);\n\n  // Handle celebration sequence\n  useEffect(() => {\n    if (isActive) {\n      // Start confetti immediately\n      setShowConfetti(true);\n      \n      // Show success message after a brief delay\n      const messageTimer = setTimeout(() => {\n        setShowMessage(true);\n      }, 300);\n      \n      // Hide everything after duration\n      const hideTimer = setTimeout(() => {\n        setShowMessage(false);\n        setShowConfetti(false);\n        if (onComplete) onComplete();\n      }, duration);\n      \n      return () => {\n        clearTimeout(messageTimer);\n        clearTimeout(hideTimer);\n      };\n    } else {\n      setShowConfetti(false);\n      setShowMessage(false);\n    }\n  }, [isActive, duration, onComplete]);\n\n  // Colors for confetti - theme-aware\n  const colors = isDark \n    ? ['#8B5CF6', '#EC4899', '#6EE7B7', '#3B82F6', '#F87171'] \n    : ['#8B5CF6', '#EC4899', '#10B981', '#3B82F6', '#F87171'];\n\n  return (\n    <AnimatePresence>\n      {showConfetti && (\n        <>\n          <Confetti\n            width={width}\n            height={height}\n            recycle={false}\n            numberOfPieces={200}\n            gravity={0.15}\n            colors={colors}\n            tweenDuration={5000}\n          />\n          \n          {showMessage && (\n            <motion.div\n              initial={{ opacity: 0, scale: 0.8, y: -20 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.8, y: -20 }}\n              className=\"fixed top-1/4 left-1/2 transform -translate-x-1/2 z-50\"\n            >\n              <div \n                className={`px-8 py-4 rounded-xl shadow-xl ${\n                  isDark ? 'bg-gray-800 text-white' : 'bg-white text-gray-800'\n                }`}\n              >\n                <motion.div \n                  initial={{ scale: 0.8 }}\n                  animate={{ \n                    scale: [0.8, 1.2, 1],\n                    rotate: [-5, 5, 0] \n                  }}\n                  transition={{ duration: 0.6 }}\n                  className=\"text-center\"\n                >\n                  <div className=\"text-4xl mb-2\">🎉</div>\n                  <h3 className=\"text-xl font-bold mb-1\">{message}</h3>\n                  <p className={isDark ? 'text-gray-300' : 'text-gray-600'}>\n                    Your playlist is ready to use!\n                  </p>\n                </motion.div>\n              </div>\n            </motion.div>\n          )}\n        </>\n      )}\n    </AnimatePresence>\n  );\n}; ","import React, { forwardRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTheme } from '../../lib/ThemeContext';\nimport { cn } from '../../lib/utils';\nimport { CheckCircle, AlertTriangle, Info, XCircle } from 'lucide-react';\n\n// Define toast types and their properties\nexport type ToastType = 'success' | 'error' | 'warning' | 'info';\n\nexport interface Toast {\n  id: number;\n  message: string;\n  type: ToastType;\n  title?: string;\n  duration?: number;\n  actionLabel?: string;\n  onAction?: () => void;\n}\n\ninterface ToastProps {\n  toast: Toast;\n  onDismiss: (id: number) => void;\n}\n\n// Visual settings for different toast types\nconst toastSettings = {\n  success: {\n    icon: CheckCircle,\n    lightStyles: {\n      bg: 'bg-green-50',\n      border: 'border-l-4 border-green-500',\n      iconColor: 'text-green-500',\n      title: 'text-green-800',\n      message: 'text-green-700',\n    },\n    darkStyles: {\n      bg: 'bg-green-900/30',\n      border: 'border-l-4 border-green-500',\n      iconColor: 'text-green-400',\n      title: 'text-green-300',\n      message: 'text-green-400',\n    }\n  },\n  error: {\n    icon: XCircle,\n    lightStyles: {\n      bg: 'bg-red-50',\n      border: 'border-l-4 border-red-500',\n      iconColor: 'text-red-500',\n      title: 'text-red-800',\n      message: 'text-red-700',\n    },\n    darkStyles: {\n      bg: 'bg-red-900/30',\n      border: 'border-l-4 border-red-500',\n      iconColor: 'text-red-400',\n      title: 'text-red-300',\n      message: 'text-red-400',\n    }\n  },\n  warning: {\n    icon: AlertTriangle,\n    lightStyles: {\n      bg: 'bg-yellow-50',\n      border: 'border-l-4 border-yellow-500',\n      iconColor: 'text-yellow-500',\n      title: 'text-yellow-800',\n      message: 'text-yellow-700',\n    },\n    darkStyles: {\n      bg: 'bg-yellow-900/30',\n      border: 'border-l-4 border-yellow-500',\n      iconColor: 'text-yellow-400',\n      title: 'text-yellow-300',\n      message: 'text-yellow-400',\n    }\n  },\n  info: {\n    icon: Info,\n    lightStyles: {\n      bg: 'bg-blue-50',\n      border: 'border-l-4 border-blue-500',\n      iconColor: 'text-blue-500',\n      title: 'text-blue-800',\n      message: 'text-blue-700',\n    },\n    darkStyles: {\n      bg: 'bg-blue-900/30',\n      border: 'border-l-4 border-blue-500',\n      iconColor: 'text-blue-400',\n      title: 'text-blue-300',\n      message: 'text-blue-400',\n    }\n  }\n};\n\n// Use forwardRef to properly handle refs passed by Framer Motion\nexport const ToastItem = forwardRef<HTMLDivElement, ToastProps>(\n  ({ toast, onDismiss }, ref) => {\n    const { isDark } = useTheme();\n    const { type, message, title, id, actionLabel, onAction, duration = 5000 } = toast;\n    const settings = toastSettings[type];\n    const styles = isDark ? settings.darkStyles : settings.lightStyles;\n    const [paused, setPaused] = React.useState(false);\n    const [progress, setProgress] = React.useState(100);\n    const progressRef = React.useRef<number>(100);\n    const intervalRef = React.useRef<NodeJS.Timeout | null>(null);\n    const startTimeRef = React.useRef<number>(Date.now());\n    const remainingRef = React.useRef<number>(duration);\n    const [touchStartX, setTouchStartX] = React.useState<number | null>(null);\n    const [touchDeltaX, setTouchDeltaX] = React.useState(0);\n\n    // Progress bar logic (pause/resume)\n    React.useEffect(() => {\n      if (paused) {\n        if (intervalRef.current) clearInterval(intervalRef.current);\n        remainingRef.current = remainingRef.current - (Date.now() - startTimeRef.current);\n        return;\n      }\n      startTimeRef.current = Date.now();\n      intervalRef.current = setInterval(() => {\n        const elapsed = Date.now() - startTimeRef.current;\n        const percent = Math.max(0, 100 - (100 * (duration - remainingRef.current + elapsed) / duration));\n        setProgress(percent);\n        progressRef.current = percent;\n        if (percent <= 0) {\n          onDismiss(id);\n        }\n      }, 50);\n      return () => { if (intervalRef.current) clearInterval(intervalRef.current); };\n    }, [paused, duration, id, onDismiss]);\n\n    // Touch swipe to dismiss (mobile)\n    const handleTouchStart = (e: React.TouchEvent) => {\n      setTouchStartX(e.touches[0].clientX);\n    };\n    const handleTouchMove = (e: React.TouchEvent) => {\n      if (touchStartX !== null) {\n        setTouchDeltaX(e.touches[0].clientX - touchStartX);\n      }\n    };\n    const handleTouchEnd = () => {\n      if (Math.abs(touchDeltaX) > 80) {\n        onDismiss(id);\n      }\n      setTouchStartX(null);\n      setTouchDeltaX(0);\n    };\n    \n    return (\n      <motion.div\n        ref={ref}\n        layout\n        initial={{ opacity: 0, y: 40, scale: 0.95 }}\n        animate={{ opacity: 1, y: 0, scale: 1 }}\n        exit={{ opacity: 0, y: 40, scale: 0.95, transition: { duration: 0.2 } }}\n        className={cn(\n          'p-4 rounded-lg shadow-lg max-w-md w-full backdrop-blur-sm relative',\n          styles.bg,\n          styles.border,\n          'select-none',\n          'transition-all duration-200',\n          'focus-within:ring-2 focus-within:ring-purple-400',\n          'outline-none',\n          'z-[1000]',\n          'mobile:py-6 mobile:px-5'\n        )}\n        role=\"alert\"\n        aria-live=\"assertive\"\n        tabIndex={0}\n        onMouseEnter={() => setPaused(true)}\n        onMouseLeave={() => setPaused(false)}\n        onFocus={() => setPaused(true)}\n        onBlur={() => setPaused(false)}\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n        style={{ transform: `translateX(${touchDeltaX}px)` }}\n      >\n        <div className=\"flex items-start gap-3\">\n          <div className={cn(\"flex-shrink-0 w-6 h-6 mt-0.5 text-xl\", styles.iconColor)}>\n            <CheckCircle className=\"h-5 w-5 bg-gradient-to-r from-green-400 to-red-500 text-transparent bg-clip-text\" />\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            {title && (\n              <h3 className={cn(\"text-sm font-medium mb-1\", styles.title)}>\n                {title}\n              </h3>\n            )}\n            <p className={cn(\"text-sm break-words\", styles.message)}>{message}</p>\n            {actionLabel && onAction && (\n              <button\n                onClick={() => {\n                  onAction();\n                  onDismiss(id);\n                }}\n                className={cn(\n                  \"mt-2 text-xs font-medium rounded focus:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 px-2 py-1\",\n                  type === 'success' ? 'text-green-600 dark:text-green-400' :\n                  type === 'error' ? 'text-red-600 dark:text-red-400' :\n                  type === 'warning' ? 'text-yellow-600 dark:text-yellow-400' :\n                  'text-blue-600 dark:text-blue-400'\n                )}\n                tabIndex={0}\n              >\n                {actionLabel}\n              </button>\n            )}\n          </div>\n          <button\n            onClick={() => onDismiss(id)}\n            className=\"ml-4 flex-shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded focus:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 p-2\"\n            aria-label=\"Close notification\"\n            tabIndex={0}\n          >\n            <XCircle className=\"h-4 w-4\" />\n          </button>\n        </div>\n        {/* Progress bar for auto-dismiss */}\n        <motion.div\n          className={cn(\n            \"h-0.5 absolute bottom-0 left-0 right-0\",\n            type === 'success' ? 'bg-green-500' :\n            type === 'error' ? 'bg-red-500' :\n            type === 'warning' ? 'bg-yellow-500' :\n            'bg-blue-500'\n          )}\n          initial={{ width: \"100%\" }}\n          animate={{ width: paused ? `${progress}%` : 0 }}\n          transition={{ \n            duration: paused ? 0 : (progress / 100) * (duration / 1000),\n            ease: \"linear\"\n          }}\n        />\n      </motion.div>\n    );\n  }\n);\n\n// Set display name for easier debugging\nToastItem.displayName = 'ToastItem';\n\n// Toast container\ninterface ToastContainerProps {\n  toasts: Toast[];\n  onDismiss: (id: number) => void;\n  position?: 'top-right' | 'top-left' | 'bottom-right' | 'bottom-left' | 'top-center' | 'bottom-center';\n}\n\nexport const ToastContainer: React.FC<ToastContainerProps> = ({ \n  toasts, \n  onDismiss,\n  position = 'bottom-right'\n}) => {\n  // Define position classes\n  const positionClasses = {\n    'top-right': 'top-4 right-4',\n    'top-left': 'top-4 left-4',\n    'bottom-right': 'bottom-4 right-4',\n    'bottom-left': 'bottom-4 left-4',\n    'top-center': 'top-4 left-1/2 -translate-x-1/2',\n    'bottom-center': 'bottom-4 left-1/2 -translate-x-1/2',\n  };\n  return (\n    <div className={`fixed z-[1000] flex flex-col gap-2 max-w-full w-full pointer-events-none ${positionClasses[position]}`} style={{ maxWidth: '100vw' }} aria-live=\"polite\" aria-atomic=\"true\">\n      <AnimatePresence mode=\"popLayout\">\n        {toasts.map(toast => (\n          <ToastItem \n            key={toast.id} \n            toast={toast} \n            onDismiss={onDismiss} \n          />\n        ))}\n      </AnimatePresence>\n    </div>\n  );\n}; ","import React, { forwardRef } from 'react';\nimport { cn } from '../../lib/utils';\nimport { motion } from 'framer-motion';\n\ninterface GlassmorphicContainerProps {\n  children: React.ReactNode;\n  className?: string;\n  rounded?: 'none' | 'sm' | 'md' | 'lg' | 'xl' | '2xl' | '3xl' | 'full';\n  shadow?: 'none' | 'sm' | 'md' | 'lg' | 'xl' | '2xl';\n  blur?: 'none' | 'sm' | 'md' | 'lg' | 'xl';\n  border?: boolean;\n  intensity?: 'light' | 'medium' | 'heavy';\n  onClick?: () => void;\n  animate?: boolean;\n  hoverEffect?: boolean;\n}\n\nexport const GlassmorphicContainer = forwardRef<HTMLDivElement, GlassmorphicContainerProps>(({\n  children,\n  className,\n  rounded = 'lg',\n  shadow = 'lg',\n  blur = 'md',\n  border = true,\n  intensity = 'medium',\n  onClick,\n  animate = false,\n  hoverEffect = true\n}, ref) => {\n  const roundedClasses = {\n    none: '',\n    sm: 'rounded-sm',\n    md: 'rounded-md',\n    lg: 'rounded-lg',\n    xl: 'rounded-xl',\n    '2xl': 'rounded-2xl',\n    '3xl': 'rounded-3xl',\n    full: 'rounded-full'\n  };\n\n  const shadowClasses = {\n    none: '',\n    sm: 'shadow-sm',\n    md: 'shadow-md',\n    lg: 'shadow-lg',\n    xl: 'shadow-xl',\n    '2xl': 'shadow-2xl'\n  };\n\n  const blurClasses = {\n    none: '',\n    sm: 'backdrop-blur-sm',\n    md: 'backdrop-blur-md',\n    lg: 'backdrop-blur-lg',\n    xl: 'backdrop-blur-xl'\n  };\n\n  const intensityClasses = {\n    light: 'bg-white/30 dark:bg-gray-900/30',\n    medium: 'bg-white/40 dark:bg-gray-900/40',\n    heavy: 'bg-white/50 dark:bg-gray-900/50'\n  };\n\n  const borderClasses = border ? 'border border-white/20 dark:border-gray-700/20' : '';\n\n  const sharedProps = {\n    ref,\n    className: cn(\n      'transition-all duration-300',\n      roundedClasses[rounded],\n      shadowClasses[shadow],\n      blurClasses[blur],\n      intensityClasses[intensity],\n      borderClasses,\n      hoverEffect && 'hover:bg-opacity-[0.45] dark:hover:bg-opacity-[0.45]',\n      'focus:outline-none focus:ring-2 focus:ring-purple-500/50',\n      className\n    ),\n    onClick\n  };\n\n  if (animate) {\n    return (\n      <motion.div\n        {...sharedProps}\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n      >\n        {children}\n      </motion.div>\n    );\n  }\n\n  return <div {...sharedProps}>{children}</div>;\n});\n\nGlassmorphicContainer.displayName = 'GlassmorphicContainer';\n\nexport default GlassmorphicContainer; ","import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { \r\n  Music, \r\n  Clock, \r\n  Flame, \r\n  Users, \r\n  Info,\r\n  Disc,\r\n  Share2,\r\n  Download,\r\n  TrendingUp,\r\n  Calendar,\r\n  Star,\r\n  PlayCircle,\r\n  Headphones,\r\n  Award,\r\n  Eye,\r\n  BarChart3,\r\n  PieChart,\r\n  Activity,\r\n  Sparkles,\r\n  Zap,\r\n  Heart,\r\n  Volume2,\r\n  Shuffle,\r\n  ChevronsUpDown,\r\n  ArrowLeft,\r\n  ChevronRight\r\n} from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { GlassmorphicContainer } from '../ui/GlassmorphicContainer';\r\nimport { PlaylistTypes } from '../../types/playlist';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { cn } from '../../lib/utils';\r\nimport {\r\n  Chart as ChartJS,\r\n  CategoryScale,\r\n  LinearScale,\r\n  BarElement,\r\n  Title,\r\n  Tooltip,\r\n  Legend,\r\n  ArcElement,\r\n  PointElement,\r\n  LineElement,\r\n} from 'chart.js';\r\nimport { Bar, Doughnut, Line, Pie } from 'react-chartjs-2';\r\n\r\n// Register ChartJS components\r\nChartJS.register(\r\n  CategoryScale,\r\n  LinearScale,\r\n  BarElement,\r\n  Title,\r\n  Tooltip,\r\n  Legend,\r\n  ArcElement,\r\n  PointElement,\r\n  LineElement\r\n);\r\n\r\n// Use shared types\r\ntype Genre = PlaylistTypes.Genre;\r\ntype Track = PlaylistTypes.Track;\r\ntype Artist = PlaylistTypes.Artist;\r\ntype PlaylistInsightsProps = PlaylistTypes.PlaylistInsightsProps & { tracks: any[] };\r\n\r\n// Enhanced animations\r\nconst fadeInUp = {\r\n  initial: { opacity: 0, y: 20 },\r\n  animate: { opacity: 1, y: 0 },\r\n  transition: { duration: 0.5 }\r\n};\r\n\r\nconst staggerChildren = {\r\n  animate: {\r\n    transition: {\r\n      staggerChildren: 0.1\r\n    }\r\n  }\r\n};\r\n\r\nconst scaleOnHover = {\r\n  whileHover: { scale: 1.05, y: -2 },\r\n  whileTap: { scale: 0.98 }\r\n};\r\n\r\n// Enhanced metric calculation\r\nconst calculateAdvancedMetrics = (stats: PlaylistInsightsProps['stats']) => {\r\n  const listeningTime = Math.round(stats.totalDuration / 3600000); // Convert ms to hours\r\n  const avgTracksPerArtist = stats.uniqueArtists ? Math.round(stats.totalTracks / stats.uniqueArtists) : 0;\r\n  // Diversity score: never exceed 100%, always safe for edge cases\r\n  const diversityScore = stats.totalTracks > 0\r\n    ? Math.min(100, Math.round((stats.genres.length / stats.totalTracks) * 100))\r\n    : 0;\r\n  const vintageScore = stats.releaseYears ? \r\n    Math.round((Object.entries(stats.releaseYears)\r\n      .filter(([year]) => parseInt(year) < 2000)\r\n      .reduce((sum, [_, count]) => sum + count, 0) / stats.totalTracks) * 100) : 0;\r\n  return {\r\n    listeningTime,\r\n    avgTracksPerArtist,\r\n    diversityScore,\r\n    vintageScore\r\n  };\r\n};\r\n\r\n// Enhanced StatCard component\r\ninterface StatCardProps {\r\n  icon: React.ComponentType<{ size?: number | string }>;\r\n  title: string;\r\n  value: string | number;\r\n  subtitle?: string;\r\n  color?: 'purple' | 'blue' | 'green' | 'red' | 'yellow' | 'indigo';\r\n  trend?: string;\r\n  onClick?: () => void;\r\n  gradient?: boolean;\r\n}\r\n\r\nconst StatCard = ({ \r\n  icon: Icon, \r\n  title, \r\n  value, \r\n  subtitle, \r\n  color = 'purple', \r\n  trend,\r\n  onClick,\r\n  gradient = true\r\n}: StatCardProps) => {\r\n  const colorClasses: Record<string, string> = {\r\n    purple: 'from-purple-500 to-pink-500',\r\n    blue: 'from-blue-500 to-cyan-500',\r\n    green: 'from-green-500 to-teal-500',\r\n    red: 'from-red-500 to-orange-500',\r\n    yellow: 'from-yellow-500 to-orange-500',\r\n    indigo: 'from-indigo-500 to-purple-500'\r\n  };\r\n\r\n  const bgClasses: Record<string, string> = {\r\n    purple: 'bg-purple-500/10 border-purple-500/20',\r\n    blue: 'bg-blue-500/10 border-blue-500/20',\r\n    green: 'bg-green-500/10 border-green-500/20',\r\n    red: 'bg-red-500/10 border-red-500/20',\r\n    yellow: 'bg-yellow-500/10 border-yellow-500/20',\r\n    indigo: 'bg-indigo-500/10 border-indigo-500/20'\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      {...scaleOnHover}\r\n      onClick={onClick}\r\n      className={`relative overflow-hidden rounded-xl border backdrop-blur-sm cursor-pointer\r\n        ${gradient ? 'bg-gradient-to-br from-white/80 to-white/40 dark:from-gray-800/80 dark:to-gray-900/40' : 'bg-white/60 dark:bg-gray-800/60'}\r\n        ${bgClasses[color]} shadow-lg hover:shadow-xl transition-all duration-300`}\r\n    >\r\n      {/* Animated background gradient */}\r\n      <div className={`absolute inset-0 bg-gradient-to-r ${colorClasses[color]} opacity-0 hover:opacity-5 transition-opacity duration-300`} />\r\n      \r\n      {/* Content */}\r\n      <div className=\"relative p-6\">\r\n        <div className=\"flex items-start justify-between\">\r\n          <div className=\"flex-1\">\r\n            <div className=\"flex items-center gap-3 mb-3\">\r\n              <div className={`p-2 rounded-lg bg-gradient-to-r ${colorClasses[color]} text-white shadow-md`}>\r\n                <Icon size={20} />\r\n              </div>\r\n              <div>\r\n                <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">{title}</h3>\r\n                {trend && (\r\n                  <div className=\"flex items-center gap-1 mt-1\">\r\n                    <TrendingUp size={12} className=\"text-green-500\" />\r\n                    <span className=\"text-xs text-green-500 font-medium\">{trend}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"space-y-1\">\r\n              <motion.div\r\n                initial={{ opacity: 0, scale: 0.8 }}\r\n                animate={{ opacity: 1, scale: 1 }}\r\n                transition={{ delay: 0.2 }}\r\n                className=\"text-2xl font-bold text-gray-900 dark:text-white\"\r\n              >\r\n                {value}\r\n              </motion.div>\r\n              {subtitle && (\r\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">{subtitle}</div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\n// Enhanced visualization components\r\ninterface ModernProgressBarProps {\r\n  label: string;\r\n  value: number;\r\n  max: number;\r\n  color?: 'purple' | 'blue' | 'green' | 'red' | 'yellow' | 'indigo';\r\n  showPercentage?: boolean;\r\n}\r\n\r\nconst ModernProgressBar = ({ label, value, max, color = 'purple', showPercentage = true }: ModernProgressBarProps) => {\r\n  const percentage = Math.round((value / max) * 100);\r\n  \r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">{label}</span>\r\n        {showPercentage && (\r\n          <span className=\"text-xs text-gray-500 dark:text-gray-400\">{percentage}%</span>\r\n        )}\r\n      </div>\r\n      <div className=\"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\r\n        <motion.div\r\n          initial={{ width: 0 }}\r\n          animate={{ width: `${percentage}%` }}\r\n          transition={{ duration: 1, ease: \"easeOut\" }}\r\n          className={`h-full rounded-full bg-gradient-to-r ${\r\n            color === 'purple' ? 'from-purple-500 to-pink-500' :\r\n            color === 'blue' ? 'from-blue-500 to-cyan-500' :\r\n            color === 'green' ? 'from-green-500 to-teal-500' :\r\n            color === 'red' ? 'from-red-500 to-orange-500' :\r\n            color === 'yellow' ? 'from-yellow-500 to-orange-500' :\r\n            'from-indigo-500 to-purple-500'\r\n          }`}\r\n        />\r\n        {/* Shimmer effect */}\r\n        <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse\" />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\ninterface CircularProgressProps {\r\n  percentage: number;\r\n  color?: 'purple' | 'blue' | 'green' | 'red' | 'yellow' | 'indigo';\r\n  size?: number;\r\n  strokeWidth?: number;\r\n}\r\n\r\nconst CircularProgress = ({ percentage, color = 'purple', size = 60, strokeWidth = 4 }: CircularProgressProps) => {\r\n  const radius = (size - strokeWidth) / 2;\r\n  const circumference = 2 * Math.PI * radius;\r\n  const strokeDasharray = circumference;\r\n  const strokeDashoffset = circumference - (percentage / 100) * circumference;\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <svg width={size} height={size} className=\"transform -rotate-90\">\r\n        <circle\r\n          cx={size / 2}\r\n          cy={size / 2}\r\n          r={radius}\r\n          fill=\"transparent\"\r\n          stroke=\"currentColor\"\r\n          strokeWidth={strokeWidth}\r\n          className=\"text-gray-200 dark:text-gray-700\"\r\n        />\r\n        <motion.circle\r\n          cx={size / 2}\r\n          cy={size / 2}\r\n          r={radius}\r\n          fill=\"transparent\"\r\n          stroke=\"currentColor\"\r\n          strokeWidth={strokeWidth}\r\n          strokeDasharray={strokeDasharray}\r\n          strokeDashoffset={strokeDashoffset}\r\n          strokeLinecap=\"round\"\r\n          className={`${\r\n            color === 'purple' ? 'text-purple-500' :\r\n            color === 'blue' ? 'text-blue-500' :\r\n            color === 'green' ? 'text-green-500' :\r\n            color === 'red' ? 'text-red-500' :\r\n            color === 'yellow' ? 'text-yellow-500' :\r\n            'text-indigo-500'\r\n          }`}\r\n          initial={{ strokeDashoffset: circumference }}\r\n          animate={{ strokeDashoffset }}\r\n          transition={{ duration: 1.5, ease: \"easeInOut\" }}\r\n        />\r\n      </svg>\r\n      <div className=\"absolute inset-0 flex items-center justify-center\">\r\n        <span className=\"text-sm font-bold text-gray-700 dark:text-gray-300\">{percentage}%</span>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Add SoundSwapp Logo SVG component\r\nconst SoundSwappLogo = ({ className = \"\", size = 36 }: { className?: string, size?: number }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 36 36\" fill=\"currentColor\" className={className}>\r\n    <defs>\r\n      <linearGradient id=\"soundswapp-grad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n        <stop offset=\"0%\" stopColor=\"var(--brand-primary)\" />\r\n        <stop offset=\"35%\" stopColor=\"var(--brand-accent-pink)\" />\r\n        <stop offset=\"100%\" stopColor=\"var(--brand-secondary)\" />\r\n      </linearGradient>\r\n      <filter id=\"glow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\r\n        <feGaussianBlur stdDeviation=\"1.8\" result=\"blur\" />\r\n        <feOffset dy=\"1\" result=\"offsetBlur\" />\r\n        <feMerge>\r\n          <feMergeNode in=\"offsetBlur\" />\r\n          <feMergeNode in=\"SourceGraphic\" />\r\n        </feMerge>\r\n      </filter>\r\n      <pattern id=\"bg-pattern\" patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\">\r\n        <path d=\"M-1,1 l2,-2 M0,10 l10,-10 M9,11 l2,-2\" stroke=\"rgba(255,255,255,0.03)\" strokeWidth=\"0.5\"/>\r\n      </pattern>\r\n    </defs>\r\n    \r\n    <circle cx=\"18\" cy=\"18\" r=\"18\" fill=\"url(#soundswapp-grad)\" opacity=\"0.9\" />\r\n    <circle cx=\"18\" cy=\"18\" r=\"18\" fill=\"url(#bg-pattern)\" opacity=\"0.5\"/>\r\n\r\n    <g filter=\"url(#glow)\" transform=\"translate(0.5, 0.5)\">\r\n      <path className=\"ss-letter-main\" \r\n            d=\"M12.5 23.5 C10 23.5 8.5 21.5 9 19 C9.5 16.5 12.5 15.5 15 15.5 C17.5 15.5 19.5 14 19 11.5 C18.5 9 16.5 7.5 14 7.5\" \r\n            stroke=\"white\" fill=\"none\" strokeWidth=\"2.2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n      <path className=\"ss-letter-highlight\" \r\n            d=\"M12.8 23 C10.5 23 9.3 21.3 9.7 19.2 C10.1 17.1 12.8 16.1 15 16.1 C17.2 16.1 18.8 14.7 18.4 12.5 C18.0 10.3 16.2 8.5 14 8.5\"\r\n            stroke=\"rgba(255,255,255,0.5)\" fill=\"none\" strokeWidth=\"0.8\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n\r\n      <path className=\"ss-letter-main\" \r\n            d=\"M23.5 23.5 C26 23.5 27.5 21.5 27 19 C26.5 16.5 23.5 15.5 21 15.5 C18.5 15.5 16.5 14 17 11.5 C17.5 9 19.5 7.5 22 7.5\"\r\n            stroke=\"white\" fill=\"none\" strokeWidth=\"2.2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n      <path className=\"ss-letter-highlight\" \r\n            d=\"M23.2 23 C25.5 23 26.7 21.3 26.3 19.2 C25.9 17.1 23.2 16.1 21 16.1 C18.8 16.1 17.2 14.7 17.6 12.5 C18.0 10.3 19.8 8.5 22 8.5\"\r\n            stroke=\"rgba(255,255,255,0.5)\" fill=\"none\" strokeWidth=\"0.8\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n    </g>\r\n  </svg>\r\n);\r\n\r\n// Enhanced chart options with better styling\r\nconst chartOptions = {\r\n  responsive: true,\r\n  maintainAspectRatio: false,\r\n  animation: {\r\n    duration: 1000,\r\n    easing: 'easeInOutQuart' as const,\r\n  },\r\n  plugins: {\r\n    legend: {\r\n      position: 'bottom' as const,\r\n      labels: {\r\n        usePointStyle: true,\r\n        padding: 20,\r\n        color: 'rgb(156, 163, 175)',\r\n        font: {\r\n          size: 12\r\n        }\r\n      }\r\n    },\r\n    tooltip: {\r\n      backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n      titleFont: {\r\n        size: 14,\r\n        weight: 'bold' as const,\r\n      },\r\n      bodyFont: {\r\n        size: 13,\r\n      },\r\n      padding: 12,\r\n      cornerRadius: 8,\r\n      callbacks: {\r\n        label: function(context: any) {\r\n          const value = context.raw;\r\n          const total = context.dataset.data.reduce((a: number, b: number) => a + b, 0);\r\n          const percentage = ((value / total) * 100).toFixed(1);\r\n          return `${context.label}: ${value} (${percentage}%)`;\r\n        }\r\n      }\r\n    },\r\n    datalabels: {\r\n      color: '#fff',\r\n      font: {\r\n        weight: 'bold' as const,\r\n        size: 12\r\n      },\r\n      formatter: (value: number, context: any) => {\r\n        const total = context.dataset.data.reduce((a: number, b: number) => a + b, 0);\r\n        const percentage = ((value / total) * 100).toFixed(1);\r\n        return `${percentage}%`;\r\n      }\r\n    }\r\n  },\r\n  scales: {\r\n    y: {\r\n      beginAtZero: true,\r\n      grid: {\r\n        color: 'rgba(156, 163, 175, 0.1)',\r\n      },\r\n      ticks: {\r\n        color: 'rgb(156, 163, 175)',\r\n        font: {\r\n          size: 12\r\n        }\r\n      }\r\n    },\r\n    x: {\r\n      grid: {\r\n        display: false\r\n      },\r\n      ticks: {\r\n        color: 'rgb(156, 163, 175)',\r\n        font: {\r\n          size: 12\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n// Prepare chart data with enhanced styling\r\nconst prepareGenreData = (stats: PlaylistTypes.PlaylistStats) => ({\r\n  labels: stats.genres.map(g => g.name),\r\n  datasets: [{\r\n    data: stats.genres.map(g => g.count),\r\n    backgroundColor: stats.genres.map(g => g.color + '80'),\r\n    borderColor: stats.genres.map(g => g.color),\r\n    borderWidth: 2,\r\n    hoverOffset: 4,\r\n  }]\r\n});\r\n\r\nconst prepareDurationData = (stats: PlaylistTypes.PlaylistStats) => ({\r\n  labels: ['< 3 min', '3-5 min', '> 5 min'],\r\n  datasets: [{\r\n    data: [\r\n      stats.durationCategories?.short || 0,\r\n      stats.durationCategories?.medium || 0,\r\n      stats.durationCategories?.long || 0\r\n    ],\r\n    backgroundColor: [\r\n      'rgba(147, 51, 234, 0.7)',  // Purple\r\n      'rgba(59, 130, 246, 0.7)',  // Blue\r\n      'rgba(236, 72, 153, 0.7)'   // Pink\r\n    ],\r\n    borderColor: [\r\n      'rgb(147, 51, 234)',\r\n      'rgb(59, 130, 246)',\r\n      'rgb(236, 72, 153)'\r\n    ],\r\n    borderWidth: 2\r\n  }]\r\n});\r\n\r\nconst preparePopularityData = (stats: PlaylistTypes.PlaylistStats) => ({\r\n  labels: ['Low (0-33)', 'Medium (34-66)', 'High (67-100)'],\r\n  datasets: [{\r\n    data: [\r\n      stats.popularityRanges?.low || 0,\r\n      stats.popularityRanges?.medium || 0,\r\n      stats.popularityRanges?.high || 0\r\n    ],\r\n    backgroundColor: [\r\n      'rgba(239, 68, 68, 0.7)',   // Red\r\n      'rgba(245, 158, 11, 0.7)',  // Orange\r\n      'rgba(34, 197, 94, 0.7)'    // Green\r\n    ],\r\n    borderColor: [\r\n      'rgb(239, 68, 68)',\r\n      'rgb(245, 158, 11)',\r\n      'rgb(34, 197, 94)'\r\n    ],\r\n    borderWidth: 2\r\n  }]\r\n});\r\n\r\nconst prepareYearData = (stats: PlaylistTypes.PlaylistStats) => {\r\n  const years = Object.keys(stats.releaseYears).sort();\r\n  const counts = years.map(year => stats.releaseYears[year]);\r\n  const total = counts.reduce((a, b) => a + b, 0);\r\n  const percentages = counts.map(count => ((count / total) * 100).toFixed(1));\r\n\r\n  return {\r\n    labels: years,\r\n    datasets: [{\r\n      label: 'Tracks by Year',\r\n      data: counts,\r\n      borderColor: 'rgb(147, 51, 234)',\r\n      backgroundColor: 'rgba(147, 51, 234, 0.1)',\r\n      borderWidth: 2,\r\n      tension: 0.3,\r\n      fill: true,\r\n      pointBackgroundColor: 'rgb(147, 51, 234)',\r\n      pointBorderColor: '#fff',\r\n      pointHoverRadius: 6,\r\n      pointHoverBackgroundColor: 'rgb(147, 51, 234)',\r\n      pointHoverBorderColor: '#fff'\r\n    }]\r\n  };\r\n};\r\n\r\n// Helper to detect if playlist is from YouTube (all tracks have duration_ms and popularity 0)\r\nfunction isYouTubePlaylist(tracks: Track[]) {\r\n  if (!tracks || tracks.length === 0) return false;\r\n  return tracks.every(track => (track.duration_ms === 0 || track.duration_ms === undefined) && (track.popularity === 0 || track.popularity === undefined));\r\n}\r\n\r\n// Helper to detect if playlist is from Spotify (at least one track has a nonzero duration_ms and a releaseYear)\r\nfunction isSpotifyPlaylist(tracks: Track[]) {\r\n  if (!tracks || tracks.length === 0) return false;\r\n  return tracks.some(track => (track.duration_ms ?? 0) > 0 && track.releaseYear);\r\n}\r\n\r\n// Helpers for formatting stats with graceful fallbacks\r\nfunction formatMinutes(minutes: number | null | undefined) {\r\n  if (minutes === null || minutes === undefined) return 'N/A';\r\n  if (minutes === 0) return 'N/A';\r\n  return `${minutes} mins`;\r\n}\r\n\r\nfunction formatNumber(num: number | null | undefined) {\r\n  if (num === null || num === undefined) return 'N/A';\r\n  if (num === 0) return 'N/A';\r\n  return num;\r\n}\r\n\r\nfunction formatPercent(percent: number | null | undefined) {\r\n  if (percent === null || percent === undefined) return 'N/A';\r\n  if (percent === 0) return 'N/A';\r\n  return `${percent}%`;\r\n}\r\n\r\n// Main component\r\nexport function EnhancedPlaylistInsights({ stats, tracks }: PlaylistInsightsProps) {\r\n  const [activeView, setActiveView] = useState<'overview' | 'genres' | 'artists' | 'trends' | 'musicTaste'>('overview');\r\n  const [isInfoVisible, setIsInfoVisible] = useState<boolean>(false);\r\n  const [selectedMetric, setSelectedMetric] = useState<'popularity' | 'duration' | 'release'>('popularity');\r\n  const [showTooltip, setShowTooltip] = useState<{ x: number; y: number; content: string } | null>(null);\r\n\r\n  const advancedMetrics = calculateAdvancedMetrics(stats);\r\n  const isYoutube = isYouTubePlaylist(tracks);\r\n  const isSpotify = isSpotifyPlaylist(tracks);\r\n\r\n  return (\r\n    <GlassmorphicContainer className=\"max-w-7xl mx-auto p-6 space-y-8\" rounded=\"xl\">\r\n      {/* Header with enhanced branding */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: -20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        className=\"text-center space-y-4\"\r\n      >\r\n        <div className=\"flex items-center justify-center gap-3\">\r\n          <SoundSwappLogo size={48} className=\"text-purple-500\" />\r\n          {/* Show official YouTube logo for YouTube playlists, branding compliant */}\r\n          {isYoutube && (\r\n            <a\r\n              href=\"https://www.youtube.com/\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              aria-label=\"YouTube\"\r\n              style={{ display: 'inline-block', padding: '8px' }}\r\n            >\r\n              <img\r\n                src=\"/images/yt_logo_rgb_dark.png\"\r\n                alt=\"YouTube\"\r\n                style={{ \r\n                  height: 32, \r\n                  minHeight: 20, \r\n                  maxHeight: 40, \r\n                  width: 'auto', \r\n                  objectFit: 'contain',\r\n                  minWidth: '32px'\r\n                }}\r\n              />\r\n            </a>\r\n          )}\r\n          <h1 className=\"text-4xl font-bold bg-gradient-to-r from-[var(--brand-primary)] to-[var(--brand-accent-pink)] bg-clip-text text-transparent\">\r\n            Playlist Insights\r\n          </h1>\r\n        </div>\r\n        <p className=\"text-gray-600 dark:text-gray-400 max-w-2xl mx-auto\">\r\n          Discover the hidden patterns and stories within your music collection with advanced analytics and beautiful visualizations.\r\n        </p>\r\n      </motion.div>\r\n\r\n      {/* Navigation with glassmorphic effect */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ delay: 0.1 }}\r\n        className=\"flex justify-center\"\r\n      >\r\n        <div className=\"flex gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-xl max-w-full overflow-x-auto hide-scrollbar\">\r\n          {[ \r\n            { key: 'overview', label: 'Overview', icon: BarChart3 },\r\n            { key: 'genres', label: 'Genres', icon: PieChart },\r\n            { key: 'artists', label: 'Artists', icon: Users },\r\n            { key: 'trends', label: 'Trends', icon: TrendingUp },\r\n            { key: 'musicTaste', label: 'Music Taste', icon: Heart }\r\n          ].map(({ key, label, icon: Icon }) => (\r\n            <motion.button\r\n              key={key}\r\n              whileHover={{ scale: 1.02 }}\r\n              whileTap={{ scale: 0.98 }}\r\n              onClick={() => setActiveView(key as any)}\r\n              className={`flex items-center gap-1.5 px-3 py-2 rounded-lg transition-all whitespace-nowrap min-w-0 flex-shrink-0 ${\r\n                activeView === key\r\n                  ? 'bg-gradient-to-r from-orange-500 to-pink-500 text-white shadow-md'\r\n                  : 'bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-200/60 dark:border-gray-600/60 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600'\r\n              }`}\r\n            >\r\n              <Icon size={14} />\r\n              <span className=\"text-xs font-medium\">{label}</span>\r\n            </motion.button>\r\n          ))}\r\n        </div>\r\n      </motion.div>\r\n\r\n      {/* Content sections with glassmorphic containers */}\r\n      <AnimatePresence mode=\"wait\">\r\n        {activeView === 'overview' && (\r\n          <motion.div\r\n            key=\"overview\"\r\n            initial={{ opacity: 0, x: -20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            exit={{ opacity: 0, x: 20 }}\r\n            className=\"space-y-8\"\r\n          >\r\n            {/* Stats Cards with graceful fallbacks */}\r\n            <motion.div\r\n              variants={staggerChildren}\r\n              initial=\"initial\"\r\n              animate=\"animate\"\r\n              className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\"\r\n            >\r\n              <StatCard\r\n                icon={Music}\r\n                title=\"Total Tracks\"\r\n                value={formatNumber(stats.totalTracks)}\r\n                subtitle={`${formatNumber(stats.uniqueArtists)} unique artists`}\r\n                color=\"purple\"\r\n                trend={undefined}\r\n              />\r\n              <StatCard\r\n                icon={Clock}\r\n                title=\"Total Duration\"\r\n                value={formatMinutes(stats.totalDuration)}\r\n                color=\"blue\"\r\n                subtitle={stats.totalDuration === 0 ? 'Data not available' : undefined}\r\n              />\r\n              <StatCard\r\n                icon={Flame}\r\n                title=\"Avg. Popularity\"\r\n                value={formatNumber(Math.round(stats.avgPopularity))}\r\n                subtitle={stats.avgPopularity === 0 ? 'Data not available' : 'Out of 100'}\r\n                color=\"red\"\r\n              />\r\n              <StatCard\r\n                icon={Award}\r\n                title=\"Diversity Score\"\r\n                value={formatPercent(advancedMetrics.diversityScore)}\r\n                subtitle={advancedMetrics.diversityScore === 0 ? 'Data not available' : 'Genre variety index'}\r\n                color=\"green\"\r\n              />\r\n            </motion.div>\r\n\r\n            {/* Enhanced Chart Section */}\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\r\n              <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6\">\r\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white flex items-center gap-2\">\r\n                  <span>Playlist Analysis</span>\r\n                  <button \r\n                    className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                    onClick={() => setShowTooltip(prev => prev ? null : { x: 0, y: 0, content: 'Click on different metrics to explore your playlist data in detail.' })}\r\n                  >\r\n                    <Info size={16} />\r\n                  </button>\r\n                </h3>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  <motion.button\r\n                    whileHover={{ scale: 1.05 }}\r\n                    whileTap={{ scale: 0.95 }}\r\n                    onClick={() => setSelectedMetric('popularity')}\r\n                    className={`px-4 py-2 text-sm rounded-lg transition-colors ${\r\n                      selectedMetric === 'popularity'\r\n                        ? 'bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300'\r\n                        : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                  >\r\n                    Popularity\r\n                  </motion.button>\r\n                  <motion.button\r\n                    whileHover={{ scale: 1.05 }}\r\n                    whileTap={{ scale: 0.95 }}\r\n                    onClick={() => setSelectedMetric('duration')}\r\n                    className={`px-4 py-2 text-sm rounded-lg transition-colors ${\r\n                      selectedMetric === 'duration'\r\n                        ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300'\r\n                        : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                  >\r\n                    Duration\r\n                  </motion.button>\r\n                  <motion.button\r\n                    whileHover={{ scale: 1.05 }}\r\n                    whileTap={{ scale: 0.95 }}\r\n                    onClick={() => setSelectedMetric('release')}\r\n                    className={`px-4 py-2 text-sm rounded-lg transition-colors ${\r\n                      selectedMetric === 'release'\r\n                        ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300'\r\n                        : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                  >\r\n                    Release Year\r\n                  </motion.button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Chart Container with Enhanced Visualizations */}\r\n              {isYoutube ? (\r\n                <div className=\"text-center text-gray-500 my-8\">\r\n                  Popularity and duration insights are not available for YouTube playlists due to API limitations.\r\n                </div>\r\n              ) : (\r\n                <div className=\"h-80 relative\">\r\n                  <AnimatePresence mode=\"wait\">\r\n                    {selectedMetric === 'popularity' && (\r\n                      <motion.div\r\n                        key=\"popularity\"\r\n                        initial={{ opacity: 0, scale: 0.95 }}\r\n                        animate={{ opacity: 1, scale: 1 }}\r\n                        exit={{ opacity: 0, scale: 0.95 }}\r\n                        transition={{ duration: 0.3 }}\r\n                        className=\"h-full\"\r\n                      >\r\n                        <Doughnut \r\n                          options={{\r\n                            ...chartOptions,\r\n                            plugins: {\r\n                              ...chartOptions.plugins,\r\n                              title: {\r\n                                display: true,\r\n                                text: 'Track Popularity Distribution',\r\n                                color: 'rgb(107, 114, 128)',\r\n                                font: {\r\n                                  size: 16,\r\n                                  weight: 'bold'\r\n                                }\r\n                              }\r\n                            }\r\n                          }} \r\n                          data={preparePopularityData(stats)} \r\n                        />\r\n                      </motion.div>\r\n                    )}\r\n                    {selectedMetric === 'duration' && (\r\n                      <motion.div\r\n                        key=\"duration\"\r\n                        initial={{ opacity: 0, scale: 0.95 }}\r\n                        animate={{ opacity: 1, scale: 1 }}\r\n                        exit={{ opacity: 0, scale: 0.95 }}\r\n                        transition={{ duration: 0.3 }}\r\n                        className=\"h-full\"\r\n                      >\r\n                        <Pie \r\n                          options={{\r\n                            ...chartOptions,\r\n                            plugins: {\r\n                              ...chartOptions.plugins,\r\n                              title: {\r\n                                display: true,\r\n                                text: 'Track Duration Distribution',\r\n                                color: 'rgb(107, 114, 128)',\r\n                                font: {\r\n                                  size: 16,\r\n                                  weight: 'bold'\r\n                                }\r\n                              }\r\n                            }\r\n                          }}\r\n                          data={prepareDurationData(stats)} \r\n                        />\r\n                      </motion.div>\r\n                    )}\r\n                    {selectedMetric === 'release' && (\r\n                      <motion.div\r\n                        key=\"release\"\r\n                        initial={{ opacity: 0, scale: 0.95 }}\r\n                        animate={{ opacity: 1, scale: 1 }}\r\n                        exit={{ opacity: 0, scale: 0.95 }}\r\n                        transition={{ duration: 0.3 }}\r\n                        className=\"h-full\"\r\n                      >\r\n                        <Line \r\n                          options={{\r\n                            ...chartOptions,\r\n                            plugins: {\r\n                              ...chartOptions.plugins,\r\n                              title: {\r\n                                display: true,\r\n                                text: 'Tracks by Release Year',\r\n                                color: 'rgb(107, 114, 128)',\r\n                                font: {\r\n                                  size: 16,\r\n                                  weight: 'bold'\r\n                                }\r\n                              }\r\n                            }\r\n                          }}\r\n                          data={prepareYearData(stats)} \r\n                        />\r\n                      </motion.div>\r\n                    )}\r\n                  </AnimatePresence>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n\r\n        {activeView === 'genres' && (\r\n          <motion.div\r\n            key=\"genres\"\r\n            initial={{ opacity: 0, x: -20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            exit={{ opacity: 0, x: 20 }}\r\n            className=\"space-y-6\"\r\n          >\r\n            <GlassmorphicContainer className=\"bg-gradient-to-br from-white/80 to-white/40 dark:from-gray-800/80 dark:to-gray-900/40 backdrop-blur-sm rounded-xl border border-gray-200/50 dark:border-gray-700/50 shadow-lg p-6\">\r\n              <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2\">\r\n                <PieChart className=\"text-purple-500\" size={20} />\r\n                Genre Distribution\r\n              </h3>\r\n              <div className=\"space-y-4\">\r\n                {stats.genres.map((genre, index) => {\r\n                  const percentage = Math.round((genre.count / (stats.totalGenreMentions || stats.totalTracks)) * 100);\r\n                  return (\r\n                    <GlassmorphicContainer className=\"group\" rounded=\"xl\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <div \r\n                            className=\"w-4 h-4 rounded-full shadow-sm\"\r\n                            style={{ backgroundColor: genre.color }}\r\n                          />\r\n                          <span className=\"font-medium text-gray-900 dark:text-white\">{genre.name}</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className=\"text-sm text-gray-500\">{genre.count} tracks</span>\r\n                          <span className=\"text-sm font-medium text-gray-900 dark:text-white\">{percentage}%</span>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"relative h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\r\n                        <motion.div\r\n                          initial={{ width: 0 }}\r\n                          animate={{ width: `${percentage}%` }}\r\n                          transition={{ duration: 1, delay: index * 0.1 }}\r\n                          className=\"h-full rounded-full\"\r\n                          style={{ backgroundColor: genre.color }}\r\n                        />\r\n                      </div>\r\n                    </GlassmorphicContainer>\r\n                  );\r\n                })}\r\n              </div>\r\n            </GlassmorphicContainer>\r\n          </motion.div>\r\n        )}\r\n\r\n        {activeView === 'artists' && (\r\n          <motion.div\r\n            key=\"artists\"\r\n            initial={{ opacity: 0, x: -20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            exit={{ opacity: 0, x: 20 }}\r\n            className=\"space-y-6\"\r\n          >\r\n            <GlassmorphicContainer className=\"p-6\" rounded=\"xl\">\r\n              <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2\">\r\n                <Users className=\"text-purple-500\" size={20} />\r\n                Top Artists\r\n              </h3>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {stats.topArtists.map((artist, i) => (\r\n                  <motion.div\r\n                    key={i}\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: i * 0.1 }}\r\n                    className=\"group relative\"\r\n                  >\r\n                    <div className=\"flex items-center p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-md transition-all duration-300\">\r\n                      <div className=\"relative w-16 h-16 rounded-full overflow-hidden border-2 border-white/20 shadow-xl\">\r\n                        {artist.image ? (\r\n                          <>\r\n                            <div className=\"absolute inset-0 bg-gradient-to-br from-purple-500/10 to-pink-500/10 animate-pulse\" />\r\n                            <img \r\n                              src={artist.image} \r\n                              alt={artist.name}\r\n                              className=\"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-300 relative z-10\"\r\n                              loading=\"lazy\"\r\n                              onLoad={(e) => {\r\n                                const target = e.target as HTMLImageElement;\r\n                                if (target.previousElementSibling) {\r\n                                  target.previousElementSibling.remove(); // Remove loading animation\r\n                                }\r\n                              }}\r\n                              onError={(e) => {\r\n                                const target = e.target as HTMLImageElement;\r\n                                target.style.display = 'none';\r\n                                if (target.previousElementSibling) {\r\n                                  target.previousElementSibling.remove(); // Remove loading animation\r\n                                }\r\n                                if (target.parentElement) {\r\n                                  target.parentElement.classList.add('bg-gradient-to-br', 'from-purple-500/10', 'to-pink-500/10');\r\n                                  const fallback = document.createElement('div');\r\n                                  fallback.className = 'w-full h-full flex items-center justify-center';\r\n                                  fallback.innerHTML = `<span class=\"text-2xl font-bold text-purple-500/70\">${artist.name.charAt(0).toUpperCase()}</span>`;\r\n                                  target.parentElement.appendChild(fallback);\r\n                                }\r\n                              }}\r\n                            />\r\n                          </>\r\n                        ) : (\r\n                          <div className=\"w-full h-full bg-gradient-to-br from-purple-500/10 to-pink-500/10 flex items-center justify-center\">\r\n                            <span className=\"text-2xl font-bold text-purple-500/70\">{artist.name.charAt(0).toUpperCase()}</span>\r\n                          </div>\r\n                        )}\r\n                        <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0 ml-4\">\r\n                        <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white truncate group-hover:text-purple-500 transition-colors\">\r\n                          {artist.name}\r\n                        </h4>\r\n                        <div className=\"flex items-center gap-2 mt-1\">\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\r\n                              <motion.div\r\n                                initial={{ width: 0 }}\r\n                                animate={{ width: `${(artist.count / stats.totalTracks) * 100}%` }}\r\n                                transition={{ duration: 1, delay: i * 0.1 }}\r\n                                className=\"h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full\"\r\n                              />\r\n                            </div>\r\n                          </div>\r\n                          <span className=\"text-sm text-gray-600 dark:text-gray-400 whitespace-nowrap\">\r\n                            {artist.count} {artist.count === 1 ? 'track' : 'tracks'}\r\n                          </span>\r\n                        </div>\r\n                        {artist.popularity !== undefined && (\r\n                          <div className=\"mt-2 flex items-center gap-2\">\r\n                            <Flame size={14} className=\"text-orange-500\" />\r\n                            <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                              Popularity: {artist.popularity}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </motion.div>\r\n                ))}\r\n              </div>\r\n            </GlassmorphicContainer>\r\n          </motion.div>\r\n        )}\r\n\r\n        {activeView === 'trends' && (\r\n          <motion.div\r\n            key=\"trends\"\r\n            initial={{ opacity: 0, x: -20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            exit={{ opacity: 0, x: 20 }}\r\n            className=\"space-y-6\"\r\n          >\r\n            <GlassmorphicContainer className=\"bg-gradient-to-br from-white/80 to-white/40 dark:from-gray-800/80 dark:to-gray-900/40 backdrop-blur-sm rounded-xl border border-gray-200/50 dark:border-gray-700/50 shadow-lg p-6\">\r\n              <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2\">\r\n                <TrendingUp className=\"text-green-500\" size={20} />\r\n                Listening Trends & Patterns\r\n              </h3>\r\n              \r\n              <div className=\"space-y-8\">\r\n                {/* Popularity Trends */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <Flame className=\"text-red-500\" size={18} />\r\n                    Popularity Distribution\r\n                  </h4>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-2xl font-bold text-red-500\">\r\n                          {stats.popularityRanges?.low || 0}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Underground</div>\r\n                        <div className=\"text-xs text-gray-500\">(0-33)</div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-2xl font-bold text-orange-500\">\r\n                          {stats.popularityRanges?.medium || 0}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Balanced</div>\r\n                        <div className=\"text-xs text-gray-500\">(34-66)</div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-2xl font-bold text-green-500\">\r\n                          {stats.popularityRanges?.high || 0}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Mainstream</div>\r\n                        <div className=\"text-xs text-gray-500\">(67-100)</div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Duration Trends */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <Clock className=\"text-blue-500\" size={18} />\r\n                    Track Length Preferences\r\n                  </h4>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-2xl font-bold text-purple-500\">\r\n                          {stats.durationCategories?.short || 0}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Short Tracks</div>\r\n                        <div className=\"text-xs text-gray-500\">&lt; 3 minutes</div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-2xl font-bold text-blue-500\">\r\n                          {stats.durationCategories?.medium || 0}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Standard</div>\r\n                        <div className=\"text-xs text-gray-500\">3-5 minutes</div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-2xl font-bold text-pink-500\">\r\n                          {stats.durationCategories?.long || 0}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Extended</div>\r\n                        <div className=\"text-xs text-gray-500\">&gt; 5 minutes</div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Genre Evolution */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <PieChart className=\"text-purple-500\" size={18} />\r\n                    Genre Distribution\r\n                  </h4>\r\n                  <div className=\"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-4\">\r\n                    <div className=\"space-y-3\">\r\n                      {stats.genres.slice(0, 5).map((genre, index) => (\r\n                        <div key={index} className=\"flex items-center justify-between\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div \r\n                              className=\"w-3 h-3 rounded-full\"\r\n                              style={{ backgroundColor: genre.color }}\r\n                            />\r\n                            <span className=\"font-medium text-gray-900 dark:text-white\">{genre.name}</span>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-sm text-gray-600 dark:text-gray-400\">{genre.count} tracks</span>\r\n                            <span className=\"text-sm font-semibold text-purple-600 dark:text-purple-400\">\r\n                              {Math.round((genre.count / stats.totalTracks) * 100)}%\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Artist Concentration */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <Users className=\"text-indigo-500\" size={18} />\r\n                    Artist Concentration\r\n                  </h4>\r\n                  <div className=\"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg p-4\">\r\n                    <div className=\"space-y-4\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-gray-700 dark:text-gray-300\">Total Artists:</span>\r\n                        <span className=\"font-semibold text-indigo-600 dark:text-indigo-400\">{stats.uniqueArtists}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-gray-700 dark:text-gray-300\">Avg. Tracks per Artist:</span>\r\n                        <span className=\"font-semibold text-indigo-600 dark:text-indigo-400\">\r\n                          {stats.uniqueArtists ? Math.round(stats.totalTracks / stats.uniqueArtists) : 0}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-gray-700 dark:text-gray-300\">Diversity Score:</span>\r\n                        <span className=\"font-semibold text-indigo-600 dark:text-indigo-400\">\r\n                          {advancedMetrics.diversityScore}%\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Listening Insights */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <Eye className=\"text-teal-500\" size={18} />\r\n                    Key Insights\r\n                  </h4>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"flex items-center gap-3 mb-3\">\r\n                        <Headphones className=\"text-teal-500\" size={16} />\r\n                        <span className=\"font-medium text-gray-900 dark:text-white\">Listening Time</span>\r\n                      </div>\r\n                      <div className=\"text-2xl font-bold text-teal-600 dark:text-teal-400\">\r\n                        {Math.round(stats.totalDuration / 3600000)}h {Math.round((stats.totalDuration % 3600000) / 60000)}m\r\n                      </div>\r\n                      <div className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                        Total playlist duration\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"flex items-center gap-3 mb-3\">\r\n                        <Star className=\"text-yellow-500\" size={16} />\r\n                        <span className=\"font-medium text-gray-900 dark:text-white\">Average Rating</span>\r\n                      </div>\r\n                      <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">\r\n                        {Math.round(stats.avgPopularity)}/100\r\n                      </div>\r\n                      <div className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                        Track popularity score\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </GlassmorphicContainer>\r\n          </motion.div>\r\n        )}\r\n\r\n        {activeView === 'musicTaste' && (\r\n          <motion.div\r\n            key=\"musicTaste\"\r\n            initial={{ opacity: 0, x: -20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            exit={{ opacity: 0, x: 20 }}\r\n            className=\"space-y-6\"\r\n          >\r\n            <GlassmorphicContainer className=\"bg-gradient-to-br from-white/80 to-white/40 dark:from-gray-800/80 dark:to-gray-900/40 backdrop-blur-sm rounded-xl border border-gray-200/50 dark:border-gray-700/50 shadow-lg p-6\">\r\n              <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2\">\r\n                <Heart className=\"text-red-500\" size={20} />\r\n                Music Taste Analysis\r\n              </h3>\r\n              \r\n              {/* Enhanced Music Taste Content */}\r\n              <div className=\"space-y-8\">\r\n                {/* Primary Genre Analysis */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <Sparkles className=\"text-purple-500\" size={18} />\r\n                    Your Musical Identity\r\n                  </h4>\r\n                  <div className=\"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-4\">\r\n                    <p className=\"text-gray-700 dark:text-gray-300\">\r\n                      {stats.genres && stats.genres.length > 0 ? (\r\n                        <>\r\n                          Your playlist reveals a strong affinity for <span className=\"font-semibold text-purple-600 dark:text-purple-400\">{stats.genres[0].name}</span> music, \r\n                          with {stats.genres.length > 1 && <span className=\"font-semibold\">{stats.genres[1].name}</span>} as your secondary preference. \r\n                          You tend to enjoy {stats.avgPopularity > 70 ? 'highly popular, mainstream' : stats.avgPopularity > 40 ? 'moderately popular, balanced' : 'underground, niche'} tracks.\r\n                        </>\r\n                      ) : (\r\n                        'Your musical taste shows diverse preferences across multiple genres.'\r\n                      )}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Listening Patterns */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <Activity className=\"text-blue-500\" size={18} />\r\n                    Listening Patterns\r\n                  </h4>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"flex items-center gap-3 mb-3\">\r\n                        <Clock className=\"text-blue-500\" size={16} />\r\n                        <span className=\"font-medium text-gray-900 dark:text-white\">Track Length Preference</span>\r\n                      </div>\r\n                      <div className=\"space-y-2\">\r\n                        {(() => {\r\n                          const short = stats.durationCategories?.short || 0;\r\n                          const medium = stats.durationCategories?.medium || 0;\r\n                          const long = stats.durationCategories?.long || 0;\r\n                          const total = short + medium + long;\r\n                          \r\n                          if (total === 0) return <span className=\"text-gray-500\">Data not available</span>;\r\n                          \r\n                          const preference = short > medium && short > long ? 'Short tracks (under 3 min)' :\r\n                                           long > medium && long > short ? 'Extended tracks (over 5 min)' :\r\n                                           'Standard length (3-5 min)';\r\n                          \r\n                          return (\r\n                            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                              You prefer <span className=\"font-semibold\">{preference}</span>\r\n                            </div>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"flex items-center gap-3 mb-3\">\r\n                        <TrendingUp className=\"text-green-500\" size={16} />\r\n                        <span className=\"font-medium text-gray-900 dark:text-white\">Popularity Range</span>\r\n                      </div>\r\n                      <div className=\"space-y-2\">\r\n                        {(() => {\r\n                          const low = stats.popularityRanges?.low || 0;\r\n                          const medium = stats.popularityRanges?.medium || 0;\r\n                          const high = stats.popularityRanges?.high || 0;\r\n                          const total = low + medium + high;\r\n                          \r\n                          if (total === 0) return <span className=\"text-gray-500\">Data not available</span>;\r\n                          \r\n                          const preference = high > medium && high > low ? 'Mainstream hits' :\r\n                                           low > medium && low > high ? 'Underground gems' :\r\n                                           'Balanced mix';\r\n                          \r\n                          return (\r\n                            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                              You enjoy <span className=\"font-semibold\">{preference}</span>\r\n                            </div>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Era Analysis */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <Calendar className=\"text-orange-500\" size={18} />\r\n                    Musical Era Preferences\r\n                  </h4>\r\n                  <div className=\"bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 rounded-lg p-4\">\r\n                    {(() => {\r\n                      if (!stats.releaseYears || Object.keys(stats.releaseYears).length === 0) {\r\n                        return <span className=\"text-gray-500\">Release year data not available</span>;\r\n                      }\r\n                      \r\n                      const years = Object.keys(stats.releaseYears).map(Number).sort();\r\n                      const recent = years.filter(y => y >= 2020).length;\r\n                      const modern = years.filter(y => y >= 2010 && y < 2020).length;\r\n                      const classic = years.filter(y => y >= 2000 && y < 2010).length;\r\n                      const vintage = years.filter(y => y < 2000).length;\r\n                      \r\n                      const total = recent + modern + classic + vintage;\r\n                      const era = recent > modern && recent > classic && recent > vintage ? 'contemporary (2020s)' :\r\n                                modern > recent && modern > classic && modern > vintage ? 'modern (2010s)' :\r\n                                classic > recent && classic > modern && classic > vintage ? 'classic (2000s)' :\r\n                                'vintage (pre-2000)';\r\n                      \r\n                      return (\r\n                        <p className=\"text-gray-700 dark:text-gray-300\">\r\n                          You gravitate toward <span className=\"font-semibold text-orange-600 dark:text-orange-400\">{era}</span> music, \r\n                          showing appreciation for {vintage > 0 ? 'both timeless classics and contemporary hits' : 'current trends and recent releases'}.\r\n                        </p>\r\n                      );\r\n                    })()}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Artist Diversity */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <Users className=\"text-indigo-500\" size={18} />\r\n                    Artist Diversity\r\n                  </h4>\r\n                  <div className=\"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg p-4\">\r\n                    {(() => {\r\n                      const diversityScore = advancedMetrics.diversityScore;\r\n                      const avgTracksPerArtist = advancedMetrics.avgTracksPerArtist;\r\n                      \r\n                      let diversityLevel = 'Low';\r\n                      let description = 'You tend to stick with familiar artists';\r\n                      \r\n                      if (diversityScore > 60) {\r\n                        diversityLevel = 'High';\r\n                        description = 'You explore a wide variety of artists';\r\n                      } else if (diversityScore > 30) {\r\n                        diversityLevel = 'Moderate';\r\n                        description = 'You balance favorites with new discoveries';\r\n                      }\r\n                      \r\n                      return (\r\n                        <div className=\"space-y-3\">\r\n                          <div className=\"flex items-center justify-between\">\r\n                            <span className=\"text-gray-700 dark:text-gray-300\">Diversity Level:</span>\r\n                            <span className=\"font-semibold text-indigo-600 dark:text-indigo-400\">{diversityLevel}</span>\r\n                          </div>\r\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400\">{description}</p>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-sm text-gray-500\">Avg. tracks per artist:</span>\r\n                            <span className=\"font-medium\">{avgTracksPerArtist || 'N/A'}</span>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })()}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Personalized Recommendations */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                    <Zap className=\"text-yellow-500\" size={18} />\r\n                    Discover More\r\n                  </h4>\r\n                  <div className=\"bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-lg p-4\">\r\n                    <p className=\"text-gray-700 dark:text-gray-300 mb-3\">\r\n                      Based on your taste, you might enjoy:\r\n                    </p>\r\n                    <div className=\"space-y-2\">\r\n                      {(() => {\r\n                        const recommendations = [];\r\n                        \r\n                        if (stats.genres && stats.genres.length > 0) {\r\n                          recommendations.push(`More ${stats.genres[0].name} artists`);\r\n                        }\r\n                        \r\n                        if (stats.avgPopularity < 50) {\r\n                          recommendations.push('Underground and indie discoveries');\r\n                        } else if (stats.avgPopularity > 70) {\r\n                          recommendations.push('Chart-topping hits and trending tracks');\r\n                        }\r\n                        \r\n                        if (stats.durationCategories?.long && stats.durationCategories?.short && stats.durationCategories.long > stats.durationCategories.short) {\r\n                          recommendations.push('Extended mixes and live performances');\r\n                        }\r\n                        \r\n                        if (recommendations.length === 0) {\r\n                          recommendations.push('Exploring new genres and artists');\r\n                        }\r\n                        \r\n                        return (\r\n                          <ul className=\"space-y-1\">\r\n                            {recommendations.map((rec, index) => (\r\n                              <li key={index} className=\"flex items-center gap-2 text-sm\">\r\n                                <div className=\"w-1.5 h-1.5 bg-yellow-500 rounded-full\"></div>\r\n                                <span className=\"text-gray-600 dark:text-gray-400\">{rec}</span>\r\n                              </li>\r\n                            ))}\r\n                          </ul>\r\n                        );\r\n                      })()}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </GlassmorphicContainer>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Footer with brand logo */}\r\n      <motion.div\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        transition={{ delay: 0.5 }}\r\n        className=\"mt-12 text-center\"\r\n      >\r\n        <SoundSwappLogo size={24} className=\"mx-auto mb-2 opacity-50\" />\r\n        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n          Powered by SoundSwapp Analytics\r\n        </p>\r\n      </motion.div>\r\n    </GlassmorphicContainer>\r\n  );\r\n}\r\n\r\n// Add alias export for backward compatibility\r\nexport const PlaylistInsights = EnhancedPlaylistInsights;\r\n\r\n// Mobile-optimized insights component with premium desktop styling\r\nexport function MobilePlaylistInsights({ stats, tracks }: PlaylistInsightsProps) {\r\n  const [activeView, setActiveView] = useState<'overview' | 'genres' | 'artists' | 'trends' | 'musicTaste'>('overview');\r\n  const navigate = useNavigate();\r\n  const advancedMetrics = calculateAdvancedMetrics(stats);\r\n  const isYoutube = isYouTubePlaylist(tracks);\r\n  const isSpotify = isSpotifyPlaylist(tracks);\r\n\r\n  // Premium Mobile StatCard component matching desktop styling\r\n  const MobileStatCard = ({ \r\n    icon: Icon, \r\n    title, \r\n    value, \r\n    subtitle, \r\n    color = 'purple', \r\n    onClick \r\n  }: StatCardProps) => {\r\n    const colorClasses: Record<string, { bg: string; icon: string; text: string; border: string }> = {\r\n      purple: { \r\n        bg: 'bg-gradient-to-br from-purple-500/10 to-pink-500/10', \r\n        icon: 'from-purple-500 to-pink-500',\r\n        text: 'text-purple-600 dark:text-purple-400',\r\n        border: 'border-purple-500/20'\r\n      },\r\n      blue: { \r\n        bg: 'bg-gradient-to-br from-blue-500/10 to-cyan-500/10', \r\n        icon: 'from-blue-500 to-cyan-500',\r\n        text: 'text-blue-600 dark:text-blue-400',\r\n        border: 'border-blue-500/20'\r\n      },\r\n      green: { \r\n        bg: 'bg-gradient-to-br from-green-500/10 to-teal-500/10', \r\n        icon: 'from-green-500 to-teal-500',\r\n        text: 'text-green-600 dark:text-green-400',\r\n        border: 'border-green-500/20'\r\n      },\r\n      red: { \r\n        bg: 'bg-gradient-to-br from-red-500/10 to-orange-500/10', \r\n        icon: 'from-red-500 to-orange-500',\r\n        text: 'text-red-600 dark:text-red-400',\r\n        border: 'border-red-500/20'\r\n      },\r\n      yellow: { \r\n        bg: 'bg-gradient-to-br from-yellow-500/10 to-orange-500/10', \r\n        icon: 'from-yellow-500 to-orange-500',\r\n        text: 'text-yellow-600 dark:text-yellow-400',\r\n        border: 'border-yellow-500/20'\r\n      },\r\n      indigo: { \r\n        bg: 'bg-gradient-to-br from-indigo-500/10 to-purple-500/10', \r\n        icon: 'from-indigo-500 to-purple-500',\r\n        text: 'text-indigo-600 dark:text-indigo-400',\r\n        border: 'border-indigo-500/20'\r\n      }\r\n    };\r\n\r\n    const colors = colorClasses[color];\r\n\r\n    return (\r\n      <motion.div\r\n        whileHover={{ scale: 1.02, y: -2 }}\r\n        whileTap={{ scale: 0.98 }}\r\n        onClick={onClick}\r\n        className={`relative overflow-hidden rounded-xl border backdrop-blur-sm cursor-pointer ${colors.bg} ${colors.border} shadow-lg hover:shadow-xl transition-all duration-300`}\r\n      >\r\n        {/* Animated background gradient */}\r\n        <div className={`absolute inset-0 bg-gradient-to-r ${colors.icon} opacity-0 hover:opacity-5 transition-opacity duration-300`} />\r\n        \r\n        <div className=\"relative p-4\">\r\n          <div className=\"flex items-center gap-3 mb-3\">\r\n            <div className={`p-2.5 rounded-lg bg-gradient-to-r ${colors.icon} text-white shadow-md`}>\r\n              <Icon size={18} />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">{title}</h3>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"space-y-1\">\r\n            <motion.div\r\n              initial={{ opacity: 0, scale: 0.8 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n              transition={{ delay: 0.2 }}\r\n              className={`text-xl font-bold ${colors.text}`}\r\n            >\r\n              {value}\r\n            </motion.div>\r\n            {subtitle && (\r\n              <div className=\"text-xs text-gray-500 dark:text-gray-400\">{subtitle}</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </motion.div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 font-sf-pro\">\r\n      {/* Premium Mobile Header */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: -20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        className=\"sticky top-0 z-50 bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-700/50 shadow-sm\"\r\n      >\r\n        <div className=\"flex items-center justify-between px-4 py-3\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <motion.button\r\n              whileHover={{ scale: 1.05 }}\r\n              whileTap={{ scale: 0.95 }}\r\n              onClick={() => navigate(-1)}\r\n              className=\"p-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors\"\r\n            >\r\n              <ArrowLeft size={20} />\r\n            </motion.button>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"soundswapp-logo\">\r\n                <SoundSwappLogo size={32} />\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-lg font-sf-pro-display font-bold text-gray-900 dark:text-white\">\r\n                  Playlist Insights\r\n                </h1>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 font-sf-pro-text\">\r\n                  {tracks[0]?.playlistName || 'Playlist Analysis'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </motion.div>\r\n\r\n      {/* Mobile Content */}\r\n      <div className=\"px-4 py-6 space-y-6\">\r\n        {/* Premium Hero Section */}\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"text-center space-y-4\"\r\n        >\r\n          <div className=\"flex items-center justify-center gap-3 mb-4\">\r\n            {isYoutube && (\r\n              <div className=\"p-2 rounded-xl bg-white shadow-md\">\r\n                <img\r\n                  src=\"/images/yt_logo_rgb_dark.png\"\r\n                  alt=\"YouTube\"\r\n                  className=\"h-6 w-auto object-contain\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 font-sf-pro-text max-w-sm mx-auto\">\r\n            Discover the hidden patterns and stories within your music collection with advanced analytics and beautiful visualizations.\r\n          </p>\r\n        </motion.div>\r\n\r\n        {/* Premium Mobile Navigation Tabs */}\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.1 }}\r\n          className=\"flex justify-center px-2\"\r\n        >\r\n          <div className=\"flex gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-xl max-w-full overflow-x-auto hide-scrollbar\">\r\n            {[ \r\n              { key: 'overview', label: 'Overview', icon: BarChart3 },\r\n              { key: 'genres', label: 'Genres', icon: PieChart },\r\n              { key: 'artists', label: 'Artists', icon: Users },\r\n              { key: 'trends', label: 'Trends', icon: TrendingUp },\r\n              { key: 'musicTaste', label: 'Music Taste', icon: Heart }\r\n            ].map(({ key, label, icon: Icon }) => (\r\n              <motion.button\r\n                key={key}\r\n                whileHover={{ scale: 1.02 }}\r\n                whileTap={{ scale: 0.98 }}\r\n                onClick={() => setActiveView(key as any)}\r\n                className={`flex items-center gap-1.5 px-3 py-2 rounded-lg transition-all whitespace-nowrap min-w-0 flex-shrink-0 ${\r\n                  activeView === key\r\n                    ? 'bg-gradient-to-r from-orange-500 to-pink-500 text-white shadow-md'\r\n                    : 'bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-200/60 dark:border-gray-600/60 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600'\r\n                }`}\r\n              >\r\n                <Icon size={14} />\r\n                <span className=\"text-xs font-medium\">{label}</span>\r\n              </motion.button>\r\n            ))}\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Content Sections */}\r\n        <AnimatePresence mode=\"wait\">\r\n          {activeView === 'overview' && (\r\n            <motion.div\r\n              key=\"overview\"\r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              exit={{ opacity: 0, x: 20 }}\r\n              transition={{ duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }}\r\n              className=\"space-y-6\"\r\n            >\r\n              {/* Premium Stats Cards */}\r\n              <motion.div\r\n                variants={staggerChildren}\r\n                initial=\"initial\"\r\n                animate=\"animate\"\r\n                className=\"grid grid-cols-2 gap-4\"\r\n              >\r\n                <MobileStatCard\r\n                  icon={Music}\r\n                  title=\"Total Tracks\"\r\n                  value={formatNumber(stats.totalTracks)}\r\n                  subtitle={`${formatNumber(stats.uniqueArtists)} unique artists`}\r\n                  color=\"purple\"\r\n                />\r\n                <MobileStatCard\r\n                  icon={Clock}\r\n                  title=\"Total Duration\"\r\n                  value={formatMinutes(stats.totalDuration)}\r\n                  color=\"blue\"\r\n                />\r\n                <MobileStatCard\r\n                  icon={Flame}\r\n                  title=\"Avg. Popularity\"\r\n                  value={formatNumber(Math.round(stats.avgPopularity))}\r\n                  subtitle=\"Out of 100\"\r\n                  color=\"red\"\r\n                />\r\n                <MobileStatCard\r\n                  icon={Award}\r\n                  title=\"Diversity Score\"\r\n                  value={formatPercent(advancedMetrics.diversityScore)}\r\n                  subtitle=\"Genre variety index\"\r\n                  color=\"green\"\r\n                />\r\n              </motion.div>\r\n\r\n              {/* Premium Quick Insights */}\r\n              <motion.div\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                transition={{ delay: 0.2 }}\r\n                className=\"bg-white/80 dark:bg-gray-800/80 rounded-xl p-4 border border-gray-200/50 dark:border-gray-700/50 shadow-lg backdrop-blur-sm\"\r\n              >\r\n                <h3 className=\"text-lg font-sf-pro-display font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                  <Sparkles className=\"text-purple-500\" size={20} />\r\n                  Quick Insights\r\n                </h3>\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Listening Time</span>\r\n                    <span className=\"text-sm font-medium text-gray-900 dark:text-white font-sf-pro-display\">\r\n                      {Math.round(stats.totalDuration / 3600000)}h {Math.round((stats.totalDuration % 3600000) / 60000)}m\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Top Genre</span>\r\n                    <span className=\"text-sm font-medium text-gray-900 dark:text-white font-sf-pro-display\">\r\n                      {stats.genres && stats.genres.length > 0 ? stats.genres[0].name : 'N/A'}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Avg. Tracks/Artist</span>\r\n                    <span className=\"text-sm font-medium text-gray-900 dark:text-white font-sf-pro-display\">\r\n                      {stats.uniqueArtists ? Math.round(stats.totalTracks / stats.uniqueArtists) : 'N/A'}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </motion.div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {activeView === 'genres' && (\r\n            <motion.div\r\n              key=\"genres\"\r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              exit={{ opacity: 0, x: 20 }}\r\n              transition={{ duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }}\r\n              className=\"space-y-4\"\r\n            >\r\n              <div className=\"bg-white/80 dark:bg-gray-800/80 rounded-xl p-4 border border-gray-200/50 dark:border-gray-700/50 shadow-lg backdrop-blur-sm\">\r\n                <h3 className=\"text-lg font-sf-pro-display font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                  <PieChart className=\"text-purple-500\" size={20} />\r\n                  Genre Distribution\r\n                </h3>\r\n                <div className=\"space-y-3\">\r\n                  {stats.genres.map((genre, index) => {\r\n                    const percentage = Math.round((genre.count / (stats.totalGenreMentions || stats.totalTracks)) * 100);\r\n                    return (\r\n                      <motion.div\r\n                        key={genre.name}\r\n                        initial={{ opacity: 0, x: -20 }}\r\n                        animate={{ opacity: 1, x: 0 }}\r\n                        transition={{ delay: index * 0.1 }}\r\n                        className=\"space-y-2\"\r\n                      >\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div \r\n                              className=\"w-3 h-3 rounded-full shadow-sm\"\r\n                              style={{ backgroundColor: genre.color }}\r\n                            />\r\n                            <span className=\"font-medium text-gray-900 dark:text-white\">{genre.name}</span>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-xs text-gray-500\">{genre.count} tracks</span>\r\n                            <span className=\"text-xs font-medium text-gray-900 dark:text-white\">{percentage}%</span>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                          <motion.div\r\n                            initial={{ width: 0 }}\r\n                            animate={{ width: `${percentage}%` }}\r\n                            transition={{ delay: index * 0.1 + 0.2, duration: 0.5 }}\r\n                            className=\"h-2 rounded-full shadow-sm\"\r\n                            style={{ backgroundColor: genre.color }}\r\n                          />\r\n                        </div>\r\n                      </motion.div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {activeView === 'artists' && (\r\n            <motion.div\r\n              key=\"artists\"\r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              exit={{ opacity: 0, x: 20 }}\r\n              transition={{ duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }}\r\n              className=\"space-y-4\"\r\n            >\r\n              <div className=\"bg-white/80 dark:bg-gray-800/80 rounded-xl p-4 border border-gray-200/50 dark:border-gray-700/50 shadow-lg backdrop-blur-sm\">\r\n                <h3 className=\"text-lg font-sf-pro-display font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                  <Users className=\"text-purple-500\" size={20} />\r\n                  Top Artists\r\n                </h3>\r\n                <div className=\"space-y-3\">\r\n                  {stats.topArtists.map((artist, i) => (\r\n                    <motion.div\r\n                      key={i}\r\n                      initial={{ opacity: 0, y: 20 }}\r\n                      animate={{ opacity: 1, y: 0 }}\r\n                      transition={{ delay: i * 0.1 }}\r\n                      className=\"flex items-center p-3 bg-gray-50/80 dark:bg-gray-700/50 rounded-xl backdrop-blur-sm\"\r\n                    >\r\n                      <div className=\"relative w-12 h-12 rounded-full overflow-hidden border-2 border-white/20 shadow-md\">\r\n                        {artist.image ? (\r\n                          <img \r\n                            src={artist.image} \r\n                            alt={artist.name}\r\n                            className=\"w-full h-full object-cover\"\r\n                            loading=\"lazy\"\r\n                          />\r\n                        ) : (\r\n                          <div className=\"w-full h-full bg-gradient-to-br from-purple-500/10 to-pink-500/10 flex items-center justify-center\">\r\n                            <span className=\"text-lg font-bold text-purple-500/70 font-sf-pro-display\">{artist.name.charAt(0).toUpperCase()}</span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"flex-1 ml-3\">\r\n                        <h4 className=\"font-medium text-gray-900 dark:text-white\">{artist.name}</h4>\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">{artist.count} tracks</p>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {Math.round((artist.count / stats.totalTracks) * 100)}%\r\n                        </div>\r\n                      </div>\r\n                    </motion.div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {activeView === 'trends' && (\r\n            <motion.div\r\n              key=\"trends\"\r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              exit={{ opacity: 0, x: 20 }}\r\n              transition={{ duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }}\r\n              className=\"space-y-4\"\r\n            >\r\n              <div className=\"bg-white/80 dark:bg-gray-800/80 rounded-xl p-4 border border-gray-200/50 dark:border-gray-700/50 shadow-lg backdrop-blur-sm\">\r\n                <h3 className=\"text-lg font-sf-pro-display font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                  <TrendingUp className=\"text-green-500\" size={20} />\r\n                  Listening Trends\r\n                </h3>\r\n                \r\n                <div className=\"space-y-4\">\r\n                  {/* Popularity Distribution */}\r\n                  <div className=\"space-y-3\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Popularity Distribution</h4>\r\n                    <div className=\"grid grid-cols-3 gap-2\">\r\n                      {[\r\n                        { label: 'High', range: '80-100', count: Math.round(stats.avgPopularity * 0.3) },\r\n                        { label: 'Medium', range: '40-79', count: Math.round(stats.avgPopularity * 0.5) },\r\n                        { label: 'Low', range: '0-39', count: Math.round(stats.avgPopularity * 0.2) }\r\n                      ].map((item, i) => (\r\n                        <div key={item.label} className=\"text-center p-3 bg-gray-50/80 dark:bg-gray-700/50 rounded-lg\">\r\n                          <div className=\"text-lg font-bold text-gray-900 dark:text-white\">{item.count}</div>\r\n                          <div className=\"text-xs text-gray-500 dark:text-gray-400\">{item.label}</div>\r\n                          <div className=\"text-xs text-gray-400 dark:text-gray-500\">{item.range}</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Release Year Trends */}\r\n                  {stats.releaseYears && Object.keys(stats.releaseYears).length > 0 && (\r\n                    <div className=\"space-y-3\">\r\n                      <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Release Year Trends</h4>\r\n                      <div className=\"space-y-2\">\r\n                        {Object.entries(stats.releaseYears)\r\n                          .sort(([a], [b]) => parseInt(b) - parseInt(a))\r\n                          .slice(0, 5)\r\n                          .map(([year, count], i) => (\r\n                            <div key={year} className=\"flex items-center justify-between p-2 bg-gray-50/80 dark:bg-gray-700/50 rounded-lg\">\r\n                              <span className=\"text-sm font-medium text-gray-900 dark:text-white\">{year}</span>\r\n                              <span className=\"text-sm text-gray-500 dark:text-gray-400\">{count} tracks</span>\r\n                            </div>\r\n                          ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {activeView === 'musicTaste' && (\r\n            <motion.div\r\n              key=\"musicTaste\"\r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              exit={{ opacity: 0, x: 20 }}\r\n              transition={{ duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }}\r\n              className=\"space-y-4\"\r\n            >\r\n              <div className=\"bg-white/80 dark:bg-gray-800/80 rounded-xl p-4 border border-gray-200/50 dark:border-gray-700/50 shadow-lg backdrop-blur-sm\">\r\n                <h3 className=\"text-lg font-sf-pro-display font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                  <Heart className=\"text-red-500\" size={20} />\r\n                  Music Taste Analysis\r\n                </h3>\r\n                \r\n                <div className=\"space-y-4\">\r\n                  {/* Musical Identity */}\r\n                  <div className=\"space-y-3\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Your Musical Identity</h4>\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                      <div className=\"text-center p-3 bg-purple-50/80 dark:bg-purple-900/20 rounded-lg border border-purple-200/50 dark:border-purple-700/50\">\r\n                        <div className=\"text-lg font-bold text-purple-600 dark:text-purple-400\">{advancedMetrics.diversityScore}%</div>\r\n                        <div className=\"text-xs text-purple-500 dark:text-purple-300\">Diversity</div>\r\n                      </div>\r\n                      <div className=\"text-center p-3 bg-blue-50/80 dark:bg-blue-900/20 rounded-lg border border-blue-200/50 dark:border-blue-700/50\">\r\n                        <div className=\"text-lg font-bold text-blue-600 dark:text-blue-400\">{advancedMetrics.avgTracksPerArtist}</div>\r\n                        <div className=\"text-xs text-blue-500 dark:text-blue-300\">Tracks/Artist</div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Listening Patterns */}\r\n                  <div className=\"space-y-3\">\r\n                    <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Listening Patterns</h4>\r\n                    <div className=\"space-y-2\">\r\n                      <div className=\"flex items-center justify-between p-2 bg-gray-50/80 dark:bg-gray-700/50 rounded-lg\">\r\n                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">Total Listening Time</span>\r\n                        <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {Math.round(stats.totalDuration / 3600000)}h {Math.round((stats.totalDuration % 3600000) / 60000)}m\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"flex items-center justify-between p-2 bg-gray-50/80 dark:bg-gray-700/50 rounded-lg\">\r\n                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">Average Track Length</span>\r\n                        <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {Math.round(stats.totalDuration / stats.totalTracks / 60000)}m\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n","import React, { useRef, useState, useEffect, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { cn } from '../../lib/utils';\nimport { GlowButton } from './GlowButton';\nimport { useTheme } from '../../lib/ThemeContext';\n\n// Icon components - Move these before platformConfigs!\nfunction SpotifyIcon({ className }: { className?: string }) {\n  return (\n    <img\n      src=\"/images/Spotify_Primary_Logo_RGB_Green.png\"\n      alt=\"Spotify\"\n      className={className}\n      style={{ height: 24, width: 'auto', objectFit: 'contain', display: 'block' }}\n    />\n  );\n}\n\nfunction YouTubeIcon({ className }: { className?: string }) {\n  return (\n    <svg viewBox=\"0 0 24 24\" className={className} fill=\"currentColor\">\n      <path d=\"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z\"/>\n    </svg>\n  );\n}\n\n// Enhanced types with better organization\ninterface AccountDetails {\n    username: string;\n    email: string;\n    profilePicture?: string;\n    plan?: string;\n    since?: string;\n    isVerified?: boolean;\n    // Enhanced Spotify-specific fields\n    country?: string;\n    followers?: number;\n    product?: string; // Changed from strict union type to string for flexibility\n    explicitContent?: boolean;\n    totalTracks?: number;\n    lastActive?: string;\n    // Additional Spotify account information\n    subscription?: string;\n    accountCountry?: string;\n    explicitContentFilter?: string;\n    displayName?: string;\n    publicPlaylists?: number;\n    privatePlaylists?: number;\n    collaborativePlaylists?: number;\n    followedPlaylists?: number;\n    recentlyPlayed?: string;\n    topGenres?: string[];\n    listeningTime?: string;\n    favoriteArtists?: number;\n    savedAlbums?: number;\n    savedTracks?: number;\n    monthlyListeners?: number;\n    accountType?: string;\n    familyPlanMembers?: number | null;\n    studentVerification?: boolean;\n    deviceLimit?: number;\n    offlineDownloads?: string;\n    audioQuality?: string;\n    crossfade?: string;\n    equalizer?: string;\n    socialFeatures?: string;\n    dataSaver?: boolean;\n    privateSession?: boolean;\n    lastSync?: string;\n    nextBilling?: string;\n    paymentMethod?: string;\n    autoRenew?: boolean;\n    // Enhanced YouTube-specific fields\n    channelId?: string;\n    subscriberCount?: number;\n    totalVideos?: number;\n    totalPlaylists?: number;\n    totalViews?: number;\n    channelType?: string; // Changed from strict union type to string for flexibility\n    monetizationStatus?: string; // Changed from strict union type to string for flexibility\n    verificationStatus?: string; // Changed from strict union type to string for flexibility\n    contentRating?: string; // Changed from strict union type to string for flexibility\n    language?: string;\n    location?: string;\n    joinDate?: string;\n    lastUploadDate?: string;\n    averageViews?: number;\n    topCategories?: string[];\n    collaborationStatus?: boolean;\n    liveStreamingEnabled?: boolean;\n    communityTabEnabled?: boolean;\n    membershipsEnabled?: boolean;\n    superChatEnabled?: boolean;\n    channelMembershipLevel?: string; // Changed from strict union type to string for flexibility\n}\n\ninterface UsageStats {\n    playlists?: number;\n    tracks?: number;\n    lastSynced?: string;\n  storage?: string;\n  playbackHours?: number;\n}\n\ninterface PlatformCardBackProps {\n  onBack: () => void;\n  platform: 'spotify' | 'youtube';\n  accountDetails: AccountDetails;\n  permissions: string[];\n  usage?: UsageStats;\n  onDisconnect?: () => void;\n  cardStyles?: React.CSSProperties;\n  isLoading?: boolean;\n  error?: string | null;\n  isFlipped: boolean;\n}\n\ntype TabId = 'overview' | 'permissions' | 'usage' | 'settings';\n\n// Settings interface\ninterface Settings {\n  autoSync: boolean;\n  backgroundSync: boolean;\n  syncFavorites: boolean;\n  shareListeningData: boolean;\n  analyticsCollection: boolean;\n  thirdPartySharing: boolean;\n  realTimeSync: boolean;\n  offlineSync: boolean;\n  crossPlatformSync: boolean;\n}\n\n// Platform configuration with enhanced visual settings\nconst platformConfigs = {\n    spotify: {\n      name: 'Spotify',\n    icon: SpotifyIcon,\n    colors: {\n      primary: 'var(--spotify-base-color-hsl)',\n      secondary: 'var(--spotify-base-color-hsl)',\n      background: 'bg-gradient-to-br from-spotify/20 to-surface-alt/10',\n      text: 'text-spotify',\n      border: 'border-spotify/50',\n      hover: 'hover:bg-spotify/10',\n      tabActiveBg: 'bg-spotify/20',\n      tabText: 'text-spotify',\n      buttonVariant: 'spotify' as const,\n    },\n    features: ['Stream Music', 'Create Playlists', 'Share Tracks', 'Offline Download']\n    },\n    youtube: {\n    name: 'YouTube',\n    icon: YouTubeIcon,\n    colors: {\n      primary: 'var(--youtube-base-color-hsl)',\n      secondary: 'var(--youtube-base-color-hsl)',\n      background: 'bg-gradient-to-br from-youtube/20 to-surface-alt/10',\n      text: 'text-youtube',\n      border: 'border-youtube/50',\n      hover: 'hover:bg-youtube/10',\n      tabActiveBg: 'bg-youtube/20',\n      tabText: 'text-youtube',\n      buttonVariant: 'youtube' as const,\n    },\n    features: [\n      'Upload & Manage Videos',\n      'Create & Edit Playlists', \n      'Live Streaming',\n      'Community Features',\n      'Comments & Ratings',\n      'Channel Analytics',\n      'Monetization Tools',\n      'Collaboration Features',\n      'Content Moderation',\n      'Multi-Language Support',\n      'Advanced Privacy Controls',\n      'Cross-Platform Sync'\n    ],\n    permissions: {\n      basic: [\n        'View your YouTube account',\n        'View your videos and playlists',\n        'View your YouTube activity'\n      ],\n      advanced: [\n        'Manage your YouTube account',\n        'View and manage your videos and playlists',\n        'View and manage your YouTube activity',\n        'Post, edit or delete your comments and captions',\n        'Rate videos and manage ratings',\n        'See, edit and permanently delete your YouTube videos',\n        'Manage your channel settings and preferences'\n      ],\n      personal: [\n        'See your personal info',\n        'See your full name and profile picture',\n        'See your primary Google Account email address',\n        'Associate you with your personal info on Google'\n      ]\n    },\n    capabilities: {\n      content: [\n        'Upload videos up to 12 hours long',\n        'Create unlimited playlists',\n        'Edit video metadata and descriptions',\n        'Add custom thumbnails and end screens',\n        'Schedule video releases',\n        'Set video privacy settings',\n        'Add captions and translations'\n      ],\n      community: [\n        'Respond to comments',\n        'Moderate community posts',\n        'Create community posts',\n        'Host live streams',\n        'Enable super chat and memberships',\n        'Collaborate with other creators'\n      ],\n      analytics: [\n        'View detailed analytics',\n        'Track video performance',\n        'Monitor audience engagement',\n        'Analyze viewer demographics',\n        'Track revenue and monetization'\n      ],\n      monetization: [\n        'Enable channel monetization',\n        'Set up ad revenue sharing',\n        'Create channel memberships',\n        'Enable super chat and super thanks',\n        'Sell merchandise through YouTube'\n      ]\n    }\n  }\n};\n\n// Tab icon components\nconst tabIcons = {\n  overview: (\n    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n    </svg>\n  ),\n  permissions: (\n    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\" />\n    </svg>\n  ),\n  usage: (\n    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\n    </svg>\n  ),\n  settings: (\n    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n    </svg>\n  )\n};\n\n// Enhanced confirmation dialog with better UX\nconst ConfirmationDialog: React.FC<{\n  isOpen: boolean; \n  onClose: () => void; \n  onConfirm: () => void;\n  platform: 'spotify' | 'youtube';\n}> = ({ isOpen, onClose, onConfirm, platform }) => {\n  const config = platformConfigs[platform];\n  const Icon = config.icon;\n  const { isDark } = useTheme();\n  \n  useEffect(() => {\n    if (isOpen) {\n      // Trap focus in dialog\n      const handleKeyDown = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n          onClose();\n        }\n      };\n      document.addEventListener('keydown', handleKeyDown);\n      return () => document.removeEventListener('keydown', handleKeyDown);\n    }\n  }, [isOpen, onClose]);\n  \n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n        <motion.div \n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            aria-hidden=\"true\"\n          />\n          \n          {/* Dialog */}\n          <motion.div\n            className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n          >\n            <div\n              className={cn(\n                \"rounded-2xl shadow-2xl max-w-md w-full p-6\",\n                isDark ? \"bg-bg-secondary\" : \"bg-surface-card\"\n              )}\n              role=\"dialog\"\n              aria-modal=\"true\"\n              aria-labelledby=\"dialog-title\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              {/* Icon */}\n              <div className={cn(\n                \"w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4\",\n                \"border-2\",\n                config.colors.border,\n                config.colors.background\n              )}>\n                <Icon className={cn(\"w-8 h-8\", config.colors.text)} />\n            </div>\n            \n              {/* Content */}\n              <h3 id=\"dialog-title\" className={cn(\"text-xl font-bold text-center mb-2\", isDark ? \"text-content-primary\" : \"text-content-primary\")}>\n                Disconnect {config.name}?\n              </h3>\n              <p className={cn(\"text-center mb-6\", isDark ? \"text-content-secondary\" : \"text-content-secondary\")}>\n                This will remove access to your {config.name} account and delete all synced data. You can reconnect anytime.\n              </p>\n              \n              {/* Actions */}\n              <div className=\"flex gap-3\">\n                <GlowButton\n                  variant=\"secondary\"\n                  onClick={onClose}\n                  className=\"flex-1\"\n                  aria-label=\"Cancel Disconnect\"\n                >\n                  Cancel\n                </GlowButton>\n                <GlowButton\n                  variant=\"soundswapp\"\n                  onClick={() => {\n                    onConfirm();\n                    onClose();\n                  }}\n                  className=\"flex-1\"\n                  aria-label={`Confirm Disconnect from ${config.name}`}\n                >\n                  Disconnect\n                </GlowButton>\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\n// Loading skeleton component\nconst LoadingSkeleton: React.FC = () => {\n  const { isDark } = useTheme();\n  return (\n    <div className=\"animate-pulse space-y-4\">\n      <div className=\"flex items-center space-x-4\">\n        <div className={cn(\"w-16 h-16 rounded-full\", isDark ? \"bg-surface-alt\" : \"bg-surface-alt\")} />\n        <div className=\"flex-1 space-y-2\">\n          <div className={cn(\"h-4 rounded w-3/4\", isDark ? \"bg-surface-alt\" : \"bg-surface-alt\")} />\n          <div className={cn(\"h-3 rounded w-1/2\", isDark ? \"bg-surface-alt\" : \"bg-surface-alt\")} />\n        </div>\n      </div>\n      <div className=\"space-y-2\">\n        <div className={cn(\"h-3 rounded\", isDark ? \"bg-surface-alt\" : \"bg-surface-alt\")} />\n        <div className={cn(\"h-3 rounded w-5/6\", isDark ? \"bg-surface-alt\" : \"bg-surface-alt\")} />\n      </div>\n    </div>\n  );\n};\n\n// Error state component\nconst ErrorState: React.FC<{ message: string; onRetry?: () => void }> = ({ message, onRetry }) => {\n  const { isDark } = useTheme();\n  return (\n    <div className=\"flex flex-col items-center justify-center h-full text-center p-6\">\n      <div className={cn(\"w-16 h-16 rounded-full flex items-center justify-center mb-4\", isDark ? \"bg-state-error/20\" : \"bg-state-error/10\")}>\n        <svg className={cn(\"w-8 h-8\", \"text-state-error\")} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n        </svg>\n      </div>\n      <p className={cn(\"mb-4\", isDark ? \"text-content-secondary\" : \"text-content-secondary\")}>{message}</p>\n      {onRetry && (\n        <GlowButton\n          variant=\"primary\"\n          onClick={onRetry}\n          aria-label=\"Try Again\"\n        >\n          Try Again\n        </GlowButton>\n      )}\n    </div>\n  );\n};\n\n// Settings Modal Component\nconst SettingsModal: React.FC<{\n  isOpen: boolean;\n  onClose: () => void;\n  platform: 'spotify' | 'youtube';\n  settings: Settings;\n  onSettingChange: (key: keyof Settings) => void;\n}> = ({ isOpen, onClose, platform, settings, onSettingChange }) => {\n  const { isDark } = useTheme();\n  const config = platformConfigs[platform];\n  \n  useEffect(() => {\n    if (isOpen) {\n      const handleKeyDown = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n          onClose();\n        }\n      };\n      document.addEventListener('keydown', handleKeyDown);\n      return () => document.removeEventListener('keydown', handleKeyDown);\n    }\n  }, [isOpen, onClose]);\n  \n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div \n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            aria-hidden=\"true\"\n          />\n          \n          {/* Modal */}\n          <motion.div\n            className=\"fixed inset-0 z-50 flex items-center justify-center p-2\"\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n          >\n            <div\n              className={cn(\n                \"rounded-2xl shadow-2xl w-full h-full max-w-6xl max-h-[98vh] overflow-y-auto\",\n                isDark ? \"bg-gray-800\" : \"bg-white\"\n              )}\n              role=\"dialog\"\n              aria-modal=\"true\"\n              aria-labelledby=\"settings-modal-title\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              {/* Header */}\n              <div className={cn(\n                \"flex items-center justify-between p-6 border-b\",\n                isDark ? \"border-gray-700\" : \"border-gray-200\"\n              )}>\n                <div className=\"flex items-center gap-3\">\n                  <div className={cn(\n                    \"w-10 h-10 rounded-lg flex items-center justify-center\",\n                    config.colors.background\n                  )}>\n                    <svg className={cn(\"w-5 h-5\", config.colors.text)} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n                    </svg>\n                  </div>\n                  <div>\n                    <h2 id=\"settings-modal-title\" className={cn(\"text-xl font-semibold\", isDark ? \"text-white\" : \"text-gray-900\")}>\n                      {config.name} Settings\n                    </h2>\n                    <p className={cn(\"text-sm\", isDark ? \"text-gray-400\" : \"text-gray-600\")}>\n                      Configure your connection preferences\n                    </p>\n                  </div>\n                </div>\n                <button \n                  onClick={onClose}\n                  className={cn(\n                    \"p-2 rounded-full transition-colors\",\n                    isDark ? \"hover:bg-gray-700\" : \"hover:bg-gray-100\"\n                  )}\n                  aria-label=\"Close settings\"\n                >\n                  <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n\n              {/* Content */}\n              <div className=\"p-6 space-y-6\">\n                {/* Settings Summary */}\n                <div className={cn(\n                  \"p-4 rounded-lg border\",\n                  isDark ? \"bg-blue-900/20 border-blue-800/50\" : \"bg-blue-50 border-blue-100\"\n                )}>\n                  <div className=\"flex items-center gap-2 mb-3\">\n                    <svg className=\"w-4 h-4 text-blue-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                    </svg>\n                    <h3 className={cn(\"text-sm font-medium\", isDark ? \"text-blue-300\" : \"text-blue-700\")}>\n                      Quick Overview\n                    </h3>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-3 text-xs\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className={`w-2 h-2 rounded-full ${settings.autoSync ? 'bg-green-400' : 'bg-gray-400'}`}></div>\n                      <span className={cn(isDark ? \"text-blue-300\" : \"text-blue-600\")}>\n                        Auto-sync: {settings.autoSync ? 'ON' : 'OFF'}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className={`w-2 h-2 rounded-full ${settings.realTimeSync ? 'bg-green-400' : 'bg-gray-400'}`}></div>\n                      <span className={cn(isDark ? \"text-blue-300\" : \"text-blue-600\")}>\n                        Real-time: {settings.realTimeSync ? 'ON' : 'OFF'}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className={`w-2 h-2 rounded-full ${settings.analyticsCollection ? 'bg-green-400' : 'bg-gray-400'}`}></div>\n                      <span className={cn(isDark ? \"text-blue-300\" : \"text-blue-600\")}>\n                        Analytics: {settings.analyticsCollection ? 'ON' : 'OFF'}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className={`w-2 h-2 rounded-full ${settings.crossPlatformSync ? 'bg-green-400' : 'bg-gray-400'}`}></div>\n                      <span className={cn(isDark ? \"text-blue-300\" : \"text-blue-600\")}>\n                        Cross-platform: {settings.crossPlatformSync ? 'ON' : 'OFF'}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Account Settings */}\n                <div className={cn(\n                  \"p-4 rounded-lg border\",\n                  isDark ? \"bg-gray-800/50 border-gray-700\" : \"bg-gray-50 border-gray-200\"\n                )}>\n                  <h3 className={cn(\"font-medium mb-3 flex items-center gap-2\", isDark ? \"text-white\" : \"text-gray-900\")}>\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\n                    </svg>\n                    Account Settings\n                  </h3>\n                  <p className={cn(\"text-sm mb-4\", isDark ? \"text-gray-400\" : \"text-gray-600\")}>\n                    Configure how your {config.name} account interacts with SoundSwapp.\n                  </p>\n                  <div className=\"space-y-3\">\n                    {[\n                      { key: 'autoSync', label: 'Auto-sync playlists', color: 'bg-green-400', description: 'Automatically sync your playlists when changes are detected' },\n                      { key: 'backgroundSync', label: 'Background sync', color: 'bg-blue-400', description: 'Sync data in the background without interrupting your experience' },\n                      { key: 'syncFavorites', label: 'Sync favorites', color: 'bg-purple-400', description: 'Keep your favorite tracks synchronized across platforms' }\n                    ].map((setting) => (\n                      <div key={setting.key} className=\"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-700\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-3 mb-1\">\n                            <div className={`w-2 h-2 rounded-full ${setting.color}`}></div>\n                            <span className={cn(\"text-sm font-medium\", isDark ? \"text-white\" : \"text-gray-900\")}>\n                              {setting.label}\n                            </span>\n                            <span className={cn(\"text-xs\", isDark ? \"text-gray-500\" : \"text-gray-500\")}>\n                              ({settings[setting.key as keyof Settings] ? 'ON' : 'OFF'})\n                            </span>\n                          </div>\n                          <p className={cn(\"text-xs\", isDark ? \"text-gray-400\" : \"text-gray-600\")}>\n                            {setting.description}\n                          </p>\n                        </div>\n                        <label className=\"relative inline-flex items-center cursor-pointer\">\n                          <input \n                            type=\"checkbox\" \n                            className=\"sr-only peer\" \n                            checked={settings[setting.key as keyof Settings]}\n                            onChange={() => onSettingChange(setting.key as keyof Settings)}\n                            data-setting={setting.key}\n                          />\n                          <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                        </label>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Privacy Settings */}\n                <div className={cn(\n                  \"p-4 rounded-lg border\",\n                  isDark ? \"bg-gray-800/50 border-gray-700\" : \"bg-gray-50 border-gray-200\"\n                )}>\n                  <h3 className={cn(\"font-medium mb-3 flex items-center gap-2\", isDark ? \"text-white\" : \"text-gray-900\")}>\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\n                    </svg>\n                    Privacy Settings\n                  </h3>\n                  <p className={cn(\"text-sm mb-4\", isDark ? \"text-gray-400\" : \"text-gray-600\")}>\n                    Manage data sharing preferences\n                  </p>\n                  <div className=\"space-y-3\">\n                    {[\n                      { key: 'shareListeningData', label: 'Share listening data', color: 'bg-yellow-400', description: 'Allow sharing of your listening habits for better recommendations' },\n                      { key: 'analyticsCollection', label: 'Analytics collection', color: 'bg-orange-400', description: 'Help improve SoundSwapp by sharing anonymous usage data' },\n                      { key: 'thirdPartySharing', label: 'Third-party sharing', color: 'bg-red-400', description: 'Allow data sharing with trusted third-party services' }\n                    ].map((setting) => (\n                      <div key={setting.key} className=\"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-700\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-3 mb-1\">\n                            <div className={`w-2 h-2 rounded-full ${setting.color}`}></div>\n                            <span className={cn(\"text-sm font-medium\", isDark ? \"text-white\" : \"text-gray-900\")}>\n                              {setting.label}\n                            </span>\n                            <span className={cn(\"text-xs\", isDark ? \"text-gray-500\" : \"text-gray-500\")}>\n                              ({settings[setting.key as keyof Settings] ? 'ON' : 'OFF'})\n                            </span>\n                          </div>\n                          <p className={cn(\"text-xs\", isDark ? \"text-gray-400\" : \"text-gray-600\")}>\n                            {setting.description}\n                          </p>\n                        </div>\n                        <label className=\"relative inline-flex items-center cursor-pointer\">\n                          <input \n                            type=\"checkbox\" \n                            className=\"sr-only peer\" \n                            checked={settings[setting.key as keyof Settings]}\n                            onChange={() => onSettingChange(setting.key as keyof Settings)}\n                            data-setting={setting.key}\n                          />\n                          <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                        </label>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Sync Settings */}\n                <div className={cn(\n                  \"p-4 rounded-lg border\",\n                  isDark ? \"bg-gray-800/50 border-gray-700\" : \"bg-gray-50 border-gray-200\"\n                )}>\n                  <h3 className={cn(\"font-medium mb-3 flex items-center gap-2\", isDark ? \"text-white\" : \"text-gray-900\")}>\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                    </svg>\n                    Sync Settings\n                  </h3>\n                  <p className={cn(\"text-sm mb-4\", isDark ? \"text-gray-400\" : \"text-gray-600\")}>\n                    Configure automatic sync options\n                  </p>\n                  <div className=\"space-y-3\">\n                    {[\n                      { key: 'realTimeSync', label: 'Real-time sync', color: 'bg-indigo-400', description: 'Sync changes immediately as they happen' },\n                      { key: 'offlineSync', label: 'Offline sync', color: 'bg-teal-400', description: 'Queue sync operations when offline' },\n                      { key: 'crossPlatformSync', label: 'Cross-platform sync', color: 'bg-pink-400', description: 'Keep data synchronized across all your devices' }\n                    ].map((setting) => (\n                      <div key={setting.key} className=\"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-700\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-3 mb-1\">\n                            <div className={`w-2 h-2 rounded-full ${setting.color}`}></div>\n                            <span className={cn(\"text-sm font-medium\", isDark ? \"text-white\" : \"text-gray-900\")}>\n                              {setting.label}\n                            </span>\n                            <span className={cn(\"text-xs\", isDark ? \"text-gray-500\" : \"text-gray-500\")}>\n                              ({settings[setting.key as keyof Settings] ? 'ON' : 'OFF'})\n                            </span>\n                          </div>\n                          <p className={cn(\"text-xs\", isDark ? \"text-gray-400\" : \"text-gray-600\")}>\n                            {setting.description}\n                          </p>\n                        </div>\n                        <label className=\"relative inline-flex items-center cursor-pointer\">\n                          <input \n                            type=\"checkbox\" \n                            className=\"sr-only peer\" \n                            checked={settings[setting.key as keyof Settings]}\n                            onChange={() => onSettingChange(setting.key as keyof Settings)}\n                            data-setting={setting.key}\n                          />\n                          <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                        </label>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n\n              {/* Footer */}\n              <div className={cn(\n                \"flex gap-3 p-6 border-t\",\n                isDark ? \"border-gray-700\" : \"border-gray-200\"\n              )}>\n                <GlowButton\n                  variant=\"secondary\"\n                  onClick={onClose}\n                  className=\"flex-1\"\n                >\n                  Close\n                </GlowButton>\n                <GlowButton\n                  variant=\"soundswapp\"\n                  onClick={() => {\n                    // Reset to defaults\n                    const defaultSettings = {\n                      autoSync: true,\n                      backgroundSync: false,\n                      syncFavorites: true,\n                      shareListeningData: false,\n                      analyticsCollection: true,\n                      thirdPartySharing: false,\n                      realTimeSync: true,\n                      offlineSync: false,\n                      crossPlatformSync: true\n                    };\n                    Object.keys(defaultSettings).forEach(key => {\n                      onSettingChange(key as keyof Settings);\n                    });\n                  }}\n                  className=\"flex-1\"\n                >\n                  Reset to Defaults\n                </GlowButton>\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\n// Main component\nexport const PlatformCardBack = React.forwardRef<HTMLDivElement, PlatformCardBackProps>(\n  ({ onBack, platform, accountDetails, permissions, usage, onDisconnect, cardStyles = {}, isLoading = false, error, isFlipped }, ref) => {\n    const { isDark } = useTheme();\n    const config = platformConfigs[platform];\n    const IconComponent = config.icon;\n    \n    console.log('[PlatformCardBack] Starting render', { platform, isLoading, error });\n    \n    const [activeTab, setActiveTab] = useState<TabId>('overview');\n    const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n    const [showSettingsModal, setShowSettingsModal] = useState(false);\n    const [settings, setSettings] = useState<Settings>({\n      autoSync: true,\n      backgroundSync: false,\n      syncFavorites: true,\n      shareListeningData: false,\n      analyticsCollection: true,\n      thirdPartySharing: false,\n      realTimeSync: true,\n      offlineSync: false,\n      crossPlatformSync: true\n    });\n\n    // Load saved settings from localStorage\n    useEffect(() => {\n      const savedSettings = localStorage.getItem(`${platform}_settings`);\n      if (savedSettings) {\n        try {\n          const parsedSettings = JSON.parse(savedSettings);\n          setSettings(prev => ({ ...prev, ...parsedSettings }));\n          console.log(`[DEBUG] Loaded ${platform} settings:`, parsedSettings);\n        } catch (error) {\n          console.error('Error loading saved settings:', error);\n        }\n      } else {\n        console.log(`[DEBUG] No saved settings found for ${platform}, using defaults`);\n      }\n    }, [platform]);\n\n    const handleSettingChange = (key: keyof Settings) => {\n      const newSettings = {\n        ...settings,\n        [key]: !settings[key]\n      };\n      \n      setSettings(newSettings);\n      \n      // Show feedback for setting changes\n      const settingName = String(key).replace(/([A-Z])/g, ' $1').replace(/^./, (str: string) => str.toUpperCase());\n      console.log(`${settingName} ${!settings[key] ? 'enabled' : 'disabled'}`);\n      \n      // Save settings to localStorage\n      localStorage.setItem(`${platform}_settings`, JSON.stringify(newSettings));\n      \n      // Add visual feedback\n      const toggleElement = document.querySelector(`[data-setting=\"${key}\"]`);\n      if (toggleElement) {\n        toggleElement.classList.add('scale-110');\n        setTimeout(() => {\n          toggleElement.classList.remove('scale-110');\n        }, 150);\n      }\n    };\n    \n    // Try/catch to identify potential errors with platformConfigs\n    try {\n      console.log('[PlatformCardBack] Config resolved:', platform, config?.name);\n      \n      // Keyboard navigation\n      useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n          if (e.key === 'Tab') {\n            // Let default tab behavior work\n            return;\n          }\n          if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {\n            const tabs: TabId[] = ['overview', 'permissions', 'usage', 'settings'];\n            const currentIndex = tabs.indexOf(activeTab);\n            let newIndex = currentIndex;\n            \n            if (e.key === 'ArrowLeft') {\n              newIndex = currentIndex > 0 ? currentIndex - 1 : tabs.length - 1;\n            } else {\n              newIndex = currentIndex < tabs.length - 1 ? currentIndex + 1 : 0;\n            }\n            \n            // Skip usage tab if no usage data\n            if (tabs[newIndex] === 'usage' && !usage) {\n              newIndex = e.key === 'ArrowLeft' ? newIndex - 1 : newIndex + 1;\n              if (newIndex < 0) newIndex = tabs.length - 1;\n              if (newIndex >= tabs.length) newIndex = 0;\n            }\n            \n            setActiveTab(tabs[newIndex]);\n            e.preventDefault();\n          }\n        };\n        \n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener('keydown', handleKeyDown);\n      }, [activeTab, usage]);\n      \n      // Tab content renderer\n      const renderTabContent = () => {\n        console.log('[PlatformCardBack] Rendering tab content:', activeTab);\n        \n        if (isLoading) {\n          console.log('[PlatformCardBack] Rendering loading state');\n          return <LoadingSkeleton />;\n        }\n        \n        if (error) {\n          console.log('[PlatformCardBack] Rendering error state:', error);\n          return <ErrorState message={error} onRetry={() => console.log(\"Retry logic not implemented yet\")} />;\n        }\n        \n        switch (activeTab) {\n          case 'overview':\n            // Get the specific platform name for button text, e.g., \"Spotify\" or \"YouTube\"\n            const platformName = config.name.replace(' Music', ''); // Removes \" Music\" if present for YouTube Music\n\n            return (\n                <motion.div \n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.3, ease: \"easeOut\" }}\n                className=\"p-1 md:p-2 space-y-4\" // Added space-y-4 for overall spacing\n              >\n                {/* Account Info Block */}\n                <div className=\"flex items-center space-x-4 p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 shadow\">\n                  {accountDetails.profilePicture ? (\n                    <img \n                      src={accountDetails.profilePicture} \n                      alt={`${accountDetails.username} profile`}\n                      className=\"w-14 h-14 rounded-md object-cover border border-gray-200 dark:border-gray-600\"\n                    />\n                  ) : (\n                    <div className=\"w-14 h-14 rounded-md bg-gray-200 dark:bg-gray-600 flex items-center justify-center border border-gray-300 dark:border-gray-500\">\n                      {/* Default User Icon from screenshot */}\n                      <svg className=\"w-8 h-8 text-gray-400 dark:text-gray-500\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"></path></svg>\n                    </div>\n                  )}\n                  <div className=\"flex-1\">\n                    <h3 className=\"text-lg font-semibold text-gray-800 dark:text-white\">{accountDetails.username}</h3>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate mb-1\">{accountDetails.email}</p>\n                    <div className=\"flex items-center space-x-3 mt-1\">\n                      {/* Enhanced subscription status */}\n                      <span \n                        className={cn(\n                          \"px-2.5 py-1 text-xs font-medium rounded shadow-sm cursor-default\",\n                          \"border\",\n                          platform === 'spotify' && accountDetails.product === 'premium' \n                            ? \"bg-green-100 border-green-300 text-green-700 dark:bg-green-900/30 dark:border-green-500 dark:text-green-300\"\n                            : platform === 'spotify' && accountDetails.product === 'free'\n                            ? \"bg-gray-100 border-gray-300 text-gray-700 dark:bg-gray-900/30 dark:border-gray-500 dark:text-gray-300\"\n                            : isDark ? `bg-${platform}-600/30 border-${platform}-500 text-${platform}-200` \n                                   : `bg-${platform}-100 border-${platform}-300 text-${platform}-700`,\n                        )}\n                      >\n                        {platform === 'spotify' && accountDetails.product \n                          ? `${accountDetails.product.charAt(0).toUpperCase() + accountDetails.product.slice(1)}`\n                          : accountDetails.plan || `Link ${platformName}`}\n                      </span>\n                      {accountDetails.since && (\n                        <span className=\"text-xs text-gray-400 dark:text-gray-500 flex items-center\">\n                          {/* Calendar Icon from screenshot */}\n                          <svg className=\"w-3.5 h-3.5 mr-1 text-gray-400 dark:text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z\" clipRule=\"evenodd\"></path></svg>\n                          Since {accountDetails.since}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Enhanced Spotify Account Details */}\n                {platform === 'spotify' && (\n                  <div className=\"p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 shadow\">\n                    <h4 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center\">\n                      <svg className=\"w-4 h-4 mr-1.5 text-gray-500 dark:text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                      </svg>\n                      Account Details\n                    </h4>\n                    <div className=\"grid grid-cols-2 gap-3 text-xs\">\n                      {accountDetails.country && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-.8-.4L2.2 8.4A1 1 0 012 7.6V6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Country: {accountDetails.country}\n                        </div>\n                      )}\n                      {accountDetails.followers && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\n                          </svg>\n                          Followers: {accountDetails.followers.toLocaleString()}\n                        </div>\n                      )}\n                      {accountDetails.totalTracks && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\" />\n                            <path fillRule=\"evenodd\" d=\"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v9a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Tracks: {accountDetails.totalTracks}\n                        </div>\n                      )}\n                      {accountDetails.publicPlaylists && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\" />\n                            <path fillRule=\"evenodd\" d=\"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v9a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Public Playlists: {accountDetails.publicPlaylists}\n                        </div>\n                      )}\n                      {accountDetails.privatePlaylists && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Private Playlists: {accountDetails.privatePlaylists}\n                        </div>\n                      )}\n                      {accountDetails.collaborativePlaylists && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\n                          </svg>\n                          Collaborative: {accountDetails.collaborativePlaylists}\n                        </div>\n                      )}\n                      {accountDetails.followedPlaylists && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                          </svg>\n                          Following: {accountDetails.followedPlaylists}\n                        </div>\n                      )}\n                      {accountDetails.savedTracks && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\n                          </svg>\n                          Saved Tracks: {accountDetails.savedTracks}\n                        </div>\n                      )}\n                      {accountDetails.savedAlbums && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M2 6a2 2 0 012-2h6l2 2h6a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z\" />\n                          </svg>\n                          Saved Albums: {accountDetails.savedAlbums}\n                        </div>\n                      )}\n                      {accountDetails.favoriteArtists && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\n                          </svg>\n                          Favorite Artists: {accountDetails.favoriteArtists}\n                        </div>\n                      )}\n                      {accountDetails.listeningTime && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Listening Time: {accountDetails.listeningTime}\n                        </div>\n                      )}\n                      {accountDetails.monthlyListeners && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\n                          </svg>\n                          Monthly Listeners: {accountDetails.monthlyListeners}\n                        </div>\n                      )}\n                      {accountDetails.explicitContentFilter && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-.8-.4L2.2 8.4A1 1 0 012 7.6V6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Content Filter: {accountDetails.explicitContentFilter}\n                        </div>\n                      )}\n                      {accountDetails.familyPlanMembers && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\n                          </svg>\n                          Family Members: {accountDetails.familyPlanMembers}\n                        </div>\n                      )}\n                      {accountDetails.deviceLimit && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Device Limit: {accountDetails.deviceLimit}\n                        </div>\n                      )}\n                      {accountDetails.audioQuality && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V5l8-1.6v6.114A4.369 4.369 0 0015 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z\" />\n                          </svg>\n                          Audio Quality: {accountDetails.audioQuality}\n                        </div>\n                      )}\n                      {accountDetails.lastActive && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Last Active: {accountDetails.lastActive}\n                        </div>\n                      )}\n                      {accountDetails.nextBilling && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Next Billing: {accountDetails.nextBilling}\n                        </div>\n                      )}\n                      {accountDetails.paymentMethod && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z\" />\n                          </svg>\n                          Payment: {accountDetails.paymentMethod}\n                        </div>\n                      )}\n                      {accountDetails.autoRenew !== undefined && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Auto Renew: {accountDetails.autoRenew ? 'Yes' : 'No'}\n                        </div>\n                      )}\n                      {accountDetails.studentVerification !== undefined && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                          </svg>\n                          Student Verified: {accountDetails.studentVerification ? 'Yes' : 'No'}\n                        </div>\n                      )}\n                      {accountDetails.dataSaver !== undefined && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Data Saver: {accountDetails.dataSaver ? 'On' : 'Off'}\n                        </div>\n                      )}\n                      {accountDetails.privateSession !== undefined && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Private Session: {accountDetails.privateSession ? 'Active' : 'Inactive'}\n                        </div>\n                      )}\n                      {accountDetails.lastSync && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Last Sync: {accountDetails.lastSync}\n                        </div>\n                      )}\n                      {accountDetails.offlineDownloads && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Offline Downloads: {accountDetails.offlineDownloads}\n                        </div>\n                      )}\n                      {accountDetails.crossfade && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V5l8-1.6v6.114A4.369 4.369 0 0015 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z\" />\n                          </svg>\n                          Crossfade: {accountDetails.crossfade}\n                        </div>\n                      )}\n                      {accountDetails.equalizer && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z\" />\n                          </svg>\n                          Equalizer: {accountDetails.equalizer}\n                        </div>\n                      )}\n                      {accountDetails.socialFeatures && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\n                          </svg>\n                          Social Features: {accountDetails.socialFeatures}\n                        </div>\n                      )}\n                      {accountDetails.recentlyPlayed && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Recently Played: {accountDetails.recentlyPlayed}\n                        </div>\n                      )}\n                      {accountDetails.topGenres && accountDetails.topGenres.length > 0 && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300 col-span-2\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\" />\n                            <path fillRule=\"evenodd\" d=\"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v9a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Top Genres: {accountDetails.topGenres.join(', ')}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n\n                {/* Enhanced YouTube Account Details */}\n                {platform === 'youtube' && (\n                  <div className=\"p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 shadow\">\n                    <h4 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center\">\n                      <svg className=\"w-4 h-4 mr-1.5 text-gray-500 dark:text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                      </svg>\n                      Channel Details\n                    </h4>\n                    <div className=\"grid grid-cols-2 gap-3 text-xs\">\n                      {accountDetails.subscriberCount && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\n                          </svg>\n                          Subscribers: {accountDetails.subscriberCount.toLocaleString()}\n                        </div>\n                      )}\n                      {accountDetails.totalVideos && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M2 6a2 2 0 012-2h6l2 2h6a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z\" />\n                          </svg>\n                          Videos: {accountDetails.totalVideos.toLocaleString()}\n                        </div>\n                      )}\n                      {accountDetails.totalViews && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M10 12a2 2 0 100-4 2 2 0 000 4z\" />\n                            <path fillRule=\"evenodd\" d=\"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Views: {accountDetails.totalViews.toLocaleString()}\n                        </div>\n                      )}\n                      {accountDetails.totalPlaylists && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\" />\n                            <path fillRule=\"evenodd\" d=\"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v9a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Playlists: {accountDetails.totalPlaylists}\n                        </div>\n                      )}\n                      {accountDetails.averageViews && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M10 12a2 2 0 100-4 2 2 0 000 4z\" />\n                            <path fillRule=\"evenodd\" d=\"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Avg Views: {accountDetails.averageViews.toLocaleString()}\n                        </div>\n                      )}\n                      {accountDetails.channelType && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Type: {accountDetails.channelType.charAt(0).toUpperCase() + accountDetails.channelType.slice(1)}\n                        </div>\n                      )}\n                      {accountDetails.verificationStatus && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Status: {accountDetails.verificationStatus.charAt(0).toUpperCase() + accountDetails.verificationStatus.slice(1)}\n                        </div>\n                      )}\n                      {accountDetails.monetizationStatus && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z\" />\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Monetization: {accountDetails.monetizationStatus.charAt(0).toUpperCase() + accountDetails.monetizationStatus.slice(1)}\n                        </div>\n                      )}\n                      {accountDetails.contentRating && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-.8-.4L2.2 8.4A1 1 0 012 7.6V6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Content Rating: {accountDetails.contentRating.charAt(0).toUpperCase() + accountDetails.contentRating.slice(1)}\n                        </div>\n                      )}\n                      {accountDetails.language && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 10-2 0v2a1 1 0 102 0v-2h4v2a1 1 0 102 0v-2h4v2a1 1 0 102 0v-2h-4v-2.07z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Language: {accountDetails.language.toUpperCase()}\n                        </div>\n                      )}\n                      {accountDetails.location && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Location: {accountDetails.location}\n                        </div>\n                      )}\n                      {accountDetails.joinDate && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Joined: {accountDetails.joinDate}\n                        </div>\n                      )}\n                      {accountDetails.lastUploadDate && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Last Upload: {accountDetails.lastUploadDate}\n                        </div>\n                      )}\n                      {accountDetails.collaborationStatus !== undefined && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\n                          </svg>\n                          Collaborations: {accountDetails.collaborationStatus ? 'Enabled' : 'Disabled'}\n                        </div>\n                      )}\n                      {accountDetails.liveStreamingEnabled !== undefined && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Live Streaming: {accountDetails.liveStreamingEnabled ? 'Enabled' : 'Disabled'}\n                        </div>\n                      )}\n                      {accountDetails.communityTabEnabled !== undefined && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\" />\n                          </svg>\n                          Community Tab: {accountDetails.communityTabEnabled ? 'Enabled' : 'Disabled'}\n                        </div>\n                      )}\n                      {accountDetails.membershipsEnabled !== undefined && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\n                          </svg>\n                          Memberships: {accountDetails.membershipsEnabled ? 'Enabled' : 'Disabled'}\n                        </div>\n                      )}\n                      {accountDetails.superChatEnabled !== undefined && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z\" />\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Super Chat: {accountDetails.superChatEnabled ? 'Enabled' : 'Disabled'}\n                        </div>\n                      )}\n                      {accountDetails.channelMembershipLevel && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\n                          </svg>\n                          Membership Level: {accountDetails.channelMembershipLevel.charAt(0).toUpperCase() + accountDetails.channelMembershipLevel.slice(1)}\n                        </div>\n                      )}\n                      {accountDetails.topCategories && accountDetails.topCategories.length > 0 && (\n                        <div className=\"flex items-center text-gray-600 dark:text-gray-300 col-span-2\">\n                          <svg className=\"w-3.5 h-3.5 mr-1.5 text-gray-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                            <path d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\" />\n                            <path fillRule=\"evenodd\" d=\"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v9a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Top Categories: {accountDetails.topCategories.join(', ')}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n\n                {/* Available Features Block */}\n                <div className=\"p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 shadow\">\n                  <h4 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center\">\n                    {/* Sparkles Icon from screenshot */}\n                    <svg className=\"w-4 h-4 mr-1.5 text-gray-500 dark:text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path d=\"M10 3.5a.75.75 0 01.75.75V6h1.75a.75.75 0 010 1.5H10.75V9.25a.75.75 0 01-1.5 0V7.5H7.5a.75.75 0 010-1.5H9.25V4.25A.75.75 0 0110 3.5zM3.5 10a.75.75 0 01.75-.75H6V7.5a.75.75 0 011.5 0V9.25H9.25a.75.75 0 010 1.5H7.5v1.75a.75.75 0 01-1.5 0V10.75H4.25a.75.75 0 01-.75-.75zM10 16.5a.75.75 0 01-.75-.75V14H7.5a.75.75 0 010-1.5h1.75v-1.75a.75.75 0 011.5 0v1.75h1.75a.75.75 0 010 1.5H10.75v1.75a.75.75 0 01-.75.75z\"></path></svg>\n                    Available Features\n                  </h4>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-x-3 gap-y-1.5\">\n                    {config.features.map((feature, index) => (\n                      <div key={index} className=\"flex items-center text-xs text-gray-600 dark:text-gray-300\">\n                        {/* Checkmark Icon from screenshot */}\n                        <svg className={cn(\"w-3.5 h-3.5 mr-1.5\", config.colors.text)} viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\"></path></svg>\n                        {feature}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Enhanced Spotify Permissions Summary */}\n                {platform === 'spotify' && (\n                  <div className=\"p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20 shadow border border-blue-100 dark:border-blue-800/50\">\n                    <h4 className=\"text-sm font-semibold text-blue-700 dark:text-blue-300 mb-2 flex items-center\">\n                      <svg className=\"w-4 h-4 mr-1.5 text-blue-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path fillRule=\"evenodd\" d=\"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                      </svg>\n                      Permissions & Capabilities\n                    </h4>\n                    <div className=\"space-y-2 text-xs\">\n                      <div className=\"flex items-center text-blue-600 dark:text-blue-400\">\n                        <svg className=\"w-3 h-3 mr-1.5 text-green-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                          <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                        </svg>\n                        Read & create playlists\n                      </div>\n                      <div className=\"flex items-center text-blue-600 dark:text-blue-400\">\n                        <svg className=\"w-3 h-3 mr-1.5 text-green-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                          <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                        </svg>\n                        Access profile & preferences\n                      </div>\n                      <div className=\"flex items-center text-blue-600 dark:text-blue-400\">\n                        <svg className=\"w-3 h-3 mr-1.5 text-green-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                          <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                        </svg>\n                        Cross-platform sync enabled\n                      </div>\n                      <div className=\"flex items-center text-blue-600 dark:text-blue-400\">\n                        <svg className=\"w-3 h-3 mr-1.5 text-green-500\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                          <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                        </svg>\n                        Real-time playlist updates\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </motion.div>\n            );\n            \n          case 'permissions':\n            return (\n              <motion.div\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.3, ease: \"easeOut\" }}\n                className=\"space-y-5\"\n              >\n                <div className=\"flex items-center gap-3 mb-2\">\n                  <svg className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\" />\n                  </svg>\n                  <h4 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                    Granted Permissions\n                  </h4>\n                </div>\n                \n                <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-3 italic\">\n                  These permissions allow SoundSwapp to interact with your {config.name} account.\n                </p>\n                \n                <div className=\"space-y-3\">\n              {permissions.map((permission, index) => (\n                    <motion.div\n                      key={permission}\n                      initial={{ opacity: 0, x: -20 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ delay: index * 0.05, duration: 0.2 }}\n                      whileHover={{ \n                        x: 3, \n                        boxShadow: \"0 4px 12px rgba(0,0,0,0.05)\",\n                        borderColor: \"rgba(var(--platform-base-color-rgb), 0.5)\"\n                      }}\n                      className={cn(\n                        \"p-4 rounded-lg flex items-center gap-4\",\n                        \"bg-gray-50 dark:bg-gray-800/50\",\n                        \"border border-gray-200 dark:border-gray-700\",\n                        \"hover:border-gray-300 dark:hover:border-gray-600\",\n                        \"transition-all duration-200\"\n                      )}\n                    >\n                      <div className={cn(\n                        \"w-10 h-10 rounded-lg flex items-center justify-center\",\n                        \"bg-gradient-to-br\",\n                        config.colors.background\n                      )}>\n                        <svg className={cn(\"w-5 h-5\", config.colors.text)} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                  </svg>\n                      </div>\n                      <span className=\"text-base text-gray-700 dark:text-gray-300\">\n                  {permission}\n                      </span>\n                    </motion.div>\n                  ))}\n                </div>\n              </motion.div>\n            );\n            \n          case 'usage':\n            if (!usage) return null;\n            return (\n              <motion.div\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.3, ease: \"easeOut\" }}\n                className=\"space-y-5\"\n              >\n                <div className=\"flex items-center gap-3 mb-1\">\n                  <svg className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\n                  </svg>\n                  <h4 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                    Usage Statistics\n                  </h4>\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                  {usage.playlists !== undefined && (\n                    <motion.div \n                      className=\"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4 text-center border border-gray-200 dark:border-gray-700 shadow-sm\"\n                      whileHover={{ y: -3, boxShadow: \"0 8px 30px rgba(0,0,0,0.12)\" }}\n                    >\n                      <p className={cn(\"text-3xl font-bold mb-1\", config.colors.text)}>\n                        {usage.playlists}\n                      </p>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-300 mt-1 flex items-center justify-center gap-1.5\">\n                        <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3\" />\n                        </svg>\n                        Playlists\n                      </p>\n                    </motion.div>\n                  )}\n                  {usage.tracks !== undefined && (\n                    <motion.div \n                      className=\"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4 text-center border border-gray-200 dark:border-gray-700 shadow-sm\"\n                      whileHover={{ y: -3, boxShadow: \"0 8px 30px rgba(0,0,0,0.12)\" }}\n                    >\n                      <p className={cn(\"text-3xl font-bold mb-1\", config.colors.text)}>\n                        {usage.tracks.toLocaleString()}\n                      </p>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-300 mt-1 flex items-center justify-center gap-1.5\">\n                        <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3\" />\n                        </svg>\n                        Tracks\n                      </p>\n                    </motion.div>\n                  )}\n                  {usage.playbackHours !== undefined && (\n                    <motion.div \n                      className=\"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4 text-center border border-gray-200 dark:border-gray-700 shadow-sm\"\n                      whileHover={{ y: -3, boxShadow: \"0 8px 30px rgba(0,0,0,0.12)\" }}\n                    >\n                      <p className={cn(\"text-3xl font-bold mb-1\", config.colors.text)}>\n                        {usage.playbackHours}h\n                      </p>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-300 mt-1 flex items-center justify-center gap-1.5\">\n                        <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z\" />\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                        </svg>\n                        Playback\n                      </p>\n                    </motion.div>\n                  )}\n                  {usage.storage && (\n                    <motion.div \n                      className=\"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4 text-center border border-gray-200 dark:border-gray-700 shadow-sm\"\n                      whileHover={{ y: -3, boxShadow: \"0 8px 30px rgba(0,0,0,0.12)\" }}\n                    >\n                      <p className={cn(\"text-3xl font-bold mb-1\", config.colors.text)}>\n                        {usage.storage}\n                      </p>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-300 mt-1 flex items-center justify-center gap-1.5\">\n                        <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2\" />\n                        </svg>\n                        Storage\n                      </p>\n                    </motion.div>\n                  )}\n                </div>\n                {usage.lastSynced && (\n                  <div className=\"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800/50 flex items-center\">\n                    <svg className=\"w-5 h-5 text-blue-500 mr-2 flex-shrink-0\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                    </svg>\n                    <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                      Last synced: {usage.lastSynced}\n                    </p>\n                  </div>\n                )}\n              </motion.div>\n            );\n            \n          case 'settings':\n            return (\n              <motion.div\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.3, ease: \"easeOut\" }}\n                className=\"space-y-5\"\n              >\n                <div className=\"flex items-center gap-3 mb-2\">\n                  <svg className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n                  </svg>\n                  <h4 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                    Connection Settings\n                  </h4>\n                </div>\n                \n                {/* Settings Hint */}\n                <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800/50\">\n                  <div className=\"flex items-center gap-2 text-sm text-blue-700 dark:text-blue-300\">\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                    </svg>\n                    <span>💡 Double-click the \"Settings\" tab above to open detailed settings</span>\n                  </div>\n                </div>\n\n                {/* Settings Summary */}\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-100 dark:border-blue-800/50 mb-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <svg className=\"w-4 h-4 text-blue-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                    </svg>\n                    <h5 className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">Settings Summary</h5>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                    <div className=\"flex items-center gap-1\">\n                      <div className={`w-2 h-2 rounded-full ${settings.autoSync ? 'bg-green-400' : 'bg-gray-400'}`}></div>\n                      <span className=\"text-blue-600 dark:text-blue-400\">Auto-sync: {settings.autoSync ? 'ON' : 'OFF'}</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <div className={`w-2 h-2 rounded-full ${settings.realTimeSync ? 'bg-green-400' : 'bg-gray-400'}`}></div>\n                      <span className=\"text-blue-600 dark:text-blue-400\">Real-time: {settings.realTimeSync ? 'ON' : 'OFF'}</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <div className={`w-2 h-2 rounded-full ${settings.analyticsCollection ? 'bg-green-400' : 'bg-gray-400'}`}></div>\n                      <span className=\"text-blue-600 dark:text-blue-400\">Analytics: {settings.analyticsCollection ? 'ON' : 'OFF'}</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <div className={`w-2 h-2 rounded-full ${settings.crossPlatformSync ? 'bg-green-400' : 'bg-gray-400'}`}></div>\n                      <span className=\"text-blue-600 dark:text-blue-400\">Cross-platform: {settings.crossPlatformSync ? 'ON' : 'OFF'}</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Account Settings */}\n                <div className=\"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\n                  <h5 className=\"text-gray-900 dark:text-white font-medium mb-3 flex items-center gap-2\">\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\n                    </svg>\n                    Account Settings\n                  </h5>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n                  Configure how your {config.name} account interacts with SoundSwapp.\n                </p>\n                <div className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n                        <span className=\"text-gray-700 dark:text-gray-300 text-sm\">Auto-sync playlists</span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">({settings.autoSync ? 'ON' : 'OFF'})</span>\n                        </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input \n                          type=\"checkbox\" \n                          className=\"sr-only peer\" \n                          checked={settings.autoSync}\n                          onChange={() => handleSettingChange('autoSync')}\n                          data-setting=\"autoSync\"\n                        />\n                        <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                      </label>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-2 h-2 bg-blue-400 rounded-full\"></div>\n                        <span className=\"text-gray-700 dark:text-gray-300 text-sm\">Background sync</span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">({settings.backgroundSync ? 'ON' : 'OFF'})</span>\n                      </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input \n                          type=\"checkbox\" \n                          className=\"sr-only peer\" \n                          checked={settings.backgroundSync}\n                          onChange={() => handleSettingChange('backgroundSync')}\n                          data-setting=\"backgroundSync\"\n                        />\n                        <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                      </label>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-2 h-2 bg-purple-400 rounded-full\"></div>\n                        <span className=\"text-gray-700 dark:text-gray-300 text-sm\">Sync favorites</span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">({settings.syncFavorites ? 'ON' : 'OFF'})</span>\n                      </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input \n                          type=\"checkbox\" \n                          className=\"sr-only peer\" \n                          checked={settings.syncFavorites}\n                          onChange={() => handleSettingChange('syncFavorites')}\n                          data-setting=\"syncFavorites\"\n                        />\n                        <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                      </label>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Privacy Settings */}\n                <div className=\"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\n                  <h5 className=\"text-gray-900 dark:text-white font-medium mb-3 flex items-center gap-2\">\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\n                    </svg>\n                            Privacy Settings\n                  </h5>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n                            Manage data sharing preferences\n                          </p>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-2 h-2 bg-yellow-400 rounded-full\"></div>\n                        <span className=\"text-gray-700 dark:text-gray-300 text-sm\">Share listening data</span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">({settings.shareListeningData ? 'ON' : 'OFF'})</span>\n                        </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input \n                          type=\"checkbox\" \n                          className=\"sr-only peer\" \n                          checked={settings.shareListeningData}\n                          onChange={() => handleSettingChange('shareListeningData')}\n                          data-setting=\"shareListeningData\"\n                        />\n                        <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                      </label>\n                      </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-2 h-2 bg-orange-400 rounded-full\"></div>\n                        <span className=\"text-gray-700 dark:text-gray-300 text-sm\">Analytics collection</span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">({settings.analyticsCollection ? 'ON' : 'OFF'})</span>\n                    </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input \n                          type=\"checkbox\" \n                          className=\"sr-only peer\" \n                          checked={settings.analyticsCollection}\n                          onChange={() => handleSettingChange('analyticsCollection')}\n                          data-setting=\"analyticsCollection\"\n                        />\n                        <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                      </label>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-2 h-2 bg-red-400 rounded-full\"></div>\n                        <span className=\"text-gray-700 dark:text-gray-300 text-sm\">Third-party sharing</span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">({settings.thirdPartySharing ? 'ON' : 'OFF'})</span>\n                        </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input \n                          type=\"checkbox\" \n                          className=\"sr-only peer\" \n                          checked={settings.thirdPartySharing}\n                          onChange={() => handleSettingChange('thirdPartySharing')}\n                          data-setting=\"thirdPartySharing\"\n                        />\n                        <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                      </label>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Sync Settings */}\n                <div className=\"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\n                  <h5 className=\"text-gray-900 dark:text-white font-medium mb-3 flex items-center gap-2\">\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                    </svg>\n                    Sync Settings\n                  </h5>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n                            Configure automatic sync options\n                          </p>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-2 h-2 bg-indigo-400 rounded-full\"></div>\n                        <span className=\"text-gray-700 dark:text-gray-300 text-sm\">Real-time sync</span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">({settings.realTimeSync ? 'ON' : 'OFF'})</span>\n                        </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input \n                          type=\"checkbox\" \n                          className=\"sr-only peer\" \n                          checked={settings.realTimeSync}\n                          onChange={() => handleSettingChange('realTimeSync')}\n                          data-setting=\"realTimeSync\"\n                        />\n                        <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                      </label>\n                      </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-2 h-2 bg-teal-400 rounded-full\"></div>\n                        <span className=\"text-gray-700 dark:text-gray-300 text-sm\">Offline sync</span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">({settings.offlineSync ? 'ON' : 'OFF'})</span>\n                      </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input \n                          type=\"checkbox\" \n                          className=\"sr-only peer\" \n                          checked={settings.offlineSync}\n                          onChange={() => handleSettingChange('offlineSync')}\n                          data-setting=\"offlineSync\"\n                        />\n                        <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                      </label>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-2 h-2 bg-pink-400 rounded-full\"></div>\n                        <span className=\"text-gray-700 dark:text-gray-300 text-sm\">Cross-platform sync</span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">({settings.crossPlatformSync ? 'ON' : 'OFF'})</span>\n                      </div>\n                      <label className=\"relative inline-flex items-center cursor-pointer\">\n                        <input \n                          type=\"checkbox\" \n                          className=\"sr-only peer\" \n                          checked={settings.crossPlatformSync}\n                          onChange={() => handleSettingChange('crossPlatformSync')}\n                          data-setting=\"crossPlatformSync\"\n                        />\n                        <div className=\"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:bg-green-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300/20 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white border border-white/20\"></div>\n                      </label>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Debug Info */}\n                <div className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700\">\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-2\">Debug Info:</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-500\">Auto-sync: {settings.autoSync ? 'ON' : 'OFF'}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-500\">Background sync: {settings.backgroundSync ? 'ON' : 'OFF'}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-500\">Sync favorites: {settings.syncFavorites ? 'ON' : 'OFF'}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-500\">Share listening data: {settings.shareListeningData ? 'ON' : 'OFF'}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-500\">Analytics collection: {settings.analyticsCollection ? 'ON' : 'OFF'}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-500\">Third-party sharing: {settings.thirdPartySharing ? 'ON' : 'OFF'}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-500\">Real-time sync: {settings.realTimeSync ? 'ON' : 'OFF'}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-500\">Offline sync: {settings.offlineSync ? 'ON' : 'OFF'}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-500\">Cross-platform sync: {settings.crossPlatformSync ? 'ON' : 'OFF'}</p>\n                </div>\n\n                {/* Action Buttons */}\n                <div className=\"flex gap-2 pt-2\">\n                  <button \n                    onClick={() => {\n                      console.log(`Refreshing ${platform} connection...`);\n                      const button = event?.target as HTMLButtonElement;\n                      if (button) {\n                        const originalText = button.innerHTML;\n                        button.innerHTML = `\n                          <svg class=\"w-4 h-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                          </svg>\n                          Refreshing...\n                        `;\n                        setTimeout(() => {\n                          button.innerHTML = `\n                            <svg class=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n                            </svg>\n                            Refreshed!\n                          `;\n                          setTimeout(() => {\n                            button.innerHTML = originalText;\n                          }, 1000);\n                        }, 2000);\n                      }\n                    }}\n                    className=\"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm transition-colors\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                        </svg>\n                    Refresh Connection\n                  </button>\n                  <button \n                    onClick={() => {\n                      try {\n                        const settingsData = {\n                          platform,\n                          settings,\n                          exportDate: new Date().toISOString()\n                        };\n                        const blob = new Blob([JSON.stringify(settingsData, null, 2)], { type: 'application/json' });\n                        const url = URL.createObjectURL(blob);\n                        const a = document.createElement('a');\n                        a.href = url;\n                        a.download = `${platform}-settings.json`;\n                        document.body.appendChild(a);\n                        a.click();\n                        document.body.removeChild(a);\n                        URL.revokeObjectURL(url);\n                        console.log(`${platform} settings exported successfully`);\n                        \n                        // Show success feedback\n                        const button = event?.target as HTMLButtonElement;\n                        if (button) {\n                          const originalText = button.innerHTML;\n                          button.innerHTML = `\n                            <svg class=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n                            </svg>\n                            Exported!\n                          `;\n                          setTimeout(() => {\n                            button.innerHTML = originalText;\n                          }, 1000);\n                        }\n                      } catch (error) {\n                        console.error('Error exporting settings:', error);\n                      }\n                    }}\n                    className=\"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-colors\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                    </svg>\n                    Export Settings\n                  </button>\n                    </div>\n                \n                {/* Reset Settings Button */}\n                <div className=\"pt-2\">\n                  <button \n                    onClick={() => {\n                      const defaultSettings = {\n                        autoSync: true,\n                        backgroundSync: false,\n                        syncFavorites: true,\n                        shareListeningData: false,\n                        analyticsCollection: true,\n                        thirdPartySharing: false,\n                        realTimeSync: true,\n                        offlineSync: false,\n                        crossPlatformSync: true\n                      };\n                      setSettings(defaultSettings);\n                      localStorage.setItem(`${platform}_settings`, JSON.stringify(defaultSettings));\n                      console.log(`${platform} settings reset to defaults`);\n                      \n                      // Show feedback\n                      const button = event?.target as HTMLButtonElement;\n                      if (button) {\n                        const originalText = button.innerHTML;\n                        button.innerHTML = `\n                          <svg class=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n                          </svg>\n                          Reset Complete!\n                        `;\n                        setTimeout(() => {\n                          button.innerHTML = originalText;\n                        }, 1000);\n                      }\n                    }}\n                    className=\"w-full flex items-center justify-center gap-2 px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm transition-colors\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                    </svg>\n                    Reset to Default Settings\n                  </button>\n                </div>\n              </motion.div>\n            );\n            \n          default:\n            return <div>Select a tab</div>;\n        }\n      };\n      \n      const tabs: Array<{ id: TabId; label: string; show: boolean }> = [\n        { id: 'overview', label: 'Overview', show: true },\n        { id: 'permissions', label: 'Permissions', show: true },\n        { id: 'usage', label: 'Usage', show: !!usage },\n        { id: 'settings', label: 'Settings', show: true }\n      ];\n      \n      console.log('[PlatformCardBack] About to return JSX');\n      \n      const jsxToReturn = (\n        <motion.div\n          ref={ref}\n          className={cn(\n            \"absolute inset-0 overflow-hidden rounded-xl shadow-xl\",\n            \"flex flex-col\",\n            isDark ? \"bg-gray-800 text-gray-200\" : \"bg-white text-gray-800\",\n            config.colors.background\n          )}\n          style={{\n            ...cardStyles,\n            transformStyle: 'preserve-3d',\n            transform: isFlipped ? 'rotateY(0deg)' : 'rotateY(180deg)',\n            transition: 'transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)',\n            backfaceVisibility: 'hidden',\n            WebkitBackfaceVisibility: 'hidden',\n            MozBackfaceVisibility: 'hidden',\n            visibility: isFlipped ? 'visible' : 'hidden',\n            padding: '0rem'\n          }}\n        >\n          <div className={cn(\n            \"flex items-center justify-between p-4 border-b\",\n            isDark ? \"border-gray-700\" : \"border-gray-200\",\n            `bg-${platform}-600 dark:bg-${platform}-700`\n          )}>\n            <div className=\"flex items-center space-x-3\">\n              <IconComponent className={cn(\"w-7 h-7\", \"text-white\")} />\n              <div>\n                <h2 className=\"text-lg font-semibold text-white\">{config.name} Account</h2>\n                <p className=\"text-xs text-white opacity-80\">Manage your connection</p>\n              </div>\n            </div>\n            <button \n              onClick={onBack} \n              className=\"p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors\"\n              aria-label=\"Go back\"\n            >\n              <svg className=\"w-5 h-5 text-white\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" /></svg>\n            </button>\n          </div>\n\n          <div className=\"flex justify-around border-b p-2\" style={{ borderColor: isDark ? 'var(--gray-700)' : 'var(--gray-200)' }}>\n            {(['overview', 'permissions', 'settings'] as TabId[]).map((tabId) => {\n              if (tabId === 'usage' && !usage) return null;\n              const tabIconElement = tabIcons[tabId];\n              return (\n                <button\n                  key={tabId}\n                  onClick={() => setActiveTab(tabId)}\n                  onDoubleClick={() => {\n                    if (tabId === 'settings') {\n                      setShowSettingsModal(true);\n                    }\n                  }}\n                  className={cn(\n                    \"flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-all duration-150\",\n                    activeTab === tabId \n                      ? cn(config.colors.tabActiveBg, config.colors.tabText, 'shadow-sm') \n                      : cn(\"hover:bg-gray-100 dark:hover:bg-gray-700\", isDark ? \"text-gray-400 hover:text-gray-100\" : \"text-gray-500 hover:text-gray-800\"),\n                    tabId === 'settings' ? \"cursor-pointer\" : \"\"\n                  )}\n                  aria-current={activeTab === tabId ? 'page' : undefined}\n                  title={tabId === 'settings' ? \"Double-click to open detailed settings\" : undefined}\n                >\n                  {tabIconElement}\n                  <span>{tabId.charAt(0).toUpperCase() + tabId.slice(1)}</span>\n                  {tabId === 'settings' && (\n                    <svg className=\"w-3 h-3 ml-1 opacity-60\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\" />\n                    </svg>\n                  )}\n                </button>\n              );\n            })}\n          </div>\n\n          <div className=\"flex-grow p-3 md:p-4 overflow-y-auto\">\n            {renderTabContent()}\n          </div>\n\n          {onDisconnect && (\n            <div className=\"px-4 py-3 border-t\" style={{ borderColor: isDark ? 'var(--gray-700)' : 'var(--gray-200)' }}>\n              <GlowButton\n                variant=\"secondary\"\n                onClick={() => setShowConfirmDialog(true)}\n                className=\"w-full !bg-red-600 hover:!bg-red-700 !text-white\"\n              >\n                Disconnect Account\n              </GlowButton>\n            </div>\n          )}\n\n          <ConfirmationDialog \n            isOpen={showConfirmDialog} \n            onClose={() => setShowConfirmDialog(false)} \n            onConfirm={onDisconnect || (() => {})}\n            platform={platform} \n          />\n          \n          <SettingsModal\n            isOpen={showSettingsModal}\n            onClose={() => setShowSettingsModal(false)}\n            platform={platform}\n            settings={settings}\n            onSettingChange={handleSettingChange}\n          />\n        </motion.div>\n      );\n      console.log('[PlatformCardBack] JSX created, returning');\n      return jsxToReturn;\n      \n    } catch (err) {\n      console.error('[PlatformCardBack] Error rendering component:', err);\n      return (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-900 text-red-500 p-4 text-center\">\n          <div>\n            <h3 className=\"font-bold text-lg\">Error rendering card</h3>\n            <p>{err instanceof Error ? err.message : 'Unknown error'}</p>\n          </div>\n        </div>\n      );\n    }\n  }\n);\n\nPlatformCardBack.displayName = 'PlatformCardBack';\n\nexport default PlatformCardBack; ","import React from 'react';\nimport { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { getGlassmorphicStyles } from '../lib/glassmorphic';\nimport { cn } from '../lib/utils';\nimport PlatformCardBack from './ui/PlatformCardBack';\nimport { GlowButton } from './ui/GlowButton';\nimport { FaSpotify, FaYoutube } from 'react-icons/fa';\nimport { useTheme } from '../lib/ThemeContext';\nimport { useAuth } from '../lib/AuthContext';\n\ninterface FlippedState {\n  spotify: boolean;\n  youtube: boolean;\n}\n\ninterface EnhancedConnectionCardProps {\n  platform: 'spotify' | 'youtube';\n  onConnect: () => void;\n  onDisconnect?: () => void;\n  isConnecting?: boolean;\n  connectionError?: string;\n  userEmail?: string;\n  userMeta?: any;\n  connected?: boolean;\n  userName?: string;\n  userPhoto?: string;\n}\n\nconst EnhancedConnectionCard: React.FC<EnhancedConnectionCardProps> = ({\n  platform, \n  onConnect,\n  onDisconnect, \n  isConnecting = false,\n  connectionError = '',\n  userEmail,\n  userMeta,\n  connected: externalConnected,\n  userName,\n  userPhoto,\n}) => {\n  const { isDark } = useTheme();\n  const {\n    hasSpotifyAuth,\n    hasYouTubeAuth,\n    spotifyUserProfile,\n    youtubeUserProfile,\n    fetchSpotifyProfile,\n    fetchYouTubeProfile,\n    user\n  } = useAuth();\n\n  const [isFlipped, setIsFlipped] = useState(false);\n  const [isHovered, setIsHovered] = useState(false);\n  const [authError, setAuthError] = useState<string | null>(null);\n  const cardRef = useRef<HTMLDivElement>(null);\n  const disconnectButtonRef = useRef<HTMLButtonElement>(null);\n\n  // Detect theme on mount\n  useEffect(() => {\n    const isDark = document.documentElement.classList.contains('dark');\n    // setIsDarkMode(isDark); // This line was removed as per the new_code\n  }, []);\n\n  // Clear auth error when user logs in\n  useEffect(() => {\n    if (user) {\n      setAuthError(null);\n    }\n  }, [user]);\n\n  // Handle connect with auth check\n  const handleConnect = async () => {\n    if (!user) {\n      setAuthError('Please sign in to connect your account');\n      return;\n    }\n    setAuthError(null);\n    onConnect();\n  };\n\n  // Determine connected status and current profile based on platform\n  const connected = externalConnected !== undefined ? externalConnected : (platform === 'spotify' ? hasSpotifyAuth : hasYouTubeAuth);\n  const userProfile = platform === 'spotify' ? spotifyUserProfile : youtubeUserProfile;\n\n  // Refetch profile if connection status is true but profile is missing (e.g., after page reload)\n  useEffect(() => {\n    if (connected && !userProfile) {\n      if (platform === 'spotify') {\n        console.log('EnhancedConnectionCard: Spotify connected but profile missing, fetching...');\n        fetchSpotifyProfile();\n      } else if (platform === 'youtube') {\n        console.log('EnhancedConnectionCard: YouTube connected but profile missing, fetching...');\n        fetchYouTubeProfile();\n      }\n    }\n  }, [connected, userProfile, platform, fetchSpotifyProfile, fetchYouTubeProfile]);\n\n  const handleCardFlip = () => {\n    if (!isConnecting) {\n      setIsFlipped(!isFlipped);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (isConnecting) return;\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      setIsFlipped(!isFlipped);\n    }\n    if (isFlipped && e.key === 'Escape') {\n      e.preventDefault();\n      setIsFlipped(false);\n    }\n  };\n\n  // Focus management: when card flips to back, focus disconnect button.\n  // When it flips to front, focus the card itself (or primary action button if appropriate).\n  useEffect(() => {\n    if (isFlipped) {\n      disconnectButtonRef.current?.focus();\n    } else {\n      // Optional: focus card or main connect/details button when flipping to front\n      // cardRef.current?.focus(); \n    }\n  }, [isFlipped]);\n\n  const platformConfig = useMemo(() => {\n    const isSpotify = platform === 'spotify';\n    const basePlatformStyle = {\n      textColor: 'text-content-primary',\n      userMetaDisplay: userMeta?.plan || (isSpotify ? 'Spotify Premium' : 'YouTube Premium'),\n    };\n\n    if (isSpotify) {\n      return {\n        ...basePlatformStyle,\n        name: 'Spotify',\n        icon: <FaSpotify className=\"w-10 h-10 text-white\" />,\n        iconContainerBg: 'bg-spotify',\n        indicator: 'bg-spotify',\n        accountTypeColor: 'text-spotify-text',\n        glowHslVar: 'var(--spotify-base-color-hsl)',\n        glowRgbVar: 'var(--spotify-base-color-rgb)',\n        disconnectBg: 'bg-spotify/80 hover:bg-spotify',\n        buttonVariant: 'soundswapp' as const,\n        cardGradient: isDark ? 'from-spotify/20 to-bg-secondary/10' : 'from-spotify/10 to-bg-secondary/5',\n        cssVariables: {\n          '--platform-bg': 'hsl(var(--spotify-base-color-hsl))',\n          '--platform-text': 'hsl(var(--text-on-primary-action-hsl))',\n          '--platform-bg-hover': 'hsla(var(--spotify-base-color-hsl), 0.8)',\n          '--platform-indicator': 'hsl(var(--spotify-base-color-hsl))',\n          '--platform-glow-color': 'hsl(var(--spotify-base-color-hsl))',\n          '--platform-glow-color-rgb': 'var(--spotify-base-color-rgb)',\n        }\n      };\n    } else {\n      return {\n        ...basePlatformStyle,\n        name: 'YouTube',\n        icon: <FaYoutube className=\"w-10 h-10 text-white\" />,\n        iconContainerBg: 'bg-youtube',\n        indicator: 'bg-youtube',\n        accountTypeColor: 'text-youtube-text',\n        glowHslVar: 'var(--youtube-base-color-hsl)',\n        glowRgbVar: 'var(--youtube-base-color-rgb)',\n        disconnectBg: 'bg-youtube/80 hover:bg-youtube',\n        buttonVariant: 'soundswapp' as const,\n        cardGradient: isDark ? 'from-youtube/20 to-bg-secondary/10' : 'from-youtube/10 to-bg-secondary/5',\n        cssVariables: {\n          '--platform-bg': 'hsl(var(--youtube-base-color-hsl))',\n          '--platform-text': 'hsl(var(--text-on-primary-action-hsl))',\n          '--platform-bg-hover': 'hsla(var(--youtube-base-color-hsl), 0.8)',\n          '--platform-indicator': 'hsl(var(--youtube-base-color-hsl))',\n          '--platform-glow-color': 'hsl(var(--youtube-base-color-hsl))',\n          '--platform-glow-color-rgb': 'var(--youtube-base-color-rgb)',\n        }\n      };\n    }\n  }, [platform, userMeta, isDark]);\n\n  const cardBaseStyles = cn(\n    \"rounded-xl border shadow-md transition-all duration-300\",\n    \"backdrop-blur-md bg-opacity-90\",\n    \"bg-surface-card border-border-default\",\n    \"shadow-[0_0_12px_3px_rgba(var(--platform-glow-color-rgb),0.15)]\",\n    \"hover:shadow-[0_0_20px_5px_rgba(var(--platform-glow-color-rgb),0.25)] hover:border-border-interactive hover:scale-[1.01] hover:brightness-102\"\n  );\n\n  const permissions = useMemo(() => [\n    \"Read your playlists\",\n    `Access your ${platformConfig.name} profile information`,\n    connected ? `Create and modify your ${platformConfig.name} playlists` : `Connect to manage ${platformConfig.name} playlists`\n  ], [platformConfig.name, connected]);\n\n  const accountDetails = useMemo(() => {\n    const baseDetails = {\n      username: userProfile?.displayName || (platform === 'spotify' ? 'Mich' : 'YouTube User'),\n      email: userEmail || (connected && userProfile ? 'michmichira@gmail.com' : 'Not available'),\n      profilePicture: userProfile?.imageUrl,\n      plan: userMeta?.plan || (connected ? `${platformConfig.name} Connected` : `Link ${platformConfig.name}`),\n      since: userMeta?.lastSignInTime ? new Date(userMeta.lastSignInTime).toLocaleDateString() : (connected ? '8/5/2025' : 'N/A')\n    };\n\n    console.log('[EnhancedConnectionCard] Building account details:', {\n      platform,\n      connected,\n      hasUserMeta: !!userMeta,\n      userProfile: userProfile?.displayName,\n      userEmail\n    });\n\n    if (platform === 'youtube' && connected && userMeta) {\n      console.log('[EnhancedConnectionCard] Building YouTube account details with userMeta');\n      return {\n        ...baseDetails,\n        // YouTube-specific fields\n        channelId: userMeta.channelId || userMeta.id,\n        subscriberCount: userMeta.subscriberCount || userMeta.statistics?.subscriberCount || 0,\n        totalVideos: userMeta.videoCount || userMeta.statistics?.videoCount || 0,\n        totalPlaylists: userMeta.playlistCount || userMeta.statistics?.playlistCount || 0,\n        totalViews: userMeta.viewCount || userMeta.statistics?.viewCount || 0,\n        channelType: userMeta.channelType || 'personal',\n        monetizationStatus: userMeta.monetizationStatus || 'disabled',\n        verificationStatus: userMeta.verificationStatus || 'unverified',\n        contentRating: userMeta.contentRating || 'family',\n        language: userMeta.language || 'en',\n        location: userMeta.location || userMeta.country || 'Unknown',\n        joinDate: userMeta.publishedAt ? new Date(userMeta.publishedAt).toLocaleDateString() : '8/5/2025',\n        lastUploadDate: userMeta.lastUploadDate ? new Date(userMeta.lastUploadDate).toLocaleDateString() : '2 days ago',\n        averageViews: userMeta.averageViews || userMeta.statistics?.averageViews || 0,\n        topCategories: userMeta.topCategories || ['Music', 'Entertainment', 'Education'],\n        collaborationStatus: userMeta.collaborationStatus || false,\n        liveStreamingEnabled: userMeta.liveStreamingEnabled || false,\n        communityTabEnabled: userMeta.communityTabEnabled || false,\n        membershipsEnabled: userMeta.membershipsEnabled || false,\n        superChatEnabled: userMeta.superChatEnabled || false,\n        channelMembershipLevel: userMeta.channelMembershipLevel || 'none'\n      };\n    } else if (platform === 'youtube' && connected) {\n      console.log('[EnhancedConnectionCard] Building YouTube account details (fallback)');\n      return {\n        ...baseDetails,\n        channelId: 'Connected',\n        subscriberCount: 1250,\n        totalVideos: 45,\n        totalPlaylists: 12,\n        totalViews: 125000,\n        channelType: 'personal',\n        monetizationStatus: 'disabled',\n        verificationStatus: 'unverified',\n        contentRating: 'family',\n        language: 'en',\n        location: 'United States',\n        joinDate: '8/5/2025',\n        lastUploadDate: '2 days ago',\n        averageViews: 2800,\n        topCategories: ['Music', 'Entertainment', 'Education'],\n        collaborationStatus: false,\n        liveStreamingEnabled: false,\n        communityTabEnabled: false,\n        membershipsEnabled: false,\n        superChatEnabled: false,\n        channelMembershipLevel: 'none'\n      };\n    } else if (platform === 'spotify' && connected && userMeta) {\n      console.log('[EnhancedConnectionCard] Building Spotify account details with userMeta:', userMeta);\n      const spotifyDetails = {\n        ...baseDetails,\n        // Spotify-specific fields from userMeta\n        country: userMeta.country,\n        followers: userMeta.followers?.total,\n        product: userMeta.product || 'free',\n        explicitContent: userMeta.explicit_content,\n        totalTracks: userMeta.totalTracks,\n        lastActive: userMeta.lastActive,\n        // Enhanced Spotify account information (always include these)\n        subscription: userMeta.product === 'premium' ? 'Premium' : 'Free',\n        accountCountry: userMeta.country || 'Unknown',\n        explicitContentFilter: userMeta.explicit_content ? 'Enabled' : 'Disabled',\n        displayName: userProfile?.displayName || 'Mich',\n        profilePicture: userProfile?.imageUrl,\n        publicPlaylists: 12,\n        privatePlaylists: 8,\n        collaborativePlaylists: 3,\n        followedPlaylists: 45,\n        recentlyPlayed: 'Last 30 days',\n        topGenres: ['Pop', 'Hip-Hop', 'Electronic'],\n        listeningTime: '2.5 hours/day',\n        favoriteArtists: 23,\n        savedAlbums: 67,\n        savedTracks: 2847,\n        monthlyListeners: 890,\n        accountType: userMeta.product === 'premium' ? 'Premium Individual' : 'Free',\n        familyPlanMembers: userMeta.product === 'family' ? 6 : null,\n        studentVerification: userMeta.product === 'student',\n        deviceLimit: userMeta.product === 'premium' ? 5 : 1,\n        offlineDownloads: userMeta.product === 'premium' ? 'Unlimited' : 'Not available',\n        audioQuality: userMeta.product === 'premium' ? 'High (320kbps)' : 'Standard (128kbps)',\n        crossfade: '12 seconds',\n        equalizer: 'Custom',\n        socialFeatures: 'Enabled',\n        dataSaver: false,\n        privateSession: false,\n        lastSync: '2 hours ago',\n        nextBilling: '9/5/2025',\n        paymentMethod: 'Credit Card',\n        autoRenew: true\n      };\n      console.log('[EnhancedConnectionCard] Spotify account details built:', spotifyDetails);\n      return spotifyDetails;\n    } else if (platform === 'spotify' && connected) {\n      console.log('[EnhancedConnectionCard] Building Spotify account details (fallback)');\n      return {\n        ...baseDetails,\n        username: 'Mich',\n        email: 'michmichira@gmail.com',\n        since: '8/5/2025',\n        product: 'premium',\n        country: 'US',\n        followers: 1250,\n        explicitContent: false,\n        totalTracks: 2847,\n        lastActive: '8/5/2025',\n        // Enhanced Spotify account information\n        subscription: 'Premium',\n        accountCountry: 'United States',\n        explicitContentFilter: 'Disabled',\n        displayName: 'Mich',\n        profilePicture: userProfile?.imageUrl,\n        publicPlaylists: 12,\n        privatePlaylists: 8,\n        collaborativePlaylists: 3,\n        followedPlaylists: 45,\n        recentlyPlayed: 'Last 30 days',\n        topGenres: ['Pop', 'Hip-Hop', 'Electronic'],\n        listeningTime: '2.5 hours/day',\n        favoriteArtists: 23,\n        savedAlbums: 67,\n        savedTracks: 2847,\n        monthlyListeners: 890,\n        accountType: 'Premium Individual',\n        familyPlanMembers: null,\n        studentVerification: false,\n        deviceLimit: 5,\n        offlineDownloads: 'Unlimited',\n        audioQuality: 'High (320kbps)',\n        crossfade: '12 seconds',\n        equalizer: 'Custom',\n        socialFeatures: 'Enabled',\n        dataSaver: false,\n        privateSession: false,\n        lastSync: '2 hours ago',\n        nextBilling: '9/5/2025',\n        paymentMethod: 'Credit Card',\n        autoRenew: true\n      };\n    }\n\n    console.log('[EnhancedConnectionCard] Returning base details');\n    return baseDetails;\n  }, [userProfile, userEmail, platform, userMeta, platformConfig.name, connected]);\n\n  return (\n    <motion.div\n      className=\"min-h-[320px] md:min-h-[360px] w-full max-w-[450px] relative rounded-xl overflow-hidden\"\n      style={{ \n        perspective: '2000px',\n        ...platformConfig.cssVariables,\n        backgroundImage: `linear-gradient(var(--surface-card), var(--surface-card)), \n                        linear-gradient(135deg, \n                          hsla(var(--platform-base-color-hsl), 0.7), \n                          hsla(var(--platform-base-color-hsl), 0.15), \n                          hsla(var(--platform-base-color-hsl), 0.7)\n                        )`,\n        backgroundOrigin: 'border-box',\n        backgroundClip: 'padding-box, border-box',\n        borderWidth: '1.5px',\n        borderStyle: 'solid',\n        borderColor: 'transparent',\n        animation: isHovered ? 'borderGradientFlow 2.5s ease infinite' : 'borderGradientFlow 5s ease infinite',\n      } as React.CSSProperties}\n      onHoverStart={() => setIsHovered(true)}\n      onHoverEnd={() => setIsHovered(false)}\n    >\n      {/* Card background blobs */}\n      <div className=\"absolute inset-0 pointer-events-none overflow-hidden rounded-xl opacity-60\">\n        <motion.div \n          className={`absolute -bottom-8 -left-8 w-56 h-56 rounded-full filter blur-3xl bg-gradient-to-br ${platformConfig.cardGradient}`}\n          animate={{\n            opacity: isHovered ? [0.2, 0.35, 0.2] : [0.15, 0.25, 0.15],\n            scale: isHovered ? [1, 1.15, 1] : [1, 1.05, 1],\n          }}\n          transition={{ \n            duration: isHovered ? 5 : 7,\n            repeat: Infinity,\n            ease: \"easeInOut\"\n          }}\n        />\n        <motion.div \n          className={`absolute -top-8 -right-8 w-56 h-56 rounded-full filter blur-3xl bg-gradient-to-br ${platformConfig.cardGradient}`}\n          animate={{\n            opacity: isHovered ? [0.15, 0.3, 0.15] : [0.1, 0.2, 0.1],\n            scale: isHovered ? [1.1, 1, 1.1] : [1.05, 1, 1.05],\n          }}\n          transition={{ \n            duration: isHovered ? 6 : 8,\n            repeat: Infinity,\n            ease: \"easeInOut\",\n            delay: 0.5\n          }}\n        />\n      </div>\n\n      <div className=\"relative w-full h-full\" style={{ perspective: '2000px' }}>\n        {/* FRONT FACE */}\n        <div \n          ref={cardRef}\n          className={cn(\n            \"absolute inset-0\",\n            cardBaseStyles,\n            isConnecting ? 'cursor-default' : 'cursor-pointer'\n          )}\n          onClick={handleCardFlip}\n          onKeyDown={handleKeyDown}\n          style={{\n            transformStyle: 'preserve-3d',\n            transform: isFlipped ? 'rotateY(180deg)' : 'rotateY(0deg)',\n            transition: 'transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)',\n            backfaceVisibility: 'hidden',\n            WebkitBackfaceVisibility: 'hidden',\n            MozBackfaceVisibility: 'hidden',\n            visibility: isFlipped ? 'hidden' : 'visible',\n            padding: '0.5rem' \n          }}\n          role=\"button\"\n          tabIndex={0}\n          aria-label={`${platformConfig.name} connection card. ${connected ? 'Connected' : 'Not connected'}. Press Enter or Space to flip.`}\n        >\n          <div className=\"absolute inset-0 bg-surface-card z-0\"></div>\n          \n          <motion.div\n            className=\"absolute -bottom-20 -left-20 w-48 h-48 rounded-full opacity-50 filter blur-3xl\"\n            style={{ backgroundColor: `hsl(${platformConfig.glowHslVar})` }}\n            animate={{\n              opacity: isHovered ? [0.3, 0.5, 0.3] : [0.2, 0.3, 0.2],\n              scale: isHovered ? [1, 1.3, 1] : [1, 1.15, 1],\n            }}\n            transition={{ \n              duration: 4,\n              repeat: Infinity,\n              ease: \"easeInOut\"\n            }}\n          />\n          \n          <motion.div \n            className=\"absolute inset-0 bg-white/0 backdrop-blur-0 transition-all duration-300 z-0\"\n            initial={false}\n            animate={isHovered ? { \n              backgroundColor: \"rgba(255, 255, 255, 0.05)\",\n              backdropFilter: \"blur(3px)\" \n            } : {\n              backgroundColor: \"rgba(255, 255, 255, 0)\",\n              backdropFilter: \"blur(0px)\"\n            }}\n            aria-hidden=\"true\"\n          />\n          \n          <div className=\"relative z-10 flex flex-col items-center justify-between h-full p-4 md:p-6 text-center\">\n            <div className={cn(\n              \"absolute top-3 right-3 px-2 py-0.5 rounded-full text-xs font-medium shadow\",\n              connected ? platformConfig.indicator : (isDark ? 'bg-gray-600 text-gray-200' : 'bg-gray-300 text-gray-700')\n            )}>\n              {isConnecting ? 'Connecting...' : (connected ? 'Connected' : 'Not Connected')}\n            </div>\n            \n            <div className=\"mb-3 mt-6 flex items-center justify-center\">\n              {platform === 'youtube' && (\n                <img\n                  src={isDark ? \"/images/yt_logo_rgb_dark.png\" : \"/images/yt_logo_rgb_light.png\"}\n                  alt=\"YouTube\"\n                  style={{ \n                    height: 72, \n                    width: 'auto', \n                    objectFit: 'contain', \n                    display: 'block',\n                    minWidth: '72px'\n                  }}\n                  className=\"h-18 w-auto\"\n                />\n              )}\n              {platform === 'spotify' && (\n                <img\n                  src=\"/images/Spotify_Primary_Logo_RGB_Green.png\"\n                  alt=\"Spotify\"\n                  style={{ \n                    height: 72, \n                    width: 'auto', \n                    objectFit: 'contain', \n                    display: 'block',\n                    minWidth: '72px'\n                  }}\n                  className=\"h-18 w-auto\"\n                />\n              )}\n            </div>\n            \n            {connected && userProfile?.displayName && (\n              <p className={`text-sm ${platformConfig.textColor} opacity-80 mb-2 truncate max-w-[90%]`}>\n                {userProfile.displayName}\n              </p>\n            )}\n            {(!connected || !userProfile?.displayName) && (\n                 <p className={`text-sm ${platformConfig.textColor} opacity-70 mb-2`}>\n                    {connected ? 'Account linked' : `Connect your ${platformConfig.name} account`}\n                 </p>\n            )}\n\n            {connected && userProfile?.imageUrl && (\n              <img \n                src={userProfile.imageUrl} \n                alt={`${userProfile.displayName || platformConfig.name} profile`}\n                className=\"w-10 h-10 rounded-full mb-3 border-2 border-[var(--platform-indicator)] shadow-md object-cover\"\n              />\n            )}\n            \n            <AnimatePresence>\n              {connectionError && (\n                <motion.p \n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  exit={{ opacity: 0, y: -10 }}\n                  className=\"text-xs text-red-500 dark:text-red-400 mt-1 mb-2 px-2 break-words\"\n                >\n                  Error: {connectionError}\n                </motion.p>\n              )}\n            </AnimatePresence>\n\n            <div className=\"mt-auto w-full flex flex-col items-center space-y-2\">\n              {connected ? (\n                <GlowButton \n                  variant='outline' \n                  className=\"w-full max-w-xs text-sm py-2.5\"\n                  onClick={(e) => { e.stopPropagation(); handleCardFlip(); }}\n                  disabled={isConnecting}\n                >\n                  View Details / Disconnect\n                </GlowButton>\n              ) : (\n                <GlowButton\n                  onClick={handleConnect}\n                  disabled={isConnecting}\n                  variant={platformConfig.buttonVariant}\n                  className=\"w-full max-w-xs py-2.5\"\n                >\n                  {isConnecting ? (\n                    <span className=\"flex items-center justify-center gap-2\">\n                      <svg className=\"animate-spin h-5 w-5\" viewBox=\"0 0 24 24\">\n                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\" />\n                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n                      </svg>\n                      Connecting...\n                    </span>\n                  ) : (\n                    `Connect ${platformConfig.name}`\n                  )}\n                </GlowButton>\n              )}\n              <p className=\"text-xs text-muted-foreground mt-2 px-1\">\n                {connected ? `Manage your ${platformConfig.name} connection.` : `Log in to link your ${platformConfig.name} account.`}\n              </p>\n            </div>\n          </div>\n        </div>\n        \n        {/* BACK FACE */}\n        <PlatformCardBack\n          platform={platform}\n          accountDetails={accountDetails}\n          permissions={permissions}\n          onBack={handleCardFlip}\n          onDisconnect={onDisconnect ? () => { onDisconnect(); setIsFlipped(false); } : undefined}\n          isFlipped={isFlipped}\n        />\n      </div>\n\n      {/* Add error message display */}\n      {authError && (\n        <div className=\"absolute bottom-4 left-4 right-4 bg-red-500/10 border border-red-500/20 rounded-lg p-3 text-red-400 text-sm\">\n          {authError}\n        </div>\n      )}\n    </motion.div>\n  );\n};\n\nexport default EnhancedConnectionCard;","import React, { useState, useRef, useEffect } from 'react';\nimport { cn } from '../../lib/utils';\n\ninterface FloatingLabelsProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  label: string;\n  variant?: 'default' | 'minimal' | 'outlined';\n  error?: string;\n  helpText?: string;\n  containerClassName?: string;\n  labelClassName?: string;\n  inputClassName?: string;\n}\n\nexport const FloatingLabels: React.FC<FloatingLabelsProps> = ({\n  label,\n  variant = 'default',\n  error,\n  helpText,\n  className,\n  containerClassName,\n  labelClassName,\n  inputClassName,\n  required,\n  id,\n  ...props\n}) => {\n  const [isFocused, setIsFocused] = useState(false);\n  const [hasValue, setHasValue] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const uniqueId = id || `input-${Math.random().toString(36).substring(2, 9)}`;\n\n  // Check if input has value\n  useEffect(() => {\n    if (props.value !== undefined) {\n      setHasValue(Boolean(props.value));\n    }\n  }, [props.value]);\n\n  const handleFocus = (e: React.FocusEvent<HTMLInputElement>) => {\n    setIsFocused(true);\n    props.onFocus?.(e);\n  };\n\n  const handleBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    setIsFocused(false);\n    setHasValue(Boolean(e.target.value));\n    props.onBlur?.(e);\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setHasValue(Boolean(e.target.value));\n    props.onChange?.(e);\n  };\n\n  // Base container styles\n  const containerBaseClasses = \"relative mb-4\";\n  \n  // Base input styles\n  const inputBaseClasses = \"block w-full text-base transition-all duration-200 ease-in-out focus:outline-none focus:ring-2\";\n  \n  // Base label styles\n  const labelBaseClasses = \"absolute left-3 transition-all duration-200 pointer-events-none\";\n  \n  // Variant-specific styles\n  const variantStyles = {\n    default: {\n      container: \"\",\n      input: \"px-3 pt-6 pb-2 rounded-lg border bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-700 focus:ring-indigo-500 dark:focus:ring-indigo-400\",\n      label: \"text-gray-500 dark:text-gray-400\",\n      labelActive: \"text-xs -translate-y-3\",\n      labelInactive: \"text-base translate-y-2\"\n    },\n    minimal: {\n      container: \"\",\n      input: \"px-0 pt-6 pb-1 border-0 border-b-2 border-gray-300 dark:border-slate-700 focus:ring-0 focus:border-indigo-500 dark:focus:border-indigo-400 bg-transparent\",\n      label: \"text-gray-500 dark:text-gray-400 left-0\",\n      labelActive: \"text-xs -translate-y-4 text-indigo-600 dark:text-indigo-400\",\n      labelInactive: \"text-base translate-y-2\"\n    },\n    outlined: {\n      container: \"\",\n      input: \"px-3 py-3 border-2 rounded-xl focus:ring-0 focus:border-indigo-500 dark:focus:border-indigo-400 bg-transparent border-gray-300 dark:border-slate-700\",\n      label: \"text-gray-500 dark:text-gray-400 bg-white dark:bg-slate-900 px-1\",\n      labelActive: \"text-xs -translate-y-5 text-indigo-600 dark:text-indigo-400 scale-90\",\n      labelInactive: \"text-base translate-y-2\"\n    }\n  };\n\n  const variantStyle = variantStyles[variant];\n  const isActive = isFocused || hasValue;\n\n  return (\n    <div className={cn(\n      containerBaseClasses,\n      variantStyle.container,\n      containerClassName\n    )}>\n      <input\n        id={uniqueId}\n        ref={inputRef}\n        className={cn(\n          inputBaseClasses,\n          variantStyle.input,\n          error ? \"border-red-500 focus:ring-red-500 focus:border-red-500\" : \"\",\n          inputClassName,\n          className\n        )}\n        onFocus={handleFocus}\n        onBlur={handleBlur}\n        onChange={handleChange}\n        aria-invalid={error ? \"true\" : \"false\"}\n        aria-describedby={error ? `${uniqueId}-error` : helpText ? `${uniqueId}-help` : undefined}\n        required={required}\n        {...props}\n      />\n      <label\n        htmlFor={uniqueId}\n        className={cn(\n          labelBaseClasses,\n          variantStyle.label,\n          isActive ? variantStyle.labelActive : variantStyle.labelInactive,\n          labelClassName\n        )}\n      >\n        {label}{required && <span className=\"text-red-500 ml-1\">*</span>}\n      </label>\n      \n      {error && (\n        <p id={`${uniqueId}-error`} className=\"mt-1 text-sm text-red-500\">\n          {error}\n        </p>\n      )}\n      \n      {helpText && !error && (\n        <p id={`${uniqueId}-help`} className=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n          {helpText}\n        </p>\n      )}\n    </div>\n  );\n}; ","import React from \"react\";\nimport { cn } from \"../../lib/utils\";\n\ninterface AnimatedGradientTextProps extends React.HTMLAttributes<HTMLDivElement> {\n  variant?: \"spotify\" | \"youtube\" | \"default\";\n}\n\nexport default function AnimatedGradientText({\n  className,\n  children,\n  variant = \"default\",\n  ...props\n}: AnimatedGradientTextProps) {\n  const gradients = {\n    spotify: \"bg-gradient-to-r from-green-400 from-20% via-blue-500 via-50% to-green-600 to-80%\",\n    youtube: \"bg-gradient-to-r from-red-500 from-30% via-red-600 via-50% to-amber-500 to-80%\",\n    default: \"bg-gradient-to-r from-yellow-500 from-30% via-purple-500 via-50% to-pink-500 to-80%\"\n  };\n\n  return (\n    <div\n      {...props}\n      className={cn(\n        \"bg-size animate-bg-position bg-[length:200%_auto] bg-clip-text text-transparent\",\n        gradients[variant],\n        className,\n      )}\n    >\n      {children}\n    </div>\n  );\n} ","import { useEffect, RefObject } from \"react\";\n\nexport function useMousePosition<T extends HTMLElement = HTMLElement>(\n  ref: RefObject<T>,\n  callback?: ({ x, y }: { x: number; y: number }) => void,\n) {\n  useEffect(() => {\n    const handleMouseMove = (event: MouseEvent) => {\n      const { clientX, clientY } = event;\n      const { top, left } = ref.current?.getBoundingClientRect() || {\n        top: 0,\n        left: 0,\n      };\n      callback?.({ x: clientX - left, y: clientY - top });\n    };\n    const handleTouchMove = (event: TouchEvent) => {\n      const { clientX, clientY } = event.touches[0];\n      const { top, left } = ref.current?.getBoundingClientRect() || {\n        top: 0,\n        left: 0,\n      };\n      callback?.({ x: clientX - left, y: clientY - top });\n    };\n    ref.current?.addEventListener(\"mousemove\", handleMouseMove, { passive: true });\n    ref.current?.addEventListener(\"touchmove\", handleTouchMove, { passive: true });\n    const nodeRef = ref.current;\n    return () => {\n      nodeRef?.removeEventListener(\"mousemove\", handleMouseMove);\n      nodeRef?.removeEventListener(\"touchmove\", handleTouchMove);\n    };\n  }, [ref, callback]);\n} ","import React, { useRef, useState } from \"react\";\nimport { cn } from \"../../lib/utils\";\nimport { useMousePosition } from \"../../hooks/useMousePosition\";\n\ninterface LightingTextProps extends React.HTMLAttributes<HTMLDivElement> {\n  baseColor?: string;\n  highlightColor?: string;\n  size?: number;\n  children: React.ReactNode;\n}\n\nexport default function LightingText({\n  className,\n  baseColor = \"text-gray-800\",\n  highlightColor = \"text-indigo-600\",\n  size = 150,\n  children,\n  ...props\n}: LightingTextProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [isHovering, setIsHovering] = useState(false);\n\n  useMousePosition(containerRef, ({ x, y }) => {\n    setPosition({ x, y });\n  });\n\n  return (\n    <div\n      ref={containerRef}\n      className={cn(\"relative\", className)}\n      onMouseEnter={() => setIsHovering(true)}\n      onMouseLeave={() => setIsHovering(false)}\n      {...props}\n    >\n      <div className={cn(\"transition-colors duration-200\", baseColor)}>\n        {children}\n      </div>\n      \n      {isHovering && (\n        <div \n          className={cn(\"absolute top-0 left-0 w-full h-full pointer-events-none\", highlightColor)}\n          style={{\n            WebkitMaskImage: `radial-gradient(${size}px circle at ${position.x}px ${position.y}px, black 10%, transparent 70%)`,\n            maskImage: `radial-gradient(${size}px circle at ${position.x}px ${position.y}px, black 10%, transparent 70%)`,\n          }}\n        >\n          {children}\n        </div>\n      )}\n    </div>\n  );\n} ","import React, { useRef, useState } from \"react\";\nimport { cn } from \"../../lib/utils\";\nimport { useMousePosition } from \"../../hooks/useMousePosition\";\n\ninterface SpotlightCardProps extends React.HTMLAttributes<HTMLDivElement> {\n  glowColor?: string;\n  size?: number;\n  strength?: number;\n  children: React.ReactNode;\n}\n\nexport default function SpotlightCard({\n  className,\n  glowColor = \"rgba(120, 119, 198, 0.4)\",\n  size = 350,\n  strength = 0.3,\n  children,\n  ...props\n}: SpotlightCardProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [opacity, setOpacity] = useState(0);\n\n  useMousePosition(containerRef, ({ x, y }) => {\n    setPosition({ x, y });\n    setOpacity(1);\n  });\n\n  return (\n    <div\n      ref={containerRef}\n      className={cn(\"relative overflow-hidden rounded-xl bg-white\", className)}\n      onMouseLeave={() => setOpacity(0)}\n      {...props}\n    >\n      <div\n        className=\"pointer-events-none absolute -inset-px opacity-0 transition-opacity duration-300\"\n        style={{\n          opacity,\n          background: `radial-gradient(${size}px circle at ${position.x}px ${position.y}px, ${glowColor}, transparent ${strength * 100}%)`,\n        }}\n      />\n      {children}\n    </div>\n  );\n} ","import React, { useState } from 'react';\r\nimport { AlertTriangle, X, Info, Search, ExternalLink, Copy, Check } from 'lucide-react';\r\nimport { FailedTrack } from '../lib/ConversionContext';\r\n\r\ninterface EnhancedFailedTracksModalProps {\r\n  failedTracks: FailedTrack[];\r\n  onClose: () => void;\r\n  onAddToYouTube?: (videoId: string, trackIndex: number) => void;\r\n  onAddToSpotify?: (trackUri: string, trackIndex: number) => void;\r\n}\r\n\r\n// Helper function to generate alternative search queries\r\nconst generateAlternativeQueries = (track: FailedTrack): string[] => {\r\n  const queries: string[] = [];\r\n  const artist = track.artists[0];\r\n  const title = track.name;\r\n  \r\n  // Remove common prefixes/suffixes\r\n  const cleanTitle = title\r\n    .replace(/\\(feat\\.?.*?\\)/gi, '')\r\n    .replace(/\\(Explicit.*?\\)/gi, '')\r\n    .replace(/\\(Album Version\\)/gi, '')\r\n    .replace(/\\(Clean.*?\\)/gi, '')\r\n    .trim();\r\n  \r\n  // Basic variations\r\n  queries.push(`${artist} ${cleanTitle}`);\r\n  queries.push(`${cleanTitle} ${artist}`);\r\n  queries.push(`${artist} - ${cleanTitle}`);\r\n  \r\n  // Artist variations\r\n  if (artist.includes('(') && artist.includes(')')) {\r\n    const mainArtist = artist.split('(')[0].trim();\r\n    queries.push(`${mainArtist} ${cleanTitle}`);\r\n  }\r\n  \r\n  // Title variations\r\n  if (cleanTitle.includes('(')) {\r\n    const mainTitle = cleanTitle.split('(')[0].trim();\r\n    queries.push(`${artist} ${mainTitle}`);\r\n  }\r\n  \r\n  // Remove \"feat.\" variations\r\n  if (artist.toLowerCase().includes('feat')) {\r\n    const mainArtist = artist.split(/feat\\.?/i)[0].trim();\r\n    queries.push(`${mainArtist} ${cleanTitle}`);\r\n  }\r\n  \r\n  return [...new Set(queries)]; // Remove duplicates\r\n};\r\n\r\nexport const EnhancedFailedTracksModal: React.FC<EnhancedFailedTracksModalProps> = ({\r\n  failedTracks,\r\n  onClose,\r\n  onAddToYouTube,\r\n  onAddToSpotify\r\n}) => {\r\n  const [copiedQuery, setCopiedQuery] = useState<string | null>(null);\r\n  const [manualInputs, setManualInputs] = useState<{ [key: number]: { youtube: string; spotify: string } }>({});\r\n\r\n  const handleCopyQuery = async (query: string) => {\r\n    try {\r\n      await navigator.clipboard.writeText(query);\r\n      setCopiedQuery(query);\r\n      setTimeout(() => setCopiedQuery(null), 2000);\r\n    } catch (err) {\r\n      console.error('Failed to copy to clipboard:', err);\r\n    }\r\n  };\r\n\r\n  const handleAddToYouTube = (trackIndex: number) => {\r\n    const videoId = manualInputs[trackIndex]?.youtube;\r\n    if (videoId && onAddToYouTube) {\r\n      onAddToYouTube(videoId, trackIndex);\r\n    }\r\n  };\r\n\r\n  const handleAddToSpotify = (trackIndex: number) => {\r\n    const trackUri = manualInputs[trackIndex]?.spotify;\r\n    if (trackUri && onAddToSpotify) {\r\n      onAddToSpotify(trackUri, trackIndex);\r\n    }\r\n  };\r\n\r\n  const updateManualInput = (trackIndex: number, platform: 'youtube' | 'spotify', value: string) => {\r\n    let processedValue = value;\r\n    \r\n    // Auto-extract video ID from YouTube URLs\r\n    if (platform === 'youtube' && (value.includes('youtube.com') || value.includes('youtu.be'))) {\r\n      const match = value.match(/(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/\\s]{11})/);\r\n      if (match) {\r\n        processedValue = match[1];\r\n      }\r\n    }\r\n    \r\n    // Auto-extract track URI from Spotify URLs\r\n    if (platform === 'spotify' && value.includes('spotify.com/track/')) {\r\n      const match = value.match(/spotify\\.com\\/track\\/([a-zA-Z0-9]+)/);\r\n      if (match) {\r\n        processedValue = `spotify:track:${match[1]}`;\r\n      }\r\n    }\r\n    \r\n    setManualInputs(prev => ({\r\n      ...prev,\r\n      [trackIndex]: {\r\n        ...prev[trackIndex],\r\n        [platform]: processedValue\r\n      }\r\n    }));\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50\">\r\n      <div className=\"bg-surface-card rounded-lg shadow-xl max-w-6xl w-full max-h-[80vh] overflow-hidden\">\r\n        <div className=\"flex items-center justify-between p-4 md:p-6 border-b border-border-default\">\r\n          <h3 className=\"text-lg md:text-xl font-bold text-content-primary flex items-center gap-2\">\r\n            <AlertTriangle className=\"h-5 w-5 text-error-text\" />\r\n            Failed Tracks Details\r\n          </h3>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-content-secondary hover:text-content-primary transition-colors\"\r\n            aria-label=\"Close modal\"\r\n          >\r\n            <X className=\"h-6 w-6\" />\r\n          </button>\r\n        </div>\r\n        \r\n        <div className=\"p-4 md:p-6 overflow-y-auto max-h-[60vh]\">\r\n          <div className=\"mb-4 md:mb-6\">\r\n            <div className=\"text-sm text-content-secondary mb-3 md:mb-4\">\r\n              {failedTracks.length} tracks failed to convert. Use the search tools below to find and add missing tracks:\r\n            </div>\r\n            \r\n            {/* Smart Search Tips */}\r\n            <div className=\"bg-warning-bg border border-warning-border rounded-lg p-3 md:p-4 mb-4 md:mb-6\">\r\n              <h4 className=\"font-semibold text-warning-text mb-2 flex items-center gap-2\">\r\n                <Info className=\"h-4 w-4\" />\r\n                Smart Search Tips\r\n              </h4>\r\n              <ul className=\"text-sm text-content-secondary space-y-1\">\r\n                <li>• Try removing \"feat.\" or \"(feat.)\" from artist names</li>\r\n                <li>• Search for just the main artist name</li>\r\n                <li>• Try different spellings or abbreviations</li>\r\n                <li>• For explicit content, try searching without \"Explicit\" in the title</li>\r\n                <li>• Use YouTube's search suggestions for better results</li>\r\n                <li>• Check for remixes, covers, or live versions</li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"space-y-4 md:space-y-6\">\r\n            {failedTracks.map((track, index) => (\r\n              <div key={index} className=\"border border-border-default rounded-lg p-3 md:p-4 bg-surface-alt\">\r\n                <div className=\"flex items-start justify-between mb-3 md:mb-4\">\r\n                  <div className=\"flex-1\">\r\n                    <h4 className=\"font-semibold text-content-primary mb-1\">\r\n                      {track.name}\r\n                    </h4>\r\n                    <p className=\"text-sm text-content-secondary\">\r\n                      by {track.artists.join(', ')}\r\n                    </p>\r\n                  </div>\r\n                  {track.bestMatchScore !== undefined && track.bestMatchScore > 0 && (\r\n                    <div className=\"text-right\">\r\n                      <span className=\"text-xs bg-warning-bg text-warning-text px-2 py-1 rounded\">\r\n                        Best match: {Math.round(track.bestMatchScore * 100)}%\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                \r\n                <div className=\"space-y-2 md:space-y-3 mb-3 md:mb-4\">\r\n                  <div>\r\n                    <span className=\"text-sm font-medium text-content-primary\">Reason:</span>\r\n                    <p className=\"text-sm text-error-text mt-1\">{track.reason}</p>\r\n                  </div>\r\n                  \r\n                  {track.bestMatchTitle && track.bestMatchTitle !== 'None' && track.bestMatchTitle !== 'Error occurred' && (\r\n                    <div>\r\n                      <span className=\"text-sm font-medium text-content-primary\">Best match found:</span>\r\n                      <p className=\"text-sm text-content-secondary mt-1\">\r\n                        \"{track.bestMatchTitle}\" by {track.bestMatchArtist}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  <div>\r\n                    <span className=\"text-sm font-medium text-content-primary\">Search queries tried:</span>\r\n                    <div className=\"flex flex-wrap gap-1 mt-1\">\r\n                      {track.searchQueries.map((query, queryIndex) => (\r\n                        <span\r\n                          key={queryIndex}\r\n                          className=\"text-xs bg-input text-content-secondary px-2 py-1 rounded\"\r\n                        >\r\n                          \"{query}\"\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Smart Search Section */}\r\n                <div className=\"border-t border-border-default pt-4\">\r\n                  <h5 className=\"font-medium text-content-primary mb-3 flex items-center gap-2\">\r\n                    <Search className=\"h-4 w-4\" />\r\n                    Find This Track:\r\n                  </h5>\r\n                  \r\n                  {/* Alternative Search Queries */}\r\n                  <div className=\"mb-4\">\r\n                    <span className=\"text-sm font-medium text-content-primary\">Try these alternative searches:</span>\r\n                    <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                      {generateAlternativeQueries(track).map((query, queryIndex) => (\r\n                        <button\r\n                          key={queryIndex}\r\n                          onClick={() => handleCopyQuery(query)}\r\n                          className=\"text-xs bg-brand-primary/10 text-brand-primary px-3 py-1 rounded-full hover:bg-brand-primary/20 transition-colors cursor-pointer flex items-center gap-1\"\r\n                        >\r\n                          {copiedQuery === query ? (\r\n                            <>\r\n                              <Check className=\"h-3 w-3\" />\r\n                              Copied!\r\n                            </>\r\n                          ) : (\r\n                            <>\r\n                              <Copy className=\"h-3 w-3\" />\r\n                              {query}\r\n                            </>\r\n                          )}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Direct Search Links */}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n                    {/* YouTube Search */}\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-content-primary\">YouTube Search:</label>\r\n                      <div className=\"flex gap-2\">\r\n                        <input\r\n                          type=\"text\"\r\n                          defaultValue={track.artists[0] + ' ' + track.name}\r\n                          className=\"flex-1 px-3 py-2 bg-input border border-border-default rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-brand-primary\"\r\n                          placeholder=\"Search YouTube...\"\r\n                        />\r\n                        <button\r\n                          onClick={() => {\r\n                            const query = encodeURIComponent(track.artists[0] + ' ' + track.name);\r\n                            window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');\r\n                          }}\r\n                          className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm flex items-center justify-center\"\r\n                        >\r\n                          <Search className=\"h-4 w-4\" />\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Spotify Search */}\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-content-primary\">Spotify Search:</label>\r\n                      <div className=\"flex gap-2\">\r\n                        <input\r\n                          type=\"text\"\r\n                          defaultValue={track.artists[0] + ' ' + track.name}\r\n                          className=\"flex-1 px-3 py-2 bg-input border border-border-default rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-brand-primary\"\r\n                          placeholder=\"Search Spotify...\"\r\n                        />\r\n                        <button\r\n                          onClick={() => {\r\n                            const query = encodeURIComponent(track.artists[0] + ' ' + track.name);\r\n                            window.open(`https://open.spotify.com/search/${query}`, '_blank');\r\n                          }}\r\n                          className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm flex items-center justify-center\"\r\n                        >\r\n                          <Search className=\"h-4 w-4\" />\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Manual Track Addition */}\r\n                  <div className=\"p-4 bg-surface-card rounded-lg border border-border-default\">\r\n                    <h6 className=\"font-medium text-content-primary mb-3\">Add Track Manually:</h6>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                      <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium text-content-primary\">YouTube Video ID:</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          placeholder=\"e.g., dQw4w9WgXcQ or https://youtu.be/dQw4w9WgXcQ\"\r\n                          value={manualInputs[index]?.youtube || ''}\r\n                          onChange={(e) => updateManualInput(index, 'youtube', e.target.value)}\r\n                          className=\"w-full px-3 py-2 bg-input border border-border-default rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-brand-primary\"\r\n                        />\r\n                        <p className=\"text-xs text-content-secondary\">\r\n                          Paste a YouTube URL or enter the 11-character video ID\r\n                        </p>\r\n                        <button \r\n                          onClick={() => handleAddToYouTube(index)}\r\n                          disabled={!manualInputs[index]?.youtube}\r\n                          className=\"w-full px-3 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        >\r\n                          Add to YouTube Playlist\r\n                        </button>\r\n                      </div>\r\n                      \r\n                      <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium text-content-primary\">Spotify Track URI:</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          placeholder=\"e.g., spotify:track:4iV5W9uYEdYUVa79Axb7Rh or https://open.spotify.com/track/4iV5W9uYEdYUVa79Axb7Rh\"\r\n                          value={manualInputs[index]?.spotify || ''}\r\n                          onChange={(e) => updateManualInput(index, 'spotify', e.target.value)}\r\n                          className=\"w-full px-3 py-2 bg-input border border-border-default rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-brand-primary\"\r\n                        />\r\n                        <p className=\"text-xs text-content-secondary\">\r\n                          Paste a Spotify track URL or enter the track URI\r\n                        </p>\r\n                        <button \r\n                          onClick={() => handleAddToSpotify(index)}\r\n                          disabled={!manualInputs[index]?.spotify}\r\n                          className=\"w-full px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        >\r\n                          Add to Spotify Playlist\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center justify-between p-4 md:p-6 border-t border-border-default bg-surface-alt\">\r\n          <div className=\"text-sm text-content-secondary\">\r\n            {failedTracks.length} failed tracks\r\n          </div>\r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              onClick={() => {\r\n                // Open all failed tracks in YouTube search\r\n                const queries = failedTracks.map(track => \r\n                  encodeURIComponent(track.artists[0] + ' ' + track.name)\r\n                );\r\n                queries.forEach(query => {\r\n                  window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');\r\n                });\r\n              }}\r\n              className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm flex items-center gap-2 whitespace-nowrap shadow-sm\"\r\n            >\r\n              <ExternalLink className=\"h-4 w-4\" />\r\n              Search All on YouTube\r\n            </button>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 bg-brand-primary text-white rounded-md hover:bg-brand-primaryHover transition-colors text-sm shadow-sm\"\r\n            >\r\n              Close\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\n\ninterface SoundSwappLogoProps {\n  width?: number;\n  height?: number;\n  className?: string;\n}\n\nconst SoundSwappLogo: React.FC<SoundSwappLogoProps> = ({ width = 36, height = 36, className }) => (\n  <svg\n    width={width}\n    height={height}\n    viewBox=\"0 0 36 36\"\n    fill=\"currentColor\"\n    className={className}\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <defs>\n      <linearGradient id=\"soundswapp-grad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n        <stop offset=\"0%\" stopColor=\"var(--brand-primary)\" />\n        <stop offset=\"35%\" stopColor=\"var(--brand-accent-pink)\" />\n        <stop offset=\"100%\" stopColor=\"var(--brand-secondary)\" />\n      </linearGradient>\n      <filter id=\"glow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n        <feGaussianBlur stdDeviation=\"1.8\" result=\"blur\" />\n        <feOffset dy=\"1\" result=\"offsetBlur\" />\n        <feMerge>\n          <feMergeNode in=\"offsetBlur\" />\n          <feMergeNode in=\"SourceGraphic\" />\n        </feMerge>\n      </filter>\n      <pattern id=\"bg-pattern\" patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\">\n        <path d=\"M-1,1 l2,-2 M0,10 l10,-10 M9,11 l2,-2\" stroke=\"rgba(255,255,255,0.03)\" strokeWidth=\"0.5\"/>\n      </pattern>\n    </defs>\n    <circle cx=\"18\" cy=\"18\" r=\"18\" fill=\"url(#soundswapp-grad)\" opacity=\"0.9\" />\n    <circle cx=\"18\" cy=\"18\" r=\"18\" fill=\"url(#bg-pattern)\" opacity=\"0.5\"/>\n    <g filter=\"url(#glow)\" transform=\"translate(0.5, 0.5)\">\n      <path\n        d=\"M12.5 23.5 C10 23.5 8.5 21.5 9 19 C9.5 16.5 12.5 15.5 15 15.5 C17.5 15.5 19.5 14 19 11.5 C18.5 9 16.5 7.5 14 7.5\"\n        stroke=\"white\" fill=\"none\" strokeWidth=\"2.2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"\n      />\n      <path\n        d=\"M12.8 23 C10.5 23 9.3 21.3 9.7 19.2 C10.1 17.1 12.8 16.1 15 16.1 C17.2 16.1 18.8 14.7 18.4 12.5 C18.0 10.3 16.2 8.5 14 8.5\"\n        stroke=\"rgba(255,255,255,0.5)\" fill=\"none\" strokeWidth=\"0.8\" strokeLinecap=\"round\" strokeLinejoin=\"round\"\n      />\n      <path\n        d=\"M23.5 23.5 C26 23.5 27.5 21.5 27 19 C26.5 16.5 23.5 15.5 21 15.5 C18.5 15.5 16.5 14 17 11.5 C17.5 9 19.5 7.5 22 7.5\"\n        stroke=\"white\" fill=\"none\" strokeWidth=\"2.2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"\n      />\n      <path\n        d=\"M23.2 23 C25.5 23 26.7 21.3 26.3 19.2 C25.9 17.1 23.2 16.1 21 16.1 C18.8 16.1 17.2 14.7 17.6 12.5 C18.0 10.3 19.8 8.5 22 8.5\"\n        stroke=\"rgba(255,255,255,0.5)\" fill=\"none\" strokeWidth=\"0.8\" strokeLinecap=\"round\" strokeLinejoin=\"round\"\n      />\n    </g>\n  </svg>\n);\n\nexport default SoundSwappLogo; ","import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { EnhancedHeroSection } from './EnhancedHeroSection';\nimport { useTheme } from '../lib/ThemeContext';\nimport { useAuth } from '../lib/AuthContext';\nimport { useConversion, type FailedTrack } from '../lib/ConversionContext';\nimport { ConversionStatus } from '../types/conversion';\nimport { getYouTubeAuthUrl, getYouTubeToken } from '../lib/youtubeAuth';\nimport { initSpotifyAuth } from '../lib/spotifyAuth';\nimport { cn } from '../lib/utils';\nimport { GlassmorphicCard } from './ui/GlassmorphicCard';\nimport { Enhanced3DCard } from './ui/Enhanced3DCard';\nimport { EnhancedGradientText } from './ui/EnhancedGradientText';\nimport { SuccessCelebration } from './feedback/SuccessCelebration';\nimport { ToastContainer, Toast } from './feedback/EnhancedToast';\nimport { PlaylistInsights } from './visualization/PlaylistInsights';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport EnhancedConnectionCard from './EnhancedConnectionCard';\nimport { GlowButton } from './ui/GlowButton';\nimport { ParticleField } from './ui/ParticleField';\nimport { GlassmorphicContainer } from './ui/GlassmorphicContainer';\nimport { FloatingLabels } from './ui/FloatingLabels';\nimport AnimatedGradientText from './ui/AnimatedGradientText';\nimport LightingText from './ui/LightingText'; // Added import\nimport SpotlightCard from './ui/SpotlightCard'; // Added import\nimport { EnhancedFailedTracksModal } from './EnhancedFailedTracksModal';\nimport SoundSwappLogo from '../assets/SoundSwappLogo';\nimport { addToYouTubePlaylist } from '../lib/youtubeApi';\nimport { addTracksToSpotifyPlaylist } from '../lib/spotifyApi';\n\n// Import Lucide React icons\nimport { \n  FileSpreadsheet, \n  CheckCircle,\n  Loader,\n  Music,\n  Github,\n  Mail,\n  ExternalLink,\n  RefreshCw,\n  Shield,\n  Zap,\n  Info,\n  AlertTriangle,\n  ChevronRight,\n  ChevronLeft,\n  Upload,\n  Download,\n  ClipboardPaste,\n  Search,\n  LogOut,\n  Lock,\n  PlayCircle,\n  Settings,\n  Headphones,\n  Youtube,\n  Loader2,\n  X,\n  Play,\n  Pause,\n  SkipBack,\n  SkipForward,\n  Volume2,\n  VolumeX,\n  Clock,\n  Users,\n  Heart,\n  Star,\n  TrendingUp,\n  Calendar,\n  MapPin,\n  Globe,\n  Activity,\n  BarChart3,\n  PieChart,\n  Target,\n  Sparkles,\n  Palette,\n  Filter,\n  Share2,\n  Plus,\n  Minus,\n  RotateCcw,\n  Eye,\n  EyeOff,\n  ChevronDown,\n  ChevronUp,\n  ArrowRight,\n  ArrowLeft,\n  Copy,\n  Check,\n  User,\n  Phone,\n  Unlock,\n  Key,\n  ShieldCheck,\n  AlertCircle,\n  HelpCircle,\n  MessageCircle,\n  ThumbsUp,\n  ThumbsDown,\n  Flag,\n  Bookmark\n} from 'lucide-react';\n// Import real Spotify icon\nimport { FaSpotify } from 'react-icons/fa';\n\n// Platform key type\nexport type PlatformKey = 'spotify' | 'youtube' | 'soundcloud';\n\n// Define YouTube playlist interface\ninterface YouTubePlaylist {\n  id: string;\n  snippet?: {\n    title?: string;\n    thumbnails?: {\n      default?: {\n        url: string;\n      };\n    };\n    channelTitle?: string;\n  };\n  contentDetails?: {\n    itemCount?: number;\n  };\n}\n\n// Enhanced track interface\ninterface Track {\n  id: string;\n  name: string;\n  artists: string[];\n  artistIds?: string[];\n  artistImages?: string[];\n  genres?: string[];\n  album?: string;\n  duration_ms: number;\n  popularity: number;\n  explicit?: boolean;\n  releaseYear?: string;\n  searchQuery?: string;\n  videoId?: string;\n}\n\n// Keyboard accessibility helper\ninterface KeyboardFocusableCardProps {\n  children: React.ReactNode;\n  onKeyDown?: React.KeyboardEventHandler<HTMLDivElement>;\n  onClick?: React.MouseEventHandler<HTMLDivElement>;\n  className?: string;\n  [key: string]: any;\n}\n\nconst KeyboardFocusableCard: React.FC<KeyboardFocusableCardProps> = ({ \n  children, \n  onKeyDown, \n  onClick, \n  className, \n  ...props \n}) => {\n  const handleKeyDown = useCallback((e: React.KeyboardEvent<HTMLDivElement>) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      onKeyDown?.(e);\n      \n      if (!e.defaultPrevented && onClick) {\n        onClick(e as unknown as React.MouseEvent<HTMLDivElement>);\n      }\n    } else if (onKeyDown) {\n      onKeyDown(e);\n    }\n  }, [onKeyDown, onClick]);\n\n  return (\n    <div \n      tabIndex={0} \n      role=\"button\"\n      className={cn(\n        \"focus:outline-none focus:ring-2 focus:ring-brand-primary-action focus:ring-offset-2 focus:ring-offset-background-primary rounded-lg transition-all\",\n        className\n      )}\n      onKeyDown={handleKeyDown}\n      onClick={onClick}\n      {...props}\n    >\n      {children}\n                </div>\n              );\n};\n\n// Create a reusable connection button component\ninterface ConnectButtonProps {\n  platform: PlatformKey;\n  isConnected: boolean;\n  onConnect: () => void;\n  className?: string;\n}\n\n// Platform connection button component\nconst ConnectButton: React.FC<ConnectButtonProps> = ({ platform, isConnected, onConnect, className }) => {\n  const { isDark } = useTheme();\n  \n  const platformData = {\n    spotify: {\n      icon: (\n        <img \n          src=\"/images/Spotify_Primary_Logo_RGB_Green.png\" \n          alt=\"Spotify\" \n          style={{ \n            height: 24, \n            width: 'auto', \n            objectFit: 'contain', \n            display: 'block',\n            minWidth: '24px'\n          }} \n          className=\"h-6 w-auto\" \n        />\n      ),\n      text: 'Spotify',\n      bgColor: 'bg-platform-spotify hover:bg-platform-spotify-hover',\n      bgColorConnected: 'bg-platform-spotify-connected text-content-on-platform-spotify-connected'\n    },\n    youtube: {\n      icon: (\n        <img \n          src={isConnected ? \"/images/yt_logo_rgb_dark.png\" : (isDark ? \"/images/yt_logo_mono_dark.png\" : \"/images/yt_logo_mono_light.png\")}\n          alt=\"YouTube\" \n          style={{ \n            height: 24, \n            width: 'auto', \n            objectFit: 'contain', \n            display: 'block',\n            minWidth: '24px'\n          }} \n          className=\"h-6 w-auto\" \n        />\n      ),\n      text: 'YouTube',\n      bgColor: 'bg-platform-youtube hover:bg-platform-youtube-hover',\n      bgColorConnected: 'bg-platform-youtube-connected text-content-on-platform-youtube-connected'\n    },\n    soundcloud: {\n      icon: <Music className=\"h-5 w-5\" />,\n      text: 'SoundCloud',\n      bgColor: 'bg-platform-soundcloud hover:bg-platform-soundcloud-hover', \n      bgColorConnected: 'bg-platform-soundcloud-connected text-content-on-platform-soundcloud-connected'\n    }\n  };\n\n  const data = platformData[platform];\n  \n  return (\n    <button\n      onClick={onConnect}\n      disabled={isConnected}\n      className={cn(\n        \"flex items-center justify-center gap-2 px-5 py-3 rounded-lg font-medium transition-colors\",\n        isConnected \n          ? data.bgColorConnected\n          : `${data.bgColor} text-content-inverse`, // Assuming default button text is on a dark/colored background\n        \"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background-primary\", \n        // Determine focus ring color based on platform or a generic action color\n        platform === 'spotify' ? 'focus:ring-platform-spotify' :\n        platform === 'youtube' ? 'focus:ring-platform-youtube' :\n        platform === 'soundcloud' ? 'focus:ring-platform-soundcloud' :\n        'focus:ring-brand-primary-action',\n        className\n      )}\n      aria-label={`${isConnected ? 'Connected to' : 'Connect to'} ${data.text}`}\n    >\n      {data.icon}\n      <span>{isConnected ? 'Connected' : `Connect ${data.text}`}</span>\n      {isConnected && <CheckCircle className=\"h-5 w-5 text-current\" />}\n                </button>\n  );\n};\n\n// Define insights interfaces\nimport { PlaylistTypes } from '../types/playlist';\n\n// Use shared types\ntype PlaylistStats = PlaylistTypes.PlaylistStats;\ntype Album = PlaylistTypes.Album;\ntype Genre = PlaylistTypes.Genre;\ntype Artist = PlaylistTypes.Artist;\n\ninterface ConversionTrack {\n  name: string;\n  artists: string[];\n  popularity?: number;\n  duration_ms?: number;\n  explicit?: boolean;\n  album?: string;\n  releaseYear?: string | number;\n  genres?: string[];\n  artistImages?: string[];\n}\n\n// Convert track to the correct type\nconst convertTrack = (track: ConversionTrack): PlaylistTypes.Track => ({\n  name: track.name,\n  artists: track.artists,\n  popularity: track.popularity,\n  duration_ms: track.duration_ms,\n  explicit: track.explicit,\n  album: track.album,\n  releaseYear: track.releaseYear ? Number(track.releaseYear) : undefined,\n  genres: track.genres,\n  artistImages: track.artistImages\n});\n\n// Generate a consistent color for a genre\nconst generateGenreColor = (genre: string): string => {\n  // Create a hash of the genre name\n  let hash = 0;\n  for (let i = 0; i < genre.length; i++) {\n    hash = genre.charCodeAt(i) + ((hash << 5) - hash);\n  }\n  \n  // Convert to HSL color\n  const h = Math.abs(hash % 360);\n  return `hsl(${h}, 70%, 50%)`;\n};\n\n// Function to get playlist insights from the tracks data\nconst generatePlaylistInsights = (tracks: ConversionTrack[]): PlaylistStats => {\n  const artistCounts: Record<string, number> = {};\n  const artistImages: Record<string, string> = {};\n  const genreCounts: Record<string, number> = {};\n  const yearCounts: Record<string, number> = {};\n  const albumCounts: Record<string, number> = {};\n  const genres = new Set<string>();\n  let totalTracks = tracks.length;\n  let explicitCount = 0;\n  let nonExplicitCount = 0;\n  let validPopularityCount = 0;\n  let totalPopularity = 0;\n  let totalDuration = 0;\n  let longestTrackDuration = 0;\n  let shortestTrackDuration = Infinity;\n  let longestTrack: ConversionTrack | null = null;\n  let shortestTrack: ConversionTrack | null = null;\n  let mostPopularTrack: ConversionTrack | null = null;\n  let leastPopularTrack: ConversionTrack | null = null;\n  let highestPopularity = 0;\n  let lowestPopularity = 100;\n  let oldestYear = '9999';\n  let newestYear = '0';\n  let oldestTrack: ConversionTrack | null = null;\n  let newestTrack: ConversionTrack | null = null;\n\n  // Duration categories\n  const durationCategories = {\n    short: 0, // < 3 min\n    medium: 0, // 3-5 min\n    long: 0, // > 5 min\n  };\n\n  // Popularity ranges\n  const popularityRanges = {\n    low: 0, // 0-33\n    medium: 0, // 34-66\n    high: 0, // 67-100\n  };\n\n  // Process each track\n  tracks.forEach(track => {\n    // Process artists\n    track.artists.forEach((artist, index) => {\n      artistCounts[artist] = (artistCounts[artist] || 0) + 1;\n      if (track.artistImages?.[index] && !artistImages[artist]) {\n        artistImages[artist] = track.artistImages[index];\n      }\n    });\n\n    // Process genres\n    if (track.genres) {\n      track.genres.forEach(genre => {\n        genres.add(genre);\n        genreCounts[genre] = (genreCounts[genre] || 0) + 1;\n      });\n    }\n\n    // Process duration\n    if (track.duration_ms) {\n      totalDuration += track.duration_ms;\n      const durationMinutes = track.duration_ms / 1000 / 60;\n\n      if (durationMinutes < 3) durationCategories.short++;\n      else if (durationMinutes <= 5) durationCategories.medium++;\n      else durationCategories.long++;\n\n      if (track.duration_ms > longestTrackDuration) {\n        longestTrackDuration = track.duration_ms;\n        longestTrack = track;\n      }\n      if (track.duration_ms < shortestTrackDuration) {\n        shortestTrackDuration = track.duration_ms;\n        shortestTrack = track;\n      }\n    }\n\n    // Process popularity\n    if (track.popularity !== undefined) {\n      totalPopularity += track.popularity;\n      validPopularityCount++;\n\n      if (track.popularity <= 33) popularityRanges.low++;\n      else if (track.popularity <= 66) popularityRanges.medium++;\n      else popularityRanges.high++;\n\n      if (track.popularity > highestPopularity) {\n        highestPopularity = track.popularity;\n        mostPopularTrack = track;\n      }\n      if (track.popularity < lowestPopularity) {\n        lowestPopularity = track.popularity;\n        leastPopularTrack = track;\n      }\n    }\n\n    // Process release year\n    if (track.releaseYear) {\n      const year = track.releaseYear.toString();\n      yearCounts[year] = (yearCounts[year] || 0) + 1;\n\n      if (year < oldestYear) {\n        oldestYear = year;\n        oldestTrack = track;\n      }\n      if (year > newestYear) {\n        newestYear = year;\n        newestTrack = track;\n      }\n    }\n\n    // Process explicit content\n    if (track.explicit) explicitCount++;\n    else nonExplicitCount++;\n\n    // Process albums\n    if (track.album) {\n      albumCounts[track.album] = (albumCounts[track.album] || 0) + 1;\n    }\n  });\n\n  // Calculate genre percentages\n  const genrePercentages: Record<string, number> = {};\n  const totalGenreMentions = Object.values(genreCounts).reduce((a, b) => a + b, 0);\n  Object.entries(genreCounts).forEach(([genre, count]) => {\n    genrePercentages[genre] = (count / totalGenreMentions) * 100;\n  });\n\n  // Calculate yearly trends\n  const yearlyTrends = Object.entries(yearCounts)\n    .map(([year, count]) => ({\n      year,\n      count,\n      avgPopularity: tracks\n        .filter(t => t.releaseYear?.toString() === year && t.popularity !== undefined)\n        .reduce((acc, t) => acc + (t.popularity || 0), 0) / count\n    }))\n    .sort((a, b) => a.year.localeCompare(b.year));\n\n  // Calculate decade distribution\n  const decadeDistribution: Record<string, number> = {};\n  Object.entries(yearCounts).forEach(([year, count]) => {\n    const decade = year.slice(0, 3) + '0';\n    decadeDistribution[decade] = (decadeDistribution[decade] || 0) + count;\n  });\n\n  // Convert genres to array with colors\n  const genreArray = Array.from(genres).map(name => ({\n    name,\n    count: genreCounts[name],\n    color: generateGenreColor(name),\n    percentage: genrePercentages[name]\n  })).sort((a, b) => b.count - a.count);\n\n  // Convert artists to array with images\n  const artistArray = Object.entries(artistCounts)\n    .map(([name, count]) => ({\n      name,\n      count,\n      image: artistImages[name],\n      popularity: tracks.find(t => t.artists.includes(name))?.popularity\n    }))\n    .sort((a, b) => b.count - a.count)\n    .slice(0, 10); // Top 10 artists\n\n  // Convert albums to array\n  const albumArray = Object.entries(albumCounts)\n    .map(([name, trackCount]) => {\n      const track = tracks.find(t => t.album === name);\n      const year = track?.releaseYear ? Number(track.releaseYear) : undefined;\n      return { \n        name, \n        trackCount,\n        year: !isNaN(year as number) ? year : undefined\n      };\n    })\n    .sort((a, b) => b.trackCount - a.trackCount)\n    .slice(0, 5); // Top 5 albums\n\n  return {\n    totalTracks,\n    avgPopularity: validPopularityCount ? totalPopularity / validPopularityCount : 0,\n    totalDuration: Math.round(totalDuration / 60000), // Convert to minutes\n    genres: genreArray,\n    topArtists: artistArray,\n    releaseYears: yearCounts,\n    totalGenreMentions,\n    mostPopularTrack: mostPopularTrack ? convertTrack(mostPopularTrack) : undefined,\n    leastPopularTrack: leastPopularTrack ? convertTrack(leastPopularTrack) : undefined,\n    longestTrack: longestTrack ? convertTrack(longestTrack) : undefined,\n    shortestTrack: shortestTrack ? convertTrack(shortestTrack) : undefined,\n    explicitCount,\n    nonExplicitCount,\n    topAlbums: albumArray,\n    avgTrackLength: totalDuration / totalTracks,\n    oldestTrack: oldestTrack ? convertTrack(oldestTrack) : undefined,\n    newestTrack: newestTrack ? convertTrack(newestTrack) : undefined,\n    explicitPercentage: (explicitCount / totalTracks) * 100,\n    uniqueArtists: Object.keys(artistCounts).length,\n    uniqueAlbums: Object.keys(albumCounts).length,\n    decadeDistribution,\n    // New fields\n    genrePercentages,\n    yearlyTrends,\n    durationCategories,\n    popularityRanges,\n  };\n};\n\n// Helper function to calculate distribution array\nconst calculateDistributionArray = (values: number[], buckets: number): { range: string; count: number }[] => {\n  if (values.length === 0) return [];\n\n  const min = Math.min(...values);\n  const max = Math.max(...values);\n  const range = max - min;\n  const bucketSize = range / buckets;\n  const distribution: { range: string; count: number }[] = [];\n\n  values.forEach(value => {\n    const bucketIndex = Math.min(Math.floor((value - min) / bucketSize), buckets - 1);\n    const bucketKey = `${Math.round(min + bucketIndex * bucketSize)}-${Math.round(min + (bucketIndex + 1) * bucketSize)}`;\n    const existingBucket = distribution.find(d => d.range === bucketKey);\n    if (existingBucket) {\n      existingBucket.count++;\n    } else {\n      distribution.push({ range: bucketKey, count: 1 });\n    }\n  });\n\n  return distribution;\n};\n\n// Extract URL utility function\nconst extractPlaylistId = (url: string, platform: PlatformKey): string | null => {\n  if (!url) return null;\n  \n  try {\n    if (platform === 'spotify') {\n      // Handle URLs like https://open.spotify.com/playlist/37i9dQZF1DX0XUsuxWHRQd?si=abc123\n      // or spotify:playlist:37i9dQZF1DX0XUsuxWHRQd\n      let match = url.match(/spotify\\.com\\/playlist\\/([a-zA-Z0-9_-]+)/);\n      if (!match && url.includes('spotify:playlist:')) {\n        match = url.match(/spotify:playlist:([a-zA-Z0-9_-]+)/);\n      }\n      if (match && match[1]) {\n        // Remove any trailing query params or slashes\n        return match[1].split(/[/?#]/)[0];\n      }\n      \n      // Try direct ID format (if the user just pasted the ID)\n      if (/^[a-zA-Z0-9]{22}$/.test(url)) {\n        return url;\n      }\n    } else if (platform === 'youtube') {\n      // Handle URLs like https://www.youtube.com/playlist?list=PLw-VjHDlEOgvtnnnqWlTqryAtBXmZCujo\n      const match = url.match(/[?&]list=([a-zA-Z0-9_-]+)/);\n      if (match && match[1]) {\n        return match[1];\n      }\n      \n      // Try direct ID format (if the user just pasted the ID)\n      if (/^[a-zA-Z0-9_-]{24,34}$/.test(url)) {\n        return url;\n      }\n    }\n    } catch (error) {\n    console.error(\"Error extracting playlist ID:\", error);\n  }\n  \n  return null;\n};\n\n/**\n * Modern playlist converter with enhanced accessibility\n */\nconst ModernPlaylistConverter: React.FC = () => {\n  const { isDark } = useTheme();\n  const navigate = useNavigate();\n  \n  // Add mobile detection\n  const [isMobile, setIsMobile] = useState<boolean>(false);\n  \n  // Detect mobile devices on component mount\n  useEffect(() => {\n    const checkMobile = () => {\n      const mobile = window.innerWidth < 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n      setIsMobile(mobile);\n      \n      // Add mobile class to body for CSS targeting\n      if (mobile) {\n        document.body.classList.add('is-mobile');\n      } else {\n        document.body.classList.remove('is-mobile');\n      }\n    };\n    \n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n  \n  const { \n    user, \n    isAuthenticated, \n    hasSpotifyAuth, \n    hasYouTubeAuth,\n    signOut,\n    disconnectFromSpotify,\n    disconnectFromYouTube,\n    isConnectingSpotify,\n    isConnectingYouTube,\n    spotifyError,\n    youtubeError,\n    spotifyUserProfile,\n    youtubeUserProfile\n  } = useAuth();\n  \n  const conversion = useConversion();\n  const {\n    state: conversionState,\n    fetchSpotifyPlaylists,\n    selectPlaylist,\n    startConversion,\n    fetchConversionHistory,\n    dispatch\n  } = conversion;\n  \n  // Get YouTube methods safely \n  const fetchYouTubePlaylists = conversion.fetchYouTubePlaylists || (() => {\n    console.warn('fetchYouTubePlaylists not available');\n  });\n  \n  // Form state\n  const [spotifyUrl, setSpotifyUrl] = useState('');\n  const [youtubeUrl, setYoutubeUrl] = useState('');\n  const [showCelebration, setShowCelebration] = useState(false);\n  const [toasts, setToasts] = useState<Toast[]>([]);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [currentWizardStep, setCurrentWizardStep] = useState(1);\n  const [showPlaylistSuggestions, setShowPlaylistSuggestions] = useState(false);\n  const [showYoutubePlaylistSuggestions, setShowYoutubePlaylistSuggestions] = useState(false);\n  const [playlistNameForExport, setPlaylistNameForExport] = useState('');\n  const [playlistDescriptionForExport, setPlaylistDescriptionForExport] = useState('');\n  const [selectedFailedTracks, setSelectedFailedTracks] = useState<FailedTrack[] | null>(null);\n  \n  // Platform selection with proper typing\n  type PlatformInfo = {\n    key: PlatformKey;\n    label: string;\n    color: string;\n    icon: any; // Using any for icon is acceptable here since we know it's a FontAwesome icon\n  };\n  \n  const platforms = useMemo<PlatformInfo[]>(() => [\n    { key: 'spotify', label: 'Spotify', color: 'bg-green-500', icon: FaSpotify },\n    { key: 'youtube', label: 'YouTube', color: 'bg-red-500', icon: Youtube },\n  ], []);\n  \n  // State with proper typing\n  const [sourcePlatform, setSourcePlatform] = useState<PlatformKey>('spotify');\n  const [destinationPlatform, setDestinationPlatform] = useState<PlatformKey>('youtube');\n\n  // Ensure destination is never the same as source\n  useEffect(() => {\n    if (destinationPlatform === sourcePlatform) {\n      const next = platforms.find(p => p.key !== sourcePlatform);\n      if (next) setDestinationPlatform(next.key);\n    }\n    \n    // Save platform selections to localStorage for persistence\n    localStorage.setItem('source_platform', sourcePlatform);\n    localStorage.setItem('destination_platform', destinationPlatform);\n  }, [sourcePlatform, destinationPlatform, platforms]);\n  \n  // Restore saved platform selections on initial load\n  useEffect(() => {\n    const savedSource = localStorage.getItem('source_platform');\n    const savedDestination = localStorage.getItem('destination_platform');\n    const lastPlaylistUrl = localStorage.getItem('last_playlist_url');\n    \n    if (savedSource && platforms.some(p => p.key === savedSource as PlatformKey)) {\n      setSourcePlatform(savedSource as PlatformKey);\n    }\n    \n    if (savedDestination && platforms.some(p => p.key === savedDestination as PlatformKey) && savedDestination !== sourcePlatform) {\n      setDestinationPlatform(savedDestination as PlatformKey);\n    }\n    \n    if (lastPlaylistUrl) {\n      setSpotifyUrl(lastPlaylistUrl);\n    }\n  }, [platforms, sourcePlatform]);\n  \n  // Set the document title\n  useEffect(() => {\n    document.title = `Playlist Converter - Convert ${platforms.find(p => p.key === sourcePlatform)?.label} to ${platforms.find(p => p.key === destinationPlatform)?.label}`;\n  }, [sourcePlatform, destinationPlatform, platforms]);\n  \n  // Fetch conversion history when user is authenticated\n  const hasFetchedHistory = useRef(false);\n  useEffect(() => {\n    if (isAuthenticated && !hasFetchedHistory.current) {\n      hasFetchedHistory.current = true;\n      const loadHistory = async () => {\n        try {\n          await fetchConversionHistory();\n        } catch (error) {\n          console.error('Error loading conversion history:', error);\n        }\n      };\n      loadHistory();\n    }\n  }, [isAuthenticated, fetchConversionHistory]);\n  \n  // Set default playlist name and description when a playlist is selected\n  useEffect(() => {\n    if (conversionState.selectedPlaylistId && conversionState.spotifyPlaylists) {\n      const selectedPlaylist = conversionState.spotifyPlaylists.find(p => p.id === conversionState.selectedPlaylistId);\n      if (selectedPlaylist) {\n        setPlaylistNameForExport(`${selectedPlaylist.name} (Converted)`);\n        setPlaylistDescriptionForExport(`Converted from ${sourcePlatform} using SoundSwapp`);\n      }\n    }\n  }, [conversionState.selectedPlaylistId, conversionState.spotifyPlaylists, sourcePlatform]);\n  \n  // Show celebration when conversion is successful\n  useEffect(() => {\n    if (conversionState.status === ConversionStatus.SUCCESS) {\n      setShowCelebration(true);\n      setIsProcessing(false);\n      \n      // Determine destination platform and use appropriate playlist URL\n      const destinationIsSpotify = destinationPlatform === 'spotify';\n      const playlistUrl = destinationIsSpotify \n        ? conversionState.spotifyPlaylistUrl \n        : conversionState.youtubePlaylistUrl;\n      \n      const platformName = destinationIsSpotify ? 'Spotify' : 'YouTube';\n      \n      addToast({\n        type: 'success',\n        title: 'Conversion Complete',\n        message: `Your playlist has been successfully converted to ${platformName}!`,\n        actionLabel: 'View Playlist',\n        onAction: () => {\n          if (playlistUrl) {\n            window.open(playlistUrl, '_blank');\n          }\n        }\n      });\n      \n      // Move to final step in wizard\n      setCurrentWizardStep(4);\n    }\n  }, [conversionState.status, conversionState.youtubePlaylistUrl, conversionState.spotifyPlaylistUrl, destinationPlatform]);\n  \n  // Set processing state based on conversion status\n  useEffect(() => {\n    const processingStatuses = [\n      ConversionStatus.LOADING_TRACKS,\n      ConversionStatus.MATCHING_TRACKS,\n      ConversionStatus.CREATING_PLAYLIST\n    ];\n    \n    setIsProcessing(processingStatuses.includes(conversionState.status));\n  }, [conversionState.status]);\n  \n  // Track errors and notify the user\n  useEffect(() => {\n    if (conversionState.error) {\n      addToast({\n        type: 'error',\n        title: 'Conversion Error',\n        message: conversionState.error || 'An error occurred during conversion.',\n        actionLabel: 'Try Again'\n      });\n    }\n  }, [conversionState.error]);\n  \n  // Auto-advance Steps: Advance to step 3 when tracks are loaded after import\n  useEffect(() => {\n    if (currentWizardStep === 2 && conversionState.tracks.length > 0 && !isProcessing) {\n    setTimeout(() => {\n        setCurrentWizardStep(3);\n        // Scroll to wizard card\n        document.getElementById('playlist-wizard-card')?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      }, 500);\n    }\n    // Save last imported playlist URL\n    if (conversionState.selectedPlaylistId && currentWizardStep === 2) {\n      if (sourcePlatform === 'spotify') {\n        localStorage.setItem('last_playlist_url', spotifyUrl);\n      } else if (sourcePlatform === 'youtube') {\n        localStorage.setItem('last_playlist_url', youtubeUrl);\n      }\n    }\n  }, [conversionState.tracks.length, isProcessing, currentWizardStep, conversionState.selectedPlaylistId, spotifyUrl, youtubeUrl, sourcePlatform]);\n  \n  // Toast management\n  const dismissToast = useCallback((id: number) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id));\n  }, []);\n  \n  const addToast = useCallback(({ type, message, title, actionLabel, onAction, duration = 5000 }: Omit<Toast, 'id'> & { duration?: number }) => {\n    const id = Date.now();\n    const newToast: Toast = {\n      id,\n      type,\n      title: title || '',\n      message: message || '',\n      actionLabel,\n      onAction\n    };\n    \n    setToasts(prev => [...prev, newToast]);\n    \n    setTimeout(() => {\n      dismissToast(id);\n    }, duration);\n  }, [dismissToast]);\n  \n  // Show different toast types\n  const showToast = useCallback((type: 'success' | 'error' | 'warning' | 'info', message: string) => {\n    const toastConfig = {\n      success: {\n        title: 'Success',\n        message: message || 'Operation completed successfully!',\n        actionLabel: 'Ok'\n      },\n      error: {\n        title: 'Error',\n        message: message || 'Something went wrong. Please try again.',\n        actionLabel: 'Retry'\n      },\n      warning: {\n        title: 'Warning',\n        message: message || 'Some tracks might not have been matched correctly.',\n        actionLabel: 'Review'\n      },\n      info: {\n        title: 'Information',\n        message: message || 'Your conversion is being processed in the background.',\n        actionLabel: 'Details'\n      }\n    };\n    \n    addToast({\n      type,\n      title: toastConfig[type].title,\n      message: toastConfig[type].message,\n      actionLabel: toastConfig[type].actionLabel\n    });\n  }, [addToast]);\n  \n  // YouTube playlists data handling\n  const selectYouTubePlaylist = useCallback(async (id: string) => {\n    dispatch({ type: 'SET_STATUS', payload: ConversionStatus.LOADING_TRACKS });\n    setIsProcessing(true);\n    \n    // Select the playlist\n    dispatch({ type: 'SELECT_PLAYLIST', payload: id });\n    \n    // Call the YouTube API to get tracks from this playlist\n    const accessToken = await getYouTubeToken();\n    \n    if (!accessToken) {\n      showToast('error', 'YouTube authentication token not found. Please reconnect.');\n      setIsProcessing(false);\n      return;\n    }\n    \n    // Use a proper abort controller for the fetch\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n    \n    fetchAllYouTubePlaylistItems(id, accessToken)\n      .then(async allItems => {\n        if (!allItems || allItems.length === 0) {\n          console.warn('No tracks found in playlist or playlist is private/empty.');\n          setIsProcessing(false);\n          addToast({\n            type: 'error',\n            title: 'No tracks found',\n            message: 'This playlist appears to be empty or private.'\n          });\n          return;\n        }\n        // Step 1: Collect all videoIds\n        const videoIds = allItems.map((item: any) => item.snippet?.resourceId?.videoId || item.contentDetails?.videoId).filter(Boolean);\n        // Step 2: Fetch video details in batches of 50\n        const batches = [];\n        for (let i = 0; i < videoIds.length; i += 50) {\n          batches.push(videoIds.slice(i, i + 50));\n        }\n        let videoIdToYear: Record<string, number> = {};\n        for (const batch of batches) {\n          try {\n            const detailsResp = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${batch.join(',')}`, {\n              headers: { 'Authorization': `Bearer ${accessToken}` }\n            });\n            if (detailsResp.ok) {\n              const detailsData = await detailsResp.json();\n              detailsData.items.forEach((video: any) => {\n                if (video.id && video.snippet && video.snippet.publishedAt) {\n                  videoIdToYear[video.id] = parseInt(video.snippet.publishedAt.split('-')[0], 10);\n                }\n              });\n            }\n          } catch (err) {\n            console.error('Error fetching video details batch:', err);\n          }\n        }\n        // Step 3: Map tracks with releaseYear\n        const tracks: Track[] = allItems.map((item: any) => {\n            let videoTitle = item.snippet?.title || '';\n            let artists = [item.snippet?.videoOwnerChannelTitle || 'Unknown'];\n            let title = videoTitle;\n            // Smart parsing of video titles to extract artist and title\n            const separators = [' - ', ' – ', ': ', ' \"', \" '\", ' // '];\n            for (const separator of separators) {\n              if (videoTitle.includes(separator)) {\n                const parts = videoTitle.split(separator);\n                if (parts.length >= 2) {\n                  artists = [parts[0].trim()];\n                  title = parts.slice(1).join(separator).trim()\n                    .replace(/^['\"]/, '')\n                    .replace(/['\"]$/, '');\n                  break;\n                }\n              }\n            }\n          const videoId = item.snippet?.resourceId?.videoId || item.contentDetails?.videoId;\n            return {\n              id: item.id || `yt-${Math.random().toString(36).substring(2, 9)}`,\n              name: title,\n              artists: artists,\n              album: item.snippet?.channelTitle || '',\n              duration_ms: 0, // YouTube API doesn't provide duration in the playlist items response\n              popularity: 0,\n              explicit: false,\n              searchQuery: `${artists[0]} ${title}`,\n            videoId,\n            releaseYear: videoIdToYear[videoId]?.toString()\n            };\n          });\n        dispatch({ type: 'SET_TRACKS', payload: tracks as any });\n          setIsProcessing(false);\n          setTimeout(() => {\n            setCurrentWizardStep(3);\n            document.getElementById('playlist-wizard-card')?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n          }, 500);\n      })\n      .catch(error => {\n        setIsProcessing(false);\n        console.error('Error fetching YouTube playlist tracks:', error);\n        let errorMessage = 'An error occurred trying to load the YouTube playlist.';\n        if (error.name === 'AbortError') {\n          errorMessage = 'Request timed out. Please try again or check your internet connection.';\n        } else if (error.message && error.message.includes('401')) {\n          errorMessage = 'YouTube authorization expired. Please reconnect your YouTube account.';\n        } else if (error.message && error.message.includes('403')) {\n          errorMessage = 'You don\\'t have permission to access this playlist.';\n        } else if (error.message && error.message.includes('404')) {\n          errorMessage = 'Playlist not found. It may have been deleted or set to private.';\n        }\n        addToast({\n          type: 'error',\n          title: 'Failed to load playlist',\n          message: errorMessage\n        });\n      });\n  }, [dispatch, addToast, showToast]);\n\n  // Helper to fetch all YouTube playlist items with pagination\n  async function fetchAllYouTubePlaylistItems(playlistId: string, accessToken: string) {\n    let allItems: any[] = [];\n    let nextPageToken = '';\n    let page = 1;\n    try {\n      do {\n        const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet,contentDetails&maxResults=50&playlistId=${playlistId}` + (nextPageToken ? `&pageToken=${nextPageToken}` : '');\n        const resp = await fetch(url, {\n          headers: { 'Authorization': `Bearer ${accessToken}` }\n        });\n        if (!resp.ok) {\n          throw new Error(`YouTube API error: ${resp.status}`);\n        }\n        const data = await resp.json();\n        if (data.items && data.items.length > 0) {\n          allItems = allItems.concat(data.items);\n        }\n        nextPageToken = data.nextPageToken || '';\n        page++;\n      } while (nextPageToken);\n      return allItems;\n    } catch (err) {\n      console.error('Error fetching playlist items (pagination):', err);\n      return allItems;\n    }\n  }\n\n  // Handle playlist URL submission with improved error handling\n  const handlePlaylistUrlSubmit = useCallback(async (platform: PlatformKey) => {\n    const url = platform === 'spotify' ? spotifyUrl : youtubeUrl;\n    \n    if (!url.trim()) {\n      showToast('error', `Please enter a ${platform} playlist URL`);\n      return;\n    }\n    \n    try {\n      const playlistId = extractPlaylistId(url, platform);\n      console.log('Extracted playlist ID:', playlistId, 'from URL:', url);\n      \n      if (!playlistId) {\n        showToast('error', `Invalid ${platform} playlist URL format`);\n        return;\n      }\n\n      // Validate playlist ID format\n      if (platform === 'spotify' && playlistId.length !== 22) {\n        showToast('warning', 'The playlist ID format looks unusual, but trying anyway...');\n      }\n      \n      showToast('info', 'Fetching playlist details...');\n      setIsProcessing(true);\n      \n      // Select the playlist for conversion based on platform\n      if (platform === 'spotify') {\n        try {\n          await selectPlaylist(playlistId);\n          console.log('Playlist import successful for ID:', playlistId);\n          setIsProcessing(false); // Explicitly set processing to false\n        } catch (err: unknown) {\n          console.error('Error importing playlist:', err);\n          showToast('error', `Failed to import playlist: ${err instanceof Error ? err.message : String(err)}`);\n          setIsProcessing(false);\n        }\n      } else if (platform === 'youtube') {\n        selectYouTubePlaylist(playlistId);\n      }\n    } catch (error) {\n      console.error(`Error parsing ${platform} URL:`, error);\n      showToast('error', `Failed to process ${platform} URL`);\n      setIsProcessing(false);\n    }\n  }, [spotifyUrl, youtubeUrl, showToast, selectPlaylist, selectYouTubePlaylist]);\n  \n  // Auth helpers\n  const connectToSpotify = useCallback(() => {\n    try {\n      // First, explicitly check if user is authenticated\n      if (!isAuthenticated) {\n        console.warn('User not authenticated when trying to connect to Spotify');\n        showToast('error', 'Please sign in to your account first before connecting to Spotify');\n        \n        // Save that user wants to connect to Spotify and redirect to login\n        sessionStorage.setItem('connect_after_login', 'spotify');\n        navigate('/login');\n        return;\n      }\n      \n      // Add a small delay to ensure auth state is properly propagated\n      setTimeout(() => {\n        console.log('Initiating Spotify auth with user state:', { isAuthenticated, user });\n        initSpotifyAuth();\n      }, 500);\n    } catch (error) {\n      console.error('Error initiating Spotify auth:', error);\n      showToast('error', 'Failed to connect to Spotify');\n    }\n  }, [showToast, isAuthenticated, user, navigate]);\n  \n  const connectToYouTube = useCallback(() => {\n    try {\n    window.location.href = getYouTubeAuthUrl();\n    } catch (error) {\n      console.error('Error initiating YouTube auth:', error);\n      showToast('error', 'Failed to connect to YouTube');\n    }\n  }, [showToast]);\n  \n  // Determine current conversion step\n  const getCurrentStep = useCallback(() => {\n    switch (conversionState.status) {\n      case ConversionStatus.LOADING_PLAYLISTS:\n      case ConversionStatus.SELECTING_PLAYLIST:\n      case ConversionStatus.IDLE:\n        return 1;\n      case ConversionStatus.LOADING_TRACKS:\n        return 2;\n      case ConversionStatus.MATCHING_TRACKS:\n        return 3;\n      case ConversionStatus.CREATING_PLAYLIST:\n        return 4;\n      case ConversionStatus.SUCCESS:\n        return 4;\n      default:\n        return 1;\n    }\n  }, [conversionState.status]);\n  \n  // Start conversion with proper error handling\n  const handleStartConversion = useCallback(async () => {\n    // Make sure we have a playlist selected\n    if (!conversionState.selectedPlaylistId) {\n      showToast('error', 'Please select a playlist first');\n      return;\n    }\n    \n    // Make sure we have the necessary auth for both platforms\n    if (sourcePlatform === 'spotify' && !hasSpotifyAuth) {\n      showToast('error', 'Please connect to Spotify first');\n      return;\n    }\n    \n    if (destinationPlatform === 'youtube' && !hasYouTubeAuth) {\n      showToast('error', 'Please connect to YouTube first');\n      return;\n    }\n    \n    try {\n      setIsProcessing(true);\n      showToast('info', 'Starting conversion process...');\n      \n      // Pass the playlist name and description for the new playlist\n      await startConversion();\n    } catch (error) {\n      console.error('Error starting conversion:', error);\n      setIsProcessing(false);\n      \n      if (error instanceof Error) {\n        showToast('error', `Conversion failed: ${error.message}`);\n      } else {\n        showToast('error', 'Conversion failed. Please try again.');\n      }\n    }\n  }, [\n    conversionState.selectedPlaylistId,\n    sourcePlatform,\n    destinationPlatform,\n    hasSpotifyAuth,\n    hasYouTubeAuth,\n    showToast,\n    startConversion\n  ]);\n  \n  // Fetch playlists based on auth status\n  useEffect(() => {\n    if (isAuthenticated && hasSpotifyAuth) {\n      fetchSpotifyPlaylists();\n    }\n  }, [isAuthenticated, hasSpotifyAuth, fetchSpotifyPlaylists]);\n\n  useEffect(() => {\n    if (isAuthenticated && hasYouTubeAuth && typeof fetchYouTubePlaylists === 'function') {\n      fetchYouTubePlaylists();\n    }\n  }, [isAuthenticated, hasYouTubeAuth, fetchYouTubePlaylists]);\n\n  // Add new effect to auto-connect after login\n  useEffect(() => {\n    // Check if we need to auto-connect after login\n    if (isAuthenticated && !isProcessing) {\n      const connectAfterLogin = sessionStorage.getItem('connect_after_login');\n      \n      if (connectAfterLogin) {\n        console.log('Auto-connecting to', connectAfterLogin, 'after login');\n        \n        // Clear the stored value to prevent repeated attempts\n        sessionStorage.removeItem('connect_after_login');\n        \n        // Short delay to ensure auth state has propagated\n        setTimeout(() => {\n          if (connectAfterLogin === 'spotify') {\n            connectToSpotify();\n          } else if (connectAfterLogin === 'youtube') {\n            connectToYouTube();\n          }\n        }, 1000);\n      }\n    }\n  }, [isAuthenticated, isProcessing, connectToSpotify, connectToYouTube]);\n\n  // Get current auth status based on source and destination platforms\n  const getAuthStatus = useCallback(() => {\n    const sourceAuth = sourcePlatform === 'spotify' ? hasSpotifyAuth : hasYouTubeAuth;\n    const destinationAuth = destinationPlatform === 'spotify' ? hasSpotifyAuth : hasYouTubeAuth;\n    \n    return { sourceAuth, destinationAuth };\n  }, [sourcePlatform, destinationPlatform, hasSpotifyAuth, hasYouTubeAuth]);\n  \n  // Determine which connection handlers to use based on platforms\n  const getConnectionHandlers = useCallback(() => {\n    return {\n      connectToSource: sourcePlatform === 'spotify' ? connectToSpotify : connectToYouTube,\n      connectToDestination: destinationPlatform === 'spotify' ? connectToSpotify : connectToYouTube\n    };\n  }, [sourcePlatform, destinationPlatform, connectToSpotify, connectToYouTube]);\n  \n  // Get auth status for current platforms\n  const { sourceAuth, destinationAuth } = getAuthStatus();\n  \n  // Get appropriate connection handlers\n  const { connectToSource, connectToDestination } = getConnectionHandlers();\n\n  // Get selected playlist\n  const selectedPlaylist = useMemo(() => {\n    if (sourcePlatform === 'spotify') {\n      return conversionState.spotifyPlaylists?.find(p => p.id === conversionState.selectedPlaylistId);\n    }\n    \n    return (conversionState.youtubePlaylists || [])\n      .find((p: YouTubePlaylist) => p.id === conversionState.selectedPlaylistId);\n  }, [conversionState.spotifyPlaylists, conversionState.youtubePlaylists, conversionState.selectedPlaylistId, sourcePlatform]);\n\n  // Define step data for the wizard\n  const wizardSteps = useMemo(() => [\n    {\n      number: 1,\n      label: 'Select Source',\n      help: 'Choose the platform you want to import your playlist from (Spotify or YouTube).',\n      icon: <Settings size={24} />,\n      className: 'text-white'  // Always white since background is dark\n    },\n    {\n      number: 2,\n      label: 'Import Playlist',\n      help: 'Paste your playlist URL or select from your library to import tracks.',\n      icon: <Upload size={24} />,\n      className: 'text-white'\n    },\n    {\n      number: 3,\n      label: 'Review Tracks',\n      help: 'Review the imported tracks and make sure everything looks correct.',\n      icon: <FileSpreadsheet size={24} />,\n      className: 'text-white'\n    },\n    {\n      number: 4,\n      label: 'Export Playlist',\n      help: 'Export your playlist to the destination platform with one click.',\n      icon: <Download size={24} />,\n      className: 'text-white'\n    }\n  ], []);\n\n  // Feature description data\n  const features = useMemo(() => [\n    {\n      title: \"Modern UI\",\n      description: \"Sleek, responsive design that works on all devices\",\n      icon: <Settings size={24} />,\n      color: \"bg-blue-100 text-blue-600\"\n    },\n    {\n      title: \"Type-Safe\",\n      description: \"Built with TypeScript and React for maximum reliability\",\n      icon: <Shield size={24} />,\n      color: \"bg-green-100 text-green-600\"\n    },\n    {\n      title: \"Privacy First\", \n      description: \"We don't store your playlists or personal data\",\n      icon: <Lock size={24} />,\n      color: \"bg-yellow-100 text-yellow-600\"\n    },\n    {\n      title: \"Fast Conversion\",\n      description: \"Convert your playlists in seconds with our optimized algorithms\",\n      icon: <Zap size={24} />,\n      color: \"bg-red-100 text-red-600\"\n    }\n  ], []);\n\n  // How it works steps\n  const howItWorks = useMemo(() => [\n    {\n      title: \"1. Paste Playlist URL\",\n      description: \"Copy the link to your playlist and paste it into our converter\",\n      icon: <ClipboardPaste size={24} />,\n      color: \"bg-green-100 text-green-600\"\n    },\n    {\n      title: \"2. Fetch & Verify\",\n      description: \"We'll retrieve all songs from your playlist and display them for verification\",\n      icon: <Search size={24} />,\n      color: \"bg-blue-100 text-blue-600\"\n    },\n    {\n      title: \"3. Create New Playlist\",\n      description: \"Create a new playlist with matching songs with just one click\",\n      icon: <PlayCircle size={24} />,\n      color: \"bg-red-100 text-red-600\"\n    }\n  ], []);\n\n  // Function to reset the converter (for \"Convert Another\" button)\n  const resetConverter = useCallback(() => {\n    // Reset form values\n    setSpotifyUrl('');\n    setYoutubeUrl('');\n    setPlaylistNameForExport('');\n    setPlaylistDescriptionForExport('');\n    \n    // Reset state\n    setCurrentWizardStep(1);\n    setIsProcessing(false);\n    \n    // Reset conversion context\n    dispatch({ type: 'RESET' });\n  }, [dispatch]);\n\n  // Find the useEffect that handles tracking conversion state changes\n  // Around line 625, add/modify:\n  useEffect(() => {\n    // When tracks are loaded, update UI immediately\n    if (conversionState.tracks.length > 0 && isProcessing) {\n      setIsProcessing(false);\n      \n      // Short timeout to allow rendering to complete before advancing\n      setTimeout(() => {\n        setCurrentWizardStep(3);\n        document.getElementById('playlist-wizard-card')?.scrollIntoView({ \n          behavior: 'smooth', \n          block: 'center' \n        });\n      }, 100); // Reduced from 500ms to 100ms for faster UI update\n    }\n  }, [conversionState.tracks]);\n\n  // Function to handle logout or connect missing services\n  const handleLogoutOrConnectMissing = useCallback(() => {\n    if (hasSpotifyAuth && hasYouTubeAuth) {\n      signOut();\n    } else if (!hasSpotifyAuth && !hasYouTubeAuth) {\n      connectToSpotify();\n    } else if (!hasSpotifyAuth) {\n      connectToSpotify();\n    } else {\n      connectToYouTube();\n    }\n  }, [hasSpotifyAuth, hasYouTubeAuth, signOut, connectToSpotify, connectToYouTube]);\n  \n  // Return the playlist converter UI\n  return (\n    <div className={cn(\n      \"min-h-screen transition-colors duration-300 relative overflow-hidden\",\n      \"bg-white dark:bg-gray-900 text-gray-900 dark:text-white\" // Explicit background colors for consistency\n    )}>\n      {/* Background effects - using ParticleField */}\n      <div className=\"absolute inset-0 z-0 pointer-events-none\">\n        <ParticleField \n          color=\"var(--particle-color, #A855F7)\" \n          density={isMobile ? \"low\" : \"medium\"}\n          className=\"absolute inset-0\"\n        />\n      </div>\n      \n      <EnhancedHeroSection /> {/* Assuming this will be styled separately or inherits */}\n      \n      <section \n        id=\"auth\" \n        className={cn(\n          \"py-12 px-4 bg-transparent relative overflow-hidden\"\n        )}\n      >\n        <div className=\"absolute inset-0 pointer-events-none overflow-hidden z-0\">\n            <motion.div \n              className=\"absolute -top-20 -right-20 w-[40vw] h-[40vw] rounded-full opacity-10 bg-brand-blob-1 filter blur-[80px]\"\n              animate={{ opacity: [0.05, 0.15, 0.05], scale: [1, 1.1, 1]}}\n              transition={{ duration: 20, repeat: Infinity, ease: \"easeInOut\" }}\n            />\n            <motion.div \n              className=\"absolute -bottom-20 -left-20 w-[45vw] h-[45vw] rounded-full opacity-10 bg-brand-blob-2 filter blur-[100px]\"\n              animate={{ opacity: [0.1, 0.05, 0.1], scale: [1, 1.15, 1]}}\n              transition={{ duration: 25, repeat: Infinity, ease: \"easeInOut\", delay: 5 }}\n            />\n        </div>\n        \n        <div className=\"container mx-auto max-w-5xl relative z-10\">\n          <div className=\"text-center mb-12\">\n            <motion.h2 \n              className=\"text-3xl lg:text-4xl font-bold mb-6 text-content-primary\" // Keep structural and font-size classes\n              initial={{ opacity: 0, y: -20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.5 }}\n              viewport={{ once: true }}\n            >\n              <AnimatedGradientText variant=\"default\">\n                Connect Your Music Accounts\n              </AnimatedGradientText>\n            </motion.h2>\n            \n            <motion.p \n              className=\"text-lg text-content-secondary mb-6 max-w-2xl mx-auto\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.5, delay: 0.2 }}\n              viewport={{ once: true }}\n            >\n              Sign in to both platforms to easily convert playlists between services\n            </motion.p>\n            \n            <motion.p\n              className=\"text-md mb-12 max-w-2xl mx-auto text-content-tertiary\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.5, delay: 0.3 }}\n              viewport={{ once: true }}\n            >\n              Your account credentials are securely handled and we only request read-only access to your playlists\n            </motion.p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8\">\n            <EnhancedConnectionCard\n              platform=\"spotify\"\n              connected={hasSpotifyAuth}\n              onConnect={connectToSpotify}\n              onDisconnect={disconnectFromSpotify}\n              isConnecting={isConnectingSpotify}\n              connectionError={spotifyError || undefined}\n              userEmail={spotifyUserProfile?.email || user?.email || undefined}\n              userName={spotifyUserProfile?.displayName || user?.displayName || undefined}\n              userPhoto={spotifyUserProfile?.imageUrl || user?.photoURL || undefined}\n              userMeta={hasSpotifyAuth ? {\n                // Real basic profile data\n                displayName: spotifyUserProfile?.displayName,\n                imageUrl: spotifyUserProfile?.imageUrl,\n                email: spotifyUserProfile?.email,\n                country: spotifyUserProfile?.country || 'Unknown',\n                product: spotifyUserProfile?.product || 'free',\n                \n                // Real playlist data\n                publicPlaylists: spotifyUserProfile?.publicPlaylists || 0,\n                privatePlaylists: spotifyUserProfile?.privatePlaylists || 0,\n                collaborativePlaylists: spotifyUserProfile?.collaborativePlaylists || 0,\n                totalPlaylists: spotifyUserProfile?.totalPlaylists || 0,\n                \n                // Real saved content\n                savedTracks: spotifyUserProfile?.savedTracks || 0,\n                savedAlbums: spotifyUserProfile?.savedAlbums || 0,\n                followingArtists: spotifyUserProfile?.followingArtists || 0,\n                \n                // Real account details\n                accountType: spotifyUserProfile?.accountType || 'Free',\n                explicitContentFilter: spotifyUserProfile?.explicitContentFilter || 'Unknown',\n                audioQuality: spotifyUserProfile?.audioQuality || 'Standard',\n                offlineDownloads: spotifyUserProfile?.offlineDownloads || 'Not Available',\n                deviceLimit: spotifyUserProfile?.deviceLimit || 1,\n                \n                // Real derived data\n                topGenres: spotifyUserProfile?.topGenres || ['Music Lover'],\n                \n                // Data not available through API (marked appropriately)\n                lastActive: spotifyUserProfile?.lastActive || 'Data not available',\n                listeningTime: spotifyUserProfile?.listeningTime || 'Data not available',\n                monthlyListeners: spotifyUserProfile?.monthlyListeners || 'Not applicable',\n                nextBilling: spotifyUserProfile?.nextBilling || 'Not available',\n                crossfade: spotifyUserProfile?.crossfade || 'Not available',\n                equalizer: spotifyUserProfile?.equalizer || 'Not available',\n                \n                // Legacy fields for compatibility\n                plan: spotifyUserProfile?.product || 'free',\n                subscription: spotifyUserProfile?.accountType || 'Free',\n                accountCountry: spotifyUserProfile?.country || 'Unknown',\n                totalTracks: spotifyUserProfile?.savedTracks || 0, // Use saved tracks as total\n                followedPlaylists: spotifyUserProfile?.followingArtists || 0, // Use following artists\n                favoriteArtists: spotifyUserProfile?.followingArtists || 0,\n                recentlyPlayed: 'Last 30 days', // Standard value\n                socialFeatures: 'Enabled', // Standard for most accounts\n                dataSaver: false, // Default\n                privateSession: false, // Default\n                lastSync: spotifyUserProfile?.lastActive || 'Unknown',\n                paymentMethod: 'Not available',\n                autoRenew: true, // Default assumption\n                familyPlanMembers: null, // Not available via API\n                studentVerification: false, // Default\n                explicit_content: spotifyUserProfile?.explicitContentFilter === 'Enabled'\n              } : undefined}\n            />\n            <EnhancedConnectionCard\n              platform=\"youtube\"\n              connected={hasYouTubeAuth}\n              onConnect={connectToYouTube}\n              onDisconnect={disconnectFromYouTube}\n              isConnecting={isConnectingYouTube}\n              connectionError={youtubeError || undefined}\n              userEmail={youtubeUserProfile?.email || user?.email || undefined}\n              userName={youtubeUserProfile?.displayName || user?.displayName || undefined}\n              userPhoto={youtubeUserProfile?.imageUrl || user?.photoURL || undefined}\n              userMeta={hasYouTubeAuth ? {\n                displayName: youtubeUserProfile?.displayName,\n                imageUrl: youtubeUserProfile?.imageUrl,\n                email: youtubeUserProfile?.email,\n                plan: 'youtube',\n                lastSignInTime: new Date().toISOString(),\n                // channelId: 'UC_REAL_CHANNEL_ID', // TODO: Replace with actual channel ID\n                subscriberCount: 1500,\n                videoCount: 45,\n                playlistCount: 12,\n                viewCount: 25000,\n                channelType: 'personal',\n                monetizationStatus: 'disabled',\n                verificationStatus: 'unverified',\n                contentRating: 'standard',\n                language: 'English',\n                location: 'United States',\n                joinDate: '2020-01-01',\n                lastUploadDate: '2024-01-15',\n                averageViews: 1500,\n                topCategories: ['Music', 'Entertainment', 'Gaming'],\n                collaborationStatus: false,\n                liveStreamingEnabled: true,\n                communityTabEnabled: true,\n                membershipsEnabled: false,\n                superChatEnabled: false,\n                channelMembershipLevel: 'none'\n              } : undefined}\n            />\n          </div>\n          \n          <motion.div \n            className=\"mt-12 text-center\"\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.5, delay: 0.4 }}\n            viewport={{ once: true }}\n          >\n            <p className=\"text-content-tertiary mb-4\">\n              Once connected, you can convert playlists in just a few clicks\n            </p>\n            <GlowButton\n              variant=\"primary\"\n              onClick={handleLogoutOrConnectMissing}\n              disabled={isConnectingSpotify || isConnectingYouTube}\n              isLoading={isConnectingSpotify || isConnectingYouTube}\n              aria-label={\n                hasSpotifyAuth && hasYouTubeAuth \n                  ? 'Logout' \n                  : 'Connect Missing Accounts'\n              }\n            >\n              {isConnectingSpotify || isConnectingYouTube ? (\n                <>\n                  <span>Connecting...</span>\n                </>\n              ) : hasSpotifyAuth && hasYouTubeAuth ? (\n                <>\n                  <LogOut size={16} className=\"inline-block mr-2\" />\n                  Logout\n                </>\n              ) : (\n                'Connect Missing Accounts'\n              )}\n            </GlowButton>\n            \n            {(!hasSpotifyAuth || !hasYouTubeAuth) && !isConnectingSpotify && !isConnectingYouTube && (\n              <p className={cn(\n                \"mt-3 text-sm flex items-center justify-center\",\n                \"text-warning-text\" // Use text-warning-text from CSS vars\n                // Consider adding bg-warning-bg and border-warning-border if a banner style is desired\n              )}>\n                <AlertTriangle size={16} className=\"inline-block mr-1 text-warning-icon\" /> {/* Use text-warning-icon */ }\n                {!hasSpotifyAuth && !hasYouTubeAuth\n                  ? \"You need to connect both accounts to convert playlists\" \n                  : !hasSpotifyAuth \n                    ? \"Connect your Spotify account to continue\" \n                    : \"Connect your YouTube account to continue\"}\n              </p>\n            )}\n          </motion.div>\n        </div>\n      </section>\n      \n      {/* Converter Section with Progress Visualization */}\n      {isAuthenticated && (\n        <section \n          id=\"converter\" \n          className={cn(\n            \"py-16 px-4 scroll-mt-20\",\n            \"bg-background-secondary\" // Section background\n          )}\n          aria-labelledby=\"converter-title\"\n        >\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 id=\"converter-title\" className=\"sr-only\">Playlist Converter</h2>\n            \n            <div className={cn(\n              \"sticky top-16 z-20 py-4 mb-12 rounded-lg backdrop-blur-md shadow-xl\", // Increased mb, top-16 for navbar\n              \"bg-surface-card/80 border border-border-default\" // Updated background and border\n            )}\n            role=\"navigation\"\n            aria-label=\"Conversion Steps\">\n              <div className=\"flex items-center justify-center flex-wrap gap-x-4 gap-y-2 px-2\">\n                {wizardSteps.map((step, idx) => (\n                  <div key={step.label} className=\"flex items-center gap-2\">\n                    <button\n                      className={cn(\n                        \"rounded-full w-10 h-10 flex items-center justify-center font-bold transition-all duration-300 ease-in-out border-2\",\n                        idx + 1 === currentWizardStep // Active step\n                          ? \"bg-stepper-active-icon-bg text-stepper-active-icon border-stepper-active-ring ring-4 ring-stepper-active-ring/50 ring-offset-2 ring-offset-surface-card scale-110\"\n                          : getCurrentStep() > idx + 1 // Completed step\n                            ? \"bg-stepper-completed-bg text-stepper-completed-icon border-transparent\"\n                            : \"bg-stepper-inactive-bg border-border-default text-stepper-inactive-icon hover:border-stepper-active-ring/50\", // Inactive step\n                        \"focus:outline-none focus:ring-2 focus:ring-stepper-active-ring\"\n                      )}\n                      onClick={() => setCurrentWizardStep(idx + 1)}\n                      disabled={(idx + 1 > getCurrentStep() && idx + 1 !== currentWizardStep) || isProcessing}\n                      aria-label={`Go to step ${idx + 1}: ${step.label}`}\n                      aria-current={idx + 1 === currentWizardStep ? \"step\" : undefined}\n                    >\n                      {idx + 1 < getCurrentStep() && !(idx + 1 === currentWizardStep) ? <CheckCircle size={20} /> : step.icon}\n                    </button>\n                    <span className={cn(\n                      \"font-medium text-sm hidden md:flex items-center\", // md:flex\n                      idx + 1 === currentWizardStep \n                        ? \"text-brand-primary\" \n                        : \"text-content-secondary\"\n                    )}>\n                      {step.label}\n                      <div className=\"relative ml-1.5 cursor-help group\">\n                        <Info size={14} className={cn(\n                          \"text-content-tertiary group-hover:text-brand-primary transition-colors\",\n                          idx + 1 === currentWizardStep ? \"text-brand-primary\" : \"\"\n                        )} />\n                        <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2.5 rounded-md bg-tooltip text-tooltip-text text-xs shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-30 pointer-events-none\">\n                          {step.help}\n                        </div>\n                      </div>\n                    </span>\n                    {idx < wizardSteps.length - 1 && (\n                      <ChevronRight size={20} className=\"mx-1 text-content-tertiary hidden md:block\" />\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n            \n            <div id=\"playlist-wizard-card\">\n              <GlassmorphicCard\n                className=\"p-6 sm:p-8 max-w-2xl mx-auto mb-8 rounded-2xl bg-surface-card border border-border-default shadow-xl backdrop-blur-lg\"\n              >\n                {conversionState.error && (\n                  <div \n                    className={cn(\n                      \"mb-6 p-4 rounded-lg flex items-start gap-3\",\n                      \"bg-error-bg text-error-text border border-error-border\"\n                    )}\n                    role=\"alert\"\n                    aria-live=\"assertive\"\n                  >\n                    <AlertTriangle size={20} className=\"flex-shrink-0 mt-0.5\" />\n                    <div>\n                      <p className=\"font-semibold text-md\">Conversion Error</p>\n                      <p className=\"text-sm\">{conversionState.error}</p>\n              </div>\n                  </div>\n                )}\n                \n                <AnimatePresence mode=\"wait\">\n                  {currentWizardStep === 1 && (\n                    <motion.div\n                      key=\"step1\"\n                      initial={{ opacity: 0, y: 20 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -20 }}\n                      transition={{ duration: 0.3 }}\n                    >\n                      <div>\n                        <div className=\"mb-8\">\n                          <h2 className={cn(\n                            \"text-2xl font-bold mb-2\",\n                            \"text-white\"  // Always white since background is dark\n                          )}>\n                          {wizardSteps[0].label}\n                          </h2>\n                          <p className={cn(\n                            \"text-white/90\",  // Always white with high opacity since background is dark\n                            \"text-lg\"\n                          )}>\n                          {wizardSteps[0].help}\n                        </p>\n                        </div>\n                        \n                        <div className=\"grid sm:grid-cols-2 gap-8 mb-8\">\n                          <div>\n                            <label className=\"block text-xl font-bold mb-3 text-white\">\n                              Source Platform\n                            </label>\n                            <div className=\"flex flex-col gap-3\">\n                              <GlowButton\n                                variant={sourcePlatform === 'spotify' ? \"soundswapp\" : \"secondary\"}\n                                onClick={() => setSourcePlatform('spotify')}\n                                disabled={false}\n                                className={cn(\n                                  \"flex flex-1 justify-center items-center gap-3 py-4\",\n                                  \"bg-surface-card dark:bg-surface-card-dark border-2\",\n                                  sourcePlatform === 'spotify' \n                                    ? \"border-[#1DB954] shadow-[0_0_15px_rgba(29,185,84,0.3)]\" \n                                    : \"border-border dark:border-border-dark\",\n                                  \"hover:bg-surface-hover dark:hover:bg-surface-hover-dark transition-all duration-200\",\n                                  \"text-lg font-medium\"\n                                )}\n                                aria-label=\"Select Spotify as source platform\"\n                              >\n                                <img\n                                  src=\"/images/Spotify_Primary_Logo_RGB_Green.png\"\n                                  alt=\"Spotify\"\n                                  style={{ \n                                    height: 24, \n                                    width: 'auto', \n                                    objectFit: 'contain', \n                                    display: 'block',\n                                    minWidth: '24px'\n                                  }}\n                                  className=\"h-6 w-auto\"\n                                />\n                                <span className={cn(\n                                  sourcePlatform === 'spotify' \n                                    ? \"text-[#1DB954] dark:text-[#1DB954]\" \n                                    : \"text-content-primary dark:text-white\"\n                                )}>Spotify</span>\n                              </GlowButton>\n                              \n                              <GlowButton\n                                variant={sourcePlatform === 'youtube' ? \"soundswapp\" : \"secondary\"}\n                                onClick={() => setSourcePlatform('youtube')}\n                                disabled={false}\n                                className={cn(\n                                  \"flex flex-1 justify-center items-center gap-3 py-4\",\n                                  \"bg-surface-card dark:bg-surface-card-dark border-2\",\n                                  sourcePlatform === 'youtube' \n                                    ? \"border-[#FF0000] shadow-[0_0_15px_rgba(255,0,0,0.3)]\" \n                                    : \"border-border dark:border-border-dark\",\n                                  \"hover:bg-surface-hover dark:hover:bg-surface-hover-dark transition-all duration-200\",\n                                  \"text-lg font-medium\"\n                                )}\n                                aria-label=\"Select YouTube as source platform\"\n                              >\n                                <img\n                                  src={isDark ? \"/images/yt_logo_rgb_dark.png\" : \"/images/yt_logo_rgb_light.png\"}\n                                  alt=\"YouTube\"\n                                  style={{ \n                                    height: 24, \n                                    width: 'auto', \n                                    objectFit: 'contain', \n                                    display: 'block',\n                                    minWidth: '24px'\n                                  }}\n                                  className={cn(\n                                    \"h-6 w-auto\",\n                                    sourcePlatform === 'youtube' ? \"\" : \"opacity-70\"\n                                  )}\n                                />\n                                {/* YouTube name removed */}\n                              </GlowButton>\n                            </div>\n                          </div>\n                          \n                          <div>\n                            <label className=\"block text-xl font-bold mb-3 text-white\">\n                              Destination Platform\n                            </label>\n                            <div className=\"flex flex-col gap-3\">\n                              <GlowButton\n                                onClick={() => setDestinationPlatform('spotify')}\n                                disabled={!hasSpotifyAuth || sourcePlatform === 'spotify'}\n                                variant={destinationPlatform === 'spotify' ? \"soundswapp\" : \"secondary\"}\n                                className={cn(\n                                  \"flex flex-1 justify-center items-center gap-3 py-4\",\n                                  \"bg-surface-card dark:bg-surface-card-dark border-2\",\n                                  destinationPlatform === 'spotify' \n                                    ? \"border-[#1DB954] shadow-[0_0_15px_rgba(29,185,84,0.3)]\" \n                                    : \"border-border dark:border-border-dark\",\n                                  \"hover:bg-surface-hover dark:hover:bg-surface-hover-dark transition-all duration-200\",\n                                  \"text-lg font-medium\",\n                                  (!hasSpotifyAuth || sourcePlatform === 'spotify') && \"opacity-50 cursor-not-allowed\"\n                                )}\n                                aria-label=\"Select Spotify as destination platform\"\n                              >\n                                <img\n                                  src=\"/images/Spotify_Primary_Logo_RGB_Green.png\"\n                                  alt=\"Spotify\"\n                                  style={{ \n                                    height: 24, \n                                    width: 'auto', \n                                    objectFit: 'contain', \n                                    display: 'block',\n                                    minWidth: '24px'\n                                  }}\n                                  className=\"h-6 w-auto\"\n                                />\n                                <span className=\"text-green-500 dark:text-green-400\">Spotify</span>\n                              </GlowButton>\n                              \n                              <GlowButton\n                                onClick={() => setDestinationPlatform('youtube')}\n                                disabled={!hasYouTubeAuth || sourcePlatform === 'youtube'}\n                                variant={destinationPlatform === 'youtube' ? \"soundswapp\" : \"secondary\"}\n                                className={cn(\n                                  \"flex flex-1 justify-center items-center gap-3 py-4\",\n                                  \"bg-surface-card dark:bg-surface-card-dark border-2\",\n                                  destinationPlatform === 'youtube' \n                                    ? \"border-[#FF0000] shadow-[0_0_15px_rgba(255,0,0,0.3)]\" \n                                    : \"border-border dark:border-border-dark\",\n                                  \"hover:bg-surface-hover dark:hover:bg-surface-hover-dark transition-all duration-200\",\n                                  \"text-lg font-medium\",\n                                  (!hasYouTubeAuth || sourcePlatform === 'youtube') && \"opacity-50 cursor-not-allowed\"\n                                )}\n                                aria-label=\"Select YouTube as destination platform\"\n                              >\n                                <img\n                                  src={isDark ? \"/images/yt_logo_rgb_dark.png\" : \"/images/yt_logo_rgb_light.png\"}\n                                  alt=\"YouTube\"\n                                  style={{ height: 24, width: 'auto', objectFit: 'contain', display: 'block' }}\n                                  className={cn(\n                                    \"h-6 w-auto\",\n                                    destinationPlatform === 'youtube' ? \"\" : \"opacity-70\"\n                                  )}\n                                />\n                                {/* YouTube name removed */}\n                              </GlowButton>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Next button */}\n                        <div className=\"flex justify-end mt-8\">\n                          <GlowButton\n                            variant=\"soundswapp\"\n                            onClick={() => setCurrentWizardStep(2)}\n                            className={cn(\n                              \"flex items-center gap-2 px-6 py-3\",\n                              \"text-white font-medium text-lg\",\n                              \"bg-gradient-to-r from-brand-primary to-brand-secondary\",\n                              \"hover:shadow-lg hover:scale-105 transform transition-all duration-200\"\n                            )}\n                          >\n                            Next Step\n                            <ChevronRight className=\"w-5 h-5\" />\n                          </GlowButton>\n                        </div>\n                      </div>\n                    </motion.div>\n                  )}\n                  \n                  {/* Step 2: Import Playlist */}\n                  {currentWizardStep === 2 && (\n                    <motion.div\n                      key=\"step2\"\n                      initial={{ opacity: 0, y: 30 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -30 }}\n                      transition={{ duration: 0.3 }}\n                    >\n                      <div>\n                        <h3 className={cn(\n                          \"text-lg font-bold mb-2\",\n                          \"text-white\"  // White in both themes\n                        )}>\n                          <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-green-500 to-red-500\">\n                            {wizardSteps[currentWizardStep - 1]?.icon}\n                          </span>\n                          {wizardSteps[currentWizardStep - 1]?.label}\n                        </h3>\n                        <p className={cn(\n                          \"mb-4\",\n                          \"text-white\"  // White in both themes\n                        )}>\n                          {wizardSteps[currentWizardStep - 1]?.help}\n                        </p>\n                        \n                        {/* Platform-specific import UI */}\n                        <div className=\"mt-2 flex flex-col gap-3 w-full\">\n                  {sourcePlatform === 'spotify' && (\n                    <>\n                              <div className=\"relative\">\n                                {/* <label htmlFor=\"spotify-url\" className=\"text-sm font-medium mb-1 block\"> -- Label handled by FloatingLabels\n                                  Paste Spotify playlist URL or ID\n                                </label> */} \n                                <div className=\"relative flex items-center gap-2 w-full\">\n                                  <input\n                                    type=\"text\"\n                                    placeholder=\"Spotify Playlist URL or ID\"\n                                    className={cn(\n                                      \"flex-1 px-4 py-2 rounded-lg\",\n                                      \"bg-surface-card dark:bg-surface-card-dark\",\n                                      \"border border-border dark:border-border-dark\",\n                                      \"focus:outline-none focus:ring-2 focus:ring-brand-primary/50 dark:focus:ring-brand-primary-dark/50\",\n                                      \"text-content-primary dark:text-content-primary-dark\",\n                                      \"placeholder-content-secondary dark:placeholder-content-secondary-dark\"\n                                    )}\n                                    value={spotifyUrl}\n                                    onChange={(e) => setSpotifyUrl(e.target.value)}\n                                    disabled={isProcessing}\n                                  />\n                                  <GlowButton\n                                    onClick={() => handlePlaylistUrlSubmit('spotify')}\n                                    disabled={isProcessing || !spotifyUrl}\n                                    variant=\"soundswapp\"\n                                    className={cn(\n                                      \"px-6 py-2.5 rounded-lg font-medium flex items-center gap-2 min-w-[120px] justify-center\",\n                                      \"bg-brand-primary dark:bg-brand-primary-dark text-white\",\n                                      \"hover:bg-brand-primary-hover dark:hover:bg-brand-primary-hover-dark\",\n                                      \"disabled:opacity-50 disabled:cursor-not-allowed\",\n                                      \"transition-all duration-200 ease-in-out\",\n                                      \"shadow-md hover:shadow-lg dark:shadow-brand-primary/20\",\n                                      \"transform hover:-translate-y-0.5\",\n                                      \"focus:outline-none focus:ring-2 focus:ring-brand-primary/50 dark:focus:ring-brand-primary-dark/50\"\n                                    )}\n                                  >\n                                    {isProcessing ? (\n                                      <>\n                                        <Loader2 size={16} className=\"animate-spin\" />\n                                        <span>Importing...</span>\n                                      </>\n                                    ) : (\n                                      <>\n                                        <Upload size={16} className=\"opacity-90\" />\n                                        <span>Import</span>\n                                      </>\n                                    )}\n                                  </GlowButton>\n                                </div>\n                              </div>\n                              \n                              {/* Your Playlists button with dropdown */}\n                              <div className=\"w-full my-2\">\n                                <button\n                                  onClick={() => setShowPlaylistSuggestions(true)}\n                                  className={cn(\n                                    \"w-full px-4 py-3 rounded-lg flex items-center justify-between\",\n                                    \"bg-white dark:bg-surface-card-dark\",\n                                    \"border border-border dark:border-border-dark\",\n                                    \"hover:bg-surface-hover dark:hover:bg-surface-hover-dark\",\n                                    \"transition-all duration-200\"\n                                  )}\n                                >\n                                  <div className=\"flex items-center gap-2\">\n                                    <img\n                                      src=\"/images/Spotify_Primary_Logo_RGB_Green.png\"\n                                      alt=\"Spotify\"\n                                      style={{ height: 24, width: 'auto', objectFit: 'contain', display: 'block' }}\n                                      className=\"h-6 w-auto\"\n                                    />\n                                    <span className=\"text-gray-900 dark:text-gray-900\">Your Spotify Playlists</span>\n                                  </div>\n                                  <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                                </button>\n                                \n                                {/* Update the help text */}\n                                <p className={cn(\n                                  \"text-white\",  // White in both themes\n                                  \"text-sm mt-2\"\n                                )}>\n                                  Paste your playlist URL or select from your library to import tracks.\n                                </p>\n                                \n                                {/* Playlist suggestions dropdown */}\n                                <AnimatePresence>\n                                  {showPlaylistSuggestions && sourceAuth && conversionState.spotifyPlaylists && conversionState.spotifyPlaylists.length > 0 && (\n                                    <motion.div\n                                      id=\"playlist-dropdown\"\n                                      initial={{ opacity: 0, height: 0 }}\n                                      animate={{ opacity: 1, height: 'auto' }}\n                                      exit={{ opacity: 0, height: 0 }}\n                                      transition={{ duration: 0.2 }}\n                                      className={cn(\n                                        \"mt-1 border rounded-lg shadow overflow-hidden\",\n                                        isDark ? \"bg-gray-800 border-gray-700\" : \"bg-white border-gray-200\"\n                                      )}\n                                    >\n                                      <div className=\"max-h-56 overflow-y-auto p-1\">\n                                        <div className=\"text-xs text-gray-500 dark:text-gray-400 p-2 font-semibold\">\n                                          Select a playlist to import:\n                                        </div>\n                                        <ul>\n                                          {conversionState.spotifyPlaylists.slice(0, 8).map((playlist) => (\n                                            <li key={playlist.id}>\n                                              <KeyboardFocusableCard\n                                                className={cn(\n                                                  \"flex items-center gap-3 p-2 rounded cursor-pointer transition\",\n                                                  isDark ? \"hover:bg-green-900/30\" : \"hover:bg-green-100\"\n                                                )}\n                                                onClick={() => {\n                                                  if (isProcessing) return;\n                                                  setSpotifyUrl(`https://open.spotify.com/playlist/${playlist.id}`);\n                                                  setShowPlaylistSuggestions(false);\n                                                }}\n                                                onKeyDown={(e) => {\n                                                  if (e.key === 'Enter' || e.key === ' ') {\n                                                    e.preventDefault();\n                                                    if (isProcessing) return;\n                                                    setSpotifyUrl(`https://open.spotify.com/playlist/${playlist.id}`);\n                                                    setShowPlaylistSuggestions(false);\n                                                  }\n                                                }}\n                                                aria-label={`Select playlist: ${playlist.name} by ${playlist.owner} with ${playlist.trackCount || 'unknown'} tracks`}\n                                              >\n                                                {playlist.imageUrl ? (\n                                                  <img \n                                                    src={playlist.imageUrl} \n                                                    alt=\"\" \n                                                    className=\"w-10 h-10 rounded object-cover flex-shrink-0\" \n                                                    aria-hidden=\"true\"\n                                                  />\n                                                ) : (\n                                                  <div className=\"w-10 h-10 rounded bg-green-100 flex items-center justify-center flex-shrink-0\">\n                                                    <Music size={16} className=\"text-green-600\" aria-hidden=\"true\" />\n                                                  </div>\n                                                )}\n                                                <div className=\"flex-1 min-w-0\">\n                                                  <div className=\"truncate font-medium text-sm\">{playlist.name}</div>\n                                                  <div className=\"truncate text-xs text-gray-400\">\n                                                    {playlist.owner} • {playlist.trackCount || 'Unknown'} tracks\n                                                  </div>\n                                                </div>\n                                              </KeyboardFocusableCard>\n                                            </li>\n                                          ))}\n                                        </ul>\n                                      </div>\n                                    </motion.div>\n                                  )}\n\n                                  {/* Show message when no playlists are available */}\n                                  {showPlaylistSuggestions && sourceAuth && (!conversionState.spotifyPlaylists || conversionState.spotifyPlaylists.length === 0) && (\n                                    <motion.div\n                                      initial={{ opacity: 0, height: 0 }}\n                                      animate={{ opacity: 1, height: 'auto' }}\n                                      exit={{ opacity: 0, height: 0 }}\n                                      transition={{ duration: 0.2 }}\n                                      className={cn(\n                                        \"mt-1 border rounded-lg shadow p-4 text-center\",\n                                        isDark ? \"bg-gray-800 border-gray-700 text-gray-300\" : \"bg-white border-gray-200 text-gray-600\"\n                                      )}\n                                    >\n                                      <p>No Spotify playlists found in your account.</p>\n                                    </motion.div>\n                                  )}\n\n                                  {/* Show message when not authenticated with Spotify */}\n                                  {showPlaylistSuggestions && !sourceAuth && (\n                                    <motion.div\n                                      initial={{ opacity: 0, height: 0 }}\n                                      animate={{ opacity: 1, height: 'auto' }}\n                                      exit={{ opacity: 0, height: 0 }}\n                                      transition={{ duration: 0.2 }}\n                                      className={cn(\n                                        \"mt-1 border rounded-lg shadow p-4\",\n                                        isDark ? \"bg-gray-800 border-gray-700\" : \"bg-white border-gray-200\"\n                                      )}\n                                    >\n                                      <div className=\"flex flex-col items-center gap-2\">\n                                        <p className=\"text-center text-sm text-gray-500 mb-2\">\n                                          You need to connect to Spotify first\n                                        </p>\n                                        <ConnectButton\n                                          platform=\"spotify\"\n                                          isConnected={sourceAuth}\n                                          onConnect={connectToSource}\n                                          className=\"text-sm w-full\"\n                                        />\n                                      </div>\n                                    </motion.div>\n                                  )}\n                                </AnimatePresence>\n                              </div>\n                    </>\n                  )}\n                          \n                          {/* Add YouTube input for YouTube as source */}\n                  {sourcePlatform === 'youtube' && (\n                    <>\n                              <div className=\"relative\">\n                                {/* <label htmlFor=\"youtube-url\" className=\"text-sm font-medium mb-1 block\">\n                                  Paste YouTube playlist URL or ID\n                                </label> */} \n                                <div className=\"relative flex items-center gap-2 w-full\">\n                                  <input\n                                    type=\"text\"\n                                    placeholder=\"YouTube Playlist URL or ID\"\n                                    className=\"flex-1 px-4 py-2 rounded-lg bg-surface-card border border-border focus:outline-none focus:ring-2 focus:ring-primary/50 text-content-primary\"\n                                    value={youtubeUrl}\n                                    onChange={(e) => setYoutubeUrl(e.target.value)}\n                                    disabled={isProcessing}\n                                  />\n                                  <button\n                                    onClick={() => handlePlaylistUrlSubmit('youtube')}\n                                    disabled={isProcessing || !youtubeUrl}\n                                    className=\"px-6 py-2 rounded-lg bg-primary text-white font-medium hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 min-w-[100px] justify-center\"\n                                  >\n                                    {isProcessing ? (\n                                      <>\n                                        <Loader2 size={16} className=\"animate-spin\" />\n                                        <span>Importing...</span>\n                                      </>\n                                    ) : (\n                                      'Import'\n                                    )}\n                                  </button>\n                                </div>\n                              </div>\n\n                              {/* Your YouTube Playlists button with dropdown */}\n                              <div className=\"w-full my-2\">\n                                <button\n                                  className={cn(\n                                    \"w-full px-4 py-2 rounded-md border flex items-center justify-between\",\n                                    isDark ? \"bg-gray-800 border-gray-700 text-gray-300\" : \"bg-white border-gray-300 text-gray-700\",\n                                    \"hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\",\n                                    \"focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                                  )}\n                                  onClick={() => setShowYoutubePlaylistSuggestions(!showYoutubePlaylistSuggestions)}\n                                  aria-expanded={showYoutubePlaylistSuggestions}\n                                  aria-controls=\"youtube-playlist-dropdown\"\n                                  aria-label=\"Show your YouTube playlists\"\n                                >\n                                  <span className=\"flex items-center\">\n                                    <Youtube className=\"mr-2 text-red-500\" aria-hidden=\"true\" />\n                                    <span>Your YouTube Playlists</span>\n                                  </span>\n                                  <ChevronRight \n                                    size={16} \n                                    className={cn(\n                                      \"transition-transform\",\n                                      showYoutubePlaylistSuggestions ? \"rotate-90\" : \"\"\n                                    )}\n                                    aria-hidden=\"true\"\n                                  />\n                                </button>\n                                \n                                {/* YouTube Playlist suggestions dropdown */}\n                                <AnimatePresence>\n                                  {showYoutubePlaylistSuggestions && hasYouTubeAuth && conversionState.youtubePlaylists && conversionState.youtubePlaylists.length > 0 && (\n                                    <motion.div\n                                      id=\"youtube-playlist-dropdown\"\n                                      initial={{ opacity: 0, height: 0 }}\n                                      animate={{ opacity: 1, height: 'auto' }}\n                                      exit={{ opacity: 0, height: 0 }}\n                                      transition={{ duration: 0.2 }}\n                                      className={cn(\n                                        \"mt-1 border rounded-lg shadow overflow-hidden\",\n                                        isDark ? \"bg-gray-800 border-gray-700\" : \"bg-white border-gray-200\"\n                                      )}\n                                    >\n                                      <div className=\"max-h-56 overflow-y-auto p-1\">\n                                        <div className=\"text-xs text-gray-500 dark:text-gray-400 p-2 font-semibold\">\n                                          Select a playlist to import:\n                                        </div>\n                                        <ul>\n                                          {conversionState.youtubePlaylists.slice(0, 8).map((playlist: YouTubePlaylist) => (\n                                            <li key={playlist.id}>\n                                              <KeyboardFocusableCard\n                                                className={cn(\n                                                  \"flex items-center gap-3 p-2 rounded cursor-pointer transition\",\n                                                  isDark ? \"hover:bg-red-900/30\" : \"hover:bg-red-100\"\n                                                )}\n                              onClick={() => {\n                                                  if (isProcessing) return;\n                                                  setYoutubeUrl(`https://www.youtube.com/playlist?list=${playlist.id}`);\n                                                  setShowYoutubePlaylistSuggestions(false);\n                                                }}\n                                                onKeyDown={(e) => {\n                                                  if (e.key === 'Enter' || e.key === ' ') {\n                                                    e.preventDefault();\n                                                    if (isProcessing) return;\n                                                    setYoutubeUrl(`https://www.youtube.com/playlist?list=${playlist.id}`);\n                                                    setShowYoutubePlaylistSuggestions(false);\n                                                  }\n                                                }}\n                                                aria-label={`Select playlist: ${playlist.snippet?.title || 'Untitled playlist'} with ${playlist.contentDetails?.itemCount || 'unknown'} tracks`}\n                                              >\n                                                {playlist.snippet?.thumbnails?.default?.url ? (\n                                                  <img \n                                                    src={playlist.snippet.thumbnails.default.url} \n                                                    alt=\"\" \n                                                    className=\"w-10 h-10 rounded object-cover flex-shrink-0\" \n                                                    aria-hidden=\"true\"\n                                                  />\n                                                ) : (\n                                                  <div className=\"w-10 h-10 rounded bg-red-100 flex items-center justify-center flex-shrink-0\">\n                                                    <Music size={16} className=\"text-red-600\" aria-hidden=\"true\" />\n                                                  </div>\n                              )}\n                              <div className=\"flex-1 min-w-0\">\n                                                  <div className=\"truncate font-medium text-sm\">{playlist.snippet?.title || 'Untitled playlist'}</div>\n                                                  <div className=\"truncate text-xs text-gray-400\">\n                                                    {playlist.snippet?.channelTitle ? `${playlist.snippet.channelTitle} • ` : ''}{playlist.contentDetails?.itemCount || 'Unknown'} tracks\n                              </div>\n                                                </div>\n                                              </KeyboardFocusableCard>\n                            </li>\n                          ))}\n                        </ul>\n                                      </div>\n                                    </motion.div>\n                                  )}\n\n                                  {/* Show message when no playlists are available */}\n                                  {showYoutubePlaylistSuggestions && hasYouTubeAuth && (!conversionState.youtubePlaylists || conversionState.youtubePlaylists.length === 0) && (\n                                    <motion.div\n                                      initial={{ opacity: 0, height: 0 }}\n                                      animate={{ opacity: 1, height: 'auto' }}\n                                      exit={{ opacity: 0, height: 0 }}\n                                      transition={{ duration: 0.2 }}\n                                      className={cn(\n                                        \"mt-1 border rounded-lg shadow p-4 text-center\",\n                                        isDark ? \"bg-gray-800 border-gray-700 text-gray-300\" : \"bg-white border-gray-200 text-gray-600\"\n                                      )}\n                                    >\n                                      <p>No YouTube playlists found in your account.</p>\n                                    </motion.div>\n                                  )}\n\n                                  {/* Show message when not authenticated with YouTube */}\n                                  {showYoutubePlaylistSuggestions && !hasYouTubeAuth && (\n                                    <motion.div\n                                      initial={{ opacity: 0, height: 0 }}\n                                      animate={{ opacity: 1, height: 'auto' }}\n                                      exit={{ opacity: 0, height: 0 }}\n                                      transition={{ duration: 0.2 }}\n                                      className={cn(\n                                        \"mt-1 border rounded-lg shadow p-4\",\n                                        \"bg-surface-dropdown border-border-default\" // Style update\n                                      )}\n                                    >\n                                      <div className=\"flex flex-col items-center gap-2\">\n                                        <p className=\"text-center text-sm text-content-secondary mb-2\">\n                                          You need to connect to YouTube first\n                                        </p>\n                                        <ConnectButton\n                                          platform=\"youtube\"\n                                          isConnected={hasYouTubeAuth} // This should be false here\n                                          onConnect={connectToYouTube} // Correct function call\n                                          className=\"text-sm w-full\"\n                                        />\n                                      </div>\n                                    </motion.div>\n                                  )}\n                                </AnimatePresence>\n                  </div>\n                            </>\n                          )}\n                        </div>\n                        \n                        {/* Show loading or error */}\n                        {isProcessing && (\n                          <div \n                            className=\"mt-4 text-center flex items-center justify-center gap-2 text-purple-500\"\n                            aria-live=\"polite\"\n                          >\n                            <Loader className=\"animate-spin\" size={16} aria-hidden=\"true\" />\n                            <span>Loading tracks...</span>\n                          </div>\n                        )}\n                        \n                        <div className=\"flex justify-between mt-6\">\n                          <button\n                            className={cn(\n                              \"px-4 py-2 rounded flex items-center gap-2 text-sm\",\n                              isDark ? \"text-gray-400 hover:text-white hover:bg-gray-700\" : \"text-gray-600 hover:text-gray-900 hover:bg-gray-100\",\n                              \"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-offset-gray-800\"\n                            )}\n                            onClick={() => setCurrentWizardStep(1)}\n                            aria-label=\"Go back to Select Source\"\n                          >\n                            <ChevronLeft size={16} aria-hidden=\"true\" />\n                            <span>Back</span>\n                          </button>\n                          \n                          <GlowButton\n                            variant=\"primary\"\n                            onClick={() => setCurrentWizardStep(3)}\n                            disabled={!conversionState.tracks.length}\n                            isLoading={isProcessing && !conversionState.tracks.length}\n                            aria-label={`Continue to Review Tracks ${!conversionState.tracks.length ? '(No Tracks Yet)' : ''}`}\n                          >\n                            <span>Next</span>\n                            <ChevronRight size={16} aria-hidden=\"true\" className=\"ml-1\" />\n                          </GlowButton>\n                        </div>\n                      </div>\n                    </motion.div>\n                  )}\n                  \n                  {/* Step 3: Review Tracks */}\n                  {currentWizardStep === 3 && (\n                    <motion.div\n                      key=\"step3\"\n                      initial={{ opacity: 0, y: 30 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -30 }}\n                      transition={{ duration: 0.3 }}\n                    >\n                      <div>\n                        <h3 className=\"text-lg font-bold mb-3 flex items-center gap-2\">\n                          <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-green-500 to-red-500\"><FileSpreadsheet size={24} /></span>\n                          Review Tracks\n                          <span className=\"sr-only\">{wizardSteps[2].help}</span>\n                        </h3>\n                        \n                        {/* Track summary */}\n                        <div className={cn(\n                          \"mb-4 p-4 rounded-lg\",\n                          \"bg-surface-highlight border border-border-default\" // Updated styles\n                        )}>\n                          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n                            <div>\n                              <h4 className=\"font-semibold text-content-primary\">{selectedPlaylist?.name || 'Imported Playlist'}</h4>\n                              <p className=\"text-sm text-content-secondary\">\n                                {selectedPlaylist?.trackCount || conversionState.tracks.length} tracks •\n                                {selectedPlaylist?.owner && ` By ${selectedPlaylist.owner}`}\n                              </p>\n                            </div>\n                            <div className={cn(\n                              \"flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium\",\n                              // Platform specific badge styles\n                              sourcePlatform === 'spotify'\n                                ? \"bg-[var(--spotify-bg-subtle)] text-[var(--spotify-text-accent)]\"\n                                : \"bg-[var(--youtube-bg-subtle)] text-[var(--youtube-text-accent)]\"\n                            )}>\n                              <Music\n                                className={cn(\n                                  sourcePlatform === 'spotify' ? 'text-[var(--spotify-icon-color)]' : 'text-[var(--youtube-icon-color)]'\n                                )}\n                                aria-hidden=\"true\"\n                              />\n                              <span>{platforms.find(p => p.key === sourcePlatform)?.label} Source</span>\n                            </div>\n                          </div>\n                        </div>\n                        \n                        {/* Track list with improved accessibility */}\n                        <div \n                          className=\"mt-2 rounded-lg border border-border-default overflow-hidden\" // Added overflow hidden\n                          role=\"region\"\n                          aria-label=\"Track list preview\"\n                        >\n                          <div className={cn(\n                            \"p-3 font-medium border-b text-sm\",\n                            \"bg-surface-alt text-content-secondary border-border-default\" // Header styles\n                          )}>\n                            Track Preview ({conversionState.tracks.length})\n                          </div>\n                          <div className={cn(\n                            \"max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-surface-scrollbar scrollbar-track-surface-alt\", // Scrollbar styles\n                            \"bg-surface-card\" // Background for list\n                          )}>\n                            {isProcessing && conversionState.tracks.length === 0 && ( // Show loader only if no tracks and processing\n                              <div className=\"mt-4 text-center flex items-center justify-center gap-2 text-brand-primary py-4\" aria-live=\"polite\">\n                                <Loader className=\"animate-spin\" size={16} aria-hidden=\"true\" />\n                                <span>Loading tracks...</span>\n                              </div>\n                            )}\n                            {!isProcessing && conversionState.tracks.length > 0 && (\n                              <ul role=\"list\">\n                                {conversionState.tracks.map((track, idx) => (\n                                  <li \n                                    key={`track-${track.id}-${idx}`}\n                                    className={cn(\n                                      \"py-2.5 px-3 border-b flex items-center gap-2 transition-colors\", // Adjusted padding\n                                      \"border-border-default hover:bg-surface-hover\" // Hover and border\n                                    )}\n                                  >\n                                    <span className=\"w-6 text-center text-xs text-content-tertiary\">{idx + 1}</span>\n                                    <div className=\"flex-1 min-w-0\">\n                                      <p className=\"font-medium text-sm truncate text-content-primary\">{track.name}</p>\n                                      <p className=\"text-xs text-content-secondary truncate\">{track.artists.join(', ')}</p>\n                                    </div>\n                                    {track.duration_ms && (\n                                      <span className=\"text-xs text-gray-400 whitespace-nowrap\">\n                                        {Math.floor(track.duration_ms / 60000)}:{((track.duration_ms % 60000) / 1000).toFixed(0).padStart(2, '0')}\n                                      </span>\n                                    )}\n                              </li>\n                          ))}\n                        </ul>\n                      )}\n                            {!isProcessing && conversionState.tracks.length === 0 && (\n                              <div className=\"py-8 text-center text-content-tertiary\">\n                                <Music size={24} className=\"mx-auto mb-2 opacity-50\" aria-hidden=\"true\" />\n                                <p>No tracks loaded.</p>\n                    </div>\n                            )}\n                  </div>\n                        </div>\n                        \n                        <div className=\"flex justify-between mt-6\">\n                          <button\n                            className={cn(\n                              \"px-4 py-2 rounded flex items-center gap-2 text-sm\",\n                              isDark ? \"text-gray-400 hover:text-white hover:bg-gray-700\" : \"text-gray-600 hover:text-gray-900 hover:bg-gray-100\",\n                              \"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-offset-gray-800\"\n                            )}\n                            onClick={() => setCurrentWizardStep(2)}\n                            aria-label=\"Go back to Import Playlist\"\n                          >\n                            <ChevronLeft size={16} aria-hidden=\"true\" />\n                            <span>Back</span>\n                          </button>\n                          \n                          <GlowButton\n                            variant=\"primary\"\n                            onClick={() => setCurrentWizardStep(4)}\n                            disabled={!conversionState.tracks.length}\n                            aria-label={`Continue to Export Playlist ${!conversionState.tracks.length ? '(import tracks first)' : ''}`}\n                          >\n                            <span>Next</span>\n                            <ChevronRight size={16} aria-hidden=\"true\" className=\"ml-1\" />\n                          </GlowButton>\n                        </div>\n                      </div>\n                    </motion.div>\n                  )}\n                  \n                  {/* Step 4: Export Playlist */}\n                  {currentWizardStep === 4 && (\n                    <motion.div\n                      key=\"step4\"\n                      initial={{ opacity: 0, y: 30 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -30 }}\n                      transition={{ duration: 0.3 }}\n                    >\n                      <div>\n                        <h3 className=\"text-lg font-bold mb-3 flex items-center gap-2\">\n                          <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-green-500 to-red-500\"><Download size={24} /></span>\n                          Export Playlist\n                          <span className=\"sr-only\">{wizardSteps[3].help}</span>\n                        </h3>\n                        \n                        {/* Export summary */}\n                  <div className={cn(\n                          \"p-4 rounded-lg border\",\n                          isDark ? \"bg-gray-800/50 border-gray-700\" : \"bg-white border-gray-200\"\n                        )}>\n                          <div className=\"flex items-start gap-4\">\n                            <div className={cn(\n                              \"w-12 h-12 flex-shrink-0 rounded flex items-center justify-center\",\n                              sourcePlatform === 'spotify' ? \"bg-green-100\" : \"bg-red-100\"\n                            )}>\n                              <Music \n                                className={sourcePlatform === 'spotify' ? 'text-green-600 text-lg' : 'text-red-600 text-lg'} \n                                aria-hidden=\"true\" \n                              />\n                  </div>\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2\">\n                                <h4 className=\"font-semibold\">{selectedPlaylist?.name || 'Unnamed Playlist'}</h4>\n                                <div className=\"flex items-center gap-2\">\n                                  <span className={cn(\n                                    \"px-2 py-0.5 rounded-full text-xs\",\n                                    isDark ? \"bg-gray-700 text-gray-300\" : \"bg-gray-200 text-gray-700\"\n                                  )}>\n                                    {conversionState.tracks.length} tracks\n                                  </span>\n                                  <Music \n                                    className={sourcePlatform === 'spotify' ? 'text-green-500 text-sm' : 'text-red-500 text-sm'} \n                                    aria-hidden=\"true\" \n                                  />\n                </div>\n                              </div>\n                              <div className=\"mt-3 flex items-center\">\n                                <div className=\"font-medium text-sm flex items-center gap-1\">\n                                  <span>Converting to:</span>\n                                  <Youtube \n                                    className={destinationPlatform === 'spotify' ? 'text-green-500 ml-1' : 'text-red-500 ml-1'} \n                                    aria-hidden=\"true\"\n                                  />\n                                  <span className=\"font-bold\">{platforms.find(p => p.key === destinationPlatform)?.label}</span>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                          \n                          {/* Add customization options for new playlist */}\n                          <div className=\"mt-4 space-y-3\">\n                            <div>\n                              {/* <label htmlFor=\"playlist-name\" className=\"block text-sm font-medium mb-1\">\n                                New Playlist Name\n                              </label> */} \n                              <FloatingLabels\n                                type=\"text\"\n                                id=\"playlist-name\"\n                                label=\"New Playlist Name\"\n                                value={playlistNameForExport}\n                                onChange={(e) => setPlaylistNameForExport(e.target.value)}\n                                placeholder={`${selectedPlaylist?.name || 'Playlist'} (Converted)`}\n                                variant=\"outlined\"\n                                inputClassName={cn(\n                                  // Retain original dynamic classes if necessary, e.g., for dark mode\n                                  isDark ? \"dark:bg-gray-700 dark:border-gray-600 dark:text-white\" : \"bg-white border-gray-300 text-gray-900\",\n                                  isProcessing ? \"opacity-50 cursor-not-allowed\" : \"\"\n                                )}\n                                disabled={isProcessing}\n                              />\n                            </div>\n                            \n                            <div>\n                              <label htmlFor=\"playlist-description\" className=\"block text-sm font-medium mb-1\">\n                                Description\n                              </label>\n                              <textarea \n                                id=\"playlist-description\"\n                                value={playlistDescriptionForExport}\n                                onChange={(e) => setPlaylistDescriptionForExport(e.target.value)}\n                                placeholder={`Converted from ${sourcePlatform} using SoundSwapp`}\n                                rows={2}\n                                className={cn(\n                                  \"w-full px-3 py-2 rounded border focus:ring-2 focus:ring-purple-500 focus:outline-none\",\n                                  isDark ? \"bg-gray-700 border-gray-600 text-white\" : \"bg-white border-gray-300 text-gray-900\"\n                                )}\n                                disabled={isProcessing}\n                              />\n                            </div>\n                          </div>\n                            \n                          {/* Conversion action button */}\n                          <div className=\"mt-6\">\n                  <GlowButton\n                              onClick={handleStartConversion}\n                              disabled={isProcessing || !conversionState.tracks.length || \n                                (sourcePlatform === 'spotify' && !hasSpotifyAuth) || \n                                (destinationPlatform === 'youtube' && !hasYouTubeAuth)}\n                    className={cn(\n                                \"px-6 py-3 rounded-lg font-medium transition-all\",\n                                !isProcessing && conversionState.tracks.length > 0\n                                  ? \"bg-primary hover:bg-primary/80 text-primary-foreground\" \n                                  : \"bg-muted text-muted-foreground cursor-not-allowed\",\n                                \"flex items-center gap-2\"\n                              )}\n                              aria-label=\"Start playlist conversion\"\n                            >\n                              {isProcessing ? (\n                                <>\n                                  <Loader className=\"h-5 w-5 animate-spin\" />\n                                  <span>Converting...</span>\n                                </>\n                              ) : (\n                                <>\n                                  <Zap size={18} />\n                                  <span>Convert Playlist</span>\n                                </>\n                              )}\n                  </GlowButton>\n                </div>\n\n                          {/* Conversion Progress Bar */}\n                          {isProcessing && (\n                            <div className=\"mt-4 pt-4 border-t border-muted\">\n                              <div className=\"flex justify-between text-sm mb-1\">\n                                <span className=\"text-muted-foreground\">\n                                  {conversionState.status === ConversionStatus.MATCHING_TRACKS ? 'Matching tracks...' : \n                                   conversionState.status === ConversionStatus.CREATING_PLAYLIST ? 'Creating playlist...' :\n                                   'Converting...'}\n                                </span>\n                                <span>{Math.round(conversionState.matchingProgress)}%</span>\n                              </div>\n                              <div className=\"h-2 w-full bg-muted rounded-full overflow-hidden\">\n                                <div \n                                  className=\"h-full bg-gradient-to-r from-green-500 to-red-500 transition-all duration-500\"\n                                  style={{ width: `${conversionState.matchingProgress}%` }}\n                                  role=\"progressbar\"\n                                  aria-valuenow={conversionState.matchingProgress}\n                                  aria-valuemin={0}\n                                  aria-valuemax={100}\n                                ></div>\n                              </div>\n                              \n                              {conversionState.error && (\n                                <div className=\"mt-4 bg-youtube/10 text-youtube p-3 rounded-md\">\n                                  <div className=\"flex items-start gap-2\">\n                                    <AlertTriangle size={16} className=\"flex-shrink-0 mt-0.5\" />\n                                    <p className=\"text-sm\">{conversionState.error}</p>\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                        \n                        {/* Success or error message */}\n                        {conversionState.status === ConversionStatus.SUCCESS && (\n                          <div className={cn(\n                            \"mt-4 p-3 rounded-lg flex items-center gap-2\",\n                            isDark ? \"bg-green-900/30 text-green-300 border border-green-800/50\" : \"bg-green-100 text-green-800 border-l-4 border-green-600\"\n                          )}\n                          role=\"status\"\n                          aria-live=\"polite\"\n                          >\n                            <CheckCircle size={18} className=\"flex-shrink-0\" aria-hidden=\"true\" />\n                            <div>\n                              <p className=\"font-semibold\">Conversion successful!</p>\n                              <p className=\"text-sm mt-1\">\n                                Your playlist has been successfully converted to {platforms.find(p => p.key === destinationPlatform)?.label}.\n                              </p>\n                            </div>\n                            <a\n                              href={(destinationPlatform === 'spotify' ? conversionState.spotifyPlaylistUrl : conversionState.youtubePlaylistUrl) || '#'}\n                              target=\"_blank\"\n                              rel=\"noopener noreferrer\"\n                              className={cn(\n                                \"ml-auto px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1\",\n                                destinationPlatform === 'spotify' \n                                  ? \"bg-green-200 text-green-800 hover:bg-green-300\" \n                                  : \"bg-red-200 text-red-800 hover:bg-red-300\",\n                                \"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-offset-gray-800\"\n                              )}\n                              aria-label={`View ${platforms.find(p => p.key === destinationPlatform)?.label} playlist (opens in new tab)`}\n                            >\n                              <span>View Playlist</span>\n                              <ExternalLink size={12} aria-hidden=\"true\" />\n                            </a>\n                          </div>\n                        )}\n                        \n                        <div className=\"flex justify-between mt-6\">\n                          <button\n                            className={cn(\n                              \"px-4 py-2 rounded flex items-center gap-2 text-sm\",\n                              isDark ? \"text-gray-400 hover:text-white hover:bg-gray-700\" : \"text-gray-600 hover:text-gray-900 hover:bg-gray-100\",\n                              \"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-offset-gray-800\"\n                            )}\n                            onClick={() => setCurrentWizardStep(3)}\n                            aria-label=\"Go back to Review Tracks\"\n                            disabled={isProcessing}\n                          >\n                            <ChevronLeft size={16} aria-hidden=\"true\" />\n                            <span>Back</span>\n                          </button>\n                          \n                          {/* Add a start over button */}\n                          {conversionState.status === ConversionStatus.SUCCESS && (\n                            <GlowButton\n                              variant=\"primary\"\n                              onClick={resetConverter}\n                              aria-label=\"Convert another playlist\"\n                            >\n                              <RefreshCw size={16} aria-hidden=\"true\" className=\"mr-1.5\" />\n                              <span>Convert Another</span>\n                            </GlowButton>\n                          )}\n                        </div>\n                      </div>\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n              </GlassmorphicCard>\n            </div>\n            \n\n\n            {/* Recent Conversions Section */}\n            <AnimatePresence>\n              {conversionState.conversionHistory && conversionState.conversionHistory.length > 0 && (\n                <motion.div\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  exit={{ opacity: 0 }}\n                  transition={{ duration: 0.3 }}\n                  className=\"mt-12\" // Remove duplicate className\n                >\n                  <GlassmorphicCard \n                    className=\"p-6 sm:p-8 mb-8 rounded-2xl border border-border-default shadow-xl\" \n                    gradientOverlay={true} \n                    variant=\"primary\"\n                    magneticEffect={true}\n                    glowIntensity=\"medium\"\n                  >\n                    <h3 className=\"text-xl font-bold mb-6 flex items-center gap-2 text-content-primary\">\n                      <svg className=\"h-6 w-6 text-brand-accentPink\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                      </svg>\n                      <LightingText baseColor=\"text-content-primary\" highlightColor=\"text-brand-accentPink\" size={100}>\n                        Recent Conversions\n                      </LightingText>\n                    </h3>\n                    <div \n                      className={cn(\n                        \"rounded-lg border overflow-x-auto\",\n                        \"border-border-default\"\n                      )}\n                      role=\"region\"\n                      aria-label=\"Recent conversion history\"\n                    >\n                      <table className=\"w-full min-w-[600px]\" role=\"table\">\n                        <thead>\n                          <tr className={cn(\n                            \"text-xs font-semibold text-left\",\n                            \"bg-surface-alt text-content-secondary\" // Updated header style\n                          )}>\n                            <th className=\"px-4 py-3\" scope=\"col\">Playlist</th>\n                            <th className=\"px-4 py-3 hidden md:table-cell\" scope=\"col\">Date</th>\n                            <th className=\"px-4 py-3 text-center\" scope=\"col\">Tracks</th>\n                            <th className=\"px-4 py-3 text-right\" scope=\"col\">Actions</th>\n                          </tr>\n                        </thead>\n                        <tbody role=\"rowgroup\" className=\"divide-y divide-border-default bg-surface-card\">{/* Ensure no whitespace immediately after this opening tag */}\n                          {conversionState.conversionHistory.slice(0, 5).map((conv) => (\n                            <tr \n                              key={conv.id}\n                              className={cn(\n                                \"text-sm\",\n                                \"hover:bg-surface-hover\" // Updated row hover\n                              )}\n                              role=\"row\"\n                            >\n                              <td className=\"px-4 py-3 font-medium text-content-primary\">{conv.spotifyPlaylistName || 'Unnamed Playlist'}</td>\n                              <td className=\"px-4 py-3 text-content-secondary hidden md:table-cell\">{new Date(conv.convertedAt).toLocaleDateString()}</td>\n                              <td className=\"px-4 py-3 text-center\">\n                                <span className={cn(\n                                  \"inline-flex items-center text-xs rounded-full px-2.5 py-1 font-medium\",\n                                  \"bg-input text-content-secondary\" // Updated badge style\n                                )}>\n                                  {conv.tracksMatched} / {conv.totalTracks}\n                                </span>\n                                {conv.failedTracks && conv.failedTracks.length > 0 && (\n                                  <button\n                                    onClick={() => setSelectedFailedTracks(conv.failedTracks || [])}\n                                    className={cn(\n                                      \"ml-2 inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors\",\n                                      \"bg-yellow-500 text-yellow-900 hover:bg-yellow-600\",\n                                      \"focus:outline-none focus:ring-2 focus:ring-yellow-500\"\n                                    )}\n                                    aria-label=\"View failed tracks details\"\n                                  >\n                                    <AlertTriangle size={12} />\n                                    {conv.failedTracks.length} failed\n                                  </button>\n                                )}\n                              </td>\n                              <td className=\"px-4 py-3 text-right\">\n                                <div className=\"flex items-center justify-end gap-2\">\n                                  <Link\n                                    to={`/insights/${conv.id}`}\n                                    className={cn(\n                                      \"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-colors\",\n                                      \"bg-black text-white hover:bg-gray-800\",\n                                      \"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black ring-offset-surface-card\"\n                                    )}\n                                    aria-label=\"View playlist insights\"\n                                  >\n                                    <Info size={14} className=\"text-white\" />\n                                    <span>Insights</span>\n                                  </Link>\n                                  {conv.youtubePlaylistUrl && (\n                                    <a\n                                      href={conv.youtubePlaylistUrl}\n                                      target=\"_blank\"\n                                      rel=\"noopener noreferrer\"\n                                      className={cn(\n                                        \"inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-white text-xs font-medium transition-colors\",\n                                        \"bg-black hover:bg-gray-900\",\n                                        \"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black ring-offset-surface-card\"\n                                      )}\n                                      aria-label=\"Open YouTube playlist in new tab\"\n                                    >\n                                      <img\n                                        src={isDark ? \"/images/yt_logo_rgb_dark.png\" : \"/images/yt_logo_rgb_light.png\"}\n                                        alt=\"YouTube\"\n                                        style={{ height: 18, width: 'auto', objectFit: 'contain', display: 'block' }}\n                                        className=\"h-5 w-auto\"\n                                      />\n                                      <span>Watch on YouTube</span>\n                                    </a>\n                                  )}\n                                  {conv.spotifyPlaylistUrl && (\n                                    <a\n                                      href={conv.spotifyPlaylistUrl}\n                                      target=\"_blank\"\n                                      rel=\"noopener noreferrer\"\n                                      className={cn(\n                                        \"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md text-white text-xs font-medium transition-colors\",\n                                        \"bg-[var(--spotify-bg)] hover:bg-[var(--spotify-bg-hover)]\",\n                                        \"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--spotify-bg)] ring-offset-surface-card\"\n                                      )}\n                                      aria-label=\"Open Spotify playlist in new tab\"\n                                    >\n                                      <img\n                                        src=\"/images/Spotify_Primary_Logo_RGB_Green.png\"\n                                        alt=\"Spotify\"\n                                        style={{ height: 14, width: 'auto', objectFit: 'contain', display: 'block' }}\n                                        className=\"text-[var(--spotify-icon-color-button)]\"\n                                      />\n                                      <span className=\"text-[var(--spotify-text-button)]\">View</span>\n                                    </a>\n                                  )}\n                                </div>\n                              </td>\n                            </tr>\n                          ))}\n                        </tbody>{/* Ensure no whitespace immediately before this closing tag */}\n                      </table>\n                    </div>\n                  </GlassmorphicCard>\n                </motion.div>\n              )}\n            </AnimatePresence>\n            \n            {/* Playlist Insights section (conditionally rendered) */}\n            {conversionState.status === ConversionStatus.SUCCESS && conversionState.tracks.length > 0 && (\n              <motion.div \n                className=\"mt-12\" // Add margin to the wrapper\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.5, delay: 0.2 }}\n              >\n                <GlassmorphicContainer\n                  className=\"p-4 sm:p-6\" // Keep padding\n                  shadow=\"xl\" // Keep shadow\n                  animate={true} // Enable built-in animation\n                  hoverEffect={true} // Enable hover effect\n                >\n                  <PlaylistInsights \n                    stats={generatePlaylistInsights(conversionState.tracks)}\n                    tracks={conversionState.tracks}\n                  />\n                </GlassmorphicContainer>\n              </motion.div>\n            )}\n          </div>\n        </section>\n      )}\n      \n      {/* How It Works Section */}\n      <section \n        id=\"how-it-works\" \n        className={cn(\n          \"py-16 lg:py-24 px-4 relative overflow-hidden\", \n          \"bg-gradient-to-br from-background-primary via-background-secondary to-background-primary\" // Soft gradient background\n        )}\n        aria-labelledby=\"how-it-works-title\"\n      >\n        {/* Enhanced Background elements */}\n        <div className=\"absolute inset-0 pointer-events-none overflow-hidden z-0\">\n          <motion.div \n            className=\"absolute -top-1/4 -left-1/4 w-1/2 h-1/2 rounded-full opacity-10 bg-gradient-to-br from-brand-primary via-brand-accent-pink to-transparent filter blur-3xl\"\n            animate={{ \n              transform: [\"translateX(0px) translateY(0px)\", \"translateX(20px) translateY(10px)\", \"translateX(0px) translateY(0px)\"],\n            }}\n            transition={{ duration: 12, repeat: Infinity, ease: \"easeInOut\" }}\n          />\n          <motion.div \n            className=\"absolute -bottom-1/4 -right-1/4 w-1/2 h-1/2 rounded-full opacity-10 bg-gradient-to-tl from-brand-secondary via-brand-accent-purple to-transparent filter blur-3xl\"\n            animate={{ \n              transform: [\"translateX(0px) translateY(0px)\", \"translateX(-20px) translateY(-10px)\", \"translateX(0px) translateY(0px)\"],\n            }}\n            transition={{ duration: 15, repeat: Infinity, ease: \"easeInOut\", delay: 2 }}\n          />\n           {/* Subtle grid pattern */}\n          <div \n            className=\"absolute inset-0 opacity-[0.03]\"\n            style={{\n              backgroundImage: 'linear-gradient(rgba(255,255,255,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.3) 1px, transparent 1px)',\n              backgroundSize: '30px 30px',\n            }}\n          ></div>\n        </div>\n\n        <div className=\"container mx-auto max-w-6xl text-center relative z-10\">\n          <motion.div\n            initial={{ opacity: 0, y: -20 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true, amount: 0.3 }}\n            transition={{ duration: 0.6 }}\n          >\n            {/* Section label */}\n            <div className=\"mb-4 inline-block\">\n              <span \n                className={cn(\n                  \"px-5 py-2 rounded-full text-sm font-semibold tracking-wider uppercase shadow-lg\",\n                  \"bg-gradient-to-r from-brand-primary/80 via-brand-accent-pink/80 to-brand-secondary/80 text-white\",\n                  \"border border-white/20\"\n                )}\n              >\n                EASY PROCESS\n              </span>\n            </div>\n            \n            <h2 \n              id=\"how-it-works-title\" \n              className=\"text-4xl lg:text-6xl font-extrabold mb-6 text-content-primary drop-shadow-md\"\n            >\n              <span \n                className=\"bg-clip-text text-transparent\"\n                style={{\n                  backgroundImage: 'linear-gradient(120deg, var(--brand-primary) 0%, var(--brand-accent-pink) 50%, var(--brand-secondary) 100%)'\n                }}\n              >\n                How It Works\n              </span>\n            </h2>\n            <p className=\"text-lg lg:text-xl text-content-secondary mb-12 lg:mb-20 max-w-3xl mx-auto\">\n              Converting your playlists is simple with our streamlined three-step process. Get your music where you want it, hassle-free.\n            </p>\n          </motion.div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 lg:gap-12\">\n            {howItWorks.map((step, index) => (\n              <motion.div \n                key={index}\n                initial={{ opacity: 0, y: 50, scale: 0.95 }}\n                whileInView={{ opacity: 1, y: 0, scale: 1 }}\n                viewport={{ once: true, amount: 0.2, margin: \"-50px\" }}\n                transition={{ duration: 0.5, delay: index * 0.15, ease: \"easeOut\" }}\n                className=\"flex flex-col h-full\" // Ensure cards take full height in grid cell\n              >\n                <SpotlightCard\n                  className={cn(\n                    \"p-6 md:p-8 text-left rounded-2xl shadow-lg transition-all duration-300 h-full flex flex-col group hover:shadow-xl\",\n                    isDark \n                      ? \"bg-[#1A1A2E]/90 hover:bg-[#21213D]/95 border border-[var(--brand-secondary-alpha-20)]\" \n                      : \"bg-slate-50 hover:bg-white border border-slate-200\"\n                  )}\n                >\n                  <div className=\"relative z-10 flex flex-col h-full\">\n                    <motion.div\n                      className={cn(\n                        \"w-16 h-16 rounded-xl flex items-center justify-center mb-6 shadow-md\",\n                        // SoundSwapp gradient backgrounds based on index\n                        index === 0 ? \"bg-gradient-to-br from-brand-primary to-brand-primary-dark\" :\n                        index === 1 ? \"bg-gradient-to-br from-brand-accent-pink to-brand-accent-pink/80\" :\n                        \"bg-gradient-to-br from-brand-secondary to-brand-secondary-dark\"\n                      )}\n                      whileHover={{ scale: 1.05, rotate: 3 }}\n                      transition={{ type: \"spring\", stiffness: 300 }}\n                    >\n                      {React.cloneElement(step.icon, { \n                        size: 28, \n                        strokeWidth: isDark ? 2 : 2.5,\n                        className: cn(\n                          isDark ? \"text-white\" : \n                            (index === 0 ? \"text-brand-primary-dark\" : \n                             index === 1 ? \"text-brand-accent-pink-dark\" : \n                             \"text-brand-secondary-dark\"),\n                          \"drop-shadow-sm\"\n                        )\n                      })}\n                    </motion.div>\n\n                    <h3 className={cn(\n                      \"text-xl font-semibold mb-3 transition-colors\",\n                      isDark\n                        ? \"text-slate-100 group-hover:text-brand-accent-pink\"\n                        : \"text-slate-700 group-hover:text-brand-primary\"\n                    )}>\n                      {step.title.substring(step.title.indexOf('.') + 2)} {/* Remove number prefix */}\n                    </h3>\n\n                    <p className={cn(\n                      \"text-md flex-grow leading-relaxed\",\n                      isDark \n                        ? \"text-slate-300\" \n                        : \"text-slate-500\"\n                    )}>{step.description}</p>\n                  </div>\n                </SpotlightCard>\n              </motion.div>\n            ))}\n          </div>\n        </div>\n      </section>\n      \n      {/* Features Section - Apply enhanced styling */}\n      <section \n        id=\"features\" \n        className={cn(\n          \"py-16 lg:py-24 px-4 relative overflow-hidden\",\n          \"bg-background-primary\" // Solid background, or a subtle gradient if preferred\n        )}\n        aria-labelledby=\"features-title\"\n      >\n        {/* Enhanced Background elements - similar to How It Works but varied */}\n        <div className=\"absolute inset-0 pointer-events-none overflow-hidden z-0\">\n          <motion.div\n            className=\"absolute -top-1/3 -right-1/4 w-2/5 h-2/5 rounded-full opacity-10 bg-gradient-to-bl from-brand-secondary via-brand-accent-purple to-transparent filter blur-3xl\"\n            animate={{\n              transform: [\"translateX(0px) translateY(0px)\", \"translateX(-15px) translateY(15px)\", \"translateX(0px) translateY(0px)\"],\n            }}\n            transition={{ duration: 13, repeat: Infinity, ease: \"easeInOut\" }}\n          />\n          <motion.div\n            className=\"absolute -bottom-1/3 -left-1/4 w-2/5 h-2/5 rounded-full opacity-10 bg-gradient-to-tr from-brand-primary via-brand-accent-pink to-transparent filter blur-3xl\"\n            animate={{\n              transform: [\"translateX(0px) translateY(0px)\", \"translateX(15px) translateY(-15px)\", \"translateX(0px) translateY(0px)\"],\n            }}\n            transition={{ duration: 16, repeat: Infinity, ease: \"easeInOut\", delay: 1.5 }}\n          />\n          <div\n            className=\"absolute inset-0 opacity-[0.02]\"\n            style={{\n              backgroundImage: 'radial-gradient(rgba(255,255,255,0.2) 0.5px, transparent 0.5px)',\n              backgroundSize: '15px 15px',\n            }}\n          />\n        </div>\n\n        <div className=\"container mx-auto max-w-6xl text-center relative z-10\">\n          <motion.div\n            initial={{ opacity: 0, y: -20 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true, amount: 0.3 }}\n            transition={{ duration: 0.6 }}\n          >\n            {/* Section label */}\n            <div className=\"mb-4 inline-block\">\n              <span\n                className={cn(\n                  \"px-5 py-2 rounded-full text-sm font-semibold tracking-wider uppercase shadow-lg\",\n                  \"bg-gradient-to-r from-brand-secondary/80 via-brand-accent-pink/80 to-brand-primary/80 text-white\", // Reversed gradient for variety\n                  \"border border-white/20\"\n                )}\n              >\n                PREMIUM EXPERIENCE\n              </span>\n            </div>\n\n            <h2\n              id=\"features-title\"\n              className=\"text-4xl lg:text-6xl font-extrabold mb-6 text-content-primary drop-shadow-md\"\n            >\n              <span\n                className=\"bg-clip-text text-transparent\"\n                style={{\n                  backgroundImage: 'linear-gradient(120deg, var(--brand-secondary) 0%, var(--brand-accent-pink) 50%, var(--brand-primary) 100%)' // Slightly different gradient\n                }}\n              >\n                Powerful Features\n              </span>\n            </h2>\n            <p className=\"text-lg lg:text-xl text-content-secondary mb-12 lg:mb-20 max-w-3xl mx-auto\">\n              Our converter is packed with cutting-edge features designed for a seamless and delightful music conversion experience.\n            </p>\n          </motion.div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8\">\n            {features.map((feature, index) => (\n              <motion.div\n                key={index}\n                initial={{ opacity: 0, y: 50, scale: 0.95 }}\n                whileInView={{ opacity: 1, y: 0, scale: 1 }}\n                viewport={{ once: true, amount: 0.2, margin: \"-50px\" }}\n                transition={{ duration: 0.5, delay: index * 0.1, ease: \"easeOut\" }}\n                className=\"h-full\"\n              >\n                <SpotlightCard\n                  className={cn(\n                    \"p-6 text-left h-full rounded-2xl shadow-lg transition-all duration-300 group flex flex-col overflow-hidden\",\n                    isDark \n                      ? \"bg-[#1A1A2E]/90 hover:bg-[#21213D]/95 border-[var(--brand-secondary-alpha-20)] backdrop-blur-sm\" // Richer dark bg with blur\n                      : \"bg-slate-50 hover:bg-white border-slate-200\"\n                  )}\n                  // Ensure SpotlightCard props like fromColor, viaColor, toColor are set if they control the spotlight effect\n                  // For example (these are illustrative, adjust to your component's API):\n                  // fromColor={isDark ? \"var(--brand-primary-alpha-10)\" : \"var(--brand-primary-alpha-5)\"}\n                  // viaColor={isDark ? \"var(--brand-accent-pink-alpha-10)\" : \"var(--brand-accent-pink-alpha-5)\"}\n                  // size={isMobile ? 200 : 300} // Adjust spotlight size\n                >\n                  <div className=\"relative z-10 flex flex-col h-full\">\n                    <motion.div\n                      className={cn(\n                        \"w-16 h-16 rounded-xl flex items-center justify-center mb-6 shadow-lg\",\n                        index % 4 === 0 ? \"bg-gradient-to-br from-brand-primary to-brand-primary-dark\" :\n                        index % 4 === 1 ? \"bg-gradient-to-br from-brand-secondary to-brand-secondary-dark\" :\n                        index % 4 === 2 ? \"bg-gradient-to-br from-brand-accent-pink to-brand-accent-pink/80\" :\n                        \"bg-gradient-to-br from-brand-accent-yellow to-brand-accent-yellow/80\"\n                      )}\n                      whileHover={{ scale: 1.1, y: -5 }}\n                      transition={{ type: \"spring\", stiffness: 250, damping: 10 }}\n                    >\n                      {React.cloneElement(feature.icon, { \n                        size: 32, \n                        strokeWidth: isDark ? 1.8 : 2.2,\n                        className: cn(\n                          isDark ? \"text-white\" : \n                            (index % 4 === 0 ? \"text-brand-primary-dark\" : \n                             index % 4 === 1 ? \"text-brand-secondary-dark\" : \n                             index % 4 === 2 ? \"text-brand-accent-pink-dark\" : \n                             \"text-brand-accent-yellow-dark\"),\n                          isDark ? \"drop-shadow-sm\" : \"drop-shadow-md\"\n                        )\n                      })}\n                    </motion.div>\n\n                    <h3 className={cn(\n                      \"text-xl font-semibold mb-3 transition-colors\",\n                      isDark\n                        ? \"text-slate-100 group-hover:text-brand-accent-pink\"\n                        : \"text-slate-700 group-hover:text-brand-primary\"\n                    )}>\n                      {feature.title}\n                    </h3>\n                    <p className={cn(\n                      \"text-md flex-grow leading-relaxed\",\n                      isDark \n                        ? \"text-slate-300\" \n                        : \"text-slate-500\"\n                    )}>{feature.description}</p>\n                  </div>\n                </SpotlightCard>\n              </motion.div>\n            ))}\n          </div>\n        </div>\n      </section>\n      \n      {/* Footer - Updated with SoundSwapp branding */}\n      <footer className={cn(\n        \"py-12 px-4 text-center\",\n        \"bg-background-secondary border-t border-border-default\" // Footer background and top border\n      )}>\n        <div className=\"container mx-auto max-w-4xl\">\n          <div className=\"flex flex-col sm:flex-row justify-between items-center gap-6 mb-6\">\n            <div className=\"flex items-center gap-2 text-content-primary\">\n              <div className=\"soundswapp-logo\">\n                <SoundSwappLogo width={32} height={32} />\n              </div>\n              <span className=\"font-bold text-xl soundswapp-gradient-text\">SoundSwapp</span>\n            </div>\n            <div className=\"flex gap-4\">\n              <a href=\"https://github.com/your-repo\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-content-tertiary hover:text-brand-primary transition-colors\">\n                <Github size={24} />\n                <span className=\"sr-only\">GitHub</span>\n              </a>\n              <a href=\"mailto:support@soundswapp.app\" className=\"text-content-tertiary hover:text-brand-primary transition-colors\">\n                <Mail size={24} />\n                <span className=\"sr-only\">Email Support</span>\n              </a>\n            </div>\n          </div>\n          <p className=\"text-sm text-content-tertiary mb-4\">\n            Convert your playlists between Spotify and YouTube with ease. Secure, fast, and user-friendly.\n          </p>\n          <p className=\"text-xs text-content-tertiary\">\n            &copy; {new Date().getFullYear()} SoundSwapp. All Rights Reserved. \n            <a href=\"/privacy.html\" className=\"ml-2 hover:text-brand-primary underline\" target=\"_blank\" rel=\"noopener noreferrer\">Privacy Policy</a>\n            <span className=\"mx-1\">•</span>\n            <a href=\"/terms.html\" className=\"hover:text-brand-primary underline\" target=\"_blank\" rel=\"noopener noreferrer\">Terms of Service</a>\n          </p>\n          <div className=\"mt-4 flex justify-center items-center gap-2\">\n            <span className=\"text-xs font-semibold bg-gradient-to-r from-purple-500 via-pink-500 to-blue-400 bg-clip-text text-transparent animate-gradient-x\">\n              Designed & Developed by\n            </span>\n            <a\n              href=\"https://eliudsamwel.dev\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"inline-flex items-center gap-1 text-xs font-bold bg-gradient-to-r from-pink-500 via-purple-500 to-blue-400 bg-clip-text text-transparent hover:underline hover:scale-105 focus:outline-none focus:ring-2 focus:ring-pink-400 transition-all duration-200\"\n            >\n              eliudsamwel.dev\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" className=\"inline ml-1\">\n                <path d=\"M5 12h14M12 5l7 7-7 7\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n              </svg>\n            </a>\n          </div>\n        </div>\n      </footer>\n\n      <SuccessCelebration \n        isActive={showCelebration} \n        onComplete={() => setShowCelebration(false)} \n      />\n      <ToastContainer toasts={toasts} onDismiss={dismissToast} />\n\n      {/* Failed Tracks Modal */}\n      {selectedFailedTracks && (\n        <EnhancedFailedTracksModal\n          failedTracks={selectedFailedTracks}\n          onClose={() => setSelectedFailedTracks(null)}\n          onAddToYouTube={async (videoId, trackIndex) => {\n            try {\n              // Use statically imported function\n              const youtubePlaylistId = conversionState.youtubePlaylistId;\n              \n              if (!youtubePlaylistId) {\n                throw new Error('No YouTube playlist found. Please start a conversion first.');\n              }\n              \n              // Extract video ID if a full URL was provided\n              const cleanVideoId = videoId.includes('youtube.com') || videoId.includes('youtu.be') \n                ? videoId.match(/(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/\\s]{11})/)?.[1] || videoId\n                : videoId;\n              \n              if (!cleanVideoId || cleanVideoId.length !== 11) {\n                throw new Error('Invalid YouTube video ID. Please provide a valid 11-character video ID or YouTube URL.');\n              }\n              \n              console.log(`Adding YouTube video ${cleanVideoId} to playlist ${youtubePlaylistId}`);\n              \n              // Add the video to the YouTube playlist\n              await addToYouTubePlaylist('user', youtubePlaylistId, cleanVideoId);\n              \n              // Show success message\n              addToast({\n                type: 'success',\n                title: 'Track Added!',\n                message: `Successfully added YouTube video to playlist.`,\n                duration: 3000\n              });\n              \n            } catch (error) {\n              console.error('Error adding YouTube video:', error);\n              addToast({\n                type: 'error',\n                title: 'Failed to Add Track',\n                message: error instanceof Error ? error.message : 'Failed to add YouTube video to playlist.',\n                duration: 5000\n              });\n            }\n          }}\n          onAddToSpotify={async (trackUri, trackIndex) => {\n            try {\n              // Use statically imported function\n              const spotifyPlaylistId = conversionState.spotifyPlaylistId;\n              \n              if (!spotifyPlaylistId) {\n                throw new Error('No Spotify playlist found. Please start a conversion first.');\n              }\n              \n              // Clean the track URI\n              let cleanTrackUri = trackUri;\n              \n              // If it's a URL, extract the track ID\n              if (trackUri.includes('spotify.com/track/')) {\n                const match = trackUri.match(/spotify\\.com\\/track\\/([a-zA-Z0-9]+)/);\n                if (match) {\n                  cleanTrackUri = `spotify:track:${match[1]}`;\n                }\n              }\n              \n              // Validate track URI format\n              if (!cleanTrackUri.startsWith('spotify:track:')) {\n                throw new Error('Invalid Spotify track URI. Please provide a valid track URI or Spotify URL.');\n              }\n              \n              console.log(`Adding Spotify track ${cleanTrackUri} to playlist ${spotifyPlaylistId}`);\n              \n              // Add the track to the Spotify playlist\n              await addTracksToSpotifyPlaylist(spotifyPlaylistId, [cleanTrackUri]);\n              \n              // Show success message\n              addToast({\n                type: 'success',\n                title: 'Track Added!',\n                message: `Successfully added Spotify track to playlist.`,\n                duration: 3000\n              });\n              \n            } catch (error) {\n              console.error('Error adding Spotify track:', error);\n              addToast({\n                type: 'error',\n                title: 'Failed to Add Track',\n                message: error instanceof Error ? error.message : 'Failed to add Spotify track to playlist.',\n                duration: 5000\n              });\n            }\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ModernPlaylistConverter;","import { useState, useEffect } from 'react';\n\n// Utility functions for device detection\nconst isMobileDevice = (): boolean => {\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n};\n\nconst isIOSDevice = (): boolean => {\n  return /iPad|iPhone|iPod/.test(navigator.userAgent);\n};\n\nconst isAndroidDevice = (): boolean => {\n  return /Android/i.test(navigator.userAgent);\n};\n\nconst isTabletDevice = (): boolean => {\n  return /iPad|Android(?=.*\\bMobile\\b)(?=.*\\bSafari\\b)/i.test(navigator.userAgent);\n};\n\n/**\n * Hook to detect mobile devices and provide responsive information\n */\nexport const useMobileDetection = () => {\n  // Initialize with immediate detection to avoid flash\n  const initialMobile = isMobileDevice() || window.innerWidth < 768;\n  const initialPortrait = window.innerHeight > window.innerWidth;\n  const initialIOS = isIOSDevice();\n  const initialAndroid = isAndroidDevice();\n  const initialTablet = isTabletDevice();\n  \n  const [isMobile, setIsMobile] = useState(initialMobile);\n  const [isPortrait, setIsPortrait] = useState(initialPortrait);\n  const [isIOS, setIsIOS] = useState(initialIOS);\n  const [isAndroid, setIsAndroid] = useState(initialAndroid);\n  const [isTablet, setIsTablet] = useState(initialTablet);\n  const [viewport, setViewport] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    devicePixelRatio: window.devicePixelRatio || 1\n  });\n  \n  useEffect(() => {\n    // Initial detection\n    const detectDevice = () => {\n      const mobile = isMobileDevice() || window.innerWidth < 768;\n      const portrait = window.innerHeight > window.innerWidth;\n      const ios = isIOSDevice();\n      const android = isAndroidDevice();\n      const tablet = isTabletDevice();\n      \n      setIsMobile(mobile);\n      setIsIOS(ios);\n      setIsAndroid(android);\n      setIsTablet(tablet);\n      setIsPortrait(portrait);\n      setViewport({\n        width: window.innerWidth,\n        height: window.innerHeight,\n        devicePixelRatio: window.devicePixelRatio || 1\n      });\n    };\n    \n    // Call initially\n    detectDevice();\n    \n    // Add listeners for window resizing\n    const handleResize = () => {\n      detectDevice();\n    };\n    \n    // Handle orientation changes\n    const handleOrientationChange = () => {\n      // Add delay for iOS orientation change\n      setTimeout(() => {\n        detectDevice();\n      }, 100);\n    };\n    \n    window.addEventListener('resize', handleResize);\n    window.addEventListener('orientationchange', handleOrientationChange);\n    \n    // Remove event listeners on cleanup\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      window.removeEventListener('orientationchange', handleOrientationChange);\n    };\n  }, []);\n  \n  return {\n    isMobile,\n    isPortrait,\n    isLandscape: !isPortrait,\n    isIOS,\n    isAndroid,\n    isTablet,\n    viewport,\n    // Helper functions\n    isSmallScreen: viewport.width < 640,\n    isMediumScreen: viewport.width >= 640 && viewport.width < 1024,\n    isLargeScreen: viewport.width >= 1024,\n    // Device-specific helpers\n    isMobileOrTablet: isMobile || isTablet,\n    isStandalone: window.matchMedia('(display-mode: standalone)').matches || \n                  (window.navigator as any).standalone === true\n  };\n};\n\nexport default useMobileDetection; ","import React from 'react';\nimport { useMobileDetection } from '../hooks/useMobileDetection';\nimport { cn } from '../lib/utils';\nimport {\n  type MotionValue,\n  AnimatePresence, \n  motion, \n  useMotionValue, \n  useSpring, \n  useTransform,\n  MotionConfig\n} from \"framer-motion\";\nimport { Link, useLocation } from \"react-router-dom\";\nimport { useRef, useState, type ReactNode, useEffect } from \"react\";\nimport {\n  Menu, \n  X,\n  ChevronUp\n} from \"lucide-react\";\n\ninterface ResponsiveLayoutProps {\n  children: React.ReactNode;\n  className?: string;\n  mobileClassName?: string;\n  desktopClassName?: string;\n}\n\n/**\n * ResponsiveLayout automatically switches between mobile and desktop layouts\n * while maintaining the same styling and branding\n */\nexport const ResponsiveLayout: React.FC<ResponsiveLayoutProps> = ({\n  children,\n  className = '',\n  mobileClassName = '',\n  desktopClassName = ''\n}) => {\n  const { isMobile, isPortrait, viewport } = useMobileDetection();\n\n  // Mobile layout wrapper\n  const MobileWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n    <div className={cn(\n      \"min-h-screen bg-background-primary\",\n      \"pb-20\", // Increased space for bottom navigation (64px + 16px extra)\n      \"transition-all duration-300\",\n      mobileClassName\n    )}>\n      {children}\n    </div>\n  );\n\n  // Desktop layout wrapper\n  const DesktopWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n    <div className={cn(\n      \"min-h-screen bg-background-primary\",\n      \"transition-all duration-300\",\n      desktopClassName\n    )}>\n      {children}\n    </div>\n  );\n\n  return (\n    <div className={cn(\"responsive-layout\", className)}>\n      {isMobile ? (\n        <MobileWrapper>\n          {children}\n        </MobileWrapper>\n      ) : (\n        <DesktopWrapper>\n          {children}\n        </DesktopWrapper>\n      )}\n    </div>\n  );\n};\n\n/**\n * Mobile-specific layout components\n */\nexport const MobileHeader: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n  <header className=\"sticky top-0 z-50 bg-surface-card/98 backdrop-blur-2xl border-b border-border-default/40 shadow-sm\">\n    <div className=\"px-4 py-3\">\n      {children}\n    </div>\n  </header>\n);\n\nexport const MobileContent = React.forwardRef<HTMLElement, { children: React.ReactNode }>(({ children }, ref) => (\n  <main ref={ref} className=\"px-4 py-4 space-y-4\">\n    {children}\n  </main>\n));\n\n// Interface for items in the dock\ninterface DockItem {\n  title: string;\n  icon: ReactNode;\n  href: string;\n  isNavLink?: boolean;\n  color?: string;\n}\n\n// Interface for props accepted by the AnimatedDock component\ninterface AnimatedDockProps {\n  items: DockItem[];\n  largeClassName?: string; \n  smallClassName?: string; \n  dockPosition?: 'top' | 'bottom';\n  accentColor?: string;\n  secondaryColor?: string;\n}\n\n// Main AnimatedDock component that renders both LargeDock and SmallDock\nexport const AnimatedDock: React.FC<AnimatedDockProps> = ({ \n  items, \n  largeClassName, \n  smallClassName, \n  dockPosition = 'bottom',\n  accentColor = 'hsl(144, 70%, 30%)', // Default green\n  secondaryColor = 'hsl(350, 100%, 60%)', // Default red\n}) => {\n  const location = useLocation();\n  const [activeItem, setActiveItem] = useState<string | null>(null);\n  const [showPointer, setShowPointer] = useState(false);\n  \n  // Update active item based on current location\n  useEffect(() => {\n    const current = items.find(item => \n      location.pathname === item.href || \n      (item.href !== '/' && location.pathname.startsWith(item.href))\n    );\n    setActiveItem(current?.href || null);\n  }, [location, items]);\n\n  // Position class based on dockPosition prop\n  const positionClass = dockPosition === 'top' \n    ? 'fixed top-5 left-1/2 -translate-x-1/2 z-50' \n    : 'fixed bottom-5 left-1/2 -translate-x-1/2 z-50';\n\n  return (\n    <MotionConfig transition={{ type: \"spring\", stiffness: 300, damping: 30 }}>\n      <div className={positionClass}>\n        <LargeDock \n          items={items} \n          className={largeClassName} \n          activeItem={activeItem}\n          accentColor={accentColor}\n          secondaryColor={secondaryColor}\n          onShowPointer={setShowPointer}\n        />\n        <SmallDock \n          items={items} \n          className={smallClassName} \n          activeItem={activeItem}\n          accentColor={accentColor}\n          secondaryColor={secondaryColor}\n        />\n        \n        {/* Animated scroll indicator that appears when hovering dock */}\n        <AnimatePresence>\n          {showPointer && (\n            <motion.div \n              className=\"absolute left-1/2 -translate-x-1/2 hidden md:flex\"\n              style={{ \n                bottom: dockPosition === 'bottom' ? '100%' : 'auto',\n                top: dockPosition === 'top' ? '100%' : 'auto',\n                marginBottom: dockPosition === 'bottom' ? '8px' : '0',\n                marginTop: dockPosition === 'top' ? '8px' : '0',\n              }}\n              initial={{ opacity: 0, y: dockPosition === 'bottom' ? 10 : -10 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: dockPosition === 'bottom' ? 5 : -5 }}\n              transition={{ duration: 0.2 }}\n            >\n              <ChevronUp \n                size={18} \n                className={dockPosition === 'top' ? 'rotate-180' : ''}\n                style={{ color: accentColor, filter: 'drop-shadow(0 0 5px rgba(0,0,0,0.2))' }} \n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </MotionConfig>\n  );\n};\n\n// Component for the large dock, visible on larger screens\nconst LargeDock = ({\n  items,\n  className,\n  activeItem,\n  accentColor,\n  secondaryColor,\n  onShowPointer\n}: {\n  items: DockItem[];\n  className?: string;\n  activeItem: string | null;\n  accentColor: string;\n  secondaryColor: string;\n  onShowPointer: (show: boolean) => void;\n}) => {\n  const mouseXPosition = useMotionValue(Infinity);\n  \n  return (\n    <motion.div\n      onMouseMove={(e) => mouseXPosition.set(e.pageX)}\n      onMouseLeave={() => {\n        mouseXPosition.set(Infinity);\n        onShowPointer(false);\n      }}\n      onMouseEnter={() => onShowPointer(true)}\n      className={cn(\n        \"mx-auto hidden h-16 items-center gap-4 rounded-full px-4 py-2 shadow-lg md:flex\",\n        \"border border-white/30 transition-all duration-300\",\n        // Glass morphism effects\n        \"bg-white/20 backdrop-blur-md dark:bg-gray-800/20 dark:border-gray-700/50\",\n        // Animation states\n        \"hover:shadow-xl hover:bg-white/25 dark:hover:bg-gray-800/25\",\n        className,\n      )}\n    >\n      {items.map((item) => (\n        <DockIcon \n          mouseX={mouseXPosition} \n          key={item.title} \n          {...item} \n          isActive={activeItem === item.href}\n          accentColor={accentColor}\n          secondaryColor={secondaryColor}\n        />\n      ))}\n    </motion.div>\n  );\n};\n\n// Component for individual icons in the dock\nfunction DockIcon({\n  mouseX,\n  title,\n  icon,\n  href,\n  isActive = false,\n  accentColor,\n  secondaryColor,\n  color\n}: {\n  mouseX: MotionValue;\n  title: string;\n  icon: ReactNode;\n  href: string;\n  isActive?: boolean;\n  accentColor: string;\n  secondaryColor: string;\n  color?: string;\n}) {\n  const ref = useRef<HTMLDivElement>(null);\n  const [isHovered, setIsHovered] = useState(false);\n\n  // Calculate distance from mouse for animations\n  const distanceFromMouse = useTransform(mouseX, (val) => {\n    const bounds = ref.current?.getBoundingClientRect() ?? { x: 0, width: 0 };\n    return val - bounds.x - bounds.width / 2;\n  });\n\n  // Enhanced animation values for smoother effects\n  const widthTransform = useTransform(distanceFromMouse, [-150, 0, 150], [44, 72, 44]);\n  const heightTransform = useTransform(distanceFromMouse, [-150, 0, 150], [44, 72, 44]);\n  const iconSizeTransform = useTransform(distanceFromMouse, [-150, 0, 150], [22, 34, 22]);\n  const opacityTransform = useTransform(distanceFromMouse, [-250, -150, 0, 150, 250], [0.7, 0.8, 1, 0.8, 0.7]);\n  \n  // Apply spring physics for natural motion\n  const width = useSpring(widthTransform, { mass: 0.2, stiffness: 150, damping: 15 });\n  const height = useSpring(heightTransform, { mass: 0.2, stiffness: 150, damping: 15 });\n  const iconSize = useSpring(iconSizeTransform, { mass: 0.2, stiffness: 150, damping: 15 });\n  const opacity = useSpring(opacityTransform, { mass: 0.2, stiffness: 100, damping: 20 });\n\n  // Generate dynamic styles\n  const iconColor = color || (isActive ? accentColor : 'currentColor');\n  const iconHoverColor = isActive ? accentColor : secondaryColor;\n  \n  const activeBg = `color-mix(in srgb, ${accentColor} 15%, transparent)`;\n  const hoverBg = `color-mix(in srgb, ${iconHoverColor} 10%, transparent)`;\n\n  return (\n    <Link \n      to={href} \n      className=\"outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500 rounded-full\"\n      aria-label={title}\n      aria-current={isActive ? 'page' : undefined}\n    >\n      <motion.div\n        ref={ref}\n        style={{ \n          width, \n          height,\n          opacity,\n          backgroundColor: isActive \n            ? activeBg \n            : isHovered \n              ? hoverBg\n              : 'rgba(255, 255, 255, 0.5)'\n        }}\n        whileHover={{ scale: 1.05 }}\n        whileTap={{ scale: 0.95 }}\n        onMouseEnter={() => setIsHovered(true)}\n        onMouseLeave={() => setIsHovered(false)}\n        className={cn(\n          \"relative flex aspect-square items-center justify-center rounded-full transition-colors shadow-sm\",\n          \"dark:bg-gray-700/50 dark:hover:bg-gray-600/60\",\n          isActive && \"ring-1 ring-white/40 dark:ring-gray-500/40\",\n        )}\n      >\n        {/* Tooltip */}\n        <AnimatePresence>\n          {isHovered && (\n            <motion.div\n              initial={{ opacity: 0, y: 8, x: \"-50%\" }}\n              animate={{ opacity: 1, y: 0, x: \"-50%\" }}\n              exit={{ opacity: 0, y: 5, x: \"-50%\" }}\n              className=\"absolute -top-10 left-1/2 whitespace-nowrap rounded-md px-2.5 py-1 text-xs font-medium shadow-sm z-10\"\n              style={{ \n                backgroundColor: 'rgba(17, 24, 39, 0.9)',\n                color: 'white',\n                backdropFilter: 'blur(4px)'\n              }}\n            >\n              {title}\n              {isActive && (\n                <motion.div \n                  className=\"absolute left-1/2 bottom-0 transform -translate-x-1/2 translate-y-1 w-1.5 h-1.5 rotate-45\"\n                  style={{ backgroundColor: 'rgba(17, 24, 39, 0.9)' }}\n                />\n              )}\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Icon */}\n        <motion.div\n          style={{ \n            width: iconSize, \n            height: iconSize,\n            color: isHovered ? iconHoverColor : iconColor \n          }}\n          className=\"flex items-center justify-center transition-colors\"\n        >\n          {icon}\n        </motion.div>\n\n        {/* Active indicator */}\n        {isActive && (\n          <motion.div\n            layoutId=\"activeIndicator\"\n            className=\"absolute -bottom-1 left-1/2 h-1 w-1 rounded-full\"\n            initial={false}\n            animate={{ \n              width: isHovered ? '50%' : '20%',\n              translateX: '-50%'\n            }}\n            style={{ backgroundColor: accentColor }}\n            transition={{ duration: 0.2 }}\n          />\n        )}\n      </motion.div>\n    </Link>\n  );\n}\n\n// Small Dock component (for mobile)\nconst SmallDock = ({\n  items,\n  className,\n  activeItem,\n  accentColor,\n  secondaryColor\n}: {\n  items: DockItem[];\n  className?: string;\n  activeItem: string | null;\n  accentColor: string;\n  secondaryColor: string;\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  const toggleMenu = () => {\n    setIsOpen(prev => !prev);\n  };\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [menuRef]);\n\n  return (\n    <div ref={menuRef} className={cn(\"md:hidden relative\", className)}>\n      <button\n        onClick={toggleMenu}\n        className={cn(\n          \"flex h-12 w-12 items-center justify-center rounded-full shadow-lg transition-all duration-300\",\n          \"bg-white/20 backdrop-blur-md dark:bg-gray-800/20 dark:border-gray-700/50 border border-white/30\",\n          isOpen ? \"rotate-90\" : \"rotate-0\"\n        )}\n        aria-label={isOpen ? \"Close navigation menu\" : \"Open navigation menu\"}\n        aria-expanded={isOpen}\n      >\n        {isOpen ? (\n          <X size={24} className=\"text-gray-700 dark:text-gray-200\" />\n        ) : (\n          <Menu size={24} className=\"text-gray-700 dark:text-gray-200\" />\n        )}\n      </button>\n\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            className=\"absolute bottom-full mb-2 w-48 bg-white/90 backdrop-blur-md rounded-md shadow-lg overflow-hidden dark:bg-gray-800/90 border border-white/30 dark:border-gray-700/50\"\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: 10 }}\n            transition={{ duration: 0.2 }}\n          >\n            {items.map((item) => (\n              <MobileMenuItem\n                key={item.title}\n                href={item.href}\n                title={item.title}\n                icon={item.icon}\n                isActive={activeItem === item.href}\n                accentColor={accentColor}\n                secondaryColor={secondaryColor}\n                onClick={toggleMenu}\n              />\n            ))}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n\n// Component for individual mobile menu items\nconst MobileMenuItem = ({\n  href, \n  title, \n  icon, \n  isActive, \n  accentColor,\n  secondaryColor,\n  onClick \n}: { \n  href: string; \n  title: string; \n  icon: ReactNode; \n  isActive?: boolean;\n  accentColor: string;\n  secondaryColor: string;\n  onClick: () => void;\n}) => {\n  return (\n    <Link \n      to={href} \n      onClick={onClick}\n      className={cn(\n        \"flex items-center gap-3 rounded-full p-3 text-sm font-medium shadow-md transition-all duration-200\",\n        \"bg-white/90 backdrop-blur-md text-gray-800 dark:bg-gray-800/90 dark:text-gray-200\",\n        \"hover:bg-white dark:hover:bg-gray-700\"\n      )}\n      style={isActive ? {\n        backgroundColor: `color-mix(in srgb, ${accentColor} 15%, ${\n          typeof window !== 'undefined' && \n          window.matchMedia && \n          window.matchMedia('(prefers-color-scheme: dark)').matches \n            ? 'rgba(31, 41, 55, 0.9)' \n            : 'rgba(255, 255, 255, 0.9)'\n        })`,\n        boxShadow: `0 0 0 1px ${accentColor}25, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)`\n      } : {}}\n      aria-current={isActive ? 'page' : undefined}\n    >\n      <motion.div\n        style={{ color: isActive ? accentColor : 'currentColor' }}\n        whileHover={{ scale: 1.1, color: secondaryColor }}\n        whileTap={{ scale: 0.9 }}\n      >\n        {icon}\n      </motion.div>\n      <span style={isActive ? { color: accentColor, fontWeight: 600 } : {}}>\n        {title}\n      </span>\n      \n      {/* Active indicator dot */}\n      {isActive && (\n        <motion.div\n          layoutId=\"mobileActiveIndicator\"\n          className=\"ml-1 h-1.5 w-1.5 rounded-full\"\n          style={{ backgroundColor: accentColor }}\n        />\n      )}\n    </Link>\n  );\n};\n\n// Legacy MobileBottomNav component for backward compatibility\nexport const MobileBottomNav: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n  <nav className=\"fixed bottom-0 left-0 right-0 z-50\">\n    <div className=\"bg-surface-card/98 backdrop-blur-2xl border-t border-border-default/40 shadow-sm\">\n      <div className=\"flex justify-between items-center h-20 px-6 pb-[env(safe-area-inset-bottom)]\">\n        {children}\n      </div>\n    </div>\n  </nav>\n);\n\n/**\n * Mobile navigation item component\n */\ninterface MobileNavItemProps {\n  icon: React.ReactNode;\n  label: string;\n  active?: boolean;\n  onClick: () => void;\n  badge?: string;\n}\n\nexport const MobileNavItem: React.FC<MobileNavItemProps> = ({\n  icon,\n  label,\n  active = false,\n  onClick,\n  badge\n}) => {\n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        \"flex flex-col items-center justify-center py-2 px-3 rounded-lg\",\n        \"transition-all duration-300 relative\",\n        active \n          ? \"text-primary\" \n          : \"text-muted-foreground hover:text-foreground\"\n      )}\n    >\n      <div className=\"relative\">\n        {/* Modern Icon Container */}\n        <div className={cn(\n          \"relative w-12 h-12 rounded-full transition-all duration-300\",\n          active \n            ? \"bg-gradient-to-br from-[#34A89B] to-[#2D6F6B] shadow-lg shadow-[#34A89B]/20\" \n            : \"bg-gradient-to-br from-gray-100/80 to-gray-200/80 dark:from-gray-800/80 dark:to-gray-700/80 hover:shadow-md hover:scale-105\"\n        )}>\n          {/* Inner Circle for Active State */}\n          {active && (\n            <div className=\"absolute inset-2 bg-[#34A89B] rounded-full\"></div>\n          )}\n          \n          {/* Icon */}\n          <div className={cn(\n            \"relative z-10 flex items-center justify-center w-full h-full\",\n            active ? \"text-white\" : \"text-gray-600 dark:text-gray-400\"\n          )}>\n            {React.cloneElement(icon as React.ReactElement, { \n              className: \"w-6 h-6\" \n            })}\n          </div>\n        </div>\n        \n        {/* Badge */}\n        {badge && (\n          <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-medium shadow-lg\">\n            {badge}\n          </span>\n        )}\n      </div>\n    </button>\n  );\n};\n\n/**\n * Mobile card component with consistent styling\n */\ninterface MobileCardProps {\n  children: React.ReactNode;\n  className?: string;\n  onClick?: () => void;\n}\n\nexport const MobileCard: React.FC<MobileCardProps> = ({\n  children,\n  className = '',\n  onClick\n}) => {\n  return (\n    <div\n      onClick={onClick}\n      className={cn(\n        \"bg-surface-card rounded-xl p-4 border border-border-default\",\n        \"shadow-sm hover:shadow-md transition-shadow duration-200\",\n        onClick && \"cursor-pointer hover:bg-surface-card/80\",\n        className\n      )}\n    >\n      {children}\n    </div>\n  );\n};\n\n/**\n * Mobile button component with touch-friendly sizing\n */\ninterface MobileButtonProps {\n  children: React.ReactNode;\n  onClick: () => void;\n  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';\n  size?: 'sm' | 'md' | 'lg';\n  disabled?: boolean;\n  className?: string;\n}\n\nexport const MobileButton: React.FC<MobileButtonProps> = ({\n  children,\n  onClick,\n  variant = 'primary',\n  size = 'md',\n  disabled = false,\n  className = ''\n}) => {\n  const baseClasses = \"font-medium rounded-lg transition-colors duration-200\";\n  const sizeClasses = {\n    sm: \"px-3 py-2 text-sm min-h-[36px]\",\n    md: \"px-4 py-3 text-base min-h-[44px]\",\n    lg: \"px-6 py-4 text-lg min-h-[52px]\"\n  };\n  const variantClasses = {\n    primary: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n    secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n    outline: \"border border-border-default bg-transparent hover:bg-surface-card\",\n    ghost: \"bg-transparent hover:bg-surface-card\"\n  };\n\n  return (\n    <button\n      onClick={onClick}\n      disabled={disabled}\n      className={cn(\n        baseClasses,\n        sizeClasses[size],\n        variantClasses[variant],\n        disabled && \"opacity-50 cursor-not-allowed\",\n        className\n      )}\n    >\n      {children}\n    </button>\n  );\n};\n\nexport default ResponsiveLayout; ","import { useEffect, useRef, useCallback, useState } from 'react';\r\n\r\ninterface PullToRefreshConfig {\r\n  threshold?: number;\r\n  resistance?: number;\r\n  onRefresh?: () => Promise<void>;\r\n}\r\n\r\nexport const usePullToRefresh = (\r\n  elementRef: React.RefObject<HTMLElement>,\r\n  config: PullToRefreshConfig = {}\r\n) => {\r\n  const {\r\n    threshold = 80,\r\n    resistance = 2.5,\r\n    onRefresh\r\n  } = config;\r\n\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [pullDistance, setPullDistance] = useState(0);\r\n  const startY = useRef<number | null>(null);\r\n  const currentY = useRef<number | null>(null);\r\n  const isPulling = useRef(false);\r\n\r\n  const handleTouchStart = useCallback((e: TouchEvent) => {\r\n    const element = elementRef.current;\r\n    if (!element || element.scrollTop > 0) return;\r\n\r\n    startY.current = e.touches[0].clientY;\r\n    isPulling.current = true;\r\n  }, [elementRef]);\r\n\r\n  const handleTouchMove = useCallback((e: TouchEvent) => {\r\n    if (!isPulling.current || !startY.current) return;\r\n\r\n    currentY.current = e.touches[0].clientY;\r\n    const distance = Math.max(0, (currentY.current - startY.current) / resistance);\r\n    \r\n    setPullDistance(distance);\r\n    \r\n    if (distance > 0) {\r\n      e.preventDefault();\r\n    }\r\n  }, [resistance]);\r\n\r\n  const handleTouchEnd = useCallback(async () => {\r\n    if (!isPulling.current) return;\r\n\r\n    if (pullDistance > threshold && onRefresh) {\r\n      setIsRefreshing(true);\r\n      try {\r\n        await onRefresh();\r\n      } finally {\r\n        setIsRefreshing(false);\r\n      }\r\n    }\r\n\r\n    setPullDistance(0);\r\n    startY.current = null;\r\n    currentY.current = null;\r\n    isPulling.current = false;\r\n  }, [pullDistance, threshold, onRefresh]);\r\n\r\n  useEffect(() => {\r\n    const element = elementRef.current;\r\n    if (!element) return;\r\n\r\n    element.addEventListener('touchstart', handleTouchStart, { passive: false });\r\n    element.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n    element.addEventListener('touchend', handleTouchEnd, { passive: false });\r\n\r\n    return () => {\r\n      element.removeEventListener('touchstart', handleTouchStart);\r\n      element.removeEventListener('touchmove', handleTouchMove);\r\n      element.removeEventListener('touchend', handleTouchEnd);\r\n    };\r\n  }, [elementRef, handleTouchStart, handleTouchMove, handleTouchEnd]);\r\n\r\n  return {\r\n    isRefreshing,\r\n    pullDistance,\r\n    isPulling: isPulling.current\r\n  };\r\n}; ","import { useEffect, useRef, useCallback } from 'react';\r\n\r\ninterface SwipeConfig {\r\n  minSwipeDistance?: number;\r\n  maxSwipeTime?: number;\r\n  preventDefault?: boolean;\r\n}\r\n\r\ninterface SwipeCallbacks {\r\n  onSwipeLeft?: () => void;\r\n  onSwipeRight?: () => void;\r\n  onSwipeUp?: () => void;\r\n  onSwipeDown?: () => void;\r\n}\r\n\r\nexport const useSwipeGestures = (\r\n  elementRef: React.RefObject<HTMLElement>,\r\n  callbacks: SwipeCallbacks,\r\n  config: SwipeConfig = {}\r\n) => {\r\n  const {\r\n    minSwipeDistance = 50,\r\n    maxSwipeTime = 300,\r\n    preventDefault = false // Changed default to false to avoid conflicts\r\n  } = config;\r\n\r\n  const touchStart = useRef<{ x: number; y: number; time: number } | null>(null);\r\n  const touchEnd = useRef<{ x: number; y: number; time: number } | null>(null);\r\n  const isSwiping = useRef(false);\r\n\r\n  const onTouchStart = useCallback((e: TouchEvent) => {\r\n    // Only prevent default if explicitly configured and not during scroll\r\n    if (preventDefault && e.cancelable) {\r\n      e.preventDefault();\r\n    }\r\n    \r\n    touchStart.current = {\r\n      x: e.targetTouches[0].clientX,\r\n      y: e.targetTouches[0].clientY,\r\n      time: Date.now()\r\n    };\r\n    isSwiping.current = false;\r\n  }, [preventDefault]);\r\n\r\n  const onTouchMove = useCallback((e: TouchEvent) => {\r\n    if (!touchStart.current) return;\r\n\r\n    const currentX = e.targetTouches[0].clientX;\r\n    const currentY = e.targetTouches[0].clientY;\r\n    const distanceX = Math.abs(currentX - touchStart.current.x);\r\n    const distanceY = Math.abs(currentY - touchStart.current.y);\r\n\r\n    // Only prevent default if we're actually swiping (not just scrolling)\r\n    if (preventDefault && (distanceX > 10 || distanceY > 10) && e.cancelable) {\r\n      e.preventDefault();\r\n      isSwiping.current = true;\r\n    }\r\n\r\n    touchEnd.current = {\r\n      x: currentX,\r\n      y: currentY,\r\n      time: Date.now()\r\n    };\r\n  }, [preventDefault]);\r\n\r\n  const onTouchEnd = useCallback(() => {\r\n    if (!touchStart.current || !touchEnd.current) return;\r\n\r\n    const distanceX = touchStart.current.x - touchEnd.current.x;\r\n    const distanceY = touchStart.current.y - touchEnd.current.y;\r\n    const timeDiff = touchEnd.current.time - touchStart.current.time;\r\n\r\n    const isHorizontalSwipe = Math.abs(distanceX) > Math.abs(distanceY);\r\n    const isLongEnough = Math.abs(distanceX) > minSwipeDistance || Math.abs(distanceY) > minSwipeDistance;\r\n    const isFastEnough = timeDiff < maxSwipeTime;\r\n\r\n    if (isLongEnough && isFastEnough && isSwiping.current) {\r\n      if (isHorizontalSwipe) {\r\n        if (distanceX > 0 && callbacks.onSwipeLeft) {\r\n          callbacks.onSwipeLeft();\r\n        } else if (distanceX < 0 && callbacks.onSwipeRight) {\r\n          callbacks.onSwipeRight();\r\n        }\r\n      } else {\r\n        if (distanceY > 0 && callbacks.onSwipeUp) {\r\n          callbacks.onSwipeUp();\r\n        } else if (distanceY < 0 && callbacks.onSwipeDown) {\r\n          callbacks.onSwipeDown();\r\n        }\r\n      }\r\n    }\r\n\r\n    touchStart.current = null;\r\n    touchEnd.current = null;\r\n    isSwiping.current = false;\r\n  }, [callbacks, minSwipeDistance, maxSwipeTime]);\r\n\r\n  useEffect(() => {\r\n    const element = elementRef.current;\r\n    if (!element) return;\r\n\r\n    element.addEventListener('touchstart', onTouchStart, { passive: !preventDefault });\r\n    element.addEventListener('touchmove', onTouchMove, { passive: !preventDefault });\r\n    element.addEventListener('touchend', onTouchEnd, { passive: true });\r\n\r\n    return () => {\r\n      element.removeEventListener('touchstart', onTouchStart);\r\n      element.removeEventListener('touchmove', onTouchMove);\r\n      element.removeEventListener('touchend', onTouchEnd);\r\n    };\r\n  }, [elementRef, onTouchStart, onTouchMove, onTouchEnd, preventDefault]);\r\n\r\n  return {\r\n    touchStart: touchStart.current,\r\n    touchEnd: touchEnd.current\r\n  };\r\n}; ","import { useCallback, useRef, useEffect } from 'react';\r\n\r\ninterface LongPressConfig {\r\n  delay?: number;\r\n  preventDefault?: boolean;\r\n  onLongPress?: () => void;\r\n  onPress?: () => void;\r\n}\r\n\r\nexport const useLongPress = (\r\n  elementRef: React.RefObject<HTMLElement>,\r\n  config: LongPressConfig = {}\r\n) => {\r\n  const {\r\n    delay = 500,\r\n    preventDefault = true,\r\n    onLongPress,\r\n    onPress\r\n  } = config;\r\n\r\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isLongPress = useRef(false);\r\n\r\n  const startLongPress = useCallback(() => {\r\n    isLongPress.current = false;\r\n    timeoutRef.current = setTimeout(() => {\r\n      isLongPress.current = true;\r\n      onLongPress?.();\r\n    }, delay);\r\n  }, [delay, onLongPress]);\r\n\r\n  const endLongPress = useCallback(() => {\r\n    if (timeoutRef.current) {\r\n      clearTimeout(timeoutRef.current);\r\n      timeoutRef.current = null;\r\n    }\r\n    \r\n    if (!isLongPress.current && onPress) {\r\n      onPress();\r\n    }\r\n  }, [onPress]);\r\n\r\n  const handleTouchStart = useCallback((e: TouchEvent) => {\r\n    if (preventDefault) e.preventDefault();\r\n    startLongPress();\r\n  }, [preventDefault, startLongPress]);\r\n\r\n  const handleTouchEnd = useCallback((e: TouchEvent) => {\r\n    if (preventDefault) e.preventDefault();\r\n    endLongPress();\r\n  }, [preventDefault, endLongPress]);\r\n\r\n  const handleTouchCancel = useCallback((e: TouchEvent) => {\r\n    if (preventDefault) e.preventDefault();\r\n    endLongPress();\r\n  }, [preventDefault, endLongPress]);\r\n\r\n  useEffect(() => {\r\n    const element = elementRef.current;\r\n    if (!element) return;\r\n\r\n    element.addEventListener('touchstart', handleTouchStart, { passive: !preventDefault });\r\n    element.addEventListener('touchend', handleTouchEnd, { passive: !preventDefault });\r\n    element.addEventListener('touchcancel', handleTouchCancel, { passive: !preventDefault });\r\n\r\n    return () => {\r\n      element.removeEventListener('touchstart', handleTouchStart);\r\n      element.removeEventListener('touchend', handleTouchEnd);\r\n      element.removeEventListener('touchcancel', handleTouchCancel);\r\n      \r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n    };\r\n  }, [elementRef, handleTouchStart, handleTouchEnd, handleTouchCancel, preventDefault]);\r\n\r\n  return {\r\n    isLongPress: isLongPress.current\r\n  };\r\n}; ","import { useCallback, useRef, useEffect } from 'react';\r\n\r\ninterface SwipeActionConfig {\r\n  threshold?: number;\r\n  onSwipeLeft?: () => void;\r\n  onSwipeRight?: () => void;\r\n  onSwipeUp?: () => void;\r\n  onSwipeDown?: () => void;\r\n}\r\n\r\nexport const useSwipeActions = (\r\n  elementRef: React.RefObject<HTMLElement>,\r\n  config: SwipeActionConfig = {}\r\n) => {\r\n  const {\r\n    threshold = 50,\r\n    onSwipeLeft,\r\n    onSwipeRight,\r\n    onSwipeUp,\r\n    onSwipeDown\r\n  } = config;\r\n\r\n  const touchStart = useRef<{ x: number; y: number; time: number } | null>(null);\r\n  const touchEnd = useRef<{ x: number; y: number; time: number } | null>(null);\r\n  const isSwiping = useRef(false);\r\n\r\n  const handleTouchStart = useCallback((e: TouchEvent) => {\r\n    touchStart.current = {\r\n      x: e.targetTouches[0].clientX,\r\n      y: e.targetTouches[0].clientY,\r\n      time: Date.now()\r\n    };\r\n    isSwiping.current = false;\r\n  }, []);\r\n\r\n  const handleTouchMove = useCallback((e: TouchEvent) => {\r\n    if (!touchStart.current) return;\r\n    \r\n    touchEnd.current = {\r\n      x: e.targetTouches[0].clientX,\r\n      y: e.targetTouches[0].clientY,\r\n      time: Date.now()\r\n    };\r\n    \r\n    const distanceX = Math.abs(touchStart.current.x - touchEnd.current.x);\r\n    const distanceY = Math.abs(touchStart.current.y - touchEnd.current.y);\r\n    \r\n    if (distanceX > 10 || distanceY > 10) {\r\n      isSwiping.current = true;\r\n    }\r\n  }, []);\r\n\r\n  const handleTouchEnd = useCallback(() => {\r\n    if (!touchStart.current || !touchEnd.current || !isSwiping.current) return;\r\n\r\n    const distanceX = touchStart.current.x - touchEnd.current.x;\r\n    const distanceY = touchStart.current.y - touchEnd.current.y;\r\n    const timeDiff = touchEnd.current.time - touchStart.current.time;\r\n\r\n    const isHorizontalSwipe = Math.abs(distanceX) > Math.abs(distanceY);\r\n    const isLongEnough = Math.abs(distanceX) > threshold || Math.abs(distanceY) > threshold;\r\n    const isFastEnough = timeDiff < 300;\r\n\r\n    if (isLongEnough && isFastEnough) {\r\n      if (isHorizontalSwipe) {\r\n        if (distanceX > 0 && onSwipeLeft) {\r\n          onSwipeLeft();\r\n        } else if (distanceX < 0 && onSwipeRight) {\r\n          onSwipeRight();\r\n        }\r\n      } else {\r\n        if (distanceY > 0 && onSwipeUp) {\r\n          onSwipeUp();\r\n        } else if (distanceY < 0 && onSwipeDown) {\r\n          onSwipeDown();\r\n        }\r\n      }\r\n    }\r\n\r\n    touchStart.current = null;\r\n    touchEnd.current = null;\r\n    isSwiping.current = false;\r\n  }, [threshold, onSwipeLeft, onSwipeRight, onSwipeUp, onSwipeDown]);\r\n\r\n  useEffect(() => {\r\n    const element = elementRef.current;\r\n    if (!element) return;\r\n\r\n    element.addEventListener('touchstart', handleTouchStart, { passive: true });\r\n    element.addEventListener('touchmove', handleTouchMove, { passive: true });\r\n    element.addEventListener('touchend', handleTouchEnd, { passive: true });\r\n\r\n    return () => {\r\n      element.removeEventListener('touchstart', handleTouchStart);\r\n      element.removeEventListener('touchmove', handleTouchMove);\r\n      element.removeEventListener('touchend', handleTouchEnd);\r\n    };\r\n  }, [elementRef, handleTouchStart, handleTouchMove, handleTouchEnd]);\r\n\r\n  return {\r\n    isSwiping: isSwiping.current\r\n  };\r\n}; ","// Performance configuration for SoundSwapp\r\nexport interface PerformanceConfig {\r\n  // Animation settings\r\n  enableParticleAnimations: boolean;\r\n  enableComplexAnimations: boolean;\r\n  enableMouseInteractions: boolean;\r\n  enableParallaxEffects: boolean;\r\n  \r\n  // Performance thresholds\r\n  maxParticleCount: number;\r\n  maxAnimationFPS: number;\r\n  throttleMouseEvents: boolean;\r\n  \r\n  // Device-specific optimizations\r\n  reduceMotion: boolean;\r\n  lowPowerMode: boolean;\r\n  mobileOptimizations: boolean;\r\n}\r\n\r\n// Detect device capabilities\r\nconst detectDeviceCapabilities = (): Partial<PerformanceConfig> => {\r\n  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\r\n  const isLowPower = navigator.hardwareConcurrency ? navigator.hardwareConcurrency <= 4 : true;\r\n  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n  const isSlowConnection = (navigator as any).connection?.effectiveType === 'slow-2g' || \r\n                          (navigator as any).connection?.effectiveType === '2g';\r\n  \r\n  return {\r\n    mobileOptimizations: isMobile,\r\n    lowPowerMode: isLowPower || isSlowConnection,\r\n    reduceMotion: prefersReducedMotion,\r\n    enableMouseInteractions: !isMobile,\r\n    enableParallaxEffects: !isMobile && !prefersReducedMotion,\r\n    maxParticleCount: isMobile ? 20 : isLowPower ? 30 : 50,\r\n    maxAnimationFPS: isMobile ? 30 : 60,\r\n    throttleMouseEvents: isMobile || isLowPower\r\n  };\r\n};\r\n\r\n// Default performance configuration\r\nexport const defaultPerformanceConfig: PerformanceConfig = {\r\n  enableParticleAnimations: true,\r\n  enableComplexAnimations: true,\r\n  enableMouseInteractions: true,\r\n  enableParallaxEffects: true,\r\n  maxParticleCount: 50,\r\n  maxAnimationFPS: 60,\r\n  throttleMouseEvents: false,\r\n  reduceMotion: false,\r\n  lowPowerMode: false,\r\n  mobileOptimizations: false\r\n};\r\n\r\n// Get optimized configuration based on device capabilities\r\nexport const getOptimizedPerformanceConfig = (): PerformanceConfig => {\r\n  const deviceCapabilities = detectDeviceCapabilities();\r\n  \r\n  return {\r\n    ...defaultPerformanceConfig,\r\n    ...deviceCapabilities,\r\n    enableParticleAnimations: !deviceCapabilities.reduceMotion && !deviceCapabilities.lowPowerMode,\r\n    enableComplexAnimations: !deviceCapabilities.reduceMotion && !deviceCapabilities.mobileOptimizations,\r\n    maxParticleCount: deviceCapabilities.maxParticleCount || defaultPerformanceConfig.maxParticleCount,\r\n    maxAnimationFPS: deviceCapabilities.maxAnimationFPS || defaultPerformanceConfig.maxAnimationFPS,\r\n    throttleMouseEvents: deviceCapabilities.throttleMouseEvents || false\r\n  };\r\n};\r\n\r\n// Animation presets for different performance levels\r\nexport const animationPresets = {\r\n  high: {\r\n    particleCount: 50,\r\n    animationFPS: 60,\r\n    enableComplexEffects: true,\r\n    enableMouseInteractions: true,\r\n    throttleEvents: false\r\n  },\r\n  medium: {\r\n    particleCount: 30,\r\n    animationFPS: 45,\r\n    enableComplexEffects: true,\r\n    enableMouseInteractions: true,\r\n    throttleEvents: true\r\n  },\r\n  low: {\r\n    particleCount: 15,\r\n    animationFPS: 30,\r\n    enableComplexEffects: false,\r\n    enableMouseInteractions: false,\r\n    throttleEvents: true\r\n  },\r\n  minimal: {\r\n    particleCount: 0,\r\n    animationFPS: 0,\r\n    enableComplexEffects: false,\r\n    enableMouseInteractions: false,\r\n    throttleEvents: true\r\n  }\r\n};\r\n\r\n// Performance monitoring utilities\r\nexport const performanceUtils = {\r\n  // Measure frame rate\r\n  measureFPS: (callback: (fps: number) => void) => {\r\n    let frameCount = 0;\r\n    let lastTime = performance.now();\r\n    \r\n    const countFrame = () => {\r\n      frameCount++;\r\n      const currentTime = performance.now();\r\n      \r\n      if (currentTime - lastTime >= 1000) {\r\n        const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));\r\n        callback(fps);\r\n        frameCount = 0;\r\n        lastTime = currentTime;\r\n      }\r\n      \r\n      requestAnimationFrame(countFrame);\r\n    };\r\n    \r\n    requestAnimationFrame(countFrame);\r\n  },\r\n  \r\n  // Check if device can handle animations smoothly\r\n  canHandleAnimations: (): boolean => {\r\n    const config = getOptimizedPerformanceConfig();\r\n    return config.enableParticleAnimations && !config.reduceMotion;\r\n  },\r\n  \r\n  // Get recommended animation settings\r\n  getRecommendedSettings: () => {\r\n    const config = getOptimizedPerformanceConfig();\r\n    \r\n    if (config.lowPowerMode || config.reduceMotion) {\r\n      return animationPresets.minimal;\r\n    } else if (config.mobileOptimizations) {\r\n      return animationPresets.low;\r\n    } else if (config.maxAnimationFPS < 45) {\r\n      return animationPresets.medium;\r\n    } else {\r\n      return animationPresets.high;\r\n    }\r\n  }\r\n};\r\n\r\n// Export current configuration\r\nexport const currentPerformanceConfig = getOptimizedPerformanceConfig(); ","import { useState, useEffect, useCallback } from 'react';\r\n\r\ninterface ViewportInfo {\r\n  width: number;\r\n  height: number;\r\n  aspectRatio: number;\r\n  isMobile: boolean;\r\n  isTablet: boolean;\r\n  isDesktop: boolean;\r\n  isLandscape: boolean;\r\n  isPortrait: boolean;\r\n  safeAreaTop: number;\r\n  safeAreaBottom: number;\r\n  safeAreaLeft: number;\r\n  safeAreaRight: number;\r\n  availableHeight: number;\r\n  availableWidth: number;\r\n  scrollbarWidth: number;\r\n  devicePixelRatio: number;\r\n  orientation: 'landscape' | 'portrait';\r\n  breakpoint: 'xs' | 'sm' | 'md' | 'lg' | 'xl' | '2xl';\r\n}\r\n\r\ninterface ViewportAnalysis {\r\n  viewport: ViewportInfo;\r\n  contentArea: {\r\n    headerHeight: number;\r\n    bottomNavHeight: number;\r\n    availableContentHeight: number;\r\n    contentPadding: number;\r\n    scrollableHeight: number;\r\n  };\r\n  recommendations: {\r\n    shouldUseCompactLayout: boolean;\r\n    shouldReduceAnimations: boolean;\r\n    shouldOptimizeForTouch: boolean;\r\n    recommendedFontSize: number;\r\n    recommendedSpacing: number;\r\n  };\r\n}\r\n\r\nexport const useViewportAnalysis = (): ViewportAnalysis => {\r\n  const [viewport, setViewport] = useState<ViewportInfo>({\r\n    width: 0,\r\n    height: 0,\r\n    aspectRatio: 0,\r\n    isMobile: false,\r\n    isTablet: false,\r\n    isDesktop: false,\r\n    isLandscape: false,\r\n    isPortrait: false,\r\n    safeAreaTop: 0,\r\n    safeAreaBottom: 0,\r\n    safeAreaLeft: 0,\r\n    safeAreaRight: 0,\r\n    availableHeight: 0,\r\n    availableWidth: 0,\r\n    scrollbarWidth: 0,\r\n    devicePixelRatio: 1,\r\n    orientation: 'portrait',\r\n    breakpoint: 'md'\r\n  });\r\n\r\n  const getScrollbarWidth = useCallback(() => {\r\n    const outer = document.createElement('div');\r\n    outer.style.visibility = 'hidden';\r\n    outer.style.overflow = 'scroll';\r\n    document.body.appendChild(outer);\r\n\r\n    const inner = document.createElement('div');\r\n    outer.appendChild(inner);\r\n\r\n    const scrollbarWidth = outer.offsetWidth - inner.offsetWidth;\r\n    outer.parentNode?.removeChild(outer);\r\n\r\n    return scrollbarWidth;\r\n  }, []);\r\n\r\n  const getSafeAreaInsets = useCallback(() => {\r\n    const style = getComputedStyle(document.documentElement);\r\n    return {\r\n      top: parseInt(style.getPropertyValue('--sat') || '0'),\r\n      bottom: parseInt(style.getPropertyValue('--sab') || '0'),\r\n      left: parseInt(style.getPropertyValue('--sal') || '0'),\r\n      right: parseInt(style.getPropertyValue('--sar') || '0')\r\n    };\r\n  }, []);\r\n\r\n  const getBreakpoint = useCallback((width: number): ViewportInfo['breakpoint'] => {\r\n    if (width < 640) return 'xs';\r\n    if (width < 768) return 'sm';\r\n    if (width < 1024) return 'md';\r\n    if (width < 1280) return 'lg';\r\n    if (width < 1536) return 'xl';\r\n    return '2xl';\r\n  }, []);\r\n\r\n  const updateViewport = useCallback(() => {\r\n    const width = window.innerWidth;\r\n    const height = window.innerHeight;\r\n    const aspectRatio = width / height;\r\n    const orientation = width > height ? 'landscape' : 'portrait';\r\n    const safeAreas = getSafeAreaInsets();\r\n    const scrollbarWidth = getScrollbarWidth();\r\n\r\n    const isMobile = width < 768;\r\n    const isTablet = width >= 768 && width < 1024;\r\n    const isDesktop = width >= 1024;\r\n    const isLandscape = orientation === 'landscape';\r\n    const isPortrait = orientation === 'portrait';\r\n\r\n    setViewport({\r\n      width,\r\n      height,\r\n      aspectRatio,\r\n      isMobile,\r\n      isTablet,\r\n      isDesktop,\r\n      isLandscape,\r\n      isPortrait,\r\n      safeAreaTop: safeAreas.top,\r\n      safeAreaBottom: safeAreas.bottom,\r\n      safeAreaLeft: safeAreas.left,\r\n      safeAreaRight: safeAreas.right,\r\n      availableHeight: height - safeAreas.top - safeAreas.bottom,\r\n      availableWidth: width - safeAreas.left - safeAreas.right,\r\n      scrollbarWidth,\r\n      devicePixelRatio: window.devicePixelRatio || 1,\r\n      orientation,\r\n      breakpoint: getBreakpoint(width)\r\n    });\r\n  }, [getSafeAreaInsets, getScrollbarWidth, getBreakpoint]);\r\n\r\n  useEffect(() => {\r\n    updateViewport();\r\n    window.addEventListener('resize', updateViewport);\r\n    window.addEventListener('orientationchange', updateViewport);\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', updateViewport);\r\n      window.removeEventListener('orientationchange', updateViewport);\r\n    };\r\n  }, [updateViewport]);\r\n\r\n  // Calculate content area dimensions\r\n  const contentArea = {\r\n    headerHeight: viewport.isMobile ? 60 : 80,\r\n    bottomNavHeight: viewport.isMobile ? 80 : 100,\r\n    availableContentHeight: viewport.availableHeight - (viewport.isMobile ? 140 : 180),\r\n    contentPadding: viewport.isMobile ? 16 : 24,\r\n    scrollableHeight: viewport.availableHeight - (viewport.isMobile ? 140 : 180) - 32 // 32px for padding\r\n  };\r\n\r\n  // Generate recommendations based on viewport\r\n  const recommendations = {\r\n    shouldUseCompactLayout: viewport.isMobile || viewport.aspectRatio < 0.8,\r\n    shouldReduceAnimations: viewport.devicePixelRatio > 2 || viewport.width < 375,\r\n    shouldOptimizeForTouch: viewport.isMobile || viewport.width < 1024,\r\n    recommendedFontSize: viewport.isMobile ? 14 : 16,\r\n    recommendedSpacing: viewport.isMobile ? 8 : 12\r\n  };\r\n\r\n  return {\r\n    viewport,\r\n    contentArea,\r\n    recommendations\r\n  };\r\n};\r\n\r\n// Hook for logging viewport information\r\nexport const useViewportLogger = () => {\r\n  const viewportAnalysis = useViewportAnalysis();\r\n\r\n  useEffect(() => {\r\n    console.log('🔍 Viewport Analysis:', {\r\n      dimensions: `${viewportAnalysis.viewport.width}x${viewportAnalysis.viewport.height}`,\r\n      aspectRatio: viewportAnalysis.viewport.aspectRatio.toFixed(2),\r\n      orientation: viewportAnalysis.viewport.orientation,\r\n      device: viewportAnalysis.viewport.isMobile ? 'Mobile' : viewportAnalysis.viewport.isTablet ? 'Tablet' : 'Desktop',\r\n      breakpoint: viewportAnalysis.viewport.breakpoint,\r\n      safeAreas: {\r\n        top: viewportAnalysis.viewport.safeAreaTop,\r\n        bottom: viewportAnalysis.viewport.safeAreaBottom,\r\n        left: viewportAnalysis.viewport.safeAreaLeft,\r\n        right: viewportAnalysis.viewport.safeAreaRight\r\n      },\r\n      contentArea: viewportAnalysis.contentArea,\r\n      recommendations: viewportAnalysis.recommendations\r\n    });\r\n  }, [viewportAnalysis]);\r\n\r\n  return viewportAnalysis;\r\n}; ","import React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  X, \n  Camera, \n  User, \n  Save, \n  Mail, \n  Phone, \n  MapPin, \n  Globe, \n  Edit3, \n  Trash2,\n  Upload,\n  Image as ImageIcon,\n  AlertCircle,\n  CheckCircle,\n  Eye,\n  EyeOff,\n  Calendar,\n  Music,\n  Heart,\n  Star,\n  Settings,\n  Palette,\n  Shield,\n  Bell\n} from 'lucide-react';\nimport { useAuth } from '../../lib/AuthContext';\nimport { profileService, UserProfile } from '../../services/profileService';\n\ninterface EditProfileModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void;\n}\n\nexport const EditProfileModal: React.FC<EditProfileModalProps> = ({ \n  isOpen, \n  onClose, \n  onShowToast \n}) => {\n  const { user } = useAuth();\n  const [isUploading, setIsUploading] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [activeTab, setActiveTab] = useState<'basic' | 'social' | 'preferences' | 'security'>('basic');\n  const [showPassword, setShowPassword] = useState(false);\n  const [formData, setFormData] = useState({\n    displayName: '',\n    email: '',\n    bio: '',\n    location: '',\n    website: '',\n    phone: '',\n    birthDate: '',\n    favoriteGenre: '',\n    favoriteArtist: '',\n    theme: 'dark',\n    notifications: {\n      email: true,\n      push: true,\n      conversionComplete: true,\n      weeklyReport: false\n    },\n    privacy: {\n      shareStats: false,\n      publicProfile: false,\n      showEmail: false,\n      showLocation: false,\n      showStats: true\n    }\n  });\n\n  useEffect(() => {\n    const loadUserProfile = async () => {\n      if (!user?.uid || !isOpen) return;\n      \n      try {\n        const profile = await profileService.getUserProfile(user.uid);\n        const settings = await profileService.getProfileSettings(user.uid);\n        \n        if (profile) {\n          setFormData({\n            displayName: profile.displayName || user.displayName || '',\n            email: profile.email || user.email || '',\n            bio: profile.bio || '',\n            location: profile.location || '',\n            website: profile.website || '',\n            phone: profile.phone || '',\n            birthDate: profile.birthDate || '',\n            favoriteGenre: profile.favoriteGenre || '',\n            favoriteArtist: profile.favoriteArtist || '',\n            theme: (settings.theme as 'dark' | 'light' | 'auto') || 'dark',\n            notifications: settings.notifications,\n            privacy: settings.privacy\n          });\n        }\n      } catch (error) {\n        console.error('Error loading user profile:', error);\n        onShowToast?.('error', 'Failed to load profile data');\n      }\n    };\n\n    loadUserProfile();\n  }, [user?.uid, isOpen, onShowToast]);\n\n  const handleImageUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file || !user?.uid) return;\n\n    setIsUploading(true);\n    try {\n      const imageUrl = await profileService.uploadProfileImage(user.uid, file);\n      onShowToast?.('success', 'Profile image updated successfully!');\n      \n      // Update the profile with the new image URL\n      await profileService.updateUserProfile(user.uid, { photoURL: imageUrl });\n    } catch (error) {\n      console.error('Error uploading image:', error);\n      onShowToast?.('error', 'Failed to upload image. Please try again.');\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleSave = async () => {\n    if (!user?.uid) return;\n    \n    setIsSaving(true);\n    try {\n      // Update profile data\n      await profileService.updateUserProfile(user.uid, {\n        displayName: formData.displayName,\n        bio: formData.bio,\n        location: formData.location,\n        website: formData.website,\n        phone: formData.phone,\n        birthDate: formData.birthDate,\n        favoriteGenre: formData.favoriteGenre,\n        favoriteArtist: formData.favoriteArtist\n      });\n\n      // Update settings\n      await profileService.updateProfileSettings(user.uid, {\n        theme: formData.theme as 'dark' | 'light' | 'auto',\n        notifications: formData.notifications,\n        privacy: formData.privacy\n      });\n      \n      onShowToast?.('success', 'Profile updated successfully!');\n      onClose();\n    } catch (error) {\n      console.error('Error updating profile:', error);\n      onShowToast?.('error', 'Failed to update profile. Please try again.');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleInputChange = (field: string, value: any) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const handleNestedChange = (category: string, field: string, value: any) => {\n    setFormData(prev => ({\n      ...prev,\n      [category]: {\n        ...(prev[category as keyof typeof prev] as Record<string, any>),\n        [field]: value\n      }\n    }));\n  };\n\n  const tabs = [\n    { id: 'basic', label: 'Basic Info', icon: User },\n    { id: 'social', label: 'Social & Music', icon: Music },\n    { id: 'preferences', label: 'Preferences', icon: Settings },\n    { id: 'security', label: 'Privacy', icon: Shield }\n  ];\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\n          onClick={onClose}\n        >\n          <motion.div\n            initial={{ scale: 0.9, opacity: 0, y: 20 }}\n            animate={{ scale: 1, opacity: 1, y: 0 }}\n            exit={{ scale: 0.9, opacity: 0, y: 20 }}\n            className=\"bg-white rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            {/* Header */}\n            <div className=\"flex items-center justify-between mb-6\">\n              <div>\n                <h2 className=\"text-2xl font-bold text-gray-900\">Edit Profile</h2>\n                <p className=\"text-gray-600 mt-1\">Customize your profile and preferences</p>\n              </div>\n              <button\n                onClick={onClose}\n                className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n              >\n                <X className=\"w-5 h-5 text-gray-500\" />\n              </button>\n            </div>\n\n            {/* Tab Navigation */}\n            <div className=\"flex space-x-1 mb-6 bg-gray-100 rounded-lg p-1\">\n              {tabs.map((tab) => {\n                const Icon = tab.icon;\n                return (\n                  <button\n                    key={tab.id}\n                    onClick={() => setActiveTab(tab.id as any)}\n                    className={`flex-1 flex items-center justify-center space-x-2 py-2 px-3 rounded-md text-sm font-medium transition-all ${\n                      activeTab === tab.id\n                        ? 'bg-white text-blue-600 shadow-sm'\n                        : 'text-gray-600 hover:text-gray-900'\n                    }`}\n                  >\n                    <Icon className=\"w-4 h-4\" />\n                    <span>{tab.label}</span>\n                  </button>\n                );\n              })}\n            </div>\n\n            {/* Tab Content */}\n            <div className=\"space-y-6\">\n              {/* Basic Info Tab */}\n              {activeTab === 'basic' && (\n                <motion.div\n                  initial={{ opacity: 0, x: 20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  className=\"space-y-6\"\n                >\n                  {/* Profile Image Section */}\n                  <div className=\"text-center\">\n                    <div className=\"relative inline-block\">\n                      <div className=\"w-40 h-40 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-2xl border-2 border-white/10\">\n                        <User className=\"w-24 h-24 text-white\" />\n                      </div>\n                      <button\n                        onClick={() => document.getElementById('profile-image-input')?.click()}\n                        disabled={isUploading}\n                        className=\"absolute -bottom-2 -right-2 w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center shadow-lg hover:bg-blue-600 transition-colors disabled:opacity-50\"\n                      >\n                        {isUploading ? (\n                          <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                        ) : (\n                          <Camera className=\"w-5 h-5 text-white\" />\n                        )}\n                      </button>\n                      <input\n                        id=\"profile-image-input\"\n                        type=\"file\"\n                        accept=\"image/*\"\n                        onChange={handleImageUpload}\n                        className=\"hidden\"\n                        disabled={isUploading}\n                      />\n                    </div>\n                    <p className=\"text-sm text-gray-600 mt-2\">Click to change profile photo</p>\n                  </div>\n\n                  {/* Basic Information */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                Display Name\n              </label>\n              <input\n                type=\"text\"\n                value={formData.displayName}\n                onChange={(e) => handleInputChange('displayName', e.target.value)}\n                className=\"w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                placeholder=\"Enter your display name\"\n              />\n            </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                        Email\n                      </label>\n                      <input\n                        type=\"email\"\n                        value={formData.email}\n                        onChange={(e) => handleInputChange('email', e.target.value)}\n                        className=\"w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                        placeholder=\"Enter your email\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                        Phone Number\n                      </label>\n                      <input\n                        type=\"tel\"\n                        value={formData.phone}\n                        onChange={(e) => handleInputChange('phone', e.target.value)}\n                        className=\"w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                        placeholder=\"Enter your phone number\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                        Location\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={formData.location}\n                        onChange={(e) => handleInputChange('location', e.target.value)}\n                        className=\"w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                        placeholder=\"Enter your location\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                        Website\n                      </label>\n                      <input\n                        type=\"url\"\n                        value={formData.website}\n                        onChange={(e) => handleInputChange('website', e.target.value)}\n                        className=\"w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                        placeholder=\"Enter your website\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                        Birth Date\n              </label>\n                      <input\n                        type=\"date\"\n                        value={formData.birthDate}\n                        onChange={(e) => handleInputChange('birthDate', e.target.value)}\n                        className=\"w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                      />\n                    </div>\n                </div>\n                \n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                      Bio\n                    </label>\n                    <textarea\n                      value={formData.bio}\n                      onChange={(e) => handleInputChange('bio', e.target.value)}\n                      rows={3}\n                      className=\"w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none\"\n                      placeholder=\"Tell us about yourself...\"\n                    />\n                  </div>\n                </motion.div>\n              )}\n\n              {/* Social & Music Tab */}\n              {activeTab === 'social' && (\n                <motion.div\n                  initial={{ opacity: 0, x: 20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  className=\"space-y-6\"\n                >\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                        Favorite Genre\n                      </label>\n                      <select\n                        value={formData.favoriteGenre}\n                        onChange={(e) => handleInputChange('favoriteGenre', e.target.value)}\n                        className=\"w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                      >\n                        <option value=\"\">Select your favorite genre</option>\n                        <option value=\"pop\">Pop</option>\n                        <option value=\"rock\">Rock</option>\n                        <option value=\"hip-hop\">Hip Hop</option>\n                        <option value=\"electronic\">Electronic</option>\n                        <option value=\"jazz\">Jazz</option>\n                        <option value=\"classical\">Classical</option>\n                        <option value=\"country\">Country</option>\n                        <option value=\"r&b\">R&B</option>\n                        <option value=\"indie\">Indie</option>\n                        <option value=\"alternative\">Alternative</option>\n                      </select>\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                        Favorite Artist\n                      </label>\n                <input\n                        type=\"text\"\n                        value={formData.favoriteArtist}\n                        onChange={(e) => handleInputChange('favoriteArtist', e.target.value)}\n                        className=\"w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                        placeholder=\"Enter your favorite artist\"\n                />\n              </div>\n            </div>\n\n                  {/* Music Preferences */}\n                  <div className=\"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                      <Music className=\"w-5 h-5 mr-2 text-purple-600\" />\n                      Music Preferences\n                    </h3>\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                      <div className=\"flex items-center space-x-2\">\n                        <input type=\"checkbox\" id=\"spotify\" className=\"w-4 h-4 text-purple-600\" defaultChecked />\n                        <label htmlFor=\"spotify\" className=\"text-gray-700\">Spotify</label>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <input type=\"checkbox\" id=\"youtube\" className=\"w-4 h-4 text-purple-600\" defaultChecked />\n                        <label htmlFor=\"youtube\" className=\"text-gray-700\">YouTube</label>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <input type=\"checkbox\" id=\"apple\" className=\"w-4 h-4 text-purple-600\" />\n                        <label htmlFor=\"apple\" className=\"text-gray-700\">Apple Music</label>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <input type=\"checkbox\" id=\"soundcloud\" className=\"w-4 h-4 text-purple-600\" />\n                        <label htmlFor=\"soundcloud\" className=\"text-gray-700\">SoundCloud</label>\n                      </div>\n                    </div>\n                  </div>\n                </motion.div>\n              )}\n\n              {/* Preferences Tab */}\n              {activeTab === 'preferences' && (\n                <motion.div\n                  initial={{ opacity: 0, x: 20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  className=\"space-y-6\"\n                >\n                  {/* Theme Settings */}\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                      <Palette className=\"w-5 h-5 mr-2 text-blue-600\" />\n                      Theme Settings\n                    </h3>\n                    <div className=\"space-y-3\">\n                      {['light', 'dark', 'auto'].map((theme) => (\n                        <label key={theme} className=\"flex items-center space-x-3 cursor-pointer\">\n                          <input\n                            type=\"radio\"\n                            name=\"theme\"\n                            value={theme}\n                            checked={formData.theme === theme}\n                            onChange={(e) => handleInputChange('theme', e.target.value)}\n                            className=\"w-4 h-4 text-blue-500\"\n                          />\n                          <span className=\"text-gray-700 capitalize\">{theme} Theme</span>\n                        </label>\n                      ))}\n                    </div>\n                  </div>\n\n                  {/* Notification Settings */}\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                      <Bell className=\"w-5 h-5 mr-2 text-green-600\" />\n                      Notification Settings\n                    </h3>\n                    <div className=\"space-y-3\">\n                      {Object.entries(formData.notifications).map(([key, value]) => (\n                        <label key={key} className=\"flex items-center space-x-3 cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={value}\n                            onChange={(e) => handleNestedChange('notifications', key, e.target.checked)}\n                            className=\"w-4 h-4 text-green-500 rounded\"\n                          />\n                          <span className=\"text-gray-700 capitalize\">\n                            {key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}\n                          </span>\n                        </label>\n                      ))}\n                    </div>\n                  </div>\n                </motion.div>\n              )}\n\n              {/* Privacy Tab */}\n              {activeTab === 'security' && (\n                <motion.div\n                  initial={{ opacity: 0, x: 20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  className=\"space-y-6\"\n                >\n                  {/* Privacy Settings */}\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                      <Shield className=\"w-5 h-5 mr-2 text-red-600\" />\n                      Privacy Settings\n                    </h3>\n                    <div className=\"space-y-3\">\n                      {Object.entries(formData.privacy).map(([key, value]) => (\n                        <label key={key} className=\"flex items-center space-x-3 cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={value}\n                            onChange={(e) => handleNestedChange('privacy', key, e.target.checked)}\n                            className=\"w-4 h-4 text-red-500 rounded\"\n                          />\n                          <span className=\"text-gray-700 capitalize\">\n                            {key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}\n                          </span>\n                        </label>\n                      ))}\n                    </div>\n                  </div>\n\n                  {/* Account Security */}\n                  <div className=\"bg-gradient-to-r from-red-50 to-orange-50 rounded-lg p-4\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Account Security</h3>\n                    <div className=\"space-y-3\">\n                      <button className=\"w-full bg-blue-500 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors\">\n                        Change Password\n                      </button>\n                      <button className=\"w-full bg-green-500 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-green-600 transition-colors\">\n                        Enable Two-Factor Authentication\n                      </button>\n                      <button className=\"w-full bg-gray-500 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-gray-600 transition-colors\">\n                        View Login History\n                      </button>\n                    </div>\n                  </div>\n                </motion.div>\n              )}\n            </div>\n\n            {/* Action Buttons */}\n            <div className=\"flex space-x-3 mt-8 pt-6 border-t\">\n              <button\n                onClick={onClose}\n                disabled={isSaving}\n                className=\"flex-1 bg-gray-100 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-200 transition-colors disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleSave}\n                disabled={isSaving}\n                className=\"flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 px-4 rounded-lg font-medium hover:from-blue-600 hover:to-purple-600 transition-all disabled:opacity-50 flex items-center justify-center space-x-2\"\n              >\n                {isSaving ? (\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                ) : (\n                  <Save className=\"w-4 h-4\" />\n                )}\n                <span>{isSaving ? 'Saving...' : 'Save Changes'}</span>\n              </button>\n            </div>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}; \n\n// Full-page version similar to PreferencesPage\nexport const EditProfilePage: React.FC<{ onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void }> = ({ onShowToast }) => {\n  const { user } = useAuth();\n  const [isUploading, setIsUploading] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [activeTab, setActiveTab] = useState<'basic' | 'social' | 'preferences' | 'security'>('basic');\n  const [formData, setFormData] = useState({\n    displayName: '',\n    email: '',\n    bio: '',\n    location: '',\n    website: '',\n    phone: '',\n    birthDate: '',\n    favoriteGenre: '',\n    favoriteArtist: '',\n    theme: 'dark',\n    notifications: { email: true, push: true, conversionComplete: true, weeklyReport: false },\n    privacy: { shareStats: false, publicProfile: false, showEmail: false, showLocation: false, showStats: true }\n  });\n\n  useEffect(() => {\n    const load = async () => {\n      if (!user?.uid) return;\n      try {\n        const profile = await profileService.getUserProfile(user.uid);\n        const settings = await profileService.getProfileSettings(user.uid);\n        if (profile) {\n          setFormData(prev => ({\n            ...prev,\n            displayName: profile.displayName || user.displayName || '',\n            email: profile.email || user.email || '',\n            bio: profile.bio || '',\n            location: profile.location || '',\n            website: profile.website || '',\n            phone: profile.phone || '',\n            birthDate: profile.birthDate || '',\n            favoriteGenre: profile.favoriteGenre || '',\n            favoriteArtist: profile.favoriteArtist || '',\n            theme: (settings.theme as 'dark' | 'light' | 'auto') || 'dark',\n            notifications: settings.notifications,\n            privacy: settings.privacy\n          }));\n        }\n      } catch (e) {\n        console.error('Error loading profile page:', e);\n        onShowToast?.('error', 'Failed to load profile');\n      }\n    };\n    load();\n  }, [user?.uid, onShowToast]);\n\n  const handleInputChange = (field: string, value: any) => setFormData(prev => ({ ...prev, [field]: value }));\n  const handleNestedChange = (category: string, field: string, value: any) => setFormData(prev => ({ ...prev, [category]: { ...(prev as any)[category], [field]: value } }));\n\n  const handleImageUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file || !user?.uid) return;\n    setIsUploading(true);\n    try {\n      const imageUrl = await profileService.uploadProfileImage(user.uid, file);\n      await profileService.updateUserProfile(user.uid, { photoURL: imageUrl });\n      onShowToast?.('success', 'Profile image updated');\n    } catch (e) {\n      console.error('upload error:', e);\n      onShowToast?.('error', 'Failed to upload image');\n    } finally { setIsUploading(false); }\n  };\n\n  const handleSave = async () => {\n    if (!user?.uid) return;\n    setIsSaving(true);\n    try {\n      await profileService.updateUserProfile(user.uid, {\n        displayName: formData.displayName,\n        bio: formData.bio,\n        location: formData.location,\n        website: formData.website,\n        phone: formData.phone,\n        birthDate: formData.birthDate,\n        favoriteGenre: formData.favoriteGenre,\n        favoriteArtist: formData.favoriteArtist\n      });\n      await profileService.updateProfileSettings(user.uid, {\n        theme: formData.theme as 'dark' | 'light' | 'auto',\n        notifications: formData.notifications,\n        privacy: formData.privacy\n      });\n      onShowToast?.('success', 'Profile saved');\n    } catch (e) {\n      console.error('save error:', e);\n      onShowToast?.('error', 'Failed to save profile');\n    } finally { setIsSaving(false); }\n  };\n\n  const tabs = [\n    { id: 'basic', label: 'Basic Info', icon: User },\n    { id: 'social', label: 'Social & Music', icon: Music },\n    { id: 'preferences', label: 'Preferences', icon: Settings },\n    { id: 'security', label: 'Privacy', icon: Shield }\n  ];\n\n  return (\n    <div className=\"min-h-screen px-4 sm:px-6 py-6 space-y-8\">\n      <header className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <button onClick={() => window.history.back()} aria-label=\"Go back\" className=\"p-2 rounded-full hover:bg-accent\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>\n          </button>\n          <div>\n            <h1 className=\"text-2xl font-bold\">Edit Profile</h1>\n            <p className=\"text-muted-foreground text-sm\">Customize your profile and preferences</p>\n          </div>\n        </div>\n        <button onClick={handleSave} disabled={isSaving} className=\"bg-gradient-to-r from-blue-500 to-purple-500 text-white py-2 px-4 rounded-lg font-medium disabled:opacity-50\">\n          {isSaving ? 'Saving…' : 'Save'}\n        </button>\n      </header>\n\n      {/* Tab Navigation styled like Insights */}\n      <div className=\"flex justify-center px-2\">\n        <div className=\"flex gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-xl max-w-full overflow-x-auto hide-scrollbar\">\n          {tabs.map(({ id, label, icon: Icon }) => (\n            <button\n              key={id}\n              onClick={() => setActiveTab(id as any)}\n              className={`flex items-center gap-1.5 px-3 py-2 rounded-lg transition-all whitespace-nowrap min-w-0 flex-shrink-0 ${\n                activeTab === id\n                  ? 'bg-gradient-to-r from-orange-500 to-pink-500 text-white shadow-md'\n                  : 'bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-200/60 dark:border-gray-600/60 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600'\n              }`}\n            >\n              <Icon className=\"w-3.5 h-3.5\" />\n              <span className=\"text-xs font-medium\">{label}</span>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"space-y-6\">\n        {activeTab === 'basic' && (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <div className=\"relative inline-block\">\n                <div className=\"w-40 h-40 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-2xl border-2 border-white/10\">\n                  <User className=\"w-24 h-24 text-white\" />\n                </div>\n                <button\n                  onClick={() => document.getElementById('profile-image-input')?.click()}\n                  disabled={isUploading}\n                  className=\"absolute -bottom-2 -right-2 w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center shadow-lg hover:bg-blue-600 transition-colors disabled:opacity-50\"\n                >\n                  {isUploading ? (\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  ) : (\n                    <Camera className=\"w-5 h-5 text-white\" />\n                  )}\n                </button>\n                <input id=\"profile-image-input\" type=\"file\" accept=\"image/*\" onChange={handleImageUpload} className=\"hidden\" disabled={isUploading} />\n              </div>\n              <p className=\"text-sm text-muted-foreground mt-2\">Click to change profile photo</p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Display Name</label>\n                <input type=\"text\" value={formData.displayName} onChange={(e) => handleInputChange('displayName', e.target.value)} className=\"w-full bg-background/90 border border-border rounded-lg px-4 py-3\" placeholder=\"Enter your display name\" />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Email</label>\n                <input type=\"email\" value={formData.email} onChange={(e) => handleInputChange('email', e.target.value)} className=\"w-full bg-background/90 border border-border rounded-lg px-4 py-3\" placeholder=\"Enter your email\" />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Phone Number</label>\n                <input type=\"tel\" value={formData.phone} onChange={(e) => handleInputChange('phone', e.target.value)} className=\"w-full bg-background/90 border border-border rounded-lg px-4 py-3\" placeholder=\"Enter your phone number\" />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Location</label>\n                <input type=\"text\" value={formData.location} onChange={(e) => handleInputChange('location', e.target.value)} className=\"w-full bg-background/90 border border-border rounded-lg px-4 py-3\" placeholder=\"Enter your location\" />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Website</label>\n                <input type=\"url\" value={formData.website} onChange={(e) => handleInputChange('website', e.target.value)} className=\"w-full bg-background/90 border border-border rounded-lg px-4 py-3\" placeholder=\"Enter your website\" />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Birth Date</label>\n                <input type=\"date\" value={formData.birthDate} onChange={(e) => handleInputChange('birthDate', e.target.value)} className=\"w-full bg-background/90 border border-border rounded-lg px-4 py-3\" />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">Bio</label>\n              <textarea value={formData.bio} onChange={(e) => handleInputChange('bio', e.target.value)} rows={3} className=\"w-full bg-background/90 border border-border rounded-lg px-4 py-3 resize-none\" placeholder=\"Tell us about yourself...\" />\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'social' && (\n          <div className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Favorite Genre</label>\n                <select value={formData.favoriteGenre} onChange={(e) => handleInputChange('favoriteGenre', e.target.value)} className=\"w-full bg-background/90 border border-border rounded-lg px-4 py-3\">\n                  <option value=\"\">Select your favorite genre</option>\n                  <option value=\"pop\">Pop</option>\n                  <option value=\"rock\">Rock</option>\n                  <option value=\"hip-hop\">Hip Hop</option>\n                  <option value=\"electronic\">Electronic</option>\n                  <option value=\"jazz\">Jazz</option>\n                  <option value=\"classical\">Classical</option>\n                  <option value=\"country\">Country</option>\n                  <option value=\"r&b\">R&B</option>\n                  <option value=\"indie\">Indie</option>\n                  <option value=\"alternative\">Alternative</option>\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Favorite Artist</label>\n                <input type=\"text\" value={formData.favoriteArtist} onChange={(e) => handleInputChange('favoriteArtist', e.target.value)} className=\"w-full bg-background/90 border border-border rounded-lg px-4 py-3\" placeholder=\"Enter your favorite artist\" />\n              </div>\n            </div>\n\n            <div className=\"bg-accent/40 rounded-lg p-4\">\n              <h3 className=\"text-lg font-semibold mb-4 flex items-center\"><Music className=\"w-5 h-5 mr-2\"/>Music Preferences</h3>\n              <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                <label className=\"flex items-center gap-2\"><input type=\"checkbox\" defaultChecked /> <span>Spotify</span></label>\n                <label className=\"flex items-center gap-2\"><input type=\"checkbox\" defaultChecked /> <span>YouTube</span></label>\n                <label className=\"flex items-center gap-2\"><input type=\"checkbox\" /> <span>Apple Music</span></label>\n                <label className=\"flex items-center gap-2\"><input type=\"checkbox\" /> <span>SoundCloud</span></label>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'preferences' && (\n          <div className=\"space-y-6\">\n            <div>\n              <h3 className=\"text-lg font-semibold mb-4 flex items-center\"><Palette className=\"w-5 h-5 mr-2\"/>Theme Settings</h3>\n              <div className=\"space-y-3\">\n                {['light', 'dark', 'auto'].map((theme) => (\n                  <label key={theme} className=\"flex items-center gap-3 cursor-pointer\">\n                    <input type=\"radio\" name=\"theme\" value={theme} checked={formData.theme===theme} onChange={(e)=>handleInputChange('theme', e.target.value)} />\n                    <span className=\"capitalize\">{theme} Theme</span>\n                  </label>\n                ))}\n              </div>\n            </div>\n\n            <div>\n              <h3 className=\"text-lg font-semibold mb-4 flex items-center\"><Bell className=\"w-5 h-5 mr-2\"/>Notification Settings</h3>\n              <div className=\"space-y-3\">\n                {Object.entries(formData.notifications).map(([key, value]) => (\n                  <label key={key} className=\"flex items-center gap-3 cursor-pointer\">\n                    <input type=\"checkbox\" checked={value} onChange={(e)=>handleNestedChange('notifications', key, e.target.checked)} />\n                    <span className=\"capitalize\">{key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</span>\n                  </label>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'security' && (\n          <div className=\"space-y-6\">\n            <div>\n              <h3 className=\"text-lg font-semibold mb-4 flex items-center\"><Shield className=\"w-5 h-5 mr-2\"/>Privacy Settings</h3>\n              <div className=\"space-y-3\">\n                {Object.entries(formData.privacy).map(([key, value]) => (\n                  <label key={key} className=\"flex items-center gap-3 cursor-pointer\">\n                    <input type=\"checkbox\" checked={value} onChange={(e)=>handleNestedChange('privacy', key, e.target.checked)} />\n                    <span className=\"capitalize\">{key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</span>\n                  </label>\n                ))}\n              </div>\n            </div>\n            <div className=\"bg-yellow-50 dark:bg-yellow-950/20 rounded-lg p-4\">\n              <h3 className=\"text-lg font-semibold mb-3\">Account Security</h3>\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\n                <button className=\"bg-blue-500 text-white py-2 px-3 rounded-lg text-sm\">Change Password</button>\n                <button className=\"bg-green-500 text-white py-2 px-3 rounded-lg text-sm\">Enable 2FA</button>\n                <button className=\"bg-gray-500 text-white py-2 px-3 rounded-lg text-sm\">Login History</button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}; ","import React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  X, \n  Palette, \n  Bell, \n  Shield, \n  Download, \n  Trash2, \n  Eye, \n  EyeOff,\n  Mail,\n  Smartphone,\n  CheckCircle,\n  BarChart3,\n  Globe,\n  User,\n  Save,\n  AlertTriangle,\n  ChevronRight\n} from 'lucide-react';\nimport { useAuth } from '../../lib/AuthContext';\nimport { profileService, ProfileSettings } from '../../services/profileService';\nimport { useNavigate } from 'react-router-dom';\n\ninterface SettingsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void;\n}\n\nexport const SettingsModal: React.FC<SettingsModalProps> = ({ \n  isOpen, \n  onClose, \n  onShowToast \n}) => {\n  const { user } = useAuth();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [isExporting, setIsExporting] = useState(false);\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  const [settings, setSettings] = useState<ProfileSettings>({\n    theme: 'dark',\n    notifications: {\n      email: true,\n      push: true,\n      conversionComplete: true,\n      weeklyReport: false\n    },\n    privacy: {\n      shareStats: false,\n      publicProfile: false,\n      showEmail: false,\n      showLocation: false,\n      showStats: true\n    }\n  });\n\n  useEffect(() => {\n    const loadSettings = async () => {\n      if (!user?.uid || !isOpen) return;\n      \n      setIsLoading(true);\n      try {\n        const userSettings = await profileService.getProfileSettings(user.uid);\n        setSettings(userSettings);\n      } catch (error) {\n        console.error('Error loading settings:', error);\n        onShowToast?.('error', 'Failed to load settings');\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadSettings();\n  }, [user?.uid, isOpen, onShowToast]);\n\n  const handleSaveSettings = async () => {\n    if (!user?.uid) return;\n    \n    setIsSaving(true);\n    try {\n      await profileService.updateProfileSettings(user.uid, settings);\n      onShowToast?.('success', 'Settings saved successfully!');\n      onClose();\n    } catch (error) {\n      console.error('Error saving settings:', error);\n      onShowToast?.('error', 'Failed to save settings');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleExportData = async () => {\n    if (!user?.uid) return;\n    \n    setIsExporting(true);\n    try {\n      const exportData = await profileService.exportUserData(user.uid);\n      \n      // Create and download file\n      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `soundswapp-data-${new Date().toISOString().split('T')[0]}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      \n      onShowToast?.('success', 'Data exported successfully!');\n    } catch (error) {\n      console.error('Error exporting data:', error);\n      onShowToast?.('error', 'Failed to export data');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const handleDeleteAccount = async () => {\n    if (!user?.uid) return;\n    \n    try {\n      await profileService.deleteUserAccount(user.uid);\n      onShowToast?.('success', 'Account deleted successfully');\n      onClose();\n      // Sign out user after account deletion\n      window.location.href = '/';\n    } catch (error) {\n      console.error('Error deleting account:', error);\n      onShowToast?.('error', 'Failed to delete account');\n    }\n  };\n\n  const updateSetting = (category: keyof ProfileSettings, key: string, value: any) => {\n    setSettings(prev => ({\n      ...prev,\n      [category]: {\n        ...(prev[category] as any),\n        [key]: value\n      }\n    }));\n  };\n\n  if (isLoading) {\n    return (\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\n          >\n            <motion.div\n              initial={{ scale: 0.9, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              className=\"bg-white rounded-2xl p-8 w-full max-w-md shadow-2xl\"\n            >\n              <div className=\"text-center\">\n                <div className=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n                <p className=\"text-gray-600\">Loading settings...</p>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    );\n  }\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\n          onClick={onClose}\n        >\n          <motion.div\n            initial={{ scale: 0.9, opacity: 0, y: 20 }}\n            animate={{ scale: 1, opacity: 1, y: 0 }}\n            exit={{ scale: 0.9, opacity: 0, y: 20 }}\n            className=\"bg-white rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            {/* Header */}\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Settings</h2>\n              <button\n                onClick={onClose}\n                className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n              >\n                <X className=\"w-5 h-5 text-gray-500\" />\n              </button>\n            </div>\n\n            <div className=\"space-y-8\">\n              {/* Theme Settings */}\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                  <Palette className=\"w-5 h-5 mr-2 text-blue-500\" />\n                  Theme Settings\n                </h3>\n                <div className=\"space-y-3\">\n                  <label className=\"flex items-center space-x-3 cursor-pointer\">\n                    <input\n                      type=\"radio\"\n                      name=\"theme\"\n                      value=\"light\"\n                      checked={settings.theme === 'light'}\n                      onChange={(e) => updateSetting('theme', 'theme', e.target.value)}\n                      className=\"w-4 h-4 text-blue-500\"\n                    />\n                    <span className=\"text-gray-700\">Light Theme</span>\n                  </label>\n                  <label className=\"flex items-center space-x-3 cursor-pointer\">\n                    <input\n                      type=\"radio\"\n                      name=\"theme\"\n                      value=\"dark\"\n                      checked={settings.theme === 'dark'}\n                      onChange={(e) => updateSetting('theme', 'theme', e.target.value)}\n                      className=\"w-4 h-4 text-blue-500\"\n                    />\n                    <span className=\"text-gray-700\">Dark Theme</span>\n                  </label>\n                  <label className=\"flex items-center space-x-3 cursor-pointer\">\n                    <input\n                      type=\"radio\"\n                      name=\"theme\"\n                      value=\"auto\"\n                      checked={settings.theme === 'auto'}\n                      onChange={(e) => updateSetting('theme', 'theme', e.target.value)}\n                      className=\"w-4 h-4 text-blue-500\"\n                    />\n                    <span className=\"text-gray-700\">Auto (System)</span>\n                  </label>\n                </div>\n              </div>\n\n              {/* Notification Settings */}\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                  <Bell className=\"w-5 h-5 mr-2 text-green-500\" />\n                  Notifications\n                </h3>\n                <div className=\"space-y-3\">\n                  <label className=\"flex items-center space-x-3 cursor-pointer\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.notifications.email}\n                      onChange={(e) => updateSetting('notifications', 'email', e.target.checked)}\n                      className=\"w-4 h-4 text-green-500 rounded\"\n                    />\n                    <Mail className=\"w-4 h-4 text-gray-500\" />\n                    <span className=\"text-gray-700\">Email Notifications</span>\n                  </label>\n                  <label className=\"flex items-center space-x-3 cursor-pointer\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.notifications.push}\n                      onChange={(e) => updateSetting('notifications', 'push', e.target.checked)}\n                      className=\"w-4 h-4 text-green-500 rounded\"\n                    />\n                    <Smartphone className=\"w-4 h-4 text-gray-500\" />\n                    <span className=\"text-gray-700\">Push Notifications</span>\n                  </label>\n                  <label className=\"flex items-center space-x-3 cursor-pointer\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.notifications.conversionComplete}\n                      onChange={(e) => updateSetting('notifications', 'conversionComplete', e.target.checked)}\n                      className=\"w-4 h-4 text-green-500 rounded\"\n                    />\n                    <CheckCircle className=\"w-4 h-4 text-gray-500\" />\n                    <span className=\"text-gray-700\">Conversion Complete Alerts</span>\n                  </label>\n                  <label className=\"flex items-center space-x-3 cursor-pointer\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.notifications.weeklyReport}\n                      onChange={(e) => updateSetting('notifications', 'weeklyReport', e.target.checked)}\n                      className=\"w-4 h-4 text-green-500 rounded\"\n                    />\n                    <BarChart3 className=\"w-4 h-4 text-gray-500\" />\n                    <span className=\"text-gray-700\">Weekly Usage Reports</span>\n                  </label>\n                </div>\n              </div>\n\n              {/* Privacy Settings */}\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                  <Shield className=\"w-5 h-5 mr-2 text-red-500\" />\n                  Privacy & Security\n                </h3>\n                <div className=\"space-y-3\">\n                  <label className=\"flex items-center space-x-3 cursor-pointer\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.privacy.shareStats}\n                      onChange={(e) => updateSetting('privacy', 'shareStats', e.target.checked)}\n                      className=\"w-4 h-4 text-red-500 rounded\"\n                    />\n                    <BarChart3 className=\"w-4 h-4 text-gray-500\" />\n                    <span className=\"text-gray-700\">Share Usage Statistics</span>\n                  </label>\n                  <label className=\"flex items-center space-x-3 cursor-pointer\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.privacy.publicProfile}\n                      onChange={(e) => updateSetting('privacy', 'publicProfile', e.target.checked)}\n                      className=\"w-4 h-4 text-red-500 rounded\"\n                    />\n                    <Globe className=\"w-4 h-4 text-gray-500\" />\n                    <span className=\"text-gray-700\">Public Profile</span>\n                  </label>\n                </div>\n              </div>\n\n              {/* Data Export */}\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                  <Download className=\"w-5 h-5 mr-2 text-orange-500\" />\n                  Data Export\n                </h3>\n                <p className=\"text-sm text-gray-600 mb-4\">\n                  Download all your data including profile information, conversion history, and settings.\n                </p>\n                <button\n                  onClick={handleExportData}\n                  disabled={isExporting}\n                  className=\"bg-orange-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors disabled:opacity-50 flex items-center space-x-2\"\n                >\n                  {isExporting ? (\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  ) : (\n                    <Download className=\"w-4 h-4\" />\n                  )}\n                  <span>{isExporting ? 'Exporting...' : 'Export Data'}</span>\n                </button>\n              </div>\n\n              {/* Account Deletion */}\n              <div className=\"border-t pt-6\">\n                <h3 className=\"text-lg font-semibold text-red-600 mb-4 flex items-center\">\n                  <AlertTriangle className=\"w-5 h-5 mr-2\" />\n                  Danger Zone\n                </h3>\n                <p className=\"text-sm text-gray-600 mb-4\">\n                  Permanently delete your account and all associated data. This action cannot be undone.\n                </p>\n                {!showDeleteConfirm ? (\n                  <button\n                    onClick={() => setShowDeleteConfirm(true)}\n                    className=\"bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition-colors flex items-center space-x-2\"\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                    <span>Delete Account</span>\n                  </button>\n                ) : (\n                  <div className=\"space-y-3\">\n                    <p className=\"text-sm text-red-600 font-medium\">\n                      Are you sure? This will permanently delete your account and all data.\n                    </p>\n                    <div className=\"flex space-x-3\">\n                      <button\n                        onClick={() => setShowDeleteConfirm(false)}\n                        className=\"bg-gray-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-600 transition-colors\"\n                      >\n                        Cancel\n                      </button>\n                      <button\n                        onClick={handleDeleteAccount}\n                        className=\"bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition-colors flex items-center space-x-2\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                        <span>Yes, Delete Account</span>\n                      </button>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Action Buttons */}\n            <div className=\"flex space-x-3 mt-8 pt-6 border-t\">\n              <button\n                onClick={onClose}\n                disabled={isSaving}\n                className=\"flex-1 bg-gray-100 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-200 transition-colors disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleSaveSettings}\n                disabled={isSaving}\n                className=\"flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 px-4 rounded-lg font-medium hover:from-blue-600 hover:to-purple-600 transition-all disabled:opacity-50 flex items-center justify-center space-x-2\"\n              >\n                {isSaving ? (\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                ) : (\n                  <Save className=\"w-4 h-4\" />\n                )}\n                <span>{isSaving ? 'Saving...' : 'Save Settings'}</span>\n              </button>\n            </div>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}; \n\nexport const SettingsPage: React.FC<{ onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void }> = ({ onShowToast }) => {\n  const navigate = useNavigate();\n\n  return (\n    <div className=\"min-h-screen px-4 sm:px-6 py-6 space-y-8\">\n      <header className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <button onClick={() => window.history.back()} aria-label=\"Go back\" className=\"p-2 rounded-full hover:bg-accent\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>\n          </button>\n          <h1 className=\"text-2xl font-bold\">Settings</h1>\n        </div>\n      </header>\n\n      <section className=\"space-y-3\">\n        <button onClick={() => navigate('/preferences')} className=\"flex items-center justify-between rounded-xl px-4 py-3 bg-white/5 border border-white/10 hover:bg-white/10 transition-colors\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-9 h-9 rounded-lg bg-violet-600/15 text-violet-400 flex items-center justify-center\">\n              <Palette className=\"w-5 h-5\" />\n            </div>\n            <div className=\"text-left\">\n              <div className=\"font-medium\">Preferences</div>\n              <div className=\"text-xs opacity-70\">Theme, notifications, privacy, export</div>\n            </div>\n          </div>\n          <ChevronRight className=\"w-5 h-5 opacity-70\" />\n        </button>\n      </section>\n\n      <section className=\"space-y-4\">\n        <h2 className=\"text-lg font-semibold text-red-600\">Danger Zone</h2>\n        <DeleteAccountBlock onShowToast={onShowToast} />\n      </section>\n    </div>\n  );\n};\n\nexport const PreferencesPage: React.FC = () => {\n  const navigate = useNavigate();\n  return (\n    <div className=\"min-h-screen px-4 sm:px-6 py-6 space-y-8\">\n      <header className=\"flex items-center gap-3\">\n        <button onClick={() => window.history.back()} aria-label=\"Go back\" className=\"p-2 rounded-full hover:bg-accent\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>\n        </button>\n        <h1 className=\"text-2xl font-bold\">Preferences</h1>\n      </header>\n\n      <section className=\"space-y-4\">\n        <div className=\"grid grid-cols-1 gap-3\">\n          <button onClick={() => navigate('/preferences/theme')} className=\"flex items-center justify-between rounded-xl px-4 py-3 bg-white/5 border border-white/10 hover:bg-white/10 transition-colors\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-9 h-9 rounded-lg bg-violet-600/15 text-violet-400 flex items-center justify-center\">\n                <Palette className=\"w-5 h-5\" />\n              </div>\n              <div className=\"text-left\">\n                <div className=\"font-medium\">Theme Settings</div>\n                <div className=\"text-xs opacity-70\">Customize appearance</div>\n              </div>\n            </div>\n            <ChevronRight className=\"w-5 h-5 opacity-70\" />\n          </button>\n\n          <button onClick={() => navigate('/preferences/notifications')} className=\"flex items-center justify-between rounded-xl px-4 py-3 bg-white/5 border border-white/10 hover:bg-white/10 transition-colors\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-9 h-9 rounded-lg bg-green-600/15 text-green-400 flex items-center justify-center\">\n                <Bell className=\"w-5 h-5\" />\n              </div>\n              <div className=\"text-left\">\n                <div className=\"font-medium\">Notifications</div>\n                <div className=\"text-xs opacity-70\">Manage alerts and updates</div>\n              </div>\n            </div>\n            <ChevronRight className=\"w-5 h-5 opacity-70\" />\n          </button>\n\n          <button onClick={() => navigate('/preferences/privacy')} className=\"flex items-center justify-between rounded-xl px-4 py-3 bg-white/5 border border-white/10 hover:bg-white/10 transition-colors\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-9 h-9 rounded-lg bg-red-600/15 text-red-400 flex items-center justify-center\">\n                <Shield className=\"w-5 h-5\" />\n              </div>\n              <div className=\"text-left\">\n                <div className=\"font-medium\">Privacy & Security</div>\n                <div className=\"text-xs opacity-70\">Manage your privacy</div>\n              </div>\n            </div>\n            <ChevronRight className=\"w-5 h-5 opacity-70\" />\n          </button>\n\n          <button onClick={() => navigate('/preferences/export')} className=\"flex items-center justify-between rounded-xl px-4 py-3 bg-white/5 border border-white/10 hover:bg-white/10 transition-colors\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-9 h-9 rounded-lg bg-orange-600/15 text-orange-400 flex items-center justify-center\">\n                <Download className=\"w-5 h-5\" />\n              </div>\n              <div className=\"text-left\">\n                <div className=\"font-medium\">Export Data</div>\n                <div className=\"text-xs opacity-70\">Download your data</div>\n              </div>\n            </div>\n            <ChevronRight className=\"w-5 h-5 opacity-70\" />\n          </button>\n        </div>\n      </section>\n    </div>\n  );\n};\n\n// Dedicated subpages\nexport const ThemeSettingsPage: React.FC<{ onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void }> = ({ onShowToast }) => {\n  const { user } = useAuth();\n  const [settings, setSettings] = useState<ProfileSettings>({ theme: 'dark', notifications: { email: true, push: true, conversionComplete: true, weeklyReport: false }, privacy: { shareStats: false, publicProfile: false, showEmail: false, showLocation: false, showStats: true } });\n  const [isSaving, setIsSaving] = useState(false);\n\n  useEffect(() => { (async () => { if (!user?.uid) return; try { setSettings(await profileService.getProfileSettings(user.uid)); } catch (e) { console.error(e); onShowToast?.('error','Failed to load settings'); } })(); }, [user?.uid, onShowToast]);\n\n  const save = async () => { if (!user?.uid) return; setIsSaving(true); try { await profileService.updateProfileSettings(user.uid, settings); onShowToast?.('success','Theme saved'); } catch (e) { console.error(e); onShowToast?.('error','Save failed'); } finally { setIsSaving(false); } };\n\n  return (\n    <div className=\"min-h-screen px-4 sm:px-6 py-6 space-y-6\">\n      <Header title=\"Theme Settings\" />\n      <div className=\"space-y-3\">\n        <label className=\"flex items-center gap-3\"><input type=\"radio\" name=\"theme\" value=\"light\" checked={settings.theme==='light'} onChange={(e)=>setSettings(s=>({ ...s, theme: e.target.value as any }))} /><span>Light</span></label>\n        <label className=\"flex items-center gap-3\"><input type=\"radio\" name=\"theme\" value=\"dark\" checked={settings.theme==='dark'} onChange={(e)=>setSettings(s=>({ ...s, theme: e.target.value as any }))} /><span>Dark</span></label>\n        <label className=\"flex items-center gap-3\"><input type=\"radio\" name=\"theme\" value=\"auto\" checked={settings.theme==='auto'} onChange={(e)=>setSettings(s=>({ ...s, theme: e.target.value as any }))} /><span>Auto (System)</span></label>\n      </div>\n      <FooterSave isSaving={isSaving} onSave={save} />\n    </div>\n  );\n};\n\nexport const NotificationSettingsPage: React.FC<{ onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void }> = ({ onShowToast }) => {\n  const { user } = useAuth();\n  const [settings, setSettings] = useState<ProfileSettings>({ theme: 'dark', notifications: { email: true, push: true, conversionComplete: true, weeklyReport: false }, privacy: { shareStats: false, publicProfile: false, showEmail: false, showLocation: false, showStats: true } });\n  const [isSaving, setIsSaving] = useState(false);\n\n  useEffect(() => { (async () => { if (!user?.uid) return; try { setSettings(await profileService.getProfileSettings(user.uid)); } catch (e) { console.error(e); onShowToast?.('error','Failed to load settings'); } })(); }, [user?.uid, onShowToast]);\n\n  const save = async () => { if (!user?.uid) return; setIsSaving(true); try { await profileService.updateProfileSettings(user.uid, settings); onShowToast?.('success','Notifications saved'); } catch (e) { console.error(e); onShowToast?.('error','Save failed'); } finally { setIsSaving(false); } };\n\n  return (\n    <div className=\"min-h-screen px-4 sm:px-6 py-6 space-y-6\">\n      <Header title=\"Notifications\" />\n      <div className=\"space-y-4\">\n        <ToggleRow checked={settings.notifications.email} onChange={(v)=>setSettings(s=>({ ...s, notifications: { ...s.notifications, email: v } }))} icon={<Mail className=\"w-4 h-4\"/>} label=\"Email Notifications\" />\n        <ToggleRow checked={settings.notifications.push} onChange={(v)=>setSettings(s=>({ ...s, notifications: { ...s.notifications, push: v } }))} icon={<Smartphone className=\"w-4 h-4\"/>} label=\"Push Notifications\" />\n        <ToggleRow checked={settings.notifications.conversionComplete} onChange={(v)=>setSettings(s=>({ ...s, notifications: { ...s.notifications, conversionComplete: v } }))} icon={<CheckCircle className=\"w-4 h-4\"/>} label=\"Conversion Complete Alerts\" />\n        <ToggleRow checked={settings.notifications.weeklyReport} onChange={(v)=>setSettings(s=>({ ...s, notifications: { ...s.notifications, weeklyReport: v } }))} icon={<BarChart3 className=\"w-4 h-4\"/>} label=\"Weekly Usage Reports\" />\n      </div>\n      <FooterSave isSaving={isSaving} onSave={save} />\n    </div>\n  );\n};\n\nexport const PrivacySettingsPage: React.FC<{ onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void }> = ({ onShowToast }) => {\n  const { user } = useAuth();\n  const [settings, setSettings] = useState<ProfileSettings>({ theme: 'dark', notifications: { email: true, push: true, conversionComplete: true, weeklyReport: false }, privacy: { shareStats: false, publicProfile: false, showEmail: false, showLocation: false, showStats: true } });\n  const [isSaving, setIsSaving] = useState(false);\n\n  useEffect(() => { (async () => { if (!user?.uid) return; try { setSettings(await profileService.getProfileSettings(user.uid)); } catch (e) { console.error(e); onShowToast?.('error','Failed to load settings'); } })(); }, [user?.uid, onShowToast]);\n\n  const save = async () => { if (!user?.uid) return; setIsSaving(true); try { await profileService.updateProfileSettings(user.uid, settings); onShowToast?.('success','Privacy settings saved'); } catch (e) { console.error(e); onShowToast?.('error','Save failed'); } finally { setIsSaving(false); } };\n\n  return (\n    <div className=\"min-h-screen px-4 sm:px-6 py-6 space-y-6\">\n      <Header title=\"Privacy & Security\" />\n      <div className=\"space-y-4\">\n        <ToggleRow checked={settings.privacy.shareStats} onChange={(v)=>setSettings(s=>({ ...s, privacy: { ...s.privacy, shareStats: v } }))} icon={<BarChart3 className=\"w-4 h-4\"/>} label=\"Share Usage Statistics\" />\n        <ToggleRow checked={settings.privacy.publicProfile} onChange={(v)=>setSettings(s=>({ ...s, privacy: { ...s.privacy, publicProfile: v } }))} icon={<Globe className=\"w-4 h-4\"/>} label=\"Public Profile\" />\n        <ToggleRow checked={settings.privacy.showEmail} onChange={(v)=>setSettings(s=>({ ...s, privacy: { ...s.privacy, showEmail: v } }))} icon={<Mail className=\"w-4 h-4\"/>} label=\"Show Email\" />\n        <ToggleRow checked={settings.privacy.showLocation} onChange={(v)=>setSettings(s=>({ ...s, privacy: { ...s.privacy, showLocation: v } }))} icon={<User className=\"w-4 h-4\"/>} label=\"Show Location\" />\n        <ToggleRow checked={settings.privacy.showStats} onChange={(v)=>setSettings(s=>({ ...s, privacy: { ...s.privacy, showStats: v } }))} icon={<BarChart3 className=\"w-4 h-4\"/>} label=\"Show Stats on Profile\" />\n      </div>\n      <FooterSave isSaving={isSaving} onSave={save} />\n    </div>\n  );\n};\n\nexport const DataExportPage: React.FC<{ onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void }> = ({ onShowToast }) => {\n  const { user } = useAuth();\n  const [isExporting, setIsExporting] = useState(false);\n\n  const handleExportData = async () => {\n    if (!user?.uid) return;\n    setIsExporting(true);\n    try {\n      const exportData = await profileService.exportUserData(user.uid);\n      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url; a.download = `soundswapp-data-${new Date().toISOString().split('T')[0]}.json`;\n      document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);\n      onShowToast?.('success', 'Data exported successfully!');\n    } catch (error) {\n      console.error('Error exporting data:', error);\n      onShowToast?.('error', 'Failed to export data');\n    } finally { setIsExporting(false); }\n  };\n\n  return (\n    <div className=\"min-h-screen px-4 sm:px-6 py-6 space-y-6\">\n      <Header title=\"Export Data\" />\n      <p className=\"text-sm opacity-80\">Download all your data including profile information, conversion history, and settings.</p>\n      <button onClick={handleExportData} disabled={isExporting} className=\"bg-orange-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors disabled:opacity-50 flex items-center gap-2 w-max\">\n        {isExporting ? <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" /> : <Download className=\"w-4 h-4\" />}<span>{isExporting ? 'Exporting…' : 'Export Data'}</span>\n      </button>\n    </div>\n  );\n};\n\n// Reusable pieces\nconst Header: React.FC<{ title: string }> = ({ title }) => (\n  <header className=\"flex items-center gap-3\">\n    <button onClick={() => window.history.back()} aria-label=\"Go back\" className=\"p-2 rounded-full hover:bg-accent\">\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>\n    </button>\n    <h1 className=\"text-2xl font-bold\">{title}</h1>\n  </header>\n);\n\nconst FooterSave: React.FC<{ isSaving: boolean; onSave: () => void }> = ({ isSaving, onSave }) => (\n  <div className=\"pt-4\">\n    <button onClick={onSave} disabled={isSaving} className=\"bg-gradient-to-r from-blue-500 to-purple-500 text-white py-2 px-4 rounded-lg font-medium disabled:opacity-50\">\n      {isSaving ? 'Saving…' : 'Save'}\n    </button>\n  </div>\n);\n\nconst ToggleRow: React.FC<{ checked: boolean; onChange: (v: boolean)=>void; icon: React.ReactNode; label: string }> = ({ checked, onChange, icon, label }) => (\n  <label className=\"flex items-center gap-3 cursor-pointer\">\n    <input type=\"checkbox\" checked={checked} onChange={(e)=>onChange(e.target.checked)} className=\"w-4 h-4\" />\n    <span className=\"opacity-70\">{icon}</span>\n    <span>{label}</span>\n  </label>\n);\n\nconst DeleteAccountBlock: React.FC<{ onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void }> = ({ onShowToast }) => {\n  const { user } = useAuth();\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  const handleDeleteAccount = async () => {\n    if (!user?.uid) return;\n    try { await profileService.deleteUserAccount(user.uid); onShowToast?.('success', 'Account deleted'); window.location.href = '/'; }\n    catch (error) { console.error('Delete error:', error); onShowToast?.('error', 'Failed to delete account'); }\n  };\n  return (\n    <div className=\"border border-red-500/20 rounded-xl p-4\">\n      <h3 className=\"text-lg font-semibold text-red-600 mb-2 flex items-center gap-2\"><AlertTriangle className=\"w-5 h-5\"/>Danger Zone</h3>\n      <p className=\"text-sm opacity-80 mb-4\">Permanently delete your account and all associated data. This action cannot be undone.</p>\n      {!showDeleteConfirm ? (\n        <button onClick={() => setShowDeleteConfirm(true)} className=\"bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition-colors flex items-center gap-2\">\n          <Trash2 className=\"w-4 h-4\" /> Delete Account\n        </button>\n      ) : (\n        <div className=\"space-y-3\">\n          <p className=\"text-sm text-red-600 font-medium\">Are you sure? This will permanently delete your account and all data.</p>\n          <div className=\"flex gap-3\">\n            <button onClick={() => setShowDeleteConfirm(false)} className=\"bg-gray-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-600 transition-colors\">Cancel</button>\n            <button onClick={handleDeleteAccount} className=\"bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition-colors flex items-center gap-2\"><Trash2 className=\"w-4 h-4\" /> Yes, Delete Account</button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}; ","import React, { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { \r\n  X, \r\n  HelpCircle, \r\n  BookOpen, \r\n  MessageCircle, \r\n  Mail, \r\n  ExternalLink,\r\n  ChevronRight,\r\n  ChevronDown,\r\n  Play,\r\n  Music,\r\n  Youtube,\r\n  CheckCircle,\r\n  AlertCircle,\r\n  Info\r\n} from 'lucide-react';\r\nimport { FaSpotify } from 'react-icons/fa';\r\n\r\ninterface HelpModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void;\r\n}\r\n\r\ninterface FAQItem {\r\n  question: string;\r\n  answer: string;\r\n  category: 'general' | 'conversion' | 'technical' | 'account';\r\n}\r\n\r\nconst faqData: FAQItem[] = [\r\n  {\r\n    question: \"How do I convert a playlist from Spotify to YouTube?\",\r\n    answer: \"1. Connect your Spotify account\\n2. Connect your YouTube account\\n3. Select a Spotify playlist as source\\n4. Choose YouTube as destination\\n5. Click 'Start Conversion' and wait for the process to complete.\",\r\n    category: \"conversion\"\r\n  },\r\n  {\r\n    question: \"How do I convert a playlist from YouTube to Spotify?\",\r\n    answer: \"1. Connect your YouTube account\\n2. Connect your Spotify account\\n3. Select a YouTube playlist as source\\n4. Choose Spotify as destination\\n5. Click 'Start Conversion' and wait for the process to complete.\",\r\n    category: \"conversion\"\r\n  },\r\n  {\r\n    question: \"Why are some tracks not found during conversion?\",\r\n    answer: \"Tracks may not be found due to:\\n• Different song titles or artist names\\n• Regional availability differences\\n• Explicit content restrictions\\n• Platform-specific licensing\\n\\nThe app will show you which tracks failed and why.\",\r\n    category: \"conversion\"\r\n  },\r\n  {\r\n    question: \"How accurate is the track matching?\",\r\n    answer: \"Our matching algorithm uses multiple factors:\\n• Song title similarity\\n• Artist name matching\\n• Duration comparison\\n• Popularity indicators\\n\\nWe aim for 85%+ accuracy, but results may vary.\",\r\n    category: \"technical\"\r\n  },\r\n  {\r\n    question: \"What are the conversion limits?\",\r\n    answer: \"Free users: 50 conversions per month\\nPremium users: Unlimited conversions\\n\\nEach playlist conversion counts as 1 conversion, regardless of track count.\",\r\n    category: \"account\"\r\n  },\r\n  {\r\n    question: \"How do I connect my Spotify account?\",\r\n    answer: \"1. Click 'Connect Spotify' on the connections page\\n2. Log in to your Spotify account\\n3. Grant permission to access your playlists\\n4. Your account will be connected and ready to use.\",\r\n    category: \"general\"\r\n  },\r\n  {\r\n    question: \"How do I connect my YouTube account?\",\r\n    answer: \"1. Click 'Connect YouTube' on the connections page\\n2. Log in to your Google account\\n3. Grant permission to access your YouTube playlists\\n4. Your account will be connected and ready to use.\",\r\n    category: \"general\"\r\n  },\r\n  {\r\n    question: \"Can I convert private playlists?\",\r\n    answer: \"Yes! You can convert both public and private playlists. The converted playlist will be created as private by default for your privacy.\",\r\n    category: \"conversion\"\r\n  },\r\n  {\r\n    question: \"What happens if my connection expires?\",\r\n    answer: \"If your connection expires, you'll see a 'Reconnect' button. Simply click it and log in again to restore access to your playlists.\",\r\n    category: \"account\"\r\n  },\r\n  {\r\n    question: \"How do I view my conversion history?\",\r\n    answer: \"Go to the 'History' tab in your profile to see all your past conversions, including success rates and failed tracks.\",\r\n    category: \"general\"\r\n  }\r\n];\r\n\r\nexport const HelpModal: React.FC<HelpModalProps> = ({ \r\n  isOpen, \r\n  onClose, \r\n  onShowToast \r\n}) => {\r\n  const [activeCategory, setActiveCategory] = useState<'all' | 'general' | 'conversion' | 'technical' | 'account'>('all');\r\n  const [expandedItems, setExpandedItems] = useState<Set<number>>(new Set());\r\n\r\n  const toggleExpanded = (index: number) => {\r\n    const newExpanded = new Set(expandedItems);\r\n    if (newExpanded.has(index)) {\r\n      newExpanded.delete(index);\r\n    } else {\r\n      newExpanded.add(index);\r\n    }\r\n    setExpandedItems(newExpanded);\r\n  };\r\n\r\n  const filteredFAQ = activeCategory === 'all' \r\n    ? faqData \r\n    : faqData.filter(item => item.category === activeCategory);\r\n\r\n  const handleContactSupport = () => {\r\n    const subject = encodeURIComponent('SoundSwapp Support Request');\r\n    const body = encodeURIComponent(`Hello SoundSwapp Support Team,\r\n\r\nI need help with the following issue:\r\n\r\n[Please describe your issue here]\r\n\r\nMy account details:\r\n- Email: [Your email]\r\n- Issue encountered: [Date and time]\r\n\r\nThank you for your assistance.\r\n\r\nBest regards,\r\n[Your name]`);\r\n    \r\n    window.open(`mailto:support@soundswapp.com?subject=${subject}&body=${body}`, '_blank');\r\n  };\r\n\r\n  const categories = [\r\n    { key: 'all', label: 'All Questions', icon: HelpCircle },\r\n    { key: 'general', label: 'Getting Started', icon: BookOpen },\r\n    { key: 'conversion', label: 'Conversion Process', icon: Play },\r\n    { key: 'technical', label: 'Technical Issues', icon: AlertCircle },\r\n    { key: 'account', label: 'Account & Limits', icon: Info }\r\n  ];\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0 }}\r\n          className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\r\n          onClick={onClose}\r\n        >\r\n          <motion.div\r\n            initial={{ scale: 0.9, opacity: 0, y: 20 }}\r\n            animate={{ scale: 1, opacity: 1, y: 0 }}\r\n            exit={{ scale: 0.9, opacity: 0, y: 20 }}\r\n            className=\"bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <div>\r\n                <h2 className=\"text-2xl font-bold text-gray-900\">Help & Support</h2>\r\n                <p className=\"text-gray-600 mt-1\">Find answers to common questions and get support</p>\r\n              </div>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\r\n              >\r\n                <X className=\"w-5 h-5 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n              {/* Left Sidebar - Categories */}\r\n              <div className=\"lg:col-span-1\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Categories</h3>\r\n                <div className=\"space-y-2\">\r\n                  {categories.map((category) => {\r\n                    const Icon = category.icon;\r\n                    return (\r\n                      <button\r\n                        key={category.key}\r\n                        onClick={() => setActiveCategory(category.key as any)}\r\n                        className={`w-full flex items-center space-x-3 p-3 rounded-lg text-left transition-colors ${\r\n                          activeCategory === category.key\r\n                            ? 'bg-blue-50 text-blue-700 border border-blue-200'\r\n                            : 'hover:bg-gray-50 text-gray-700'\r\n                        }`}\r\n                      >\r\n                        <Icon className=\"w-5 h-5\" />\r\n                        <span className=\"font-medium\">{category.label}</span>\r\n                      </button>\r\n                    );\r\n                  })}\r\n                </div>\r\n\r\n                {/* Contact Support */}\r\n                <div className=\"mt-8 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200\">\r\n                  <h4 className=\"font-semibold text-gray-900 mb-2\">Need More Help?</h4>\r\n                  <p className=\"text-sm text-gray-600 mb-4\">\r\n                    Can't find what you're looking for? Contact our support team.\r\n                  </p>\r\n                  <button\r\n                    onClick={handleContactSupport}\r\n                    className=\"w-full bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2\"\r\n                  >\r\n                    <Mail className=\"w-4 h-4\" />\r\n                    <span>Contact Support</span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Right Side - FAQ Content */}\r\n              <div className=\"lg:col-span-2\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n                  {activeCategory === 'all' ? 'Frequently Asked Questions' : `${categories.find(c => c.key === activeCategory)?.label}`}\r\n                </h3>\r\n                \r\n                <div className=\"space-y-4\">\r\n                  {filteredFAQ.map((item, index) => (\r\n                    <motion.div\r\n                      key={index}\r\n                      initial={{ opacity: 0, y: 10 }}\r\n                      animate={{ opacity: 1, y: 0 }}\r\n                      transition={{ delay: index * 0.1 }}\r\n                      className=\"border border-gray-200 rounded-lg overflow-hidden\"\r\n                    >\r\n                      <button\r\n                        onClick={() => toggleExpanded(index)}\r\n                        className=\"w-full p-4 text-left hover:bg-gray-50 transition-colors flex items-center justify-between\"\r\n                      >\r\n                        <span className=\"font-medium text-gray-900\">{item.question}</span>\r\n                        {expandedItems.has(index) ? (\r\n                          <ChevronDown className=\"w-5 h-5 text-gray-500\" />\r\n                        ) : (\r\n                          <ChevronRight className=\"w-5 h-5 text-gray-500\" />\r\n                        )}\r\n                      </button>\r\n                      \r\n                      <AnimatePresence>\r\n                        {expandedItems.has(index) && (\r\n                          <motion.div\r\n                            initial={{ height: 0, opacity: 0 }}\r\n                            animate={{ height: 'auto', opacity: 1 }}\r\n                            exit={{ height: 0, opacity: 0 }}\r\n                            className=\"px-4 pb-4\"\r\n                          >\r\n                            <div className=\"text-gray-700 whitespace-pre-line\">\r\n                              {item.answer}\r\n                            </div>\r\n                          </motion.div>\r\n                        )}\r\n                      </AnimatePresence>\r\n                    </motion.div>\r\n                  ))}\r\n                </div>\r\n\r\n                {/* Quick Start Guide */}\r\n                <div className=\"mt-8 p-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border border-green-200\">\r\n                  <h4 className=\"font-semibold text-gray-900 mb-4 flex items-center\">\r\n                    <Play className=\"w-5 h-5 mr-2 text-green-500\" />\r\n                    Quick Start Guide\r\n                  </h4>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-2\">\r\n                                             <h5 className=\"font-medium text-gray-900 flex items-center\">\r\n                         <FaSpotify className=\"w-4 h-4 mr-2 text-green-500\" />\r\n                         Spotify to YouTube\r\n                       </h5>\r\n                      <ol className=\"text-sm text-gray-600 space-y-1\">\r\n                        <li>1. Connect both accounts</li>\r\n                        <li>2. Select Spotify playlist</li>\r\n                        <li>3. Choose YouTube destination</li>\r\n                        <li>4. Start conversion</li>\r\n                      </ol>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <h5 className=\"font-medium text-gray-900 flex items-center\">\r\n                        <Youtube className=\"w-4 h-4 mr-2 text-red-500\" />\r\n                        YouTube to Spotify\r\n                      </h5>\r\n                      <ol className=\"text-sm text-gray-600 space-y-1\">\r\n                        <li>1. Connect both accounts</li>\r\n                        <li>2. Select YouTube playlist</li>\r\n                        <li>3. Choose Spotify destination</li>\r\n                        <li>4. Start conversion</li>\r\n                      </ol>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}; \r\n\r\nexport const HelpPage: React.FC<{ onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void }> = ({ onShowToast }) => {\r\n  const [activeCategory, setActiveCategory] = useState<'all' | 'general' | 'conversion' | 'technical' | 'account'>('all');\r\n  const [expandedItems, setExpandedItems] = useState<Set<number>>(new Set());\r\n  const toggleExpanded = (index: number) => {\r\n    const newExpanded = new Set(expandedItems);\r\n    newExpanded.has(index) ? newExpanded.delete(index) : newExpanded.add(index);\r\n    setExpandedItems(newExpanded);\r\n  };\r\n  const filteredFAQ = activeCategory === 'all' ? faqData : faqData.filter(item => item.category === activeCategory);\r\n  const categories = [\r\n    { key: 'all', label: 'All Questions', icon: HelpCircle },\r\n    { key: 'general', label: 'Getting Started', icon: BookOpen },\r\n    { key: 'conversion', label: 'Conversion Process', icon: Play },\r\n    { key: 'technical', label: 'Technical Issues', icon: AlertCircle },\r\n    { key: 'account', label: 'Account & Limits', icon: Info }\r\n  ];\r\n  return (\r\n    <div className=\"min-h-screen px-4 sm:px-6 py-6 space-y-8\">\r\n      <header className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <button onClick={() => window.history.back()} aria-label=\"Go back\" className=\"p-2 rounded-full hover:bg-accent\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>\r\n          </button>\r\n          <h1 className=\"text-2xl font-bold\">Help & Support</h1>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        <div className=\"lg:col-span-1\">\r\n          <h3 className=\"text-lg font-semibold mb-4\">Categories</h3>\r\n          <div className=\"space-y-2\">\r\n            {categories.map((category) => {\r\n              const Icon = category.icon;\r\n              return (\r\n                <button key={category.key} onClick={() => setActiveCategory(category.key as any)} className={`w-full flex items-center gap-3 p-3 rounded-lg text-left transition-colors ${activeCategory===category.key ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'hover:bg-accent text-foreground'}`}>\r\n                  <Icon className=\"w-5 h-5\" />\r\n                  <span className=\"font-medium\">{category.label}</span>\r\n                </button>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"lg:col-span-2\">\r\n          <h3 className=\"text-lg font-semibold mb-4\">{activeCategory==='all' ? 'Frequently Asked Questions' : categories.find(c => c.key===activeCategory)?.label}</h3>\r\n          <div className=\"space-y-4\">\r\n            {filteredFAQ.map((item, index) => (\r\n              <div key={index} className=\"border rounded-lg overflow-hidden\">\r\n                <button onClick={() => toggleExpanded(index)} className=\"w-full p-4 text-left hover:bg-accent/40 transition-colors flex items-center justify-between\">\r\n                  <span className=\"font-medium\">{item.question}</span>\r\n                  {expandedItems.has(index) ? (\r\n                    <ChevronDown className=\"w-5 h-5\" />\r\n                  ) : (\r\n                    <ChevronRight className=\"w-5 h-5\" />\r\n                  )}\r\n                </button>\r\n                {expandedItems.has(index) && (\r\n                  <div className=\"px-4 pb-4 text-muted-foreground whitespace-pre-line\">{item.answer}</div>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <section className=\"p-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border\">\r\n        <h4 className=\"font-semibold mb-4 flex items-center\"><Play className=\"w-5 h-5 mr-2\"/>Quick Start Guide</h4>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n          <div>\r\n            <h5 className=\"font-medium flex items-center\"><FaSpotify className=\"w-4 h-4 mr-2\"/>Spotify to YouTube</h5>\r\n            <ol className=\"space-y-1 mt-2\"><li>1. Connect both accounts</li><li>2. Select Spotify playlist</li><li>3. Choose YouTube destination</li><li>4. Start conversion</li></ol>\r\n          </div>\r\n          <div>\r\n            <h5 className=\"font-medium flex items-center\"><Youtube className=\"w-4 h-4 mr-2\"/>YouTube to Spotify</h5>\r\n            <ol className=\"space-y-1 mt-2\"><li>1. Connect both accounts</li><li>2. Select YouTube playlist</li><li>3. Choose Spotify destination</li><li>4. Start conversion</li></ol>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}; ","import { db } from '../lib/firebase';\r\nimport { doc, updateDoc, getDoc, setDoc } from 'firebase/firestore';\r\n\r\nexport interface PaymentPlan {\r\n  id: string;\r\n  name: string;\r\n  price: number;\r\n  currency: string;\r\n  interval: 'month' | 'year';\r\n  features: string[];\r\n  stripePriceId: string;\r\n}\r\n\r\nexport interface Subscription {\r\n  id: string;\r\n  userId: string;\r\n  planId: string;\r\n  status: 'active' | 'canceled' | 'past_due' | 'unpaid';\r\n  currentPeriodStart: Date;\r\n  currentPeriodEnd: Date;\r\n  cancelAtPeriodEnd: boolean;\r\n  stripeSubscriptionId: string;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport class PaymentService {\r\n  private static instance: PaymentService;\r\n  private stripe: any = null;\r\n\r\n  public static getInstance(): PaymentService {\r\n    if (!PaymentService.instance) {\r\n      PaymentService.instance = new PaymentService();\r\n    }\r\n    return PaymentService.instance;\r\n  }\r\n\r\n  constructor() {\r\n    this.initializeStripe();\r\n  }\r\n\r\n  private async initializeStripe() {\r\n    try {\r\n      // Dynamically import Stripe to avoid SSR issues\r\n      const { loadStripe } = await import('@stripe/stripe-js');\r\n      const publishableKey = import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY;\r\n      \r\n      if (!publishableKey) {\r\n        console.warn('Stripe publishable key not found. Payment features will be disabled.');\r\n        return;\r\n      }\r\n      \r\n      this.stripe = await loadStripe(publishableKey);\r\n    } catch (error) {\r\n      console.error('Failed to initialize Stripe:', error);\r\n    }\r\n  }\r\n\r\n  // Get available payment plans\r\n  async getPaymentPlans(): Promise<PaymentPlan[]> {\r\n    return [\r\n      {\r\n        id: 'premium-monthly',\r\n        name: 'Premium Monthly',\r\n        price: 9.99,\r\n        currency: 'USD',\r\n        interval: 'month',\r\n        features: [\r\n          'Unlimited conversions',\r\n          'Advanced track matching',\r\n          'Priority support',\r\n          'No ads',\r\n          'Export unlimited data',\r\n          'Custom playlist names'\r\n        ],\r\n        stripePriceId: import.meta.env.VITE_STRIPE_PREMIUM_MONTHLY_PRICE_ID\r\n      },\r\n      {\r\n        id: 'premium-yearly',\r\n        name: 'Premium Yearly',\r\n        price: 99.99,\r\n        currency: 'USD',\r\n        interval: 'year',\r\n        features: [\r\n          'Unlimited conversions',\r\n          'Advanced track matching',\r\n          'Priority support',\r\n          'No ads',\r\n          'Export unlimited data',\r\n          'Custom playlist names',\r\n          '2 months free (save 20%)'\r\n        ],\r\n        stripePriceId: import.meta.env.VITE_STRIPE_PREMIUM_YEARLY_PRICE_ID\r\n      }\r\n    ];\r\n  }\r\n\r\n  // Create a checkout session\r\n  async createCheckoutSession(planId: string, userId: string): Promise<string> {\r\n    try {\r\n      const plans = await this.getPaymentPlans();\r\n      const plan = plans.find(p => p.id === planId);\r\n      \r\n      if (!plan) {\r\n        throw new Error('Invalid plan selected');\r\n      }\r\n\r\n      // Import the payment API\r\n      const { paymentAPI } = await import('../api/paymentApi');\r\n      \r\n      const response = await paymentAPI.createCheckoutSession({\r\n        planId,\r\n        userId,\r\n        stripePriceId: plan.stripePriceId,\r\n        successUrl: `${window.location.origin}/payment/success?session_id={CHECKOUT_SESSION_ID}`,\r\n        cancelUrl: `${window.location.origin}/payment/cancel`,\r\n      });\r\n\r\n      return response.sessionId;\r\n    } catch (error) {\r\n      console.error('Error creating checkout session:', error);\r\n      throw new Error('Failed to create checkout session');\r\n    }\r\n  }\r\n\r\n  // Redirect to Stripe checkout\r\n  async redirectToCheckout(sessionId: string): Promise<void> {\r\n    if (!this.stripe) {\r\n      throw new Error('Stripe not initialized');\r\n    }\r\n\r\n    const { error } = await this.stripe.redirectToCheckout({\r\n      sessionId,\r\n    });\r\n\r\n    if (error) {\r\n      throw new Error(error.message);\r\n    }\r\n  }\r\n\r\n  // Handle successful payment\r\n  async handlePaymentSuccess(sessionId: string, userId: string): Promise<void> {\r\n    try {\r\n      // Import the payment API\r\n      const { paymentAPI } = await import('../api/paymentApi');\r\n      \r\n      // Verify the session with your backend\r\n      const response = await paymentAPI.verifyPayment({\r\n        sessionId,\r\n        userId,\r\n      });\r\n\r\n      // Update user profile to premium\r\n      await this.updateUserToPremium(userId, response.subscription);\r\n    } catch (error) {\r\n      console.error('Error handling payment success:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Update user to premium status\r\n  private async updateUserToPremium(userId: string, subscription: any): Promise<void> {\r\n    try {\r\n      const userRef = doc(db, 'users', userId);\r\n      \r\n      // Update user profile\r\n      await updateDoc(userRef, {\r\n        'isPremium': true,\r\n        'premiumSince': new Date(),\r\n        'subscription': {\r\n          id: subscription.id,\r\n          status: subscription.status,\r\n          currentPeriodStart: new Date(subscription.current_period_start * 1000),\r\n          currentPeriodEnd: new Date(subscription.current_period_end * 1000),\r\n          cancelAtPeriodEnd: subscription.cancel_at_period_end,\r\n          stripeSubscriptionId: subscription.id,\r\n          createdAt: new Date(),\r\n          updatedAt: new Date()\r\n        },\r\n        'lastUpdated': new Date()\r\n      });\r\n\r\n      console.log('User upgraded to premium successfully');\r\n    } catch (error) {\r\n      console.error('Error updating user to premium:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Get user subscription\r\n  async getUserSubscription(userId: string): Promise<Subscription | null> {\r\n    try {\r\n      const userDoc = await getDoc(doc(db, 'users', userId));\r\n      \r\n      if (!userDoc.exists()) {\r\n        return null;\r\n      }\r\n\r\n      const userData = userDoc.data();\r\n      return userData.subscription || null;\r\n    } catch (error) {\r\n      console.error('Error getting user subscription:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Cancel subscription\r\n  async cancelSubscription(userId: string): Promise<void> {\r\n    try {\r\n      const subscription = await this.getUserSubscription(userId);\r\n      \r\n      if (!subscription) {\r\n        throw new Error('No active subscription found');\r\n      }\r\n\r\n      // Import the payment API\r\n      const { paymentAPI } = await import('../api/paymentApi');\r\n      \r\n      await paymentAPI.cancelSubscription(subscription.stripeSubscriptionId, userId);\r\n\r\n      // Update local subscription status\r\n      const userRef = doc(db, 'users', userId);\r\n      await updateDoc(userRef, {\r\n        'subscription.status': 'canceled',\r\n        'subscription.cancelAtPeriodEnd': true,\r\n        'subscription.updatedAt': new Date()\r\n      });\r\n\r\n      console.log('Subscription canceled successfully');\r\n    } catch (error) {\r\n      console.error('Error canceling subscription:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Reactivate subscription\r\n  async reactivateSubscription(userId: string): Promise<void> {\r\n    try {\r\n      const subscription = await this.getUserSubscription(userId);\r\n      \r\n      if (!subscription) {\r\n        throw new Error('No subscription found');\r\n      }\r\n\r\n      // Import the payment API\r\n      const { paymentAPI } = await import('../api/paymentApi');\r\n      \r\n      await paymentAPI.reactivateSubscription(subscription.stripeSubscriptionId, userId);\r\n\r\n      // Update local subscription status\r\n      const userRef = doc(db, 'users', userId);\r\n      await updateDoc(userRef, {\r\n        'subscription.status': 'active',\r\n        'subscription.cancelAtPeriodEnd': false,\r\n        'subscription.updatedAt': new Date()\r\n      });\r\n\r\n      console.log('Subscription reactivated successfully');\r\n    } catch (error) {\r\n      console.error('Error reactivating subscription:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Check if user has active premium\r\n  async hasActivePremium(userId: string): Promise<boolean> {\r\n    try {\r\n      const subscription = await this.getUserSubscription(userId);\r\n      \r\n      if (!subscription) {\r\n        return false;\r\n      }\r\n\r\n      return subscription.status === 'active' && !subscription.cancelAtPeriodEnd;\r\n    } catch (error) {\r\n      console.error('Error checking premium status:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Get subscription details for display\r\n  async getSubscriptionDetails(userId: string): Promise<{\r\n    isPremium: boolean;\r\n    planName: string;\r\n    nextBillingDate: Date | null;\r\n    cancelAtPeriodEnd: boolean;\r\n    status: string;\r\n  } | null> {\r\n    try {\r\n      const subscription = await this.getUserSubscription(userId);\r\n      \r\n      if (!subscription) {\r\n        return null;\r\n      }\r\n\r\n      return {\r\n        isPremium: subscription.status === 'active' && !subscription.cancelAtPeriodEnd,\r\n        planName: subscription.planId === 'premium-monthly' ? 'Premium Monthly' : 'Premium Yearly',\r\n        nextBillingDate: subscription.currentPeriodEnd,\r\n        cancelAtPeriodEnd: subscription.cancelAtPeriodEnd,\r\n        status: subscription.status\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting subscription details:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const paymentService = PaymentService.getInstance(); ","import React, { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { \r\n  X, \r\n  Crown, \r\n  Check, \r\n  Star,\r\n  Zap,\r\n  Shield,\r\n  Download,\r\n  Users,\r\n  Music,\r\n  ArrowRight,\r\n  AlertCircle,\r\n  Calendar,\r\n  CreditCard\r\n} from 'lucide-react';\r\nimport { useAuth } from '../../lib/AuthContext';\r\nimport { paymentService, PaymentPlan } from '../../services/paymentService';\r\n\r\ninterface PremiumModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void;\r\n}\r\n\r\nexport const PremiumModal: React.FC<PremiumModalProps> = ({ \r\n  isOpen, \r\n  onClose, \r\n  onShowToast \r\n}) => {\r\n  const { user } = useAuth();\r\n  const [plans, setPlans] = useState<PaymentPlan[]>([]);\r\n  const [selectedPlan, setSelectedPlan] = useState<string>('premium-monthly');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [subscriptionDetails, setSubscriptionDetails] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    const loadPlans = async () => {\r\n      if (!isOpen) return;\r\n      \r\n      setIsLoading(true);\r\n      try {\r\n        const availablePlans = await paymentService.getPaymentPlans();\r\n        setPlans(availablePlans);\r\n      } catch (error) {\r\n        console.error('Error loading plans:', error);\r\n        onShowToast?.('error', 'Failed to load payment plans');\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    const loadSubscriptionDetails = async () => {\r\n      if (!user?.uid || !isOpen) return;\r\n      \r\n      try {\r\n        const details = await paymentService.getSubscriptionDetails(user.uid);\r\n        setSubscriptionDetails(details);\r\n      } catch (error) {\r\n        console.error('Error loading subscription details:', error);\r\n      }\r\n    };\r\n\r\n    loadPlans();\r\n    loadSubscriptionDetails();\r\n  }, [isOpen, user?.uid, onShowToast]);\r\n\r\n  const handleUpgrade = async () => {\r\n    if (!user?.uid) return;\r\n    \r\n    setIsProcessing(true);\r\n    try {\r\n      // Create checkout session\r\n      const sessionId = await paymentService.createCheckoutSession(selectedPlan, user.uid);\r\n      \r\n      // Redirect to Stripe checkout\r\n      await paymentService.redirectToCheckout(sessionId);\r\n    } catch (error) {\r\n      console.error('Error starting checkout:', error);\r\n      onShowToast?.('error', 'Failed to start checkout process');\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleCancelSubscription = async () => {\r\n    if (!user?.uid) return;\r\n    \r\n    setIsProcessing(true);\r\n    try {\r\n      await paymentService.cancelSubscription(user.uid);\r\n      onShowToast?.('success', 'Subscription canceled successfully');\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error canceling subscription:', error);\r\n      onShowToast?.('error', 'Failed to cancel subscription');\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleReactivateSubscription = async () => {\r\n    if (!user?.uid) return;\r\n    \r\n    setIsProcessing(true);\r\n    try {\r\n      await paymentService.reactivateSubscription(user.uid);\r\n      onShowToast?.('success', 'Subscription reactivated successfully');\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error reactivating subscription:', error);\r\n      onShowToast?.('error', 'Failed to reactivate subscription');\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  const selectedPlanData = plans.find(plan => plan.id === selectedPlan);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0 }}\r\n          className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\r\n          onClick={onClose}\r\n        >\r\n          <motion.div\r\n            initial={{ scale: 0.9, opacity: 0, y: 20 }}\r\n            animate={{ scale: 1, opacity: 1, y: 0 }}\r\n            exit={{ scale: 0.9, opacity: 0, y: 20 }}\r\n            className=\"bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <div>\r\n                <h2 className=\"text-2xl font-bold text-gray-900 flex items-center\">\r\n                  <Crown className=\"w-6 h-6 mr-2 text-yellow-500\" />\r\n                  Upgrade to Premium\r\n                </h2>\r\n                <p className=\"text-gray-600 mt-1\">Unlock unlimited conversions and advanced features</p>\r\n              </div>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\r\n              >\r\n                <X className=\"w-5 h-5 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Current Subscription Status */}\r\n            {subscriptionDetails && (\r\n              <div className=\"mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200\">\r\n                <h3 className=\"font-semibold text-gray-900 mb-2\">Current Subscription</h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm\">\r\n                  <div>\r\n                    <span className=\"text-gray-600\">Plan:</span>\r\n                    <span className=\"ml-2 font-medium\">{subscriptionDetails.planName}</span>\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-600\">Status:</span>\r\n                    <span className={`ml-2 font-medium ${\r\n                      subscriptionDetails.isPremium ? 'text-green-600' : 'text-red-600'\r\n                    }`}>\r\n                      {subscriptionDetails.status}\r\n                    </span>\r\n                  </div>\r\n                  {subscriptionDetails.nextBillingDate && (\r\n                    <div>\r\n                      <span className=\"text-gray-600\">Next billing:</span>\r\n                      <span className=\"ml-2 font-medium\">\r\n                        {new Date(subscriptionDetails.nextBillingDate).toLocaleDateString()}\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                \r\n                {subscriptionDetails.cancelAtPeriodEnd && (\r\n                  <div className=\"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg\">\r\n                    <div className=\"flex items-center\">\r\n                      <AlertCircle className=\"w-4 h-4 text-yellow-600 mr-2\" />\r\n                      <span className=\"text-sm text-yellow-800\">\r\n                        Your subscription will end on {new Date(subscriptionDetails.nextBillingDate).toLocaleDateString()}\r\n                      </span>\r\n                    </div>\r\n                    <button\r\n                      onClick={handleReactivateSubscription}\r\n                      disabled={isProcessing}\r\n                      className=\"mt-2 text-sm text-blue-600 hover:text-blue-800 font-medium\"\r\n                    >\r\n                      Reactivate Subscription\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* Payment Plans */}\r\n            <div className=\"mb-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Choose Your Plan</h3>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {plans.map((plan) => (\r\n                  <motion.div\r\n                    key={plan.id}\r\n                    onClick={() => setSelectedPlan(plan.id)}\r\n                    className={`p-6 rounded-xl border-2 cursor-pointer transition-all ${\r\n                      selectedPlan === plan.id\r\n                        ? 'border-blue-500 bg-blue-50'\r\n                        : 'border-gray-200 hover:border-gray-300'\r\n                    }`}\r\n                    whileHover={{ scale: 1.02 }}\r\n                    whileTap={{ scale: 0.98 }}\r\n                  >\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                      <h4 className=\"text-lg font-semibold text-gray-900\">{plan.name}</h4>\r\n                      <div className=\"text-right\">\r\n                        <div className=\"text-2xl font-bold text-gray-900\">\r\n                          ${plan.price}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-600\">\r\n                          per {plan.interval}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"space-y-2 mb-4\">\r\n                      {plan.features.map((feature, index) => (\r\n                        <div key={index} className=\"flex items-center text-sm\">\r\n                          <Check className=\"w-4 h-4 text-green-500 mr-2\" />\r\n                          <span className=\"text-gray-700\">{feature}</span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    \r\n                    {plan.id === 'premium-yearly' && (\r\n                      <div className=\"mb-4 p-2 bg-green-100 border border-green-200 rounded-lg\">\r\n                        <div className=\"flex items-center text-sm text-green-800\">\r\n                          <Star className=\"w-4 h-4 mr-1\" />\r\n                          Save 20% with yearly billing\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </motion.div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Premium Features */}\r\n            <div className=\"mb-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Premium Features</h3>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                <div className=\"p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg border border-purple-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <Zap className=\"w-5 h-5 text-purple-600 mr-2\" />\r\n                    <span className=\"font-semibold text-gray-900\">Unlimited Conversions</span>\r\n                  </div>\r\n                  <p className=\"text-sm text-gray-600\">Convert as many playlists as you want</p>\r\n                </div>\r\n                \r\n                <div className=\"p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border border-blue-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <Music className=\"w-5 h-5 text-blue-600 mr-2\" />\r\n                    <span className=\"font-semibold text-gray-900\">Advanced Matching</span>\r\n                  </div>\r\n                  <p className=\"text-sm text-gray-600\">Better track matching algorithms</p>\r\n                </div>\r\n                \r\n                <div className=\"p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border border-green-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <Shield className=\"w-5 h-5 text-green-600 mr-2\" />\r\n                    <span className=\"font-semibold text-gray-900\">Priority Support</span>\r\n                  </div>\r\n                  <p className=\"text-sm text-gray-600\">Get help faster with priority support</p>\r\n                </div>\r\n                \r\n                <div className=\"p-4 bg-gradient-to-br from-orange-50 to-red-50 rounded-lg border border-orange-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <Download className=\"w-5 h-5 text-orange-600 mr-2\" />\r\n                    <span className=\"font-semibold text-gray-900\">Unlimited Exports</span>\r\n                  </div>\r\n                  <p className=\"text-sm text-gray-600\">Export unlimited data and reports</p>\r\n                </div>\r\n                \r\n                <div className=\"p-4 bg-gradient-to-br from-yellow-50 to-amber-50 rounded-lg border border-yellow-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <Users className=\"w-5 h-5 text-yellow-600 mr-2\" />\r\n                    <span className=\"font-semibold text-gray-900\">Custom Names</span>\r\n                  </div>\r\n                  <p className=\"text-sm text-gray-600\">Customize playlist names during conversion</p>\r\n                </div>\r\n                \r\n                <div className=\"p-4 bg-gradient-to-br from-pink-50 to-rose-50 rounded-lg border border-pink-200\">\r\n                  <div className=\"flex items-center mb-2\">\r\n                    <Crown className=\"w-5 h-5 text-pink-600 mr-2\" />\r\n                    <span className=\"font-semibold text-gray-900\">No Ads</span>\r\n                  </div>\r\n                  <p className=\"text-sm text-gray-600\">Enjoy an ad-free experience</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"flex space-x-3\">\r\n              <button\r\n                onClick={onClose}\r\n                disabled={isProcessing}\r\n                className=\"flex-1 bg-gray-100 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-200 transition-colors disabled:opacity-50\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              \r\n              {subscriptionDetails?.isPremium ? (\r\n                <button\r\n                  onClick={handleCancelSubscription}\r\n                  disabled={isProcessing}\r\n                  className=\"flex-1 bg-red-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-red-600 transition-colors disabled:opacity-50 flex items-center justify-center space-x-2\"\r\n                >\r\n                  {isProcessing ? (\r\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                  ) : (\r\n                    <Calendar className=\"w-4 h-4\" />\r\n                  )}\r\n                  <span>{isProcessing ? 'Processing...' : 'Cancel Subscription'}</span>\r\n                </button>\r\n              ) : (\r\n                <button\r\n                  onClick={handleUpgrade}\r\n                  disabled={isProcessing || isLoading}\r\n                  className=\"flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 px-4 rounded-lg font-medium hover:from-blue-600 hover:to-purple-600 transition-all disabled:opacity-50 flex items-center justify-center space-x-2\"\r\n                >\r\n                  {isProcessing ? (\r\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                  ) : (\r\n                    <CreditCard className=\"w-4 h-4\" />\r\n                  )}\r\n                  <span>\r\n                    {isProcessing ? 'Processing...' : `Upgrade to ${selectedPlanData?.name || 'Premium'}`}\r\n                  </span>\r\n                  {!isProcessing && <ArrowRight className=\"w-4 h-4\" />}\r\n                </button>\r\n              )}\r\n            </div>\r\n\r\n            {/* Security Notice */}\r\n            <div className=\"mt-6 p-4 bg-gray-50 rounded-lg\">\r\n              <div className=\"flex items-start\">\r\n                <Shield className=\"w-5 h-5 text-gray-500 mr-3 mt-0.5\" />\r\n                <div className=\"text-sm text-gray-600\">\r\n                  <p className=\"font-medium mb-1\">Secure Payment Processing</p>\r\n                  <p>Your payment information is securely processed by Stripe. We never store your credit card details.</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}; \r\n\r\nexport const PremiumPage: React.FC<{ onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void }> = ({ onShowToast }) => {\r\n  const { user } = useAuth();\r\n  const [plans, setPlans] = useState<PaymentPlan[]>([]);\r\n  const [selectedPlan, setSelectedPlan] = useState<string>('premium-monthly');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [subscriptionDetails, setSubscriptionDetails] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      try {\r\n        const availablePlans = await paymentService.getPaymentPlans();\r\n        setPlans(availablePlans);\r\n        if (user?.uid) {\r\n          const details = await paymentService.getSubscriptionDetails(user.uid);\r\n          setSubscriptionDetails(details);\r\n        }\r\n      } catch (e) {\r\n        console.error('PremiumPage load error:', e);\r\n        onShowToast?.('error', 'Failed to load premium data');\r\n      }\r\n    };\r\n    load();\r\n  }, [user?.uid, onShowToast]);\r\n\r\n  const handleUpgrade = async () => {\r\n    if (!user?.uid) return;\r\n    setIsProcessing(true);\r\n    try {\r\n      const sessionId = await paymentService.createCheckoutSession(selectedPlan, user.uid);\r\n      await paymentService.redirectToCheckout(sessionId);\r\n    } catch (e) {\r\n      console.error('upgrade error:', e);\r\n      onShowToast?.('error', 'Failed to start checkout');\r\n    } finally { setIsProcessing(false); }\r\n  };\r\n\r\n  const handleCancelSubscription = async () => {\r\n    if (!user?.uid) return;\r\n    setIsProcessing(true);\r\n    try {\r\n      await paymentService.cancelSubscription(user.uid);\r\n      onShowToast?.('success', 'Subscription canceled');\r\n      window.history.back();\r\n    } catch (e) {\r\n      console.error('cancel error:', e);\r\n      onShowToast?.('error', 'Failed to cancel subscription');\r\n    } finally { setIsProcessing(false); }\r\n  };\r\n\r\n  const handleReactivateSubscription = async () => {\r\n    if (!user?.uid) return;\r\n    setIsProcessing(true);\r\n    try {\r\n      await paymentService.reactivateSubscription(user.uid);\r\n      onShowToast?.('success', 'Subscription reactivated');\r\n    } catch (e) {\r\n      console.error('reactivate error:', e);\r\n      onShowToast?.('error', 'Failed to reactivate');\r\n    } finally { setIsProcessing(false); }\r\n  };\r\n\r\n  const selectedPlanData = plans.find(p => p.id === selectedPlan);\r\n\r\n  return (\r\n    <div className=\"min-h-screen px-4 sm:px-6 py-6 space-y-8\">\r\n      <header className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <button onClick={() => window.history.back()} aria-label=\"Go back\" className=\"p-2 rounded-full hover:bg-accent\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>\r\n          </button>\r\n          <h1 className=\"text-2xl font-bold flex items-center\"><Crown className=\"w-6 h-6 mr-2 text-yellow-500\"/>Premium</h1>\r\n        </div>\r\n        {subscriptionDetails?.isPremium ? (\r\n          <button onClick={handleCancelSubscription} disabled={isProcessing} className=\"bg-red-500 text-white py-2 px-4 rounded-lg font-medium disabled:opacity-50\">{isProcessing ? 'Processing…' : 'Cancel'}</button>\r\n        ) : (\r\n          <button onClick={handleUpgrade} disabled={isProcessing||isLoading} className=\"bg-gradient-to-r from-blue-500 to-purple-500 text-white py-2 px-4 rounded-lg font-medium disabled:opacity-50\">{isProcessing ? 'Processing…' : 'Upgrade'}</button>\r\n        )}\r\n      </header>\r\n\r\n      {subscriptionDetails && (\r\n        <div className=\"p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200\">\r\n          <h3 className=\"font-semibold mb-2\">Current Subscription</h3>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm\">\r\n            <div><span className=\"text-muted-foreground\">Plan:</span><span className=\"ml-2 font-medium\">{subscriptionDetails.planName}</span></div>\r\n            <div><span className=\"text-muted-foreground\">Status:</span><span className={`ml-2 font-medium ${subscriptionDetails.isPremium ? 'text-green-600' : 'text-red-600'}`}>{subscriptionDetails.status}</span></div>\r\n            {subscriptionDetails.nextBillingDate && (<div><span className=\"text-muted-foreground\">Next billing:</span><span className=\"ml-2 font-medium\">{new Date(subscriptionDetails.nextBillingDate).toLocaleDateString()}</span></div>)}\r\n          </div>\r\n          {subscriptionDetails.cancelAtPeriodEnd && (\r\n            <div className=\"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm\">\r\n              Your subscription will end on {new Date(subscriptionDetails.nextBillingDate).toLocaleDateString()}\r\n              <button onClick={handleReactivateSubscription} className=\"ml-2 text-blue-600 hover:text-blue-800 font-medium\">Reactivate</button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <section className=\"space-y-4\">\r\n        <h2 className=\"text-lg font-semibold\">Choose Your Plan</h2>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          {plans.map((plan) => (\r\n            <button key={plan.id} onClick={() => setSelectedPlan(plan.id)} className={`text-left p-6 rounded-xl border-2 transition-all ${selectedPlan===plan.id ? 'border-blue-500 bg-blue-50' : 'border-border hover:border-gray-300'}`}>\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h4 className=\"text-lg font-semibold\">{plan.name}</h4>\r\n                <div className=\"text-right\">\r\n                  <div className=\"text-2xl font-bold\">${plan.price}</div>\r\n                  <div className=\"text-sm text-muted-foreground\">per {plan.interval}</div>\r\n                </div>\r\n              </div>\r\n              <div className=\"space-y-2 text-sm\">\r\n                {plan.features.map((feature, i) => (\r\n                  <div key={i} className=\"flex items-center\"><Check className=\"w-4 h-4 text-green-500 mr-2\"/><span>{feature}</span></div>\r\n                ))}\r\n              </div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </section>\r\n\r\n      <section className=\"space-y-4\">\r\n        <h2 className=\"text-lg font-semibold\">Premium Features</h2>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          <div className=\"p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg border border-purple-200\"><div className=\"flex items-center mb-2\"><Zap className=\"w-5 h-5 mr-2\"/><span className=\"font-semibold\">Unlimited Conversions</span></div><p className=\"text-sm text-muted-foreground\">Convert as many playlists as you want</p></div>\r\n          <div className=\"p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border border-blue-200\"><div className=\"flex items-center mb-2\"><Music className=\"w-5 h-5 mr-2\"/><span className=\"font-semibold\">Advanced Matching</span></div><p className=\"text-sm text-muted-foreground\">Better track matching algorithms</p></div>\r\n          <div className=\"p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border border-green-200\"><div className=\"flex items-center mb-2\"><Shield className=\"w-5 h-5 mr-2\"/><span className=\"font-semibold\">Priority Support</span></div><p className=\"text-sm text-muted-foreground\">Get help faster with priority support</p></div>\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}; ","import React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { \n  User, \n  Music, \n  CheckCircle, \n  Crown, \n  Settings, \n  Camera, \n  Edit3, \n  Link as LinkIcon, \n  HelpCircle, \n  LogOut, \n  Plus, \n  History,\n  ArrowRight,\n  Check,\n  Youtube,\n  Trophy,\n  Star,\n  Calendar,\n  Mail,\n  Shield,\n  Download,\n  Share2,\n  Bell,\n  Palette,\n  Eye,\n  EyeOff,\n  Trash2,\n  Award,\n  TrendingUp,\n  Clock,\n  Target,\n  Zap\n} from 'lucide-react';\nimport { FaSpotify } from 'react-icons/fa';\nimport { useAuth } from '../../lib/AuthContext';\nimport { cn } from '../../lib/utils';\nimport { EditProfileModal } from '../modals/EditProfileModal';\nimport { SettingsModal } from '../modals/SettingsModal';\nimport { HelpModal } from '../modals/HelpModal';\nimport { PremiumModal } from '../modals/PremiumModal';\nimport { useNavigate } from 'react-router-dom';\nimport useMobileDetection from '../../hooks/useMobileDetection';\nimport { profileService, UserStats, UserProfile } from '../../services/profileService';\n\ninterface ProfileTabProps {\n  onShowToast?: (type: 'success' | 'error' | 'warning' | 'info', message: string) => void;\n  setActiveTab?: (tab: 'connections' | 'converter' | 'history' | 'profile') => void;\n}\n\nexport const ProfileTab: React.FC<ProfileTabProps> = ({ onShowToast, setActiveTab }) => {\n  const { user, signOut } = useAuth();\n  const [showEditProfile, setShowEditProfile] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [showHelp, setShowHelp] = useState(false);\n  const [showPremium, setShowPremium] = useState(false);\n  const [userStats, setUserStats] = useState<UserStats | null>(null);\n  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);\n  const [isUploadingImage, setIsUploadingImage] = useState(false);\n  const [headerPhoto, setHeaderPhoto] = useState<string>('/images/default-avatar.svg');\n  const navigate = useNavigate();\n  const { isMobile } = useMobileDetection();\n\n\n\n  useEffect(() => {\n    const loadUserData = async () => {\n      if (!user?.uid) {\n        console.log('[ProfileTab] No user UID available, skipping data load');\n        return;\n      }\n      \n      console.log('[ProfileTab] Starting to load user data for:', user.uid);\n      \n      try {\n        const [stats, profile] = await Promise.all([\n          profileService.getUserStats(user.uid),\n          profileService.getUserProfile(user.uid)\n        ]);\n        \n        setUserStats(stats);\n        setUserProfile(profile);\n      } catch (error) {\n        console.error('Error loading user data:', error);\n        onShowToast?.('error', 'Failed to load user data');\n        \n        // Set default values if loading fails\n        setUserStats({\n          conversions: 0,\n          tracks: 0,\n          monthlyUsage: 0,\n          monthlyLimit: 50,\n          platformUsage: {\n            spotify: 0,\n            youtube: 0,\n            soundcloud: 0\n          },\n          successRate: 0,\n          totalPlaylists: 0\n        });\n        \n        setUserProfile({\n          id: user.uid,\n          displayName: user.displayName || 'User',\n          email: user.email || '',\n          photoURL: user.photoURL || undefined,\n          isPremium: false,\n          createdAt: new Date(user.metadata.creationTime || Date.now()),\n          lastActive: new Date()\n        });\n      }\n    };\n\n    loadUserData();\n  }, [user?.uid, onShowToast]);\n\n  useEffect(() => {\n    const src = userProfile?.photoURL || user?.photoURL || '/images/default-avatar.svg';\n    setHeaderPhoto(src);\n  }, [userProfile?.photoURL, user?.photoURL]);\n\n  const handleSignOut = () => {\n    signOut();\n    onShowToast?.('success', 'Signed out successfully');\n  };\n\n  const handleNewConversion = () => {\n    setActiveTab?.('converter');\n    onShowToast?.('info', 'Starting new conversion...');\n  };\n\n  const handleViewHistory = () => {\n    setActiveTab?.('history');\n    onShowToast?.('info', 'Opening conversion history...');\n  };\n  \n  const openSettings = () => {\n    if (isMobile) {\n      navigate('/preferences');\n    } else {\n      setShowSettings(true);\n    }\n  };\n\n  const handleEditProfile = () => {\n    if (isMobile) {\n      navigate('/profile/edit');\n    } else {\n      setShowEditProfile(true);\n    }\n  };\n\n  const handleManageConnections = () => {\n    setActiveTab?.('connections');\n    onShowToast?.('info', 'Opening connection management...');\n  };\n\n  const handlePremiumFeatures = () => {\n    if (isMobile) {\n      navigate('/premium');\n    } else {\n      setShowPremium(true);\n    }\n  };\n\n  const handleHelpSupport = () => {\n    if (isMobile) {\n      navigate('/help');\n    } else {\n      setShowHelp(true);\n    }\n  };\n\n  const handleUpgradePremium = () => {\n    setShowPremium(true);\n  };\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setIsUploadingImage(true);\n    try {\n      const url = await profileService.uploadProfileImage(user?.uid || '', file);\n      if (url) {\n        setUserProfile(prev => prev ? { ...prev, photoURL: url } : null);\n        onShowToast?.('success', 'Profile image updated successfully!');\n      } else {\n        onShowToast?.('error', 'Failed to update profile image.');\n      }\n    } catch (error) {\n      console.error('Error uploading image:', error);\n      onShowToast?.('error', 'Failed to update profile image.');\n    } finally {\n      setIsUploadingImage(false);\n    }\n  };\n\n  return (\n    <div className=\"h-full overflow-y-auto pb-[calc(5rem+env(safe-area-inset-bottom))]\">\n      {/* Profile Header Card - Medium Premium Size */}\n      <div className=\"px-4 sm:px-6 pt-6 pb-4 space-y-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"relative overflow-hidden rounded-2xl bg-gradient-to-br from-[#FF7A59] via-[#FF007A] to-[#00C4CC] p-8 text-white shadow-xl\"\n        >\n          {/* Decorative Elements */}\n          <div className=\"absolute inset-0 bg-black/10\"></div>\n          <div className=\"absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full -translate-y-10 translate-x-10\"></div>\n          <div className=\"absolute bottom-0 left-0 w-16 h-16 bg-white/10 rounded-full translate-y-8 -translate-x-8\"></div>\n          \n          {/* Profile Content - Medium Size */}\n          <div className=\"relative z-10\">\n            {/* Removed floating edit button to avoid overlap */}\n\n            {/* Profile Information - Medium Layout */}\n            <div className=\"flex items-center space-x-4 mb-6\">\n              {/* User Avatar - Medium Size */}\n              <div className=\"relative\">\n                <div className=\"w-24 h-24 bg-white/20 rounded-full flex items-center justify-center shadow-2xl overflow-hidden border-2 border-white/10\">\n                  <img\n                    src={headerPhoto}\n                    alt=\"Profile\"\n                    className=\"w-24 h-24 rounded-full object-cover\"\n                    loading=\"lazy\"\n                    onError={(e) => {\n                      if (!e.currentTarget.src.includes('/images/default-avatar.svg')) {\n                        setHeaderPhoto('/images/default-avatar.svg');\n                      }\n                    }}\n                  />\n                </div>\n                <button \n                  onClick={() => document.getElementById('profile-image-input')?.click()}\n                  className=\"absolute -bottom-2 -right-2 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center shadow-lg hover:bg-blue-600 transition-colors\"\n                >\n                  <Camera className=\"w-4 h-4 text-white\" />\n                </button>\n                <input\n                  id=\"profile-image-input\"\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleImageUpload}\n                  className=\"hidden\"\n                  disabled={isUploadingImage}\n                />\n              </div>\n\n              {/* User Info - Medium Typography */}\n              <div className=\"text-white\">\n                <h2 className=\"text-2xl font-bold mb-2\">\n                  {userProfile?.displayName || user?.displayName || 'User'}\n                </h2>\n                <div className=\"flex items-center space-x-2 mb-1\">\n                  <Crown className=\"w-4 h-4 text-yellow-400\" />\n                  <span className=\"text-white/90 text-sm font-medium\">\n                    {userProfile?.isPremium ? 'Premium Member' : 'Free User'}\n                  </span>\n                </div>\n                {userProfile?.isPremium && (\n                  <div className=\"flex items-center space-x-2\">\n                    <Crown className=\"w-3 h-3 text-yellow-400\" />\n                    <span className=\"text-white/80 text-xs\">Premium Features Active</span>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Statistics Cards - Grid Layout */}\n            <div className=\"grid grid-cols-2 gap-4 sm:gap-6\">\n              {/* Left Card - Conversions */}\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.1 }}\n                className=\"bg-white/20 backdrop-blur-sm rounded-xl p-4 sm:p-5 border border-white/30\"\n              >\n                <div className=\"flex items-center gap-2 mb-3 min-w-0\">\n                  <div className=\"w-7 h-7 sm:w-8 sm:h-8 bg-white/20 rounded-lg flex items-center justify-center shrink-0\">\n                    <Music className=\"w-4 h-4 text-white\" />\n                  </div>\n                  <span className=\"text-white text-xs sm:text-sm font-medium tracking-tight leading-none whitespace-nowrap\">Conversions</span>\n                </div>\n                <div className=\"text-2xl font-bold text-white\">\n                  {userStats?.conversions || 0}\n                </div>\n                <div className=\"text-xs text-white/60\">Total Playlists</div>\n              </motion.div>\n\n              {/* Right Card - Tracks */}\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.2 }}\n                className=\"bg-white/20 backdrop-blur-sm rounded-xl p-4 sm:p-5 border border-white/30\"\n              >\n                <div className=\"flex items-center gap-2 mb-3 min-w-0\">\n                  <div className=\"w-7 h-7 sm:w-8 sm:h-8 bg-white/20 rounded-lg flex items-center justify-center shrink-0\">\n                    <CheckCircle className=\"w-4 h-4 text-white\" />\n                  </div>\n                  <span className=\"text-white text-xs sm:text-sm font-medium tracking-tight leading-none whitespace-nowrap\">Tracks</span>\n                </div>\n                <div className=\"text-2xl font-bold text-white\">\n                  {userStats?.tracks || 0}\n                </div>\n                <div className=\"text-xs text-white/60\">Successfully Converted</div>\n              </motion.div>\n            </div>\n          </div>\n        </motion.div>\n      </div>\n\n      {/* Usage Analytics - Medium Size */}\n      <div className=\"px-4 sm:px-6 mb-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3 }}\n          className=\"bg-card rounded-xl p-6 border border-border shadow-lg\"\n        >\n          <h3 className=\"text-lg font-bold text-foreground mb-4\">Usage Analytics</h3>\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-muted-foreground text-sm\">This Month</span>\n              <span className=\"text-foreground font-semibold text-sm\">\n                {userStats?.monthlyUsage || 0}/{userStats?.monthlyLimit || 50}\n              </span>\n            </div>\n            <div className=\"w-full bg-muted rounded-full h-2\">\n              <div \n                className=\"bg-blue-500 h-2 rounded-full\" \n                style={{ \n                  width: `${userStats ? (userStats.monthlyUsage / userStats.monthlyLimit) * 100 : 0}%` \n                }}\n              ></div>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              {userStats ? userStats.monthlyLimit - userStats.monthlyUsage : 50} conversions remaining\n            </p>\n          </div>\n        </motion.div>\n      </div>\n\n\n\n\n      {/* Enhanced User Information */}\n      <div className=\"px-4 sm:px-6 mb-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.4 }}\n          className=\"bg-card rounded-xl p-6 border border-border shadow-lg\"\n        >\n          <h3 className=\"text-lg font-bold text-foreground mb-4\">Account Information</h3>\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <Mail className=\"w-4 h-4 text-muted-foreground\" />\n                <span className=\"text-sm text-muted-foreground\">Email</span>\n              </div>\n              <span className=\"text-sm text-foreground font-medium\">\n                {userProfile?.email || user?.email || 'Not available'}\n              </span>\n            </div>\n            \n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n                <span className=\"text-sm text-muted-foreground\">Member Since</span>\n              </div>\n              <span className=\"text-sm text-foreground font-medium\">\n                {userProfile?.createdAt ? new Date(userProfile.createdAt).toLocaleDateString() : 'Unknown'}\n              </span>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <Clock className=\"w-4 h-4 text-muted-foreground\" />\n                <span className=\"text-sm text-muted-foreground\">Last Active</span>\n              </div>\n              <span className=\"text-sm text-foreground font-medium\">\n                {userProfile?.lastActive ? new Date(userProfile.lastActive).toLocaleDateString() : 'Today'}\n              </span>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <Shield className=\"w-4 h-4 text-muted-foreground\" />\n                <span className=\"text-sm text-muted-foreground\">Account Status</span>\n              </div>\n              <span className=\"text-sm text-foreground font-medium\">\n                {userProfile?.isPremium ? 'Premium' : 'Free'}\n              </span>\n            </div>\n          </div>\n        </motion.div>\n      </div>\n\n      {/* Platform Usage - Medium Size */}\n      <div className=\"px-4 sm:px-6 mb-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.4 }}\n          className=\"bg-green-50 dark:bg-green-950/20 rounded-xl p-6 border border-green-200 dark:border-green-800 shadow-lg\"\n        >\n          <h3 className=\"text-lg font-bold text-foreground mb-4\">Platform Usage</h3>\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <FaSpotify className=\"w-5 h-5 text-green-500\" />\n                <span className=\"text-foreground font-medium text-sm\">Spotify</span>\n              </div>\n              <span className=\"text-muted-foreground text-sm\">\n                {userStats?.platformUsage?.spotify || 20} conversions\n              </span>\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <Youtube className=\"w-5 h-5 text-red-500\" />\n                <span className=\"text-foreground font-medium text-sm\">YouTube</span>\n              </div>\n              <span className=\"text-muted-foreground text-sm\">\n                {userStats?.platformUsage?.youtube || 20} conversions\n              </span>\n            </div>\n          </div>\n        </motion.div>\n      </div>\n\n      {/* Quick Actions - Premium Styling */}\n      <div className=\"px-4 sm:px-6 mb-8\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3 }}\n        >\n          <h3 className=\"text-xl font-bold text-foreground mb-8\">Quick Actions</h3>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n            <motion.button\n              onClick={handleNewConversion}\n              className=\"bg-gradient-to-br from-red-500 via-pink-500 to-purple-600 text-white py-8 px-8 rounded-2xl font-semibold flex flex-col items-center justify-center space-y-4 shadow-2xl hover:shadow-3xl transition-all duration-300 backdrop-blur-sm border border-white/10\"\n              whileHover={{ \n                scale: 1.05,\n                boxShadow: \"0 25px 50px -12px rgba(239, 68, 68, 0.4)\"\n              }}\n              whileTap={{ scale: 0.98 }}\n            >\n              <div className=\"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm\">\n                <Plus className=\"w-8 h-8 text-white\" />\n              </div>\n              <span className=\"text-white text-lg font-semibold\">New Conversion</span>\n            </motion.button>\n            \n            <motion.button\n              onClick={handleViewHistory}\n              className=\"bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 text-white py-8 px-8 rounded-2xl font-semibold flex flex-col items-center justify-center space-y-4 shadow-2xl hover:shadow-3xl transition-all duration-300 backdrop-blur-sm border border-white/10\"\n              whileHover={{ \n                scale: 1.05,\n                boxShadow: \"0 25px 50px -12px rgba(59, 130, 246, 0.4)\"\n              }}\n              whileTap={{ scale: 0.98 }}\n            >\n              <div className=\"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm\">\n                <History className=\"w-8 h-8 text-white\" />\n              </div>\n              <span className=\"text-white text-lg font-semibold\">View History</span>\n            </motion.button>\n          </div>\n        </motion.div>\n      </div>\n\n      {/* Account Settings - Medium Size */}\n      <div className=\"px-4 sm:px-6 mb-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.5 }}\n          className=\"space-y-4\"\n        >\n          <h3 className=\"text-lg font-bold text-foreground\">Account Settings</h3>\n          \n          <motion.button\n            onClick={handleEditProfile}\n            className=\"w-full bg-card rounded-xl p-5 flex items-center justify-between border border-border hover:bg-accent/50 transition-colors shadow-lg\"\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center\">\n                <Edit3 className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"font-semibold text-foreground text-sm\">Edit Profile</p>\n                <p className=\"text-xs text-muted-foreground\">Update your information</p>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-muted-foreground\" />\n          </motion.button>\n\n          <motion.button\n            onClick={handleManageConnections}\n            className=\"w-full bg-card rounded-xl p-5 flex items-center justify-between border border-border hover:bg-accent/50 transition-colors shadow-lg\"\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center\">\n                <LinkIcon className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"font-semibold text-foreground text-sm\">Manage Connections</p>\n                <p className=\"text-xs text-muted-foreground\">Spotify & YouTube accounts</p>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-muted-foreground\" />\n          </motion.button>\n\n          <motion.button\n            onClick={handlePremiumFeatures}\n            className=\"w-full bg-card rounded-xl p-5 flex items-center justify-between border border-border hover:bg-accent/50 transition-colors shadow-lg\"\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center\">\n                <Crown className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"font-semibold text-foreground text-sm\">Premium Features</p>\n                <p className=\"text-xs text-muted-foreground\">Unlock advanced features</p>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-muted-foreground\" />\n          </motion.button>\n\n          <motion.button\n            onClick={handleHelpSupport}\n            className=\"w-full bg-card rounded-xl p-5 flex items-center justify-between border border-border hover:bg-accent/50 transition-colors shadow-lg\"\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center\">\n                <HelpCircle className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"font-semibold text-foreground text-sm\">Help & Support</p>\n                <p className=\"text-xs text-muted-foreground\">Get help and contact us</p>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-muted-foreground\" />\n          </motion.button>\n        </motion.div>\n      </div>\n\n      {/* Preferences (single entry) */}\n      <div className=\"px-4 sm:px-6 mb-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.6 }}\n          className=\"space-y-4\"\n        >\n          <h3 className=\"text-lg font-bold text-foreground\">Preferences</h3>\n          <motion.button\n            onClick={openSettings}\n            className=\"w-full bg-card rounded-xl p-5 flex items-center justify-between border border-border hover:bg-accent/50 transition-colors shadow-lg\"\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center\">\n                <Palette className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"font-semibold text-foreground text-sm\">Open Preferences</p>\n                <p className=\"text-xs text-muted-foreground\">Theme, notifications, privacy, export</p>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-muted-foreground\" />\n          </motion.button>\n        </motion.div>\n      </div>\n\n      {/* Account Actions */}\n      <div className=\"px-4 sm:px-6 mb-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.7 }}\n          className=\"space-y-4\"\n        >\n          <h3 className=\"text-lg font-bold text-foreground\">Account Actions</h3>\n          \n          <motion.button\n            onClick={() => onShowToast?.('warning', 'Account deletion is permanent. Contact support for assistance.')}\n            className=\"w-full bg-red-50 dark:bg-red-950/20 rounded-xl p-5 flex items-center justify-between border border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-950/40 transition-colors shadow-lg\"\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center\">\n                <Trash2 className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"font-semibold text-red-700 dark:text-red-400 text-sm\">Delete Account</p>\n                <p className=\"text-xs text-red-600 dark:text-red-500\">Permanently remove your account</p>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-red-500\" />\n          </motion.button>\n\n          <motion.button\n            onClick={handleSignOut}\n            className=\"w-full bg-card rounded-xl p-5 flex items-center justify-between border border-border hover:bg-accent/50 transition-colors shadow-lg\"\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-10 h-10 bg-gray-500 rounded-lg flex items-center justify-center\">\n                <LogOut className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"text-left\">\n                <p className=\"font-semibold text-foreground text-sm\">Sign Out</p>\n                <p className=\"text-xs text-muted-foreground\">Log out of your account</p>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-muted-foreground\" />\n          </motion.button>\n        </motion.div>\n      </div>\n\n      {/* Premium Features Promotion - Medium Size */}\n      <div className=\"px-4 sm:px-6 mb-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.6 }}\n          className=\"bg-yellow-50 dark:bg-yellow-950/20 rounded-xl p-6 border border-yellow-200 dark:border-yellow-800 shadow-lg\"\n        >\n          <div className=\"flex items-center space-x-3 mb-4\">\n            <Crown className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" />\n            <h3 className=\"text-lg font-bold text-foreground\">Premium Features</h3>\n          </div>\n          \n          <div className=\"space-y-2 mb-4\">\n            <div className=\"flex items-center space-x-2\">\n              <Check className=\"w-4 h-4 text-green-500\" />\n              <span className=\"text-muted-foreground text-sm\">Unlimited conversions</span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Check className=\"w-4 h-4 text-green-500\" />\n              <span className=\"text-muted-foreground text-sm\">Advanced track matching</span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Check className=\"w-4 h-4 text-green-500\" />\n              <span className=\"text-muted-foreground text-sm\">Priority support</span>\n            </div>\n          </div>\n\n          <motion.button\n            onClick={handleUpgradePremium}\n            className=\"w-full bg-gradient-to-r from-orange-500 to-pink-500 text-white py-4 rounded-xl font-semibold shadow-lg text-sm\"\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            Upgrade to Premium\n          </motion.button>\n        </motion.div>\n      </div>\n\n      {/* Edit Profile Modal */}\n      {showEditProfile && (\n        <EditProfileModal\n          isOpen={showEditProfile}\n          onClose={() => setShowEditProfile(false)}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* Settings Modal */}\n      {showSettings && (\n        <SettingsModal\n          isOpen={showSettings}\n          onClose={() => setShowSettings(false)}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* Help Modal */}\n      {showHelp && (\n        <HelpModal\n          isOpen={showHelp}\n          onClose={() => setShowHelp(false)}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* Premium Modal */}\n      {showPremium && (\n        <PremiumModal\n          isOpen={showPremium}\n          onClose={() => setShowPremium(false)}\n          onShowToast={onShowToast}\n        />\n      )}\n    </div>\n  );\n}; ","import React, { useState, useEffect, useCallback, useMemo, useRef, useLayoutEffect, lazy } from 'react';\nimport { ParticleField } from './ui/ParticleField';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { motion, AnimatePresence, LazyMotion, domAnimation } from 'framer-motion';\nimport { \n  Home, \n  Link as LinkIcon, \n  History, \n  User, \n  Music, \n  Youtube, \n  Upload, \n  Download,\n  Settings,\n  Play,\n  Pause,\n  SkipBack,\n  SkipForward,\n  Loader2,\n  CheckCircle,\n  AlertTriangle,\n  RefreshCw,\n  Shield,\n  Zap,\n  Info,\n  ChevronRight,\n  ChevronLeft,\n  LogOut,\n  Lock,\n  Headphones,\n  X,\n  Volume2,\n  VolumeX,\n  Clock,\n  Users,\n  Heart,\n  Star,\n  TrendingUp,\n  Calendar,\n  MapPin,\n  Globe,\n  Activity,\n  BarChart3,\n  PieChart,\n  Target,\n  Sparkles,\n  Palette,\n  Filter,\n  Share2,\n  Plus,\n  Minus,\n  RotateCcw,\n  Eye,\n  EyeOff,\n  ChevronDown,\n  ChevronUp,\n  ArrowRight,\n  ArrowLeft,\n  Copy,\n  Check,\n  Phone,\n  Unlock,\n  Key,\n  ShieldCheck,\n  HelpCircle,\n  MessageCircle,\n  ThumbsUp,\n  ThumbsDown,\n  Flag,\n  Bookmark,\n  Trash2,\n  Bell,\n  Sun,\n  Moon,\n  AlertCircle,\n  Crown,\n  Camera,\n  Edit,\n  Edit3,\n  ExternalLink,\n  ListMusic\n} from 'lucide-react';\nimport { FaSpotify } from 'react-icons/fa';\nimport { ResponsiveLayout, MobileHeader, MobileContent, MobileBottomNav, MobileNavItem, MobileCard, MobileButton } from './ResponsiveLayout';\nimport { useAuth } from '../lib/AuthContext';\nimport { useConversion, type FailedTrack } from '../lib/ConversionContext';\nimport { ConversionStatus } from '../types/conversion';\nimport { getYouTubeAuthUrl, getYouTubeToken } from '../lib/youtubeAuth';\nimport { initSpotifyAuth } from '../lib/spotifyAuth';\nimport { cn } from '../lib/utils';\nimport { GlassmorphicCard } from './ui/GlassmorphicCard';\nimport { GlowButton } from './ui/GlowButton';\nimport { GlassmorphicContainer } from './ui/GlassmorphicContainer';\nimport { FloatingLabels } from './ui/FloatingLabels';\nimport AnimatedGradientText from './ui/AnimatedGradientText';\nimport LightingText from './ui/LightingText';\nimport SpotlightCard from './ui/SpotlightCard';\nimport { MobileFailedTracksDetails } from './visualization/MobileFailedTracksDetails';\nimport SoundSwappLogo from '../assets/SoundSwappLogo';\nimport { ToastContainer, Toast } from './feedback/EnhancedToast';\n// Success celebration is lazy-loaded below\nimport EnhancedConnectionCard from './EnhancedConnectionCard';\nimport { PlaylistInsights } from './visualization/PlaylistInsights';\nimport { useHapticFeedback } from '../hooks/useHapticFeedback';\nimport { useOfflineStatus } from '../hooks/useOfflineStatus';\nimport { usePullToRefresh } from '../hooks/usePullToRefresh';\nimport { useSwipeGestures } from '../hooks/useSwipeGestures';\nimport { useLongPress } from '../hooks/useLongPress';\nimport { useSwipeActions } from '../hooks/useSwipeActions';\nimport { useVoiceCommands } from '../hooks/useVoiceCommands';\nimport { useTheme } from '../lib/ThemeContext';\nimport { usePerformanceOptimization } from '../hooks/usePerformanceOptimization';\nimport { currentPerformanceConfig } from '../config/performance';\nimport { useScrollProgress, useScrollDirection } from '../hooks/useScrollAnimation';\nimport { useViewportLogger } from '../hooks/useViewportAnalysis';\nimport { useInfiniteScroll } from '../hooks/useInfiniteScroll';\nimport { ProfileTab } from './tabs/ProfileTab';\n\n// Performance constants\nconst DEBOUNCE_DELAY = 300;\nconst LAZY_LOAD_DELAY = 100;\nconst ANIMATION_DURATION = 0.3;\nconst SPRING_CONFIG = { type: \"spring\" as const, stiffness: 300, damping: 30 };\n\n// Lazy load heavy components\nconst LazySuccessCelebration = lazy(() => import('./feedback/SuccessCelebration').then(module => ({ default: module.SuccessCelebration })));\n\n// Memoized components for better performance\nconst MemoizedSoundSwappLogo = React.memo(SoundSwappLogo);\nconst MemoizedParticleField = React.memo(({ isDark, className }: { isDark: boolean; className: string }) => (\n  <ParticleField \n    color={isDark ? \"var(--particle-color, #FF7A59)\" : \"var(--particle-color, #FF007A)\"}\n    density=\"low\"\n    className={className}\n  />\n));\n\n// Optimized animation variants\nconst fadeInUp = {\n  initial: { opacity: 0, y: 20 },\n  animate: { opacity: 1, y: 0 },\n  exit: { opacity: 0, y: -20 },\n  transition: { duration: ANIMATION_DURATION, ease: \"easeOut\" }\n};\n\nconst scaleIn = {\n  initial: { opacity: 0, scale: 0.9 },\n  animate: { opacity: 1, scale: 1 },\n  exit: { opacity: 0, scale: 0.9 },\n  transition: { duration: ANIMATION_DURATION, ease: \"easeOut\" }\n};\n\nconst slideIn = {\n  initial: { opacity: 0, x: -20 },\n  animate: { opacity: 1, x: 0 },\n  exit: { opacity: 0, x: 20 },\n  transition: { duration: ANIMATION_DURATION, ease: \"easeOut\" }\n};\n\n// Optimized status indicators\nconst StatusIndicator = React.memo(({ \n  isVisible, \n  type, \n  message, \n  icon: Icon \n}: { \n  isVisible: boolean; \n  type: 'offline' | 'refreshing'; \n  message: string; \n  icon: React.ComponentType<any>; \n}) => (\n  <AnimatePresence>\n    {isVisible && (\n      <motion.div \n        initial={{ y: -50, opacity: 0 }}\n        animate={{ y: 0, opacity: 1 }}\n        exit={{ y: -50, opacity: 0 }}\n        transition={{ duration: 0.3, ease: \"easeOut\" }}\n        className={`fixed top-0 left-0 right-0 z-50 text-white text-center py-3 px-4 shadow-lg ${\n          type === 'offline' ? 'bg-red-500' : 'bg-blue-500'\n        }`}\n      >\n        <div className=\"flex items-center justify-center space-x-2\">\n          <Icon className=\"w-4 h-4\" />\n          <span className=\"text-sm font-medium\">{message}</span>\n        </div>\n      </motion.div>\n    )}\n  </AnimatePresence>\n));\n\n// Optimized theme toggle button\nconst ThemeToggleButton = React.memo(({ \n  isDark, \n  toggleTheme, \n  hapticLight \n}: { \n  isDark: boolean; \n  toggleTheme: () => void; \n  hapticLight: () => void; \n}) => (\n  <motion.button \n    onClick={() => {\n      toggleTheme();\n      hapticLight();\n    }}\n    className={cn(\n      \"relative transition-all duration-300\",\n      isDark \n        ? \"text-yellow-500 hover:text-yellow-400\" \n        : \"text-gray-800 dark:text-gray-200 hover:text-gray-600 dark:hover:text-gray-100\"\n    )}\n    whileHover={{ scale: 1.1 }}\n    whileTap={{ scale: 0.9 }}\n    transition={SPRING_CONFIG}\n  >\n    <motion.div\n      animate={{ rotate: isDark ? 180 : 0 }}\n      transition={{ duration: 0.5, ease: \"easeInOut\" }}\n    >\n      {isDark ? (\n        <Sun className=\"w-6 h-6 drop-shadow-sm\" />\n      ) : (\n        <Moon className=\"w-6 h-6 drop-shadow-sm\" />\n      )}\n    </motion.div>\n  </motion.button>\n));\n\n// Platform key type\nexport type PlatformKey = 'spotify' | 'youtube' | 'soundcloud';\n\n// Define YouTube playlist interface\ninterface YouTubePlaylist {\n  id: string;\n  snippet?: {\n    title?: string;\n    thumbnails?: {\n      default?: {\n        url: string;\n      };\n    };\n    channelTitle?: string;\n  };\n  contentDetails?: {\n    itemCount?: number;\n  };\n}\n\n// Enhanced track interface\ninterface Track {\n  id: string;\n  name: string;\n  artists: string[];\n  artistIds?: string[];\n  artistImages?: string[];\n  genres?: string[];\n  album?: string;\n  duration_ms: number;\n  popularity: number;\n  explicit?: boolean;\n  releaseYear?: string;\n  searchQuery?: string;\n  videoId?: string;\n}\n\n// Keyboard accessibility helper\ninterface KeyboardFocusableCardProps {\n  children: React.ReactNode;\n  onKeyDown?: React.KeyboardEventHandler<HTMLDivElement>;\n  onClick?: React.MouseEventHandler<HTMLDivElement>;\n  className?: string;\n  [key: string]: any;\n}\n\nconst KeyboardFocusableCard: React.FC<KeyboardFocusableCardProps> = ({ \n  children, \n  onKeyDown, \n  onClick, \n  className, \n  ...props \n}) => {\n  const handleKeyDown = useCallback((e: React.KeyboardEvent<HTMLDivElement>) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      onKeyDown?.(e);\n      \n      if (!e.defaultPrevented && onClick) {\n        onClick(e as unknown as React.MouseEvent<HTMLDivElement>);\n      }\n    } else if (onKeyDown) {\n      onKeyDown(e);\n    }\n  }, [onKeyDown, onClick]);\n  \n  return (\n    <div \n      tabIndex={0} \n      role=\"button\"\n      className={cn(\n        \"focus:outline-none focus:ring-2 focus:ring-brand-primary-action focus:ring-offset-2 focus:ring-offset-background-primary rounded-lg transition-all\",\n        className\n      )}\n      onKeyDown={handleKeyDown}\n      onClick={onClick}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n};\n\n// Create a reusable connection button component\ninterface ConnectButtonProps {\n  platform: PlatformKey;\n  isConnected: boolean;\n  onConnect: () => void;\n  className?: string;\n}\n\n// Platform connection button component\nconst ConnectButton: React.FC<ConnectButtonProps> = ({ platform, isConnected, onConnect, className }) => {\n  const platformData = {\n    spotify: {\n      icon: (\n        <img \n          src=\"/images/Spotify_Primary_Logo_RGB_Green.png\" \n          alt=\"Spotify\" \n          style={{ \n            height: 24, \n            width: 'auto', \n            objectFit: 'contain', \n            display: 'block',\n            minWidth: '24px'\n          }} \n          className=\"h-6 w-auto\" \n        />\n      ),\n      text: 'Spotify',\n      bgColor: 'bg-platform-spotify hover:bg-platform-spotify-hover',\n      bgColorConnected: 'bg-platform-spotify-connected text-content-on-platform-spotify-connected'\n    },\n    youtube: {\n      icon: (\n        <img \n          src=\"/images/yt_logo_rgb_dark.png\" \n          alt=\"YouTube\" \n          style={{ \n            height: 24, \n            width: 'auto', \n            objectFit: 'contain', \n            display: 'block',\n            minWidth: '24px'\n          }} \n          className=\"h-6 w-auto\" \n        />\n      ),\n      text: 'YouTube',\n      bgColor: 'bg-platform-youtube hover:bg-platform-youtube-hover',\n      bgColorConnected: 'bg-platform-youtube-connected text-content-on-platform-youtube-connected'\n    },\n    soundcloud: {\n      icon: <Music className=\"h-5 w-5\" />,\n      text: 'SoundCloud',\n      bgColor: 'bg-platform-soundcloud hover:bg-platform-soundcloud-hover', \n      bgColorConnected: 'bg-platform-soundcloud-connected text-content-on-platform-soundcloud-connected'\n    }\n  };\n  \n  const data = platformData[platform];\n  \n  return (\n    <button\n      onClick={onConnect}\n      disabled={isConnected}\n      className={cn(\n        \"flex items-center justify-center gap-2 px-5 py-3 rounded-lg font-medium transition-colors\",\n        isConnected \n          ? data.bgColorConnected\n          : `${data.bgColor} text-content-inverse`,\n        \"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background-primary\", \n        platform === 'spotify' ? 'focus:ring-platform-spotify' :\n        platform === 'youtube' ? 'focus:ring-platform-youtube' :\n        platform === 'soundcloud' ? 'focus:ring-platform-soundcloud' :\n        'focus:ring-brand-primary-action',\n        className\n      )}\n      aria-label={`${isConnected ? 'Connected to' : 'Connect to'} ${data.text}`}\n    >\n      {data.icon}\n      <span>{isConnected ? 'Connected' : `Connect ${data.text}`}</span>\n      {isConnected && <CheckCircle className=\"h-5 w-5 text-current\" />}\n    </button>\n  );\n};\n\n// Define insights interfaces\nimport { PlaylistTypes } from '../types/playlist';\nimport { profileService } from '../services/profileService';\n\n// Use shared types\ntype PlaylistStats = PlaylistTypes.PlaylistStats;\ntype Album = PlaylistTypes.Album;\ntype Genre = PlaylistTypes.Genre;\ntype Artist = PlaylistTypes.Artist;\n\ninterface ConversionTrack {\n  name: string;\n  artists: string[];\n  popularity?: number;\n  duration_ms?: number;\n  explicit?: boolean;\n  album?: string;\n  releaseYear?: string | number;\n  genres?: string[];\n  artistImages?: string[];\n}\n\n// Convert track to the correct type\nconst convertTrack = (track: ConversionTrack): PlaylistTypes.Track => ({\n  name: track.name,\n  artists: track.artists,\n  popularity: track.popularity,\n  duration_ms: track.duration_ms,\n  explicit: track.explicit,\n  album: track.album,\n  releaseYear: track.releaseYear ? Number(track.releaseYear) : undefined,\n  genres: track.genres,\n  artistImages: track.artistImages\n});\n\n// Generate a consistent color for a genre\nconst generateGenreColor = (genre: string): string => {\n  // Create a hash of the genre name\n  let hash = 0;\n  for (let i = 0; i < genre.length; i++) {\n    hash = genre.charCodeAt(i) + ((hash << 5) - hash);\n  }\n  \n  // Convert to HSL color\n  const h = Math.abs(hash % 360);\n  return `hsl(${h}, 70%, 50%)`;\n};\n\n// Function to get playlist insights from the tracks data\nconst generatePlaylistInsights = (tracks: ConversionTrack[]): PlaylistStats => {\n  const artistCounts: Record<string, number> = {};\n  const artistImages: Record<string, string> = {};\n  const genreCounts: Record<string, number> = {};\n  const yearCounts: Record<string, number> = {};\n  const albumCounts: Record<string, number> = {};\n  const genres = new Set<string>();\n  let totalTracks = tracks.length;\n  let explicitCount = 0;\n  let nonExplicitCount = 0;\n  let validPopularityCount = 0;\n  let totalPopularity = 0;\n  let totalDuration = 0;\n  let longestTrackDuration = 0;\n  let shortestTrackDuration = Infinity;\n  let longestTrack: ConversionTrack | null = null;\n  let shortestTrack: ConversionTrack | null = null;\n  let mostPopularTrack: ConversionTrack | null = null;\n  let leastPopularTrack: ConversionTrack | null = null;\n  let highestPopularity = 0;\n  let lowestPopularity = 100;\n  let oldestYear = '9999';\n  let newestYear = '0';\n  let oldestTrack: ConversionTrack | null = null;\n  let newestTrack: ConversionTrack | null = null;\n  \n  // Duration categories\n  const durationCategories = {\n    short: 0, // < 3 min\n    medium: 0, // 3-5 min\n    long: 0, // > 5 min\n  };\n  \n  // Popularity ranges\n  const popularityRanges = {\n    low: 0, // 0-33\n    medium: 0, // 34-66\n    high: 0, // 67-100\n  };\n  \n  // Process each track\n  tracks.forEach(track => {\n    // Process artists\n    track.artists.forEach((artist, index) => {\n      artistCounts[artist] = (artistCounts[artist] || 0) + 1;\n      if (track.artistImages?.[index] && !artistImages[artist]) {\n        artistImages[artist] = track.artistImages[index];\n      }\n    });\n    \n    // Process genres\n    if (track.genres) {\n      track.genres.forEach(genre => {\n        genres.add(genre);\n        genreCounts[genre] = (genreCounts[genre] || 0) + 1;\n      });\n    }\n    \n    // Process duration\n    if (track.duration_ms) {\n      totalDuration += track.duration_ms;\n      const durationMinutes = track.duration_ms / 1000 / 60;\n      if (durationMinutes < 3) durationCategories.short++;\n      else if (durationMinutes <= 5) durationCategories.medium++;\n      else durationCategories.long++;\n      \n      if (track.duration_ms > longestTrackDuration) {\n        longestTrackDuration = track.duration_ms;\n        longestTrack = track;\n      }\n      if (track.duration_ms < shortestTrackDuration) {\n        shortestTrackDuration = track.duration_ms;\n        shortestTrack = track;\n      }\n    }\n    \n    // Process popularity\n    if (track.popularity !== undefined) {\n      totalPopularity += track.popularity;\n      validPopularityCount++;\n      if (track.popularity <= 33) popularityRanges.low++;\n      else if (track.popularity <= 66) popularityRanges.medium++;\n      else popularityRanges.high++;\n      \n      if (track.popularity > highestPopularity) {\n        highestPopularity = track.popularity;\n        mostPopularTrack = track;\n      }\n      if (track.popularity < lowestPopularity) {\n        lowestPopularity = track.popularity;\n        leastPopularTrack = track;\n      }\n    }\n    \n    // Process release year\n    if (track.releaseYear) {\n      const year = track.releaseYear.toString();\n      yearCounts[year] = (yearCounts[year] || 0) + 1;\n      if (year < oldestYear) {\n        oldestYear = year;\n        oldestTrack = track;\n      }\n      if (year > newestYear) {\n        newestYear = year;\n        newestTrack = track;\n      }\n    }\n    \n    // Process explicit content\n    if (track.explicit) explicitCount++;\n    else nonExplicitCount++;\n    \n    // Process albums\n    if (track.album) {\n      albumCounts[track.album] = (albumCounts[track.album] || 0) + 1;\n    }\n  });\n  \n  // Calculate genre percentages\n  const genrePercentages: Record<string, number> = {};\n  const totalGenreMentions = Object.values(genreCounts).reduce((a, b) => a + b, 0);\n  Object.entries(genreCounts).forEach(([genre, count]) => {\n    genrePercentages[genre] = (count / totalGenreMentions) * 100;\n  });\n  \n  // Calculate yearly trends\n  const yearlyTrends = Object.entries(yearCounts)\n    .map(([year, count]) => ({\n      year,\n      count,\n      avgPopularity: tracks\n        .filter(t => t.releaseYear?.toString() === year && t.popularity !== undefined)\n        .reduce((acc, t) => acc + (t.popularity || 0), 0) / count\n    }))\n    .sort((a, b) => a.year.localeCompare(b.year));\n  \n  // Calculate decade distribution\n  const decadeDistribution: Record<string, number> = {};\n  Object.entries(yearCounts).forEach(([year, count]) => {\n    const decade = year.slice(0, 3) + '0';\n    decadeDistribution[decade] = (decadeDistribution[decade] || 0) + count;\n  });\n  \n  // Convert genres to array with colors\n  const genreArray = Array.from(genres).map(name => ({\n    name,\n    count: genreCounts[name],\n    color: generateGenreColor(name),\n    percentage: genrePercentages[name]\n  })).sort((a, b) => b.count - a.count);\n  \n  // Convert artists to array with images\n  const artistArray = Object.entries(artistCounts)\n    .map(([name, count]) => ({\n      name,\n      count,\n      image: artistImages[name],\n      popularity: tracks.find(t => t.artists.includes(name))?.popularity\n    }))\n    .sort((a, b) => b.count - a.count)\n    .slice(0, 10); // Top 10 artists\n  \n  // Convert albums to array\n  const albumArray = Object.entries(albumCounts)\n    .map(([name, trackCount]) => {\n      const track = tracks.find(t => t.album === name);\n      const year = track?.releaseYear ? Number(track.releaseYear) : undefined;\n      return { \n        name, \n        trackCount,\n        year: !isNaN(year as number) ? year : undefined\n      };\n    })\n    .sort((a, b) => b.trackCount - a.trackCount)\n    .slice(0, 5); // Top 5 albums\n  \n  return {\n    totalTracks,\n    avgPopularity: validPopularityCount ? totalPopularity / validPopularityCount : 0,\n    totalDuration: Math.round(totalDuration / 60000), // Convert to minutes\n    genres: genreArray,\n    topArtists: artistArray,\n    releaseYears: yearCounts,\n    totalGenreMentions,\n    mostPopularTrack: mostPopularTrack ? convertTrack(mostPopularTrack) : undefined,\n    leastPopularTrack: leastPopularTrack ? convertTrack(leastPopularTrack) : undefined,\n    longestTrack: longestTrack ? convertTrack(longestTrack) : undefined,\n    shortestTrack: shortestTrack ? convertTrack(shortestTrack) : undefined,\n    explicitCount,\n    nonExplicitCount,\n    topAlbums: albumArray,\n    avgTrackLength: totalDuration / totalTracks,\n    oldestTrack: oldestTrack ? convertTrack(oldestTrack) : undefined,\n    newestTrack: newestTrack ? convertTrack(newestTrack) : undefined,\n    explicitPercentage: (explicitCount / totalTracks) * 100,\n    uniqueArtists: Object.keys(artistCounts).length,\n    uniqueAlbums: Object.keys(albumCounts).length,\n    decadeDistribution,\n    // New fields\n    genrePercentages,\n    yearlyTrends,\n    durationCategories,\n    popularityRanges,\n  };\n};\n\n// Helper function to calculate distribution array\nconst calculateDistributionArray = (values: number[], buckets: number): { range: string; count: number }[] => {\n  if (values.length === 0) return [];\n  \n  const min = Math.min(...values);\n  const max = Math.max(...values);\n  const range = max - min;\n  const bucketSize = range / buckets;\n  const distribution: { range: string; count: number }[] = [];\n  \n  values.forEach(value => {\n    const bucketIndex = Math.min(Math.floor((value - min) / bucketSize), buckets - 1);\n    const bucketKey = `${Math.round(min + bucketIndex * bucketSize)}-${Math.round(min + (bucketIndex + 1) * bucketSize)}`;\n    const existingBucket = distribution.find(d => d.range === bucketKey);\n    if (existingBucket) {\n      existingBucket.count++;\n    } else {\n      distribution.push({ range: bucketKey, count: 1 });\n    }\n  });\n  \n  return distribution;\n};\n\n// Extract URL utility function\nconst extractPlaylistId = (url: string, platform: PlatformKey): string | null => {\n  if (!url) return null;\n  \n  try {\n    if (platform === 'spotify') {\n      // Handle URLs like https://open.spotify.com/playlist/37i9dQZF1DX0XUsuxWHRQd?si=abc123\n      // or spotify:playlist:37i9dQZF1DX0XUsuxWHRQd\n      let match = url.match(/spotify\\.com\\/playlist\\/([a-zA-Z0-9_-]+)/);\n      if (!match && url.includes('spotify:playlist:')) {\n        match = url.match(/spotify:playlist:([a-zA-Z0-9_-]+)/);\n      }\n      if (match && match[1]) {\n        // Remove any trailing query params or slashes\n        return match[1].split(/[/?#]/)[0];\n      }\n      \n      // Try direct ID format (if the user just pasted the ID)\n      if (/^[a-zA-Z0-9]{22}$/.test(url)) {\n        return url;\n      }\n    } else if (platform === 'youtube') {\n      // Handle URLs like https://www.youtube.com/playlist?list=PLw-VjHDlEOgvtnnnqWlTqryAtBXmZCujo\n      const match = url.match(/[?&]list=([a-zA-Z0-9_-]+)/);\n      if (match && match[1]) {\n        return match[1];\n      }\n      \n      // Try direct ID format (if the user just pasted the ID)\n      if (/^[a-zA-Z0-9_-]{24,34}$/.test(url)) {\n        return url;\n      }\n    }\n  } catch (error) {\n    console.error(\"Error extracting playlist ID:\", error);\n  }\n  \n  return null;\n};\n\ninterface MobileConverterProps {\n  // Props for mobile-specific behavior\n}\n\n// Toast type\ntype ToastType = \"success\" | \"error\" | \"warning\" | \"info\";\n\n// ProfileContentProps interface\ninterface ProfileContentProps {\n  showEditProfile: boolean;\n  setShowEditProfile: (show: boolean) => void;\n  profileImage: string | null;\n  isUploadingImage: boolean;\n  handleImageUpload: (event: React.ChangeEvent<HTMLInputElement>) => void;\n  user: any;\n  state: any;\n  onShowToast: (type: ToastType, message: string) => void;\n  setActiveTab: React.Dispatch<React.SetStateAction<'connections' | 'converter' | 'history' | 'profile'>>;\n  setConversionStep: React.Dispatch<React.SetStateAction<'select-source' | 'select-destination' | 'select-playlist' | 'converting' | 'success'>>;\n  signOut: () => void;\n}\n\n// ProfileContent component\nconst ProfileContent: React.FC<ProfileContentProps> = ({\n  showEditProfile,\n  setShowEditProfile,\n  profileImage,\n  isUploadingImage,\n  handleImageUpload,\n  user,\n  state,\n  onShowToast,\n  setActiveTab,\n  setConversionStep,\n  signOut\n}) => {\n  const [userStats, setUserStats] = useState({\n    conversions: 0,\n    tracks: 0,\n    monthlyUsage: 0,\n    monthlyLimit: 50,\n    platformUsage: {\n      spotify: 0,\n      youtube: 0,\n      soundcloud: 0\n    },\n    successRate: 0,\n    totalPlaylists: 0\n  });\n  const [isLoadingStats, setIsLoadingStats] = useState(false);\n\n  // Debug log to verify ProfileContent is being rendered\n  \n\n  // Load user stats from profile service\n  useEffect(() => {\n    const loadUserStats = async () => {\n      if (!user?.uid) {\n        console.log('[ProfileContent] No user UID available for loading stats');\n        return;\n      }\n      \n      console.log('[ProfileContent] Loading user stats for UID:', user.uid);\n      setIsLoadingStats(true);\n      \n      try {\n        console.log('[ProfileContent] Calling profileService.getUserStats...');\n        const stats = await profileService.getUserStats(user.uid);\n        console.log('[ProfileContent] User stats loaded successfully:', stats);\n        setUserStats(stats);\n      } catch (error) {\n        console.error('[ProfileContent] Error loading user stats:', error);\n        // Keep default values if loading fails\n      } finally {\n        setIsLoadingStats(false);\n      }\n    };\n\n    loadUserStats();\n  }, [user?.uid]);\n\n  const handleNewConversion = () => {\n    setActiveTab('converter');\n    onShowToast?.('info', 'Starting new conversion...');\n  };\n\n  const handleViewHistory = () => {\n    setActiveTab('history');\n    onShowToast?.('info', 'Opening conversion history...');\n  };\n\n  const handleEditProfile = () => {\n    setShowEditProfile(true);\n  };\n\n  const handleManageConnections = () => {\n    setActiveTab('connections');\n    onShowToast?.('info', 'Opening connection management...');\n  };\n\n  const handlePremiumFeatures = () => {\n    onShowToast?.('info', 'Premium features coming soon...');\n  };\n\n  const handleHelpSupport = () => {\n    onShowToast?.('info', 'Help & support feature coming soon...');\n  };\n\n  const handleUpgradePremium = () => {\n    onShowToast?.('info', 'Premium upgrade feature coming soon...');\n  };\n\n  const handleSignOutClick = () => {\n    signOut();\n    onShowToast?.('success', 'Signed out successfully');\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 p-4 space-y-6\">\n      {/* User Profile Card */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"relative overflow-hidden rounded-2xl bg-gradient-to-br from-pink-500 via-purple-500 to-blue-600 p-6 shadow-xl\"\n      >\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"relative\">\n              <div className=\"w-36 h-36 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center overflow-hidden shadow-2xl border-2 border-white/10\">\n                {profileImage ? (\n                  <img \n                    src={profileImage} \n                    alt=\"Profile\" \n                    className=\"w-36 h-36 rounded-full object-cover\"\n                    onError={(e) => {\n                      // Fallback to icon if image fails to load\n                      e.currentTarget.style.display = 'none';\n                      e.currentTarget.nextElementSibling?.classList.remove('hidden');\n                    }}\n                  />\n                ) : null}\n                <User className={`w-20 h-20 text-white ${profileImage ? 'hidden' : ''}`} />\n              </div>\n              <button \n                onClick={() => document.getElementById('profile-image-input')?.click()}\n                className=\"absolute -bottom-2 -right-2 w-11 h-11 bg-blue-500 rounded-full flex items-center justify-center shadow-lg hover:bg-blue-600 transition-colors\"\n              >\n                <Camera className=\"w-5 h-5 text-white\" />\n              </button>\n              <input\n                id=\"profile-image-input\"\n                type=\"file\"\n                accept=\"image/*\"\n                onChange={handleImageUpload}\n                className=\"hidden\"\n                disabled={isUploadingImage}\n              />\n            </div>\n            <div>\n              <h2 className=\"text-2xl font-bold text-white\">{user?.displayName || 'Mich'}</h2>\n              <p className=\"text-white/80 text-sm\">Premium Member</p>\n              <div className=\"flex items-center space-x-2 mt-1\">\n                <Crown className=\"w-4 h-4 text-yellow-400\" />\n                <span className=\"text-white/80 text-sm\">Premium Features Active</span>\n              </div>\n            </div>\n          </div>\n          <button\n            onClick={handleEditProfile}\n            className=\"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center hover:bg-white/30 transition-colors shadow-lg\"\n          >\n            <Edit3 className=\"w-5 h-5 text-white\" />\n          </button>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"flex space-x-4 mt-6\">\n          <div className=\"flex-1 bg-pink-500/20 backdrop-blur-sm rounded-xl p-4 border border-pink-500/30\">\n            <div className=\"flex items-center justify-center mb-2\">\n              <Music className=\"w-6 h-6 text-white\" />\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-white\">\n                {isLoadingStats ? (\n                  <div className=\"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto\"></div>\n                ) : (\n                  userStats.conversions\n                )}\n              </div>\n              <div className=\"text-white/80 text-sm\">Total Playlists</div>\n            </div>\n          </div>\n          <div className=\"flex-1 bg-blue-500/20 backdrop-blur-sm rounded-xl p-4 border border-blue-500/30\">\n            <div className=\"flex items-center justify-center mb-2\">\n              <CheckCircle className=\"w-6 h-6 text-white\" />\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-white\">\n                {isLoadingStats ? (\n                  <div className=\"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto\"></div>\n                ) : (\n                  userStats.tracks\n                )}\n              </div>\n              <div className=\"text-white/80 text-sm\">Successfully Converted</div>\n            </div>\n          </div>\n        </div>\n      </motion.div>\n\n      {/* Usage Analytics */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.1 }}\n        className=\"space-y-4\"\n      >\n        <h3 className=\"text-xl font-bold text-white\">Usage Analytics</h3>\n        <div className=\"bg-gray-800 rounded-xl p-4 shadow-lg border border-gray-700\">\n          <div className=\"flex justify-between items-center mb-3\">\n            <span className=\"text-white font-medium\">This Month</span>\n            <span className=\"text-blue-400 font-semibold\">\n              {isLoadingStats ? (\n                <div className=\"w-4 h-4 border-2 border-blue-400/30 border-t-blue-400 rounded-full animate-spin\"></div>\n              ) : (\n                `${userStats.monthlyUsage}/${userStats.monthlyLimit}`\n              )}\n            </span>\n          </div>\n          <div className=\"w-full bg-gray-700 rounded-full h-2 mb-2\">\n            <div \n              className=\"bg-blue-500 h-2 rounded-full transition-all duration-300\"\n              style={{ width: `${(userStats.monthlyUsage / userStats.monthlyLimit) * 100}%` }}\n            />\n          </div>\n          <p className=\"text-gray-400 text-sm\">\n            {isLoadingStats ? (\n              <div className=\"w-3 h-3 border-2 border-gray-400/30 border-t-gray-400 rounded-full animate-spin\"></div>\n            ) : (\n              `${userStats.monthlyLimit - userStats.monthlyUsage} conversions remaining`\n            )}\n          </p>\n        </div>\n      </motion.div>\n\n      {/* Platform Usage */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.2 }}\n        className=\"space-y-4\"\n      >\n        <h3 className=\"text-xl font-bold text-white\">Platform Usage</h3>\n        <div className=\"bg-gray-800 rounded-xl p-4 shadow-lg border border-gray-700 space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center\">\n                <img \n                  src=\"/images/Spotify_Primary_Logo_RGB_White.png\" \n                  alt=\"Spotify\" \n                  style={{ \n                    height: 16, \n                    width: 'auto', \n                    objectFit: 'contain', \n                    display: 'block',\n                    minWidth: '16px'\n                  }} \n                  className=\"w-4 h-4\" \n                />\n              </div>\n              <span className=\"text-white font-medium\">Spotify</span>\n            </div>\n            <span className=\"text-white\">{userStats.platformUsage.spotify} conversions</span>\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center\">\n                <img \n                  src=\"/images/YouTube connection card logo.png\" \n                  alt=\"YouTube\" \n                  style={{ \n                    height: 16, \n                    width: 'auto', \n                    objectFit: 'contain', \n                    display: 'block',\n                    minWidth: '16px'\n                  }} \n                  className=\"w-4 h-4\" \n                />\n              </div>\n              <span className=\"text-white font-medium\">YouTube</span>\n            </div>\n            <span className=\"text-white\">{userStats.platformUsage.youtube} conversions</span>\n          </div>\n        </div>\n      </motion.div>\n\n      {/* Quick Actions - Premium Styling */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.3 }}\n        className=\"space-y-6\"\n      >\n        <h3 className=\"text-xl font-bold text-white mb-6\">Quick Actions</h3>\n        <div className=\"flex space-x-16\">\n          <motion.button\n            onClick={handleNewConversion}\n            className=\"flex-1 bg-gradient-to-br from-red-500 via-pink-500 to-purple-600 rounded-2xl p-6 flex flex-col items-center justify-center space-y-3 hover:shadow-2xl transition-all duration-300 backdrop-blur-sm border border-white/10 shadow-xl\"\n            whileHover={{ \n              scale: 1.05,\n              boxShadow: \"0 25px 50px -12px rgba(239, 68, 68, 0.4)\"\n            }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <div className=\"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm\">\n              <Plus className=\"w-6 h-6 text-white\" />\n            </div>\n            <span className=\"text-white font-semibold text-sm\">New Conversion</span>\n          </motion.button>\n          <motion.button\n            onClick={handleViewHistory}\n            className=\"flex-1 bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 rounded-2xl p-6 flex flex-col items-center justify-center space-y-3 hover:shadow-2xl transition-all duration-300 backdrop-blur-sm border border-white/10 shadow-xl\"\n            whileHover={{ \n              scale: 1.05,\n              boxShadow: \"0 25px 50px -12px rgba(59, 130, 246, 0.4)\"\n            }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <div className=\"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm\">\n              <History className=\"w-6 h-6 text-white\" />\n            </div>\n            <span className=\"text-white font-semibold text-sm\">View History</span>\n          </motion.button>\n        </div>\n      </motion.div>\n\n      {/* Account Settings */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.4 }}\n        className=\"space-y-4\"\n      >\n        <h3 className=\"text-xl font-bold text-white\">Account Settings</h3>\n        <div className=\"space-y-3\">\n          <button\n            onClick={handleEditProfile}\n            className=\"w-full bg-gray-800 rounded-xl p-4 flex items-center justify-between hover:bg-gray-700 transition-colors\"\n          >\n            <div className=\"flex items-center space-x-3\">\n              <Edit3 className=\"w-5 h-5 text-blue-400\" />\n              <div className=\"text-left\">\n                <div className=\"text-white font-medium\">Edit Profile</div>\n                <div className=\"text-gray-400 text-sm\">Update your information</div>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-gray-400\" />\n          </button>\n\n          <button\n            onClick={handleManageConnections}\n            className=\"w-full bg-gray-800 rounded-xl p-4 flex items-center justify-between hover:bg-gray-700 transition-colors\"\n          >\n            <div className=\"flex items-center space-x-3\">\n              <LinkIcon className=\"w-5 h-5 text-green-400\" />\n              <div className=\"text-left\">\n                <div className=\"text-white font-medium\">Manage Connections</div>\n                <div className=\"text-gray-400 text-sm\">Spotify & YouTube accounts</div>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"w-4 h-4 bg-red-500 rounded-full flex items-center justify-center\">\n                <img \n                  src=\"/images/YouTube connection card logo.png\" \n                  alt=\"YouTube\" \n                  style={{ \n                    height: 8, \n                    width: 'auto', \n                    objectFit: 'contain', \n                    display: 'block',\n                    minWidth: '8px'\n                  }} \n                  className=\"w-2 h-2\" \n                />\n              </div>\n              <ArrowRight className=\"w-5 h-5 text-gray-400\" />\n            </div>\n          </button>\n\n          <button\n            onClick={handlePremiumFeatures}\n            className=\"w-full bg-gray-800 rounded-xl p-4 flex items-center justify-between hover:bg-gray-700 transition-colors\"\n          >\n            <div className=\"flex items-center space-x-3\">\n              <Crown className=\"w-5 h-5 text-purple-400\" />\n              <div className=\"text-left\">\n                <div className=\"text-white font-medium\">Premium Features</div>\n                <div className=\"text-gray-400 text-sm\">Advanced conversion options</div>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-gray-400\" />\n          </button>\n\n          <button\n            onClick={handleHelpSupport}\n            className=\"w-full bg-gray-800 rounded-xl p-4 flex items-center justify-between hover:bg-gray-700 transition-colors\"\n          >\n            <div className=\"flex items-center space-x-3\">\n              <HelpCircle className=\"w-5 h-5 text-orange-400\" />\n              <div className=\"text-left\">\n                <div className=\"text-white font-medium\">Help & Support</div>\n                <div className=\"text-gray-400 text-sm\">Get assistance</div>\n              </div>\n            </div>\n            <ArrowRight className=\"w-5 h-5 text-gray-400\" />\n          </button>\n        </div>\n      </motion.div>\n\n      {/* Sign Out */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.5 }}\n      >\n        <button\n          onClick={handleSignOutClick}\n          className=\"w-full bg-red-500 text-white font-semibold py-3 rounded-lg flex items-center justify-center space-x-2 hover:bg-red-600 transition-colors shadow-lg\"\n        >\n          <LogOut className=\"w-5 h-5\" />\n          <span>Sign Out</span>\n        </button>\n      </motion.div>\n    </div>\n  );\n};\n\nexport const MobileConverter: React.FC<MobileConverterProps> = React.memo((props: MobileConverterProps) => {\n  // Performance optimizations\n  const performanceConfig = currentPerformanceConfig;\n  const { throttle, debounce, requestAnimationFrame, cancelAnimationFrame, batchUpdates } = usePerformanceOptimization({\n    throttleMs: performanceConfig.throttleMouseEvents ? 32 : 16,\n    maxFPS: performanceConfig.maxAnimationFPS,\n    enableRAF: performanceConfig.enableComplexAnimations\n  });\n  \n  // State management\n  const [isLoading, setIsLoading] = useState(false);\n  const [isInitialized, setIsInitialized] = useState(false);\n  const loadingTimeoutRef = useRef<NodeJS.Timeout>();\n  const debounceRef = useRef<NodeJS.Timeout>();\n  \n  // State management with reduced re-renders\n  const [activeTab, setActiveTab] = useState<'connections' | 'converter' | 'history' | 'profile'>('converter');\n  const [conversionStep, setConversionStep] = useState<'select-source' | 'select-destination' | 'select-playlist' | 'converting' | 'success'>('select-source');\n  const [selectedSourcePlatform, setSelectedSourcePlatform] = useState<PlatformKey | null>(null);\n  const [selectedDestinationPlatform, setSelectedDestinationPlatform] = useState<PlatformKey | null>(null);\n  const [selectedPlaylist, setSelectedPlaylist] = useState<any>(null);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [toastMessage, setToastMessage] = useState('');\n  const [toastType, setToastType] = useState<'success' | 'error' | 'warning' | 'info'>('info');\n  const [showEditProfile, setShowEditProfile] = useState(false);\n  const [profileImage, setProfileImage] = useState<string | null>(null);\n  const [isUploadingImage, setIsUploadingImage] = useState(false);\n  \n  // Create a wrapper function for showToast that can be used throughout the component\n  const showToastWrapper = useRef<((type: 'success' | 'error' | 'warning' | 'info', message: string) => void) | null>(null);\n  \n  // Context hooks\n  const navigate = useNavigate();\n  const { user, signOut, hasSpotifyAuth, hasYouTubeAuth, isAuthenticated, disconnectFromSpotify, disconnectFromYouTube, isConnectingSpotify, isConnectingYouTube, spotifyError, youtubeError, spotifyUserProfile, youtubeUserProfile } = useAuth();\n  const { \n    state, \n    fetchSpotifyPlaylists, \n    fetchYouTubePlaylists, \n    selectPlaylist,\n    startConversion,\n    fetchConversionHistory,\n    dispatch \n  } = useConversion();\n  const { theme, toggleTheme, isDark } = useTheme();\n  \n  // Memoized values to prevent unnecessary re-renders\n  const spotifyPlaylists = useMemo(() => state.spotifyPlaylists || [], [state.spotifyPlaylists]);\n  const youtubePlaylists = useMemo(() => state.youtubePlaylists || [], [state.youtubePlaylists]);\n  const conversionHistory = useMemo(() => state.conversionHistory || [], [state.conversionHistory]);\n  \n  // Debounced search function with useCallback\n  const debouncedSearch = useCallback((query: string) => {\n    if (debounceRef.current) {\n      clearTimeout(debounceRef.current);\n    }\n    debounceRef.current = setTimeout(() => {\n      setSearchQuery(query);\n    }, DEBOUNCE_DELAY);\n  }, []);\n  \n  // Optimized loading state management\n  const setLoadingState = useCallback((loading: boolean) => {\n    if (loadingTimeoutRef.current) {\n      clearTimeout(loadingTimeoutRef.current);\n    }\n    \n    if (loading) {\n      setIsLoading(true);\n    } else {\n      // Add small delay to prevent flickering\n      loadingTimeoutRef.current = setTimeout(() => {\n        setIsLoading(false);\n      }, LAZY_LOAD_DELAY);\n    }\n  }, []);\n  \n  // Memoized initialization function\n  const initializeComponent = useCallback(async () => {\n    setLoadingState(true);\n    try {\n      // Preload essential data\n      await Promise.all([\n        fetchSpotifyPlaylists(),\n        fetchYouTubePlaylists()\n      ]);\n      setIsInitialized(true);\n    } catch (error) {\n      console.error('Initialization error:', error);\n      // Note: showToast will be available after it's defined later in the component\n    } finally {\n      setLoadingState(false);\n    }\n  }, [fetchSpotifyPlaylists, fetchYouTubePlaylists, setLoadingState]);\n  \n  // Initialize component\n  useEffect(() => {\n    initializeComponent();\n  }, [initializeComponent]);\n  \n  // Haptic feedback\n  const { hapticSuccess, hapticWarning, hapticError, hapticLight, hapticMedium } = useHapticFeedback();\n\n  // Offline status\n  const { isOnline, isOffline, connectionType } = useOfflineStatus();\n\n  // Pull to refresh\n  const contentRef = useRef<HTMLDivElement>(null);\n  const { isRefreshing: isPullRefreshing, pullDistance: pullToRefreshDistance, isPulling } = usePullToRefresh(contentRef, {\n    onRefresh: async () => {\n      // Refresh data\n      await Promise.all([\n        fetchSpotifyPlaylists(),\n        fetchYouTubePlaylists(),\n        fetchConversionHistory()\n      ]);\n    }\n  });\n\n  // Swipe gestures\n  const swipeRef = useRef<HTMLDivElement>(null);\n  const { touchStart, touchEnd } = useSwipeGestures(swipeRef, {\n    onSwipeLeft: () => hapticLight(),\n    onSwipeRight: () => hapticLight()\n  });\n\n  // Long press\n  const { isLongPress } = useLongPress(swipeRef, {\n    onLongPress: () => hapticMedium(),\n    onPress: () => hapticLight()\n  });\n\n  // Swipe actions\n  const historySwipeRef = useRef<HTMLDivElement>(null);\n  useSwipeActions(historySwipeRef, {\n    onSwipeLeft: () => {\n      hapticLight();\n      // Handle swipe left\n    },\n    onSwipeRight: () => {\n      hapticLight();\n      // Handle swipe right\n    }\n  });\n\n  // Voice commands\n  const { isListening, startListening, stopListening } = useVoiceCommands({\n    commands: {\n      'start conversion': () => hapticSuccess(),\n      'stop conversion': () => hapticWarning(),\n      'refresh': () => hapticLight()\n    },\n    isEnabled: false\n  });\n\n  // Scroll progress\n  const { scrollDirection } = useScrollDirection();\n\n  // Viewport logger\n\n  // Infinite scroll\n\n  // Show toast function\n\n  // Set the wrapper reference\n\n  // Handle authentication check\n  useEffect(() => {\n    if (!user) {\n      navigate('/login');\n    }\n  }, [user, navigate]);\n  \n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (loadingTimeoutRef.current) {\n        clearTimeout(loadingTimeoutRef.current);\n      }\n      if (debounceRef.current) {\n        clearTimeout(debounceRef.current);\n      }\n    };\n  }, []);\n  \n  // These variables are already declared above from useAuth()\n  \n  // State management with reduced complexity\n  const [isCardExpanded, setIsCardExpanded] = useState<'spotify' | 'youtube' | null>(null);\n  const [showCelebration, setShowCelebration] = useState(false);\n  const [toasts, setToasts] = useState<Toast[]>([]);\n  const [currentWizardStep, setCurrentWizardStep] = useState(1);\n  const [showPlaylistSuggestions, setShowPlaylistSuggestions] = useState(false);\n  const [playlistUrl, setPlaylistUrl] = useState('');\n  const [userPlaylists, setUserPlaylists] = useState<any[]>([]);\n  const [isLoadingPlaylists, setIsLoadingPlaylists] = useState(false);\n  const [playlistNameForExport, setPlaylistNameForExport] = useState('');\n  const [playlistDescriptionForExport, setPlaylistDescriptionForExport] = useState('');\n  \n  // Conversion process state\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [isConverting, setIsConverting] = useState(false);\n  const [conversionProgress, setConversionProgress] = useState(0);\n  \n  // Enhanced UI state with reduced animations\n  const [showWelcomeAnimation, setShowWelcomeAnimation] = useState(false); // Disabled by default\n  const [pulseAnimation, setPulseAnimation] = useState(false);\n  \n  // Mobile enhancement hooks\n  const tabSwipeRef = useRef<HTMLDivElement>(null);\n  \n  // Scroll behavior and animations\n  const { scrollProgress, isScrolling, handleScroll, scrollToTop } = useScrollProgress({\n    containerRef: contentRef,\n    onProgressChange: (progress) => {\n      // Optional: Add any additional progress-based logic here\n    }\n  });\n  \n  // Viewport analysis for optimization\n  const viewportAnalysis = useViewportLogger();\n  \n  // Infinite scroll functionality\n  const [hasMoreContent, setHasMoreContent] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  \n  const loadMoreContent = useCallback(async () => {\n    if (isLoadingMore || !hasMoreContent) return;\n    \n    setIsLoadingMore(true);\n    try {\n      // Simulate loading more content\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      // For now, we'll just simulate infinite content\n      // In a real app, this would load more data from an API\n      setHasMoreContent(true); // Keep it infinite for demo\n    } catch (error) {\n      console.error('Error loading more content:', error);\n    } finally {\n      setIsLoadingMore(false);\n    }\n  }, [isLoadingMore, hasMoreContent]);\n  \n  const infiniteScrollRef = useRef<HTMLDivElement>(null);\n  \n  // Scroll to top when tab changes\n  useEffect(() => {\n    scrollToTop();\n  }, [activeTab, scrollToTop]);\n  \n  // Reduced welcome animation effect\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setShowWelcomeAnimation(false);\n    }, 1000); // Reduced from 2000ms\n    return () => clearTimeout(timer);\n  }, []);\n  \n  // Swipe gestures for tab navigation\n  useSwipeGestures(tabSwipeRef, {\n    onSwipeLeft: () => {\n      const tabs = ['converter', 'connections', 'history', 'profile'];\n      const currentIndex = tabs.indexOf(activeTab);\n      const nextIndex = (currentIndex + 1) % tabs.length;\n      setActiveTab(tabs[nextIndex] as any);\n      hapticLight();\n    },\n    onSwipeRight: () => {\n      const tabs = ['converter', 'connections', 'history', 'profile'];\n      const currentIndex = tabs.indexOf(activeTab);\n      const prevIndex = (currentIndex - 1 + tabs.length) % tabs.length;\n      setActiveTab(tabs[prevIndex] as any);\n      hapticLight();\n    }\n  }, {\n    minSwipeDistance: 80,\n    maxSwipeTime: 500,\n    preventDefault: false\n  });\n  \n  // Pull to refresh functionality\n  const { isRefreshing, pullDistance } = usePullToRefresh(contentRef, {\n    onRefresh: async () => {\n      hapticSuccess();\n      await fetchConversionHistory();\n      if (hasSpotifyAuth) await fetchSpotifyPlaylists();\n      if (hasYouTubeAuth) await fetchYouTubePlaylists();\n    }\n  });\n  \n  // Long press for quick actions\n  const longPressRef = useRef<HTMLDivElement>(null);\n  useLongPress(longPressRef, {\n    onLongPress: () => {\n      hapticMedium();\n      showToastWrapper.current?.('info', 'Quick actions available on long press!');\n    }\n  });\n  \n  // Swipe actions for history items (using existing historySwipeRef)\n  useSwipeActions(historySwipeRef, {\n    threshold: 100,\n    onSwipeLeft: () => {\n      hapticLight();\n      showToastWrapper.current?.('info', 'Swipe left to delete conversion');\n    },\n    onSwipeRight: () => {\n      hapticLight();\n      showToastWrapper.current?.('info', 'Swipe right to share conversion');\n    }\n  });\n  \n  // Voice commands\n  const voiceCommands = {\n    'convert playlist': () => {\n      hapticSuccess();\n      showToastWrapper.current?.('success', 'Voice command: Convert playlist');\n      setActiveTab('converter');\n    },\n    'show history': () => {\n      hapticSuccess();\n      showToastWrapper.current?.('success', 'Voice command: Show history');\n      setActiveTab('history');\n    },\n    'connect spotify': () => {\n      hapticSuccess();\n      showToastWrapper.current?.('success', 'Voice command: Connect Spotify');\n      connectToSpotify();\n    },\n    'connect youtube': () => {\n      hapticSuccess();\n      showToastWrapper.current?.('success', 'Voice command: Connect YouTube');\n      connectToYouTube();\n    }\n  };\n  \n  // Platform selection with proper typing\n  type PlatformInfo = {\n    key: PlatformKey;\n    label: string;\n    color: string;\n    icon: any;\n  };\n  \n  const platforms = useMemo<PlatformInfo[]>(() => [\n    { key: 'spotify', label: 'Spotify', color: 'bg-green-500', icon: FaSpotify },\n    { key: 'youtube', label: 'YouTube', color: 'bg-red-500', icon: Youtube },\n  ], []);\n  \n  // State with proper typing\n  const [sourcePlatform, setSourcePlatform] = useState<PlatformKey>('spotify');\n  const [destinationPlatform, setDestinationPlatform] = useState<PlatformKey>('youtube');\n  \n  // Form state\n  const [spotifyUrl, setSpotifyUrl] = useState('');\n  const [youtubeUrl, setYoutubeUrl] = useState('');\n  \n  // Ensure destination is never the same as source\n  useEffect(() => {\n    if (destinationPlatform === sourcePlatform) {\n      const next = platforms.find(p => p.key !== sourcePlatform);\n      if (next) setDestinationPlatform(next.key);\n    }\n    \n    // Save platform selections to localStorage for persistence\n    localStorage.setItem('source_platform', sourcePlatform);\n    localStorage.setItem('destination_platform', destinationPlatform);\n  }, [sourcePlatform, destinationPlatform, platforms]);\n  \n  // Restore saved platform selections on initial load\n  useEffect(() => {\n    const savedSource = localStorage.getItem('source_platform');\n    const savedDestination = localStorage.getItem('destination_platform');\n    const lastPlaylistUrl = localStorage.getItem('last_playlist_url');\n    \n    if (savedSource && platforms.some(p => p.key === savedSource as PlatformKey)) {\n      setSourcePlatform(savedSource as PlatformKey);\n    }\n    \n    if (savedDestination && platforms.some(p => p.key === savedDestination as PlatformKey) && savedDestination !== sourcePlatform) {\n      setDestinationPlatform(savedDestination as PlatformKey);\n    }\n    \n    if (lastPlaylistUrl) {\n      setSpotifyUrl(lastPlaylistUrl);\n    }\n  }, [platforms, sourcePlatform]);\n  \n  // Set the document title\n  useEffect(() => {\n    document.title = `Playlist Converter - Convert ${platforms.find(p => p.key === sourcePlatform)?.label} to ${platforms.find(p => p.key === destinationPlatform)?.label}`;\n  }, [sourcePlatform, destinationPlatform, platforms]);\n  \n  // Fetch conversion history when user is authenticated\n  const hasFetchedHistory = useRef(false);\n  useEffect(() => {\n    if (isAuthenticated && !hasFetchedHistory.current) {\n      hasFetchedHistory.current = true;\n      const loadHistory = async () => {\n        try {\n          await fetchConversionHistory();\n        } catch (error) {\n          console.error('Error loading conversion history:', error);\n        }\n      };\n      loadHistory();\n    }\n  }, [isAuthenticated, fetchConversionHistory]);\n  \n  // Set default playlist name and description when a playlist is selected\n  useEffect(() => {\n    if (state.selectedPlaylistId && state.spotifyPlaylists) {\n      const selectedPlaylistItem = state.spotifyPlaylists.find((p: any) => p.id === state.selectedPlaylistId);\n      if (selectedPlaylistItem) {\n        setPlaylistNameForExport(`${selectedPlaylistItem.name} (Converted)`);\n        setPlaylistDescriptionForExport(`Converted from ${sourcePlatform} using SoundSwapp`);\n      }\n    }\n  }, [state.selectedPlaylistId, state.spotifyPlaylists, sourcePlatform]);\n  \n  // Show celebration when conversion is successful\n  useEffect(() => {\n    if (state.status === ConversionStatus.SUCCESS) {\n      setShowCelebration(true);\n      setIsProcessing(false);\n      \n      // Determine destination platform and use appropriate playlist URL\n      const destinationIsSpotify = destinationPlatform === 'spotify';\n      const playlistUrl = destinationIsSpotify \n        ? state.spotifyPlaylistUrl \n        : state.youtubePlaylistUrl;\n      \n      const platformName = destinationIsSpotify ? 'Spotify' : 'YouTube';\n      \n      addToast({\n        type: 'success',\n        title: 'Conversion Complete',\n        message: `Your playlist has been successfully converted to ${platformName}!`,\n        actionLabel: 'View Playlist',\n        onAction: () => {\n          if (playlistUrl) {\n            window.open(playlistUrl, '_blank');\n          }\n        }\n      });\n      \n      // Move to success step\n      setConversionStep('success');\n    }\n  }, [state.status, state.youtubePlaylistUrl, state.spotifyPlaylistUrl, destinationPlatform]);\n  \n  // Set processing state based on conversion status\n  useEffect(() => {\n    const processingStatuses = [\n      ConversionStatus.LOADING_TRACKS,\n      ConversionStatus.MATCHING_TRACKS,\n      ConversionStatus.CREATING_PLAYLIST\n    ];\n    \n    setIsProcessing(processingStatuses.includes(state.status));\n  }, [state.status]);\n  \n  // Track errors and notify the user\n  useEffect(() => {\n    if (state.error) {\n      addToast({\n        type: 'error',\n        title: 'Conversion Error',\n        message: state.error || 'An error occurred during conversion.',\n        actionLabel: 'Try Again'\n      });\n    }\n  }, [state.error]);\n  \n  // Auto-advance Steps: Advance to step 3 when tracks are loaded after import\n  useEffect(() => {\n    if (currentWizardStep === 2 && state.tracks.length > 0 && !isProcessing) {\n      setTimeout(() => {\n        setCurrentWizardStep(3);\n        // Scroll to wizard card\n        document.getElementById('playlist-wizard-card')?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      }, 500);\n    }\n    // Save last imported playlist URL\n    if (state.selectedPlaylistId && currentWizardStep === 2) {\n      if (sourcePlatform === 'spotify') {\n        localStorage.setItem('last_playlist_url', spotifyUrl);\n      } else if (sourcePlatform === 'youtube') {\n        localStorage.setItem('last_playlist_url', youtubeUrl);\n      }\n    }\n  }, [state.tracks.length, isProcessing, currentWizardStep, state.selectedPlaylistId, spotifyUrl, youtubeUrl, sourcePlatform]);\n  \n  // Fetch playlists based on auth status\n  useEffect(() => {\n    if (isAuthenticated && hasSpotifyAuth) {\n      fetchSpotifyPlaylists();\n    }\n  }, [isAuthenticated, hasSpotifyAuth, fetchSpotifyPlaylists]);\n  \n  useEffect(() => {\n    if (isAuthenticated && hasYouTubeAuth && typeof fetchYouTubePlaylists === 'function') {\n      fetchYouTubePlaylists();\n    }\n  }, [isAuthenticated, hasYouTubeAuth, fetchYouTubePlaylists]);\n  \n  // Populate userPlaylists based on selected source platform\n  useEffect(() => {\n    if (selectedSourcePlatform === 'spotify' && state.spotifyPlaylists) {\n      console.log('Setting Spotify playlists:', state.spotifyPlaylists);\n      setUserPlaylists(state.spotifyPlaylists);\n    } else if (selectedSourcePlatform === 'youtube' && state.youtubePlaylists) {\n      console.log('Setting YouTube playlists:', state.youtubePlaylists);\n      setUserPlaylists(state.youtubePlaylists);\n    } else {\n      setUserPlaylists([]);\n    }\n  }, [selectedSourcePlatform, state.spotifyPlaylists, state.youtubePlaylists]);\n  \n  // Toast management\n  const dismissToast = useCallback((id: number) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id));\n  }, []);\n  \n  const addToast = useCallback(({ type, message, title, actionLabel, onAction, duration = 5000 }: Omit<Toast, 'id'> & { duration?: number }) => {\n    const id = Date.now();\n    const newToast: Toast = {\n      id,\n      type,\n      title: title || '',\n      message: message || '',\n      actionLabel,\n      onAction\n    };\n    \n    setToasts(prev => [...prev, newToast]);\n    \n    setTimeout(() => {\n      dismissToast(id);\n    }, duration);\n  }, [dismissToast]);\n  \n  // Show different toast types\n  const showToast = useCallback((type: 'success' | 'error' | 'warning' | 'info', message: string) => {\n    const toastConfig = {\n      success: {\n        title: 'Success',\n        message: message || 'Operation completed successfully!',\n        actionLabel: 'Ok'\n      },\n      error: {\n        title: 'Error',\n        message: message || 'Something went wrong. Please try again.',\n        actionLabel: 'Retry'\n      },\n      warning: {\n        title: 'Warning',\n        message: message || 'Some tracks might not have been matched correctly.',\n        actionLabel: 'Review'\n      },\n      info: {\n        title: 'Information',\n        message: message || 'Your conversion is being processed in the background.',\n        actionLabel: 'Details'\n      }\n    };\n    \n    addToast({\n      type,\n      title: toastConfig[type].title,\n      message: toastConfig[type].message,\n      actionLabel: toastConfig[type].actionLabel\n    });\n  }, [addToast]);\n  \n  // Update the wrapper to use the actual showToast function\n  useEffect(() => {\n    showToastWrapper.current = showToast;\n  }, [showToast]);\n  \n  // Fetch playlists with proper error handling (after showToast is defined)\n  useEffect(() => {\n    if (selectedSourcePlatform === 'spotify' && hasSpotifyAuth && isAuthenticated) {\n      setIsLoadingPlaylists(true);\n      fetchSpotifyPlaylists()\n        .then(() => {\n          console.log('Spotify playlists fetched successfully');\n        })\n        .catch((error) => {\n          console.error('Error fetching Spotify playlists:', error);\n          showToast('error', 'Failed to load Spotify playlists. Please try again.');\n        })\n        .finally(() => setIsLoadingPlaylists(false));\n    } else if (selectedSourcePlatform === 'youtube' && hasYouTubeAuth && isAuthenticated) {\n      setIsLoadingPlaylists(true);\n      fetchYouTubePlaylists()\n        .then(() => {\n          console.log('YouTube playlists fetched successfully');\n        })\n        .catch((error) => {\n          console.error('Error fetching YouTube playlists:', error);\n          showToast('error', 'Failed to load YouTube playlists. Please try again.');\n        })\n        .finally(() => setIsLoadingPlaylists(false));\n    }\n  }, [selectedSourcePlatform, hasSpotifyAuth, hasYouTubeAuth, isAuthenticated, fetchSpotifyPlaylists, fetchYouTubePlaylists, showToast]);\n  \n  // Fetch playlists when reaching playlist selection step\n  useEffect(() => {\n    if (conversionStep === 'select-playlist' && selectedSourcePlatform && userPlaylists.length === 0) {\n      if (selectedSourcePlatform === 'spotify' && hasSpotifyAuth && isAuthenticated) {\n        setIsLoadingPlaylists(true);\n        fetchSpotifyPlaylists().finally(() => setIsLoadingPlaylists(false));\n      } else if (selectedSourcePlatform === 'youtube' && hasYouTubeAuth && isAuthenticated) {\n        setIsLoadingPlaylists(true);\n        fetchYouTubePlaylists().finally(() => setIsLoadingPlaylists(false));\n      }\n    }\n  }, [conversionStep, selectedSourcePlatform, userPlaylists.length, hasSpotifyAuth, hasYouTubeAuth, isAuthenticated, fetchSpotifyPlaylists, fetchYouTubePlaylists]);\n  \n  // YouTube playlists data handling\n  const selectYouTubePlaylist = useCallback(async (id: string) => {\n    dispatch({ type: 'SET_STATUS', payload: ConversionStatus.LOADING_TRACKS });\n    setIsProcessing(true);\n    \n    // Select the playlist\n    dispatch({ type: 'SELECT_PLAYLIST', payload: id });\n    \n    // Call the YouTube API to get tracks from this playlist\n    const accessToken = await getYouTubeToken();\n    \n    if (!accessToken) {\n      showToastWrapper.current?.('error', 'YouTube authentication token not found. Please reconnect.');\n      setIsProcessing(false);\n      return;\n    }\n    \n    // Use a proper abort controller for the fetch\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n    \n    fetchAllYouTubePlaylistItems(id, accessToken)\n      .then(async allItems => {\n        if (!allItems || allItems.length === 0) {\n          console.warn('No tracks found in playlist or playlist is private/empty.');\n          setIsProcessing(false);\n          addToast({\n            type: 'error',\n            title: 'No tracks found',\n            message: 'This playlist appears to be empty or private.'\n          });\n          return;\n        }\n        \n        // Step 1: Collect all videoIds\n        const videoIds = allItems.map((item: any) => item.snippet?.resourceId?.videoId || item.contentDetails?.videoId).filter((id) => id);\n        \n        // Step 2: Fetch video details in batches of 50\n        const batches = [];\n        for (let i = 0; i < videoIds.length; i += 50) {\n          batches.push(videoIds.slice(i, i + 50));\n        }\n        \n        let videoIdToYear: Record<string, number> = {};\n        for (const batch of batches) {\n          try {\n            const detailsResp = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${batch.join(',')}`, {\n              headers: { 'Authorization': `Bearer ${accessToken}` }\n            });\n            if (detailsResp.ok) {\n              const detailsData = await detailsResp.json();\n              detailsData.items.forEach((video: any) => {\n                if (video.id && video.snippet && video.snippet.publishedAt) {\n                  videoIdToYear[video.id] = parseInt(video.snippet.publishedAt.split('-')[0], 10);\n                }\n              });\n            }\n          } catch (err) {\n            console.error('Error fetching video details batch:', err);\n          }\n        }\n        \n        // Step 3: Map tracks with releaseYear\n        const tracks: Track[] = allItems.map((item: any) => {\n          let videoTitle = item.snippet?.title || '';\n          let artists = [item.snippet?.videoOwnerChannelTitle || 'Unknown'];\n          let title = videoTitle;\n          \n          // Smart parsing of video titles to extract artist and title\n          const separators = [' - ', ' – ', ': ', ' \"', \" '\", ' // '];\n          for (const separator of separators) {\n            if (videoTitle.includes(separator)) {\n              const parts = videoTitle.split(separator);\n              if (parts.length >= 2) {\n                artists = [parts[0].trim()];\n                title = parts.slice(1).join(separator).trim()\n                  .replace(/^['\"]/, '')\n                  .replace(/['\"]$/, '');\n                break;\n              }\n            }\n          }\n          \n          const videoId = item.snippet?.resourceId?.videoId || item.contentDetails?.videoId;\n          \n          return {\n            id: item.id || `yt-${Math.random().toString(36).substring(2, 9)}`,\n            name: title,\n            artists: artists,\n            album: item.snippet?.channelTitle || '',\n            duration_ms: 0, // YouTube API doesn't provide duration in the playlist items response\n            popularity: 0,\n            explicit: false,\n            searchQuery: `${artists[0]} ${title}`,\n            videoId,\n            releaseYear: videoIdToYear[videoId]?.toString()\n          };\n        });\n        \n        dispatch({ type: 'SET_TRACKS', payload: tracks as any });\n        setIsProcessing(false);\n        setTimeout(() => {\n          setCurrentWizardStep(3);\n          document.getElementById('playlist-wizard-card')?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        }, 500);\n      })\n      .catch(error => {\n        setIsProcessing(false);\n        console.error('Error fetching YouTube playlist tracks:', error);\n        let errorMessage = 'An error occurred trying to load the YouTube playlist.';\n        \n        if (error.name === 'AbortError') {\n          errorMessage = 'Request timed out. Please try again or check your internet connection.';\n        } else if (error.message && error.message.includes('401')) {\n          errorMessage = 'YouTube authorization expired. Please reconnect your YouTube account.';\n        } else if (error.message && error.message.includes('403')) {\n          errorMessage = 'You don\\'t have permission to access this playlist.';\n        } else if (error.message && error.message.includes('404')) {\n          errorMessage = 'Playlist not found. It may have been deleted or set to private.';\n        }\n        \n        addToast({\n          type: 'error',\n          title: 'Failed to load playlist',\n          message: errorMessage\n        });\n      });\n  }, [dispatch, addToast, showToastWrapper]);\n  \n  // Helper to fetch all YouTube playlist items with pagination\n  async function fetchAllYouTubePlaylistItems(playlistId: string, accessToken: string) {\n    let allItems: any[] = [];\n    let nextPageToken = '';\n    let page = 1;\n    \n    try {\n      do {\n        const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet,contentDetails&maxResults=50&playlistId=${playlistId}` + (nextPageToken ? `&pageToken=${nextPageToken}` : '');\n        const resp = await fetch(url, {\n          headers: { 'Authorization': `Bearer ${accessToken}` }\n        });\n        \n        if (!resp.ok) {\n          throw new Error(`YouTube API error: ${resp.status}`);\n        }\n        \n        const data = await resp.json();\n        if (data.items && data.items.length > 0) {\n          allItems = allItems.concat(data.items);\n        }\n        \n        nextPageToken = data.nextPageToken || '';\n        page++;\n      } while (nextPageToken);\n      \n      return allItems;\n    } catch (err) {\n      console.error('Error fetching playlist items (pagination):', err);\n      return allItems;\n    }\n  }\n  \n  // Handle playlist URL submission with improved error handling\n  const handlePlaylistUrlSubmit = useCallback(async (platform: PlatformKey) => {\n    const url = platform === 'spotify' ? spotifyUrl : youtubeUrl;\n    \n    if (!url.trim()) {\n      showToastWrapper.current?.('error', `Please enter a ${platform} playlist URL`);\n      return;\n    }\n    \n    try {\n      const playlistId = extractPlaylistId(url, platform);\n      console.log('Extracted playlist ID:', playlistId, 'from URL:', url);\n      \n      if (!playlistId) {\n        showToastWrapper.current?.('error', `Invalid ${platform} playlist URL format`);\n        return;\n      }\n      \n      // Validate playlist ID format\n      if (platform === 'spotify' && playlistId.length !== 22) {\n        showToastWrapper.current?.('warning', 'The playlist ID format looks unusual, but trying anyway...');\n      }\n      \n      showToastWrapper.current?.('info', 'Fetching playlist details...');\n      setIsProcessing(true);\n      \n      // Select the playlist for conversion based on platform\n      if (platform === 'spotify') {\n        try {\n          await selectPlaylist(playlistId);\n          console.log('Playlist import successful for ID:', playlistId);\n          setIsProcessing(false); // Explicitly set processing to false\n        } catch (err: unknown) {\n          console.error('Error importing playlist:', err);\n          showToastWrapper.current?.('error', `Failed to import playlist: ${err instanceof Error ? err.message : String(err)}`);\n          setIsProcessing(false);\n        }\n      } else if (platform === 'youtube') {\n        selectYouTubePlaylist(playlistId);\n      }\n    } catch (error) {\n      console.error(`Error parsing ${platform} URL:`, error);\n      showToastWrapper.current?.('error', `Failed to process ${platform} URL`);\n      setIsProcessing(false);\n    }\n  }, [spotifyUrl, youtubeUrl, selectPlaylist, selectYouTubePlaylist]);\n  \n  // Auth helpers\n  const connectToSpotify = useCallback(() => {\n    try {\n      // First, explicitly check if user is authenticated\n      if (!isAuthenticated) {\n        console.warn('User not authenticated when trying to connect to Spotify');\n        showToastWrapper.current?.('error', 'Please sign in to your account first before connecting to Spotify');\n        \n        // Save that user wants to connect to Spotify and redirect to login\n        sessionStorage.setItem('connect_after_login', 'spotify');\n        navigate('/login');\n        return;\n      }\n      \n      // Add a small delay to ensure auth state is properly propagated\n      setTimeout(() => {\n        initSpotifyAuth();\n      }, 100);\n    } catch (error) {\n      console.error('Error initiating Spotify auth:', error);\n      showToastWrapper.current?.('error', 'Failed to connect to Spotify');\n    }\n  }, [isAuthenticated, user, navigate]);\n  \n  const connectToYouTube = useCallback(() => {\n    try {\n      window.location.href = getYouTubeAuthUrl();\n    } catch (error) {\n      console.error('Error initiating YouTube auth:', error);\n      showToastWrapper.current?.('error', 'Failed to connect to YouTube');\n    }\n  }, []);\n  \n  // Determine current conversion step\n  const getCurrentStep = useCallback(() => {\n    switch (state.status) {\n      case ConversionStatus.LOADING_PLAYLISTS:\n      case ConversionStatus.SELECTING_PLAYLIST:\n      case ConversionStatus.IDLE:\n        return 1;\n      case ConversionStatus.LOADING_TRACKS:\n        return 2;\n      case ConversionStatus.MATCHING_TRACKS:\n        return 3;\n      case ConversionStatus.CREATING_PLAYLIST:\n        return 4;\n      case ConversionStatus.SUCCESS:\n        return 4;\n      default:\n        return 1;\n    }\n  }, [state.status]);\n  \n  // Start conversion with proper error handling\n  const handleStartConversion = useCallback(async () => {\n    // Make sure we have a playlist selected\n    if (!state.selectedPlaylistId) {\n      showToastWrapper.current?.('error', 'Please select a playlist first');\n      return;\n    }\n    \n    // Make sure we have the necessary auth for both platforms\n    if (sourcePlatform === 'spotify' && !hasSpotifyAuth) {\n      showToastWrapper.current?.('error', 'Please connect to Spotify first');\n      return;\n    }\n    \n    if (destinationPlatform === 'youtube' && !hasYouTubeAuth) {\n      showToastWrapper.current?.('error', 'Please connect to YouTube first');\n      return;\n    }\n    \n    try {\n      setIsProcessing(true);\n      showToastWrapper.current?.('info', 'Starting conversion process...');\n      \n      // Pass the playlist name and description for the new playlist\n      await startConversion();\n    } catch (error) {\n      console.error('Error starting conversion:', error);\n      setIsProcessing(false);\n      \n      if (error instanceof Error) {\n        showToastWrapper.current?.('error', `Conversion failed: ${error.message}`);\n      } else {\n        showToastWrapper.current?.('error', 'Conversion failed. Please try again.');\n      }\n    }\n  }, [\n    state.selectedPlaylistId,\n    sourcePlatform,\n    destinationPlatform,\n    hasSpotifyAuth,\n    hasYouTubeAuth,\n    startConversion\n  ]);\n  \n  // Add new effect to auto-connect after login\n  useEffect(() => {\n    // Check if we need to auto-connect after login\n    if (isAuthenticated && !isProcessing) {\n      const connectAfterLogin = sessionStorage.getItem('connect_after_login');\n      \n      if (connectAfterLogin) {\n        console.log('Auto-connecting to', connectAfterLogin, 'after login');\n        \n        // Clear the stored value to prevent repeated attempts\n        sessionStorage.removeItem('connect_after_login');\n        \n        // Short delay to ensure auth state has propagated\n        setTimeout(() => {\n          if (connectAfterLogin === 'spotify') {\n            connectToSpotify();\n          } else if (connectAfterLogin === 'youtube') {\n            connectToYouTube();\n          }\n        }, 1000);\n      }\n    }\n  }, [isAuthenticated, isProcessing, connectToSpotify, connectToYouTube]);\n  \n  // Get current auth status based on source and destination platforms\n  const getAuthStatus = useCallback(() => {\n    const sourceAuth = sourcePlatform === 'spotify' ? hasSpotifyAuth : hasYouTubeAuth;\n    const destinationAuth = destinationPlatform === 'spotify' ? hasSpotifyAuth : hasYouTubeAuth;\n    \n    return { sourceAuth, destinationAuth };\n  }, [sourcePlatform, destinationPlatform, hasSpotifyAuth, hasYouTubeAuth]);\n  \n  // Determine which connection handlers to use based on platforms\n  const getConnectionHandlers = useCallback(() => {\n    return {\n      connectToSource: sourcePlatform === 'spotify' ? connectToSpotify : connectToYouTube,\n      connectToDestination: destinationPlatform === 'spotify' ? connectToSpotify : connectToYouTube\n    };\n  }, [sourcePlatform, destinationPlatform, connectToSpotify, connectToYouTube]);\n  \n  // Get auth status for current platforms\n  const { sourceAuth, destinationAuth } = getAuthStatus();\n  \n  // Get appropriate connection handlers\n  const { connectToSource, connectToDestination } = getConnectionHandlers();\n  \n  // Get selected playlist\n  const selectedPlaylistData = useMemo(() => {\n    if (sourcePlatform === 'spotify') {\n      return state.spotifyPlaylists?.find((p: any) => p.id === state.selectedPlaylistId);\n    }\n    \n    return (state.youtubePlaylists || [])\n      .find((p: YouTubePlaylist) => p.id === state.selectedPlaylistId);\n  }, [state.spotifyPlaylists, state.youtubePlaylists, state.selectedPlaylistId, sourcePlatform]);\n  \n  // Define step data for the wizard\n  const wizardSteps = useMemo(() => [\n    {\n      number: 1,\n      label: 'Select Source',\n      help: 'Choose the platform you want to import your playlist from (Spotify or YouTube).',\n      icon: <Settings size={24} />,\n      className: 'text-white'  // Always white since background is dark\n    },\n    {\n      number: 2,\n      label: 'Import Playlist',\n      help: 'Paste your playlist URL or select from your library to import tracks.',\n      icon: <Upload size={24} />,\n      className: 'text-white'\n    },\n    {\n      number: 3,\n      label: 'Review Tracks',\n      help: 'Review the imported tracks and make sure everything looks correct.',\n      icon: <Music size={24} />,\n      className: 'text-white'\n    },\n    {\n      number: 4,\n      label: 'Export Playlist',\n      help: 'Export your playlist to the destination platform with one click.',\n      icon: <Download size={24} />,\n      className: 'text-white'\n    }\n  ], []);\n  \n  // Function to reset the converter (for \"Convert Another\" button)\n  const resetConverter = useCallback(() => {\n    // Reset form values\n    setSpotifyUrl('');\n    setYoutubeUrl('');\n    setPlaylistNameForExport('');\n    setPlaylistDescriptionForExport('');\n    \n    // Reset state\n    setCurrentWizardStep(1);\n    setIsProcessing(false);\n    \n    // Reset conversion context\n    dispatch({ type: 'RESET' });\n  }, [dispatch]);\n  \n  // Function to handle logout or connect missing services\n  const handleLogoutOrConnectMissing = useCallback(() => {\n    if (hasSpotifyAuth && hasYouTubeAuth) {\n      signOut();\n    } else if (!hasSpotifyAuth && !hasYouTubeAuth) {\n      connectToSpotify();\n    } else if (!hasSpotifyAuth) {\n      connectToSpotify();\n    } else {\n      connectToYouTube();\n    }\n  }, [hasSpotifyAuth, hasYouTubeAuth, signOut, connectToSpotify, connectToYouTube]);\n  \n  const steps = [\n    { id: 'source', label: 'Select Source', icon: <Music className=\"w-5 h-5\" /> },\n    { id: 'import', label: 'Import Playlist', icon: <Upload className=\"w-5 h-5\" /> },\n    { id: 'review', label: 'Review Tracks', icon: <Settings className=\"w-5 h-5\" /> },\n    { id: 'export', label: 'Export Playlist', icon: <Download className=\"w-5 h-5\" /> }\n  ];\n  \n  // Fetch profile image on component mount\n  useEffect(() => {\n    const fetchProfileImage = async () => {\n      try {\n        // Try to get profile image from user data or localStorage\n        const storedImage = localStorage.getItem('user_profile_image');\n        if (storedImage) {\n          setProfileImage(storedImage);\n        } else if (user?.photoURL) {\n          setProfileImage(user.photoURL);\n        }\n      } catch (error) {\n        console.error('Error fetching profile image:', error);\n      }\n    };\n    fetchProfileImage();\n  }, [user]);\n  \n  const handleImageUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n    setIsUploadingImage(true);\n    try {\n      // Create a preview URL\n      const imageUrl = URL.createObjectURL(file);\n      setProfileImage(imageUrl);\n      \n      // Store in localStorage for persistence\n      localStorage.setItem('user_profile_image', imageUrl);\n      \n      showToastWrapper.current?.('success', 'Profile image updated successfully!');\n    } catch (error) {\n      console.error('Error uploading image:', error);\n      showToastWrapper.current?.('error', 'Failed to upload image. Please try again.');\n    } finally {\n      setIsUploadingImage(false);\n    }\n  };\n  \n  const renderConverterContent = () => (\n    <div className=\"space-y-6 font-sf-pro\">\n      {/* Premium Mobile Step Navigation */}\n      <div className=\"w-full flex justify-center py-2\">\n        <div className=\"bg-surface-card/98 backdrop-blur-2xl border border-border-default/40 shadow-sm rounded-xl p-3 w-full max-w-sm\">\n          <div className=\"flex items-center justify-between\">\n            {/* Step 1: Select Source */}\n            <div className=\"flex flex-col items-center flex-1\">\n              <div className={cn(\n                \"relative w-12 h-12 rounded-full transition-all duration-300 mb-2\",\n                conversionStep === 'select-source' \n                  ? \"bg-gradient-to-br from-[#34A89B] to-[#2D6F6B] shadow-lg shadow-[#34A89B]/20\" \n                  : \"bg-gradient-to-br from-gray-100/80 to-gray-200/80 dark:from-gray-800/80 dark:to-gray-700/80\"\n              )}>\n                {conversionStep === 'select-source' && (\n                  <div className=\"absolute inset-2 bg-[#34A89B] rounded-full\"></div>\n                )}\n                <div className={cn(\n                  \"relative z-10 flex items-center justify-center w-full h-full\",\n                  conversionStep === 'select-source' ? \"text-white\" : \"text-gray-600 dark:text-gray-400\"\n                )}>\n                  <Settings className=\"w-6 h-6\" />\n                </div>\n              </div>\n            </div>\n            \n            {/* Connector Line */}\n            <div className=\"w-4 h-0.5 bg-border-default/40 mx-1\" />\n            \n            {/* Step 2: Import Playlist */}\n            <div className=\"flex flex-col items-center flex-1\">\n              <div className={cn(\n                \"relative w-12 h-12 rounded-full transition-all duration-300 mb-2\",\n                conversionStep === 'select-destination' \n                  ? \"bg-gradient-to-br from-[#34A89B] to-[#2D6F6B] shadow-lg shadow-[#34A89B]/20\" \n                  : \"bg-gradient-to-br from-gray-100/80 to-gray-200/80 dark:from-gray-800/80 dark:to-gray-700/80\"\n              )}>\n                {conversionStep === 'select-destination' && (\n                  <div className=\"absolute inset-2 bg-[#34A89B] rounded-full\"></div>\n                )}\n                <div className={cn(\n                  \"relative z-10 flex items-center justify-center w-full h-full\",\n                  conversionStep === 'select-destination' ? \"text-white\" : \"text-gray-600 dark:text-gray-400\"\n                )}>\n                  <Upload className=\"w-6 h-6\" />\n                </div>\n              </div>\n            </div>\n            \n            {/* Connector Line */}\n            <div className=\"w-4 h-0.5 bg-border-default/40 mx-1\" />\n            \n            {/* Step 3: Select Playlist */}\n            <div className=\"flex flex-col items-center flex-1\">\n              <div className={cn(\n                \"relative w-12 h-12 rounded-full transition-all duration-300 mb-2\",\n                conversionStep === 'select-playlist' \n                  ? \"bg-gradient-to-br from-[#34A89B] to-[#2D6F6B] shadow-lg shadow-[#34A89B]/20\" \n                  : \"bg-gradient-to-br from-gray-100/80 to-gray-200/80 dark:from-gray-800/80 dark:to-gray-700/80\"\n              )}>\n                {conversionStep === 'select-playlist' && (\n                  <div className=\"absolute inset-2 bg-[#34A89B] rounded-full\"></div>\n                )}\n                <div className={cn(\n                  \"relative z-10 flex items-center justify-center w-full h-full\",\n                  conversionStep === 'select-playlist' ? \"text-white\" : \"text-gray-600 dark:text-gray-400\"\n                )}>\n                  <ListMusic className=\"w-6 h-6\" />\n                </div>\n              </div>\n            </div>\n            \n            {/* Connector Line */}\n            <div className=\"w-4 h-0.5 bg-border-default/40 mx-1\" />\n            \n            {/* Step 4: Converting */}\n            <div className=\"flex flex-col items-center flex-1\">\n              <div className={cn(\n                \"relative w-12 h-12 rounded-full transition-all duration-300 mb-2\",\n                conversionStep === 'converting' \n                  ? \"bg-gradient-to-br from-[#34A89B] to-[#2D6F6B] shadow-lg shadow-[#34A89B]/20\" \n                  : \"bg-gradient-to-br from-gray-100/80 to-gray-200/80 dark:from-gray-800/80 dark:to-gray-700/80\"\n              )}>\n                {conversionStep === 'converting' && (\n                  <div className=\"absolute inset-2 bg-[#34A89B] rounded-full\"></div>\n                )}\n                <div className={cn(\n                  \"relative z-10 flex items-center justify-center w-full h-full\",\n                  conversionStep === 'converting' ? \"text-white\" : \"text-gray-600 dark:text-gray-400\"\n                )}>\n                  <Download className=\"w-6 h-6\" />\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      {/* Conversion Workflow Header */}\n      <motion.div \n        className=\"text-center mb-8\"\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.8, ease: [0.25, 0.46, 0.45, 0.94] }}\n      >\n        <h1 className=\"text-4xl font-bold bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent mb-3 font-sf-pro-display\">\n          Convert Playlists\n        </h1>\n        <p className=\"text-muted-foreground text-lg leading-relaxed max-w-sm mx-auto font-sf-pro-text\">\n          Transfer your music between platforms seamlessly\n        </p>\n      </motion.div>\n      \n      {/* Conversion Steps */}\n      <AnimatePresence mode=\"wait\">\n        {conversionStep === 'select-source' && (\n          <motion.div\n            key=\"select-source\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.3 }}\n            className=\"space-y-6\"\n          >\n            {/* Step Header */}\n            <div className=\"text-center mb-6\">\n              <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Select Source</h2>\n              <p className=\"text-gray-600 dark:text-gray-400\">Choose the platform you want to import your playlist from</p>\n            </div>\n            \n            {/* Source Platform Selection */}\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Source Platform</h3>\n              \n              {/* Spotify Option */}\n              <motion.div\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                className={`p-4 rounded-xl border-2 cursor-pointer transition-all duration-300 ${\n                  selectedSourcePlatform === 'spotify'\n                    ? 'border-green-500 bg-green-50 dark:bg-green-900/20'\n                    : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800'\n                }`}\n                onClick={() => {\n                  setSelectedSourcePlatform('spotify');\n                  setConversionStep('select-destination');\n                  hapticLight();\n                }}\n              >\n                <div className=\"flex items-center space-x-4\">\n                  <motion.div \n                    className=\"w-16 h-16 bg-gradient-to-br from-[#1DB954] to-[#1ED760] rounded-xl flex items-center justify-center shadow-lg relative overflow-hidden\"\n                    whileHover={{ scale: 1.05 }}\n                    whileTap={{ scale: 0.95 }}\n                  >\n                                          {(() => {\n                        const imageUrl = spotifyUserProfile?.images?.[0]?.url || spotifyUserProfile?.imageUrl;\n                        \n                        return hasSpotifyAuth && imageUrl ? (\n                        <motion.img\n                          src={imageUrl}\n                          alt=\"Spotify Profile\"\n                          className=\"w-full h-full object-cover rounded-xl\"\n                          initial={{ opacity: 0, scale: 0.8 }}\n                          animate={{ opacity: 1, scale: 1 }}\n                          transition={{ duration: 0.3 }}\n                          onError={(e) => {\n                            e.currentTarget.style.display = 'none';\n                            e.currentTarget.nextElementSibling?.classList.remove('hidden');\n                          }}\n                        />\n                      ) : null;\n                    })()}\n                    <motion.div \n                      className={cn(\n                        \"absolute inset-0 flex items-center justify-center\",\n                        hasSpotifyAuth && (spotifyUserProfile?.images?.[0]?.url || spotifyUserProfile?.imageUrl) ? \"hidden\" : \"\"\n                      )}\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      transition={{ duration: 0.3 }}\n                    >\n                      <FaSpotify className=\"w-8 h-8 text-white drop-shadow-lg\" />\n                    </motion.div>\n                  </motion.div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-semibold text-gray-900 dark:text-white\">Spotify</h4>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {hasSpotifyAuth ? 'Connected' : 'Not connected'}\n                    </p>\n                  </div>\n                  {selectedSourcePlatform === 'spotify' && (\n                    <div className=\"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center\">\n                      <Check className=\"w-4 h-4 text-white\" />\n                    </div>\n                  )}\n                </div>\n              </motion.div>\n              \n              {/* YouTube Option */}\n              <motion.div\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                className={`p-4 rounded-xl border-2 cursor-pointer transition-all duration-300 ${\n                  selectedSourcePlatform === 'youtube'\n                    ? 'border-red-500 bg-red-50 dark:bg-red-900/20'\n                    : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800'\n                }`}\n                onClick={() => {\n                  setSelectedSourcePlatform('youtube');\n                  setConversionStep('select-destination');\n                  hapticLight();\n                }}\n              >\n                <div className=\"flex items-center space-x-4\">\n                  <motion.div \n                    className=\"w-16 h-16 bg-gradient-to-br from-[#FF0000] to-[#FF4444] rounded-xl flex items-center justify-center shadow-lg relative overflow-hidden\"\n                    whileHover={{ scale: 1.05 }}\n                    whileTap={{ scale: 0.95 }}\n                  >\n                    {hasYouTubeAuth && youtubeUserProfile?.picture ? (\n                      <motion.img\n                        src={youtubeUserProfile.picture}\n                        alt=\"YouTube Profile\"\n                        className=\"w-full h-full object-cover rounded-xl\"\n                        initial={{ opacity: 0, scale: 0.8 }}\n                        animate={{ opacity: 1, scale: 1 }}\n                        transition={{ duration: 0.3 }}\n                        onError={(e) => {\n                          console.log('YouTube profile image failed to load');\n                          e.currentTarget.style.display = 'none';\n                          e.currentTarget.nextElementSibling?.classList.remove('hidden');\n                        }}\n                        onLoad={() => {\n                          console.log('YouTube profile image loaded successfully');\n                        }}\n                      />\n                    ) : null}\n                    <motion.div \n                      className={cn(\n                        \"absolute inset-0 flex items-center justify-center\",\n                        hasYouTubeAuth && youtubeUserProfile?.picture ? \"hidden\" : \"\"\n                      )}\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      transition={{ duration: 0.3 }}\n                    >\n                      <img \n                        src=\"/images/YouTube connection card logo.png\" \n                        alt=\"YouTube\" \n                        style={{ \n                          height: 32, \n                          width: 'auto', \n                          objectFit: 'contain', \n                          display: 'block',\n                          minWidth: '32px'\n                        }} \n                        className=\"w-8 h-8 drop-shadow-lg\" \n                      />\n                    </motion.div>\n                  </motion.div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-semibold text-gray-900 dark:text-white\">YouTube</h4>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {hasYouTubeAuth ? 'Connected' : 'Not connected'}\n                    </p>\n                  </div>\n                  {selectedSourcePlatform === 'youtube' && (\n                    <div className=\"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center\">\n                      <Check className=\"w-4 h-4 text-white\" />\n                    </div>\n                  )}\n                </div>\n              </motion.div>\n            </div>\n          </motion.div>\n        )}\n        \n        {conversionStep === 'select-destination' && (\n          <motion.div\n            key=\"select-destination\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.3 }}\n            className=\"space-y-6\"\n          >\n            {/* Step Header */}\n            <div className=\"text-center mb-6\">\n              <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Select Destination</h2>\n              <p className=\"text-gray-600 dark:text-gray-400\">Choose where you want to export your playlist</p>\n            </div>\n            \n            {/* Destination Platform Selection */}\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Destination Platform</h3>\n              \n              {/* Spotify Option */}\n              <motion.div\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                className={`p-4 rounded-xl border-2 cursor-pointer transition-all duration-300 ${\n                  selectedDestinationPlatform === 'spotify'\n                    ? 'border-green-500 bg-green-50 dark:bg-green-900/20'\n                    : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800'\n                }`}\n                onClick={() => {\n                  setSelectedDestinationPlatform('spotify');\n                  setConversionStep('select-playlist');\n                  hapticLight();\n                }}\n              >\n                <div className=\"flex items-center space-x-4\">\n                  <motion.div \n                    className=\"w-16 h-16 bg-gradient-to-br from-[#1DB954] to-[#1ED760] rounded-xl flex items-center justify-center shadow-lg relative overflow-hidden\"\n                    whileHover={{ scale: 1.05 }}\n                    whileTap={{ scale: 0.95 }}\n                  >\n                                          {(() => {\n                        const imageUrl = spotifyUserProfile?.images?.[0]?.url || spotifyUserProfile?.imageUrl;\n                        \n                        return hasSpotifyAuth && imageUrl ? (\n                        <motion.img\n                          src={imageUrl}\n                          alt=\"Spotify Profile\"\n                          className=\"w-full h-full object-cover rounded-xl\"\n                          initial={{ opacity: 0, scale: 0.8 }}\n                          animate={{ opacity: 1, scale: 1 }}\n                          transition={{ duration: 0.3 }}\n                          onError={(e) => {\n                            e.currentTarget.style.display = 'none';\n                            e.currentTarget.nextElementSibling?.classList.remove('hidden');\n                          }}\n                        />\n                      ) : null;\n                    })()}\n                    <motion.div \n                      className={cn(\n                        \"absolute inset-0 flex items-center justify-center\",\n                        hasSpotifyAuth && (spotifyUserProfile?.images?.[0]?.url || spotifyUserProfile?.imageUrl) ? \"hidden\" : \"\"\n                      )}\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      transition={{ duration: 0.3 }}\n                    >\n                      <FaSpotify className=\"w-8 h-8 text-white drop-shadow-lg\" />\n                    </motion.div>\n                  </motion.div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-semibold text-gray-900 dark:text-white\">Spotify</h4>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {hasSpotifyAuth ? 'Connected' : 'Not connected'}\n                    </p>\n                  </div>\n                  {selectedDestinationPlatform === 'spotify' && (\n                    <div className=\"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center\">\n                      <Check className=\"w-4 h-4 text-white\" />\n                    </div>\n                  )}\n                </div>\n              </motion.div>\n              \n              {/* YouTube Option */}\n              <motion.div\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                className={`p-4 rounded-xl border-2 cursor-pointer transition-all duration-300 ${\n                  selectedDestinationPlatform === 'youtube'\n                    ? 'border-red-500 bg-red-50 dark:bg-red-900/20'\n                    : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800'\n                }`}\n                onClick={() => {\n                  setSelectedDestinationPlatform('youtube');\n                  setConversionStep('select-playlist');\n                  hapticLight();\n                }}\n              >\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"w-16 h-16 bg-gradient-to-br from-[#FF0000] to-[#FF4444] rounded-xl flex items-center justify-center\">\n                    <img \n                      src=\"/images/YouTube connection card logo.png\" \n                      alt=\"YouTube\" \n                      style={{ \n                        height: 32, \n                        width: 'auto', \n                        objectFit: 'contain', \n                        display: 'block',\n                        minWidth: '32px'\n                      }} \n                      className=\"w-8 h-8 drop-shadow-lg\" \n                    />\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-semibold text-gray-900 dark:text-white\">YouTube</h4>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {hasYouTubeAuth ? 'Connected' : 'Not connected'}\n                    </p>\n                  </div>\n                  {selectedDestinationPlatform === 'youtube' && (\n                    <div className=\"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center\">\n                      <Check className=\"w-4 h-4 text-white\" />\n                    </div>\n                  )}\n                </div>\n              </motion.div>\n            </div>\n            \n            {/* Back Button */}\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => {\n                setConversionStep('select-source');\n                setSelectedDestinationPlatform(null);\n                hapticLight();\n              }}\n              className=\"w-full py-3 px-4 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-xl font-medium transition-colors\"\n            >\n              Back to Source Selection\n            </motion.button>\n          </motion.div>\n        )}\n        \n        {conversionStep === 'select-playlist' && (\n          <motion.div\n            key=\"select-playlist\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.3 }}\n            className=\"space-y-6\"\n          >\n            {/* Step Header */}\n            <div className=\"text-center mb-6\">\n              <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Select Playlist</h2>\n              <p className=\"text-gray-600 dark:text-gray-400\">Choose the playlist you want to convert</p>\n            </div>\n            \n            {/* Playlist Selection */}\n            <div className=\"space-y-4\">\n              {isLoadingPlaylists ? (\n                <div className=\"text-center py-8\">\n                  <Loader2 className=\"w-12 h-12 text-gray-400 mx-auto mb-4 animate-spin\" />\n                  <p className=\"text-gray-600 dark:text-gray-400\">Loading playlists...</p>\n                </div>\n              ) : userPlaylists.length > 0 ? (\n                <div className=\"space-y-3\">\n                  {(() => {\n                    console.log('Rendering playlists:', userPlaylists);\n                    console.log('Selected source platform:', selectedSourcePlatform);\n                    userPlaylists.forEach((playlist, index) => {\n                      console.log(`Playlist ${index}:`, {\n                        id: playlist.id,\n                        name: playlist.name || playlist.snippet?.title || 'Untitled Playlist',\n                        snippet: playlist.snippet,\n                        imageUrl: playlist.imageUrl,\n                        tracks: playlist.tracks,\n                        contentDetails: playlist.contentDetails,\n                        trackCount: playlist.trackCount\n                      });\n                    });\n                    return userPlaylists.map((playlist, index) => (\n                    <motion.div\n                      key={playlist.id}\n                      whileHover={{ scale: 1.02 }}\n                      whileTap={{ scale: 0.98 }}\n                      className={`p-4 rounded-xl border cursor-pointer transition-all duration-300 ${\n                        state.selectedPlaylistId === playlist.id\n                          ? 'border-pink-500 bg-gradient-to-br from-pink-500/20 via-purple-500/20 to-blue-600/20 backdrop-blur-sm shadow-lg'\n                          : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800'\n                      }`}\n                      onClick={() => {\n                        setSelectedPlaylist(playlist);\n                        // Call the appropriate select function based on platform\n                        if (selectedSourcePlatform === 'spotify') {\n                          selectPlaylist(playlist.id);\n                        } else if (selectedSourcePlatform === 'youtube') {\n                          selectYouTubePlaylist(playlist.id);\n                        }\n                        hapticLight();\n                        \n                        // Show toast notification\n                        showToastWrapper.current?.('info', `Starting conversion of \"${playlist.name || playlist.snippet?.title || 'Playlist'}\"...`);\n                        \n                        // Automatically start conversion after a short delay\n                        setTimeout(() => {\n                          setConversionStep('converting');\n                          handleStartConversion();\n                        }, 800);\n                      }}\n                    >\n                      <div className=\"flex items-center space-x-4\">\n                          {(() => {\n                            // Handle different image structures for Spotify vs YouTube\n                            let imageUrl = playlist.imageUrl;\n                            if (!imageUrl && playlist.snippet?.thumbnails?.default?.url) {\n                              imageUrl = playlist.snippet.thumbnails.default.url;\n                            }\n                            \n                            // Filter out invalid YouTube thumbnail URLs\n                            if (imageUrl && (\n                              imageUrl.includes('no_thumbnail.jpg')\n                            )) {\n                              imageUrl = null;\n                            }\n                            \n                            return imageUrl ? (\n                              <>\n                                                              <img \n                                src={imageUrl} \n                                alt={`${(playlist.name || playlist.snippet?.title || 'Playlist')} cover`}\n                                className=\"w-12 h-12 rounded-xl object-cover\"\n                                onError={(e) => {\n                                  console.warn('Failed to load playlist thumbnail:', imageUrl);\n                                  // Hide broken image and show fallback\n                                  e.currentTarget.style.display = 'none';\n                                  e.currentTarget.nextElementSibling?.classList.remove('hidden');\n                                }}\n                                onLoad={() => {\n                                  console.log('Successfully loaded playlist thumbnail:', imageUrl);\n                                }}\n                              />\n                                <div className={`w-12 h-12 rounded-xl flex items-center justify-center hidden ${\n                                  selectedSourcePlatform === 'spotify' \n                                    ? 'bg-gradient-to-br from-green-500 to-green-600' \n                                    : 'bg-gradient-to-br from-red-500 to-red-600'\n                                }`}>\n                                  <Music className=\"w-6 h-6 text-white\" />\n                                </div>\n                              </>\n                            ) : (\n                              <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${\n                                selectedSourcePlatform === 'spotify' \n                                  ? 'bg-gradient-to-br from-green-500 to-green-600' \n                                  : 'bg-gradient-to-br from-red-500 to-red-600'\n                              }`}>\n                                <Music className=\"w-6 h-6 text-white\" />\n                              </div>\n                            );\n                          })()}\n                        <div className=\"flex-1\">\n                            <h4 className={`font-semibold ${\n                              state.selectedPlaylistId === playlist.id\n                                ? 'text-white'\n                                : 'text-gray-900 dark:text-white'\n                            }`}>\n                              {playlist.name || playlist.snippet?.title || 'Untitled Playlist'}\n                            </h4>\n                          <p className={`text-sm ${\n                            state.selectedPlaylistId === playlist.id\n                              ? 'text-white/80'\n                              : 'text-gray-600 dark:text-gray-400'\n                          }`}>\n                              {(() => {\n                                // Handle different track count structures for Spotify vs YouTube\n                                let trackCount = 0;\n                                if (playlist.tracks?.total !== undefined) {\n                                  trackCount = playlist.tracks.total;\n                                } else if (playlist.contentDetails?.itemCount !== undefined) {\n                                  trackCount = playlist.contentDetails.itemCount;\n                                } else if (playlist.trackCount !== undefined) {\n                                  trackCount = playlist.trackCount;\n                                }\n                                \n                                let ownerInfo = '';\n                                if (playlist.owner) {\n                                  ownerInfo = ` • ${playlist.owner}`;\n                                } else if (playlist.snippet?.channelTitle) {\n                                  ownerInfo = ` • ${playlist.snippet.channelTitle}`;\n                                }\n                                \n                                return `${trackCount} tracks${ownerInfo}`;\n                              })()}\n                          </p>\n                        </div>\n                        {state.selectedPlaylistId === playlist.id ? (\n                          <div className=\"w-6 h-6 bg-gradient-to-r from-pink-500 to-purple-500 rounded-full flex items-center justify-center\">\n                            <Check className=\"w-4 h-4 text-white\" />\n                          </div>\n                        ) : (\n                          <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n                        )}\n                      </div>\n                    </motion.div>\n                    ));\n                  })()}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Music className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-600 dark:text-gray-400\">\n                    {selectedSourcePlatform === 'spotify' && !hasSpotifyAuth \n                      ? 'Please connect your Spotify account first'\n                      : selectedSourcePlatform === 'youtube' && !hasYouTubeAuth\n                      ? 'Please connect your YouTube account first'\n                      : selectedSourcePlatform === 'youtube' && hasYouTubeAuth && youtubeError?.includes('quota exceeded')\n                      ? 'YouTube API quota exceeded. Please try again later.'\n                      : 'No playlists found. Please check your account connection.'}\n                  </p>\n                  {(selectedSourcePlatform === 'spotify' && !hasSpotifyAuth) || \n                   (selectedSourcePlatform === 'youtube' && !hasYouTubeAuth) ? (\n                    <motion.button\n                      whileHover={{ scale: 1.02 }}\n                      whileTap={{ scale: 0.98 }}\n                      onClick={() => setActiveTab('connections')}\n                      className=\"mt-4 px-6 py-2 bg-gradient-to-r from-[#FF7A59] to-[#FF007A] text-white rounded-xl font-medium\"\n                    >\n                      Connect Account\n                    </motion.button>\n                  ) : selectedSourcePlatform === 'youtube' && hasYouTubeAuth && youtubeError?.includes('quota exceeded') ? (\n                    <motion.button\n                      whileHover={{ scale: 1.02 }}\n                      whileTap={{ scale: 0.98 }}\n                      onClick={() => {\n                        setIsLoadingPlaylists(true);\n                        fetchYouTubePlaylists().finally(() => setIsLoadingPlaylists(false));\n                      }}\n                      className=\"mt-4 px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-medium\"\n                    >\n                      Try Again Later\n                    </motion.button>\n                  ) : (\n                    <motion.button\n                      whileHover={{ scale: 1.02 }}\n                      whileTap={{ scale: 0.98 }}\n                      onClick={() => {\n                        if (selectedSourcePlatform === 'spotify' && hasSpotifyAuth) {\n                          setIsLoadingPlaylists(true);\n                          fetchSpotifyPlaylists().finally(() => setIsLoadingPlaylists(false));\n                        } else if (selectedSourcePlatform === 'youtube' && hasYouTubeAuth) {\n                          setIsLoadingPlaylists(true);\n                          fetchYouTubePlaylists().finally(() => setIsLoadingPlaylists(false));\n                        }\n                      }}\n                      className=\"mt-4 px-6 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium\"\n                    >\n                      Retry Loading Playlists\n                    </motion.button>\n                  )}\n                </div>\n              )}\n            </div>\n            \n\n            \n            {/* Back Button */}\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => {\n                setConversionStep('select-destination');\n                hapticLight();\n              }}\n              className=\"w-full py-3 px-4 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-xl font-medium transition-colors\"\n            >\n              Back to Destination Selection\n            </motion.button>\n          </motion.div>\n        )}\n        \n        {conversionStep === 'converting' && (\n          <motion.div\n            key=\"converting\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.3 }}\n            className=\"space-y-6\"\n          >\n            {/* Conversion Progress */}\n            <div className=\"text-center mb-6\">\n              <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Converting...</h2>\n              <p className=\"text-gray-600 dark:text-gray-400\">Please wait while we convert your playlist</p>\n            </div>\n            \n            <div className=\"space-y-4\">\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700\">\n                <div className=\"flex items-center space-x-4 mb-4\">\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-[#FF7A59] to-[#FF007A] rounded-xl flex items-center justify-center\">\n                    <Loader2 className=\"w-6 h-6 text-white animate-spin\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-semibold text-gray-900 dark:text-white\">Converting Playlist</h4>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {selectedPlaylist?.name || 'Playlist'}\n                    </p>\n                  </div>\n                </div>\n                \n                {/* Progress Bar */}\n                <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-4\">\n                  <motion.div\n                    className=\"bg-gradient-to-r from-[#FF7A59] to-[#FF007A] h-2 rounded-full\"\n                    initial={{ width: 0 }}\n                    animate={{ width: `${conversionProgress}%` }}\n                    transition={{ duration: 0.5 }}\n                  />\n                </div>\n                \n                <p className=\"text-sm text-gray-600 dark:text-gray-400 text-center\">\n                  {conversionProgress}% complete\n                </p>\n              </div>\n            </div>\n          </motion.div>\n        )}\n        \n        {conversionStep === 'success' && (\n          <motion.div\n            key=\"success\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.3 }}\n            className=\"space-y-6\"\n          >\n            {/* Success Header */}\n            <div className=\"text-center mb-6\">\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ duration: 0.5, type: \"spring\", stiffness: 200 }}\n                className=\"w-20 h-20 mx-auto bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mb-4 shadow-lg\"\n              >\n                <Check className=\"w-10 h-10 text-white\" />\n              </motion.div>\n              <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Conversion Complete!</h2>\n              <p className=\"text-gray-600 dark:text-gray-400\">Your playlist has been successfully converted</p>\n            </div>\n            \n            <div className=\"space-y-4\">\n              {/* Success Card */}\n              <motion.div \n                className=\"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 shadow-lg\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.2 }}\n              >\n                <div className=\"flex items-center space-x-4 mb-4\">\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center\">\n                    <Check className=\"w-6 h-6 text-white\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-semibold text-gray-900 dark:text-white\">Conversion Successful</h4>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {selectedPlaylist?.name || 'Playlist'} has been converted\n                    </p>\n                  </div>\n                </div>\n                \n                {/* Progress Bar - 100% Complete */}\n                <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-4\">\n                  <motion.div\n                    className=\"bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full\"\n                    initial={{ width: 0 }}\n                    animate={{ width: \"100%\" }}\n                    transition={{ duration: 0.8, delay: 0.3 }}\n                  />\n                </div>\n                \n                <p className=\"text-sm text-gray-600 dark:text-gray-400 text-center font-medium\">\n                  100% complete\n                </p>\n              </motion.div>\n              \n              {/* Action Buttons */}\n              <motion.div \n                className=\"space-y-3\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.4 }}\n              >\n                {/* View Playlist Button */}\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={() => {\n                    const destinationIsSpotify = destinationPlatform === 'spotify';\n                    const playlistUrl = destinationIsSpotify \n                      ? state.spotifyPlaylistUrl \n                      : state.youtubePlaylistUrl;\n                    if (playlistUrl) {\n                      window.open(playlistUrl, '_blank');\n                    }\n                    hapticMedium();\n                  }}\n                  className=\"w-full py-4 px-6 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200\"\n                >\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <ExternalLink className=\"w-5 h-5\" />\n                    <span>View Playlist</span>\n                  </div>\n                </motion.button>\n                \n                {/* Convert Another Button */}\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={() => {\n                    setConversionStep('select-source');\n                    resetConverter();\n                    hapticMedium();\n                  }}\n                  className=\"w-full py-4 px-6 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-semibold border border-gray-200 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-200\"\n                >\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <Plus className=\"w-5 h-5\" />\n                    <span>Convert Another Playlist</span>\n                  </div>\n                </motion.button>\n              </motion.div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n  \n  const renderConnectionsContent = () => (\n    <div className=\"space-y-6\">\n      {/* Enhanced Header with Better Typography */}\n      <motion.div \n        className=\"text-center mb-8\"\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.6, ease: \"easeOut\" }}\n      >\n        <motion.div\n          className=\"relative mb-4\"\n          initial={{ scale: 0.8 }}\n          animate={{ scale: 1 }}\n          transition={{ duration: 0.5, delay: 0.2 }}\n        >\n          <div className=\"w-20 h-20 mx-auto bg-gradient-to-br from-[#FF7A59] to-[#FF007A] rounded-full flex items-center justify-center shadow-2xl\">\n            <LinkIcon className=\"w-10 h-10 text-white\" />\n          </div>\n        </motion.div>\n        \n        <h2 className=\"text-3xl font-bold bg-gradient-to-r from-[#FF7A59] to-[#FF007A] bg-clip-text text-transparent mb-3 font-sf-pro-display\">\n          Platform Connections\n        </h2>\n        <p className=\"text-muted-foreground text-lg leading-relaxed max-w-sm mx-auto font-sf-pro-text\">\n          Connect your music platforms to start converting playlists\n        </p>\n      </motion.div>\n      \n      {/* Mobile-Optimized Connection Cards */}\n      <div className=\"space-y-4\">\n        {/* Spotify Connection Card */}\n        <motion.div\n          initial={{ opacity: 0, x: -20 }}\n          animate={{ opacity: 1, x: 0 }}\n          transition={{ duration: 0.5, delay: 0.3 }}\n        >\n          <MobileCard className=\"bg-gradient-to-br from-[#1DB954]/10 to-[#1DB954]/5 border-[#1DB954]/20 shadow-lg backdrop-blur-sm overflow-hidden\">\n            <div className=\"relative\">\n              {/* Background Glow Effect */}\n              <div className=\"absolute inset-0 bg-gradient-to-br from-[#1DB954]/20 to-transparent opacity-50\" />\n              \n              {/* Card Content */}\n              <div className=\"relative z-10 p-6\">\n                <div className=\"flex items-center justify-between mb-6\">\n                  <div className=\"flex items-center space-x-4\">\n                    <motion.div \n                      className=\"w-16 h-16 bg-gradient-to-br from-[#1DB954] to-[#1ED760] rounded-2xl flex items-center justify-center shadow-lg relative overflow-hidden\"\n                      whileHover={{ scale: 1.05 }}\n                      whileTap={{ scale: 0.95 }}\n                    >\n                      {(() => {\n                        // Try both images[0].url and imageUrl\n                        const imageUrl = spotifyUserProfile?.images?.[0]?.url || spotifyUserProfile?.imageUrl;\n                        \n                        return hasSpotifyAuth && imageUrl ? (\n                          <motion.img\n                            src={imageUrl}\n                            alt=\"Spotify Profile\"\n                            className=\"w-full h-full object-cover rounded-2xl\"\n                            initial={{ opacity: 0, scale: 0.8 }}\n                            animate={{ opacity: 1, scale: 1 }}\n                            transition={{ duration: 0.3 }}\n                                                      onError={(e) => {\n                            e.currentTarget.style.display = 'none';\n                            e.currentTarget.nextElementSibling?.classList.remove('hidden');\n                          }}\n                          />\n                        ) : null;\n                      })()}\n                      <motion.div \n                        className={cn(\n                          \"absolute inset-0 flex items-center justify-center\",\n                          hasSpotifyAuth && (spotifyUserProfile?.images?.[0]?.url || spotifyUserProfile?.imageUrl) ? \"hidden\" : \"\"\n                        )}\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ duration: 0.3 }}\n                      >\n                        <FaSpotify className=\"w-8 h-8 text-white drop-shadow-lg\" />\n                      </motion.div>\n                    </motion.div>\n                    <div>\n                      <h3 className=\"font-bold text-xl text-gray-900 dark:text-white font-sf-pro-display\">Spotify</h3>\n                      <p className=\"text-sm text-muted-foreground font-sf-pro-text\">\n                        {hasSpotifyAuth ? 'Account linked' : 'Not connected'}\n                      </p>\n                    </div>\n                  </div>\n                  <motion.div \n                    className={cn(\n                      \"px-3 py-1.5 rounded-full text-xs font-semibold transition-all duration-300\",\n                      hasSpotifyAuth \n                        ? \"bg-[#1DB954]/20 text-[#1DB954] border border-[#1DB954]/30\" \n                        : \"bg-gray-500/20 text-gray-600 border border-gray-500/30\"\n                    )}\n                    animate={hasSpotifyAuth ? { scale: [1, 1.05, 1] } : {}}\n                    transition={{ duration: 2, repeat: Infinity, repeatDelay: 3 }}\n                  >\n                    {hasSpotifyAuth ? 'Connected' : 'Disconnected'}\n                  </motion.div>\n                </div>\n                \n                {/* Account Details - Collapsible for Mobile */}\n                {hasSpotifyAuth && spotifyUserProfile && (\n                  <motion.div \n                    className=\"mb-6 p-4 bg-white/50 dark:bg-gray-800/50 rounded-xl border border-gray-200/50 dark:border-gray-700/50 backdrop-blur-sm\"\n                    initial={{ opacity: 0, height: 0 }}\n                    animate={{ opacity: 1, height: 'auto' }}\n                    transition={{ duration: 0.5, delay: 0.4 }}\n                  >\n                    <h4 className=\"font-semibold text-gray-900 dark:text-white mb-3 flex items-center font-sf-pro-display\">\n                      <Sparkles className=\"w-4 h-4 mr-2 text-[#1DB954]\" />\n                      Account Details\n                    </h4>\n                    <div className=\"grid grid-cols-1 gap-3 text-sm\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Name:</span>\n                        <span className=\"font-medium text-[#1DB954]\">{spotifyUserProfile.displayName || 'Premium User'}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Email:</span>\n                        <span className=\"font-medium\">{spotifyUserProfile.email || 'N/A'}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Plan:</span>\n                        <span className=\"font-medium text-[#1DB954]\">Premium</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Status:</span>\n                        <span className=\"font-medium text-green-600\">Active</span>\n                      </div>\n                    </div>\n                  </motion.div>\n                )}\n                \n                {/* Action Buttons */}\n                <div className=\"space-y-3\">\n                  <MobileButton\n                    onClick={() => {\n                      if (!hasSpotifyAuth) {\n                        connectToSpotify();\n                      } else {\n                        disconnectFromSpotify();\n                      }\n                    }}\n                    className=\"w-full h-14 text-base font-semibold bg-gradient-to-r from-[#1DB954] to-[#1ED760] hover:from-[#1ED760] hover:to-[#1DB954] text-white shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] rounded-2xl border-0\"\n                    disabled={isConnectingSpotify}\n                  >\n                    {isConnectingSpotify ? (\n                      <motion.div className=\"flex items-center justify-center\">\n                        <Loader2 className=\"w-5 h-5 mr-3 animate-spin\" />\n                        Connecting...\n                      </motion.div>\n                    ) : hasSpotifyAuth ? (\n                      <motion.div className=\"flex items-center justify-center\">\n                        <Unlock className=\"w-5 h-5 mr-3\" />\n                        Disconnect Spotify\n                      </motion.div>\n                    ) : (\n                      <motion.div className=\"flex items-center justify-center\">\n                        <Lock className=\"w-5 h-5 mr-3\" />\n                        Connect Spotify\n                      </motion.div>\n                    )}\n                  </MobileButton>\n                  \n                  {spotifyError && (\n                    <motion.div \n                      className=\"p-4 bg-red-500/10 border border-red-500/20 rounded-xl\"\n                      initial={{ opacity: 0, scale: 0.9 }}\n                      animate={{ opacity: 1, scale: 1 }}\n                    >\n                      <div className=\"flex items-center space-x-2\">\n                        <AlertCircle className=\"w-4 h-4 text-red-600\" />\n                        <p className=\"text-sm text-red-600 font-medium\">\n                          {typeof spotifyError === 'string' ? spotifyError : 'Spotify connection error'}\n                        </p>\n                      </div>\n                    </motion.div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </MobileCard>\n        </motion.div>\n        \n        {/* YouTube Connection Card */}\n        <motion.div\n          initial={{ opacity: 0, x: 20 }}\n          animate={{ opacity: 1, x: 0 }}\n          transition={{ duration: 0.5, delay: 0.4 }}\n        >\n          <MobileCard className=\"bg-gradient-to-br from-[#FF0000]/10 to-[#FF0000]/5 border-[#FF0000]/20 shadow-lg backdrop-blur-sm overflow-hidden\">\n            <div className=\"relative\">\n              {/* Background Glow Effect */}\n              <div className=\"absolute inset-0 bg-gradient-to-br from-[#FF0000]/20 to-transparent opacity-50\" />\n              \n              {/* Card Content */}\n              <div className=\"relative z-10 p-6\">\n                <div className=\"flex items-center justify-between mb-6\">\n                  <div className=\"flex items-center space-x-4\">\n                    <motion.div \n                      className=\"w-16 h-16 bg-gradient-to-br from-[#FF0000] to-[#FF4444] rounded-2xl flex items-center justify-center shadow-lg relative overflow-hidden\"\n                      whileHover={{ scale: 1.05 }}\n                      whileTap={{ scale: 0.95 }}\n                    >\n                      {hasYouTubeAuth && youtubeUserProfile?.picture ? (\n                        <motion.img\n                          src={youtubeUserProfile.picture}\n                          alt=\"YouTube Profile\"\n                          className=\"w-full h-full object-cover rounded-2xl\"\n                          initial={{ opacity: 0, scale: 0.8 }}\n                          animate={{ opacity: 1, scale: 1 }}\n                          transition={{ duration: 0.3 }}\n                          onError={(e) => {\n                            console.log('YouTube profile image failed to load');\n                            e.currentTarget.style.display = 'none';\n                            e.currentTarget.nextElementSibling?.classList.remove('hidden');\n                          }}\n                          onLoad={() => {\n                            console.log('YouTube profile image loaded successfully');\n                          }}\n                        />\n                      ) : null}\n                      <motion.div \n                        className={cn(\n                          \"absolute inset-0 flex items-center justify-center\",\n                          hasYouTubeAuth && youtubeUserProfile?.picture ? \"hidden\" : \"\"\n                        )}\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ duration: 0.3 }}\n                      >\n                        <img \n                          src=\"/images/YouTube connection card logo.png\" \n                          alt=\"YouTube\" \n                          style={{ \n                            height: 32, \n                            width: 'auto', \n                            objectFit: 'contain', \n                            display: 'block',\n                            minWidth: '32px'\n                          }} \n                          className=\"w-8 h-8 drop-shadow-lg\" \n                        />\n                      </motion.div>\n                    </motion.div>\n                    <div>\n                      <h3 className=\"font-bold text-xl text-gray-900 dark:text-white font-sf-pro-display\">YouTube</h3>\n                      <p className=\"text-sm text-muted-foreground font-sf-pro-text\">\n                        {hasYouTubeAuth ? 'Account linked' : 'Not connected'}\n                      </p>\n                    </div>\n                  </div>\n                  <motion.div \n                    className={cn(\n                      \"px-3 py-1.5 rounded-full text-xs font-semibold transition-all duration-300\",\n                      hasYouTubeAuth \n                        ? \"bg-[#FF0000]/20 text-[#FF0000] border border-[#FF0000]/30\" \n                        : \"bg-gray-500/20 text-gray-600 border border-gray-500/30\"\n                    )}\n                    animate={hasYouTubeAuth ? { scale: [1, 1.05, 1] } : {}}\n                    transition={{ duration: 2, repeat: Infinity, repeatDelay: 3 }}\n                  >\n                    {hasYouTubeAuth ? 'Connected' : 'Disconnected'}\n                  </motion.div>\n                </div>\n                \n                {/* Account Details - Collapsible for Mobile */}\n                {hasYouTubeAuth && youtubeUserProfile && (\n                  <motion.div \n                    className=\"mb-6 p-4 bg-white/50 dark:bg-gray-800/50 rounded-xl border border-gray-200/50 dark:border-gray-700/50 backdrop-blur-sm\"\n                    initial={{ opacity: 0, height: 0 }}\n                    animate={{ opacity: 1, height: 'auto' }}\n                    transition={{ duration: 0.5, delay: 0.5 }}\n                  >\n                    <h4 className=\"font-semibold text-gray-900 dark:text-white mb-3 flex items-center font-sf-pro-display\">\n                      <Sparkles className=\"w-4 h-4 mr-2 text-[#FF0000]\" />\n                      Channel Details\n                    </h4>\n                    <div className=\"grid grid-cols-1 gap-3 text-sm\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Name:</span>\n                        <span className=\"font-medium text-[#FF0000]\">{youtubeUserProfile.displayName || 'YouTube User'}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Email:</span>\n                        <span className=\"font-medium\">{youtubeUserProfile.email || 'N/A'}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Type:</span>\n                        <span className=\"font-medium text-[#FF0000]\">Standard</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Status:</span>\n                        <span className=\"font-medium text-green-600\">Active</span>\n                      </div>\n                    </div>\n                  </motion.div>\n                )}\n                \n                {/* Action Buttons */}\n                <div className=\"space-y-3\">\n                  <MobileButton\n                    onClick={() => {\n                      if (!hasYouTubeAuth) {\n                        connectToYouTube();\n                      } else {\n                        disconnectFromYouTube();\n                      }\n                    }}\n                    className=\"w-full h-14 text-base font-semibold bg-gradient-to-r from-[#FF0000] to-[#FF4444] hover:from-[#FF4444] hover:to-[#FF0000] text-white shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] rounded-2xl border-0\"\n                    disabled={isConnectingYouTube}\n                  >\n                    {isConnectingYouTube ? (\n                      <motion.div className=\"flex items-center justify-center\">\n                        <Loader2 className=\"w-5 h-5 mr-3 animate-spin\" />\n                        Connecting...\n                      </motion.div>\n                    ) : hasYouTubeAuth ? (\n                      <motion.div className=\"flex items-center justify-center\">\n                        <Unlock className=\"w-5 h-5 mr-3\" />\n                        Disconnect YouTube\n                      </motion.div>\n                    ) : (\n                      <motion.div className=\"flex items-center justify-center\">\n                        <Lock className=\"w-5 h-5 mr-3\" />\n                        Connect YouTube\n                      </motion.div>\n                    )}\n                  </MobileButton>\n                  \n                  {youtubeError && (\n                    <motion.div \n                      className=\"p-4 bg-red-500/10 border border-red-500/20 rounded-xl\"\n                      initial={{ opacity: 0, scale: 0.9 }}\n                      animate={{ opacity: 1, scale: 1 }}\n                    >\n                      <div className=\"flex items-start space-x-3\">\n                        <AlertCircle className=\"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0\" />\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm text-red-600 font-medium\">YouTube Connection Error</p>\n                          <p className=\"text-red-500 text-xs mt-1\">\n                            {typeof youtubeError === 'string' ? youtubeError : 'YouTube connection error'}\n                          </p>\n                          {typeof youtubeError === 'string' && youtubeError.includes('quota exceeded') && (\n                            <button\n                              onClick={() => window.location.reload()}\n                              className=\"mt-2 bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700 transition-colors\"\n                            >\n                              Try Again Later\n                            </button>\n                          )}\n                        </div>\n                      </div>\n                    </motion.div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </MobileCard>\n        </motion.div>\n      </div>\n      \n      {/* Enhanced Connection Status Summary */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.6 }}\n        className=\"text-center\"\n      >\n        <p className=\"text-sm text-muted-foreground font-sf-pro-text\">\n          Once connected, you can convert playlists in just a few clicks.\n        </p>\n      </motion.div>\n    </div>\n  );\n  \n  // Render functions\n  const renderHistoryContent = () => (\n    <div className=\"space-y-4\">\n      {/* Enhanced Header */}\n      <motion.div \n        className=\"text-center mb-6\"\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.6, ease: \"easeOut\" }}\n      >\n        <h2 className=\"text-3xl font-bold bg-gradient-to-r from-[#FF7A59] to-[#FF007A] bg-clip-text text-transparent mb-3 font-sf-pro-display\">\n          Conversion History\n        </h2>\n        <p className=\"text-muted-foreground text-lg leading-relaxed max-w-sm mx-auto font-sf-pro-text\">\n          Track your playlist conversions and insights\n        </p>\n      </motion.div>\n      \n      {/* Enhanced Real Conversion History */}\n      {state.conversionHistory && state.conversionHistory.length > 0 ? (\n        <motion.div \n          ref={historySwipeRef} \n          className=\"space-y-3\"\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.3 }}\n        >\n          {state.conversionHistory.slice(0, 10).map((conversion, index) => {\n            const successRate = Math.round((conversion.tracksMatched / conversion.totalTracks) * 100);\n            const hasFailures = conversion.tracksFailed > 0;\n            const isFailed = conversion.tracksMatched === 0;\n            \n            return (\n              <motion.div\n                key={conversion.id}\n                initial={{ opacity: 0, x: -20 }}\n                animate={{ opacity: 1, x: 0 }}\n                transition={{ duration: 0.5, delay: 0.1 * index }}\n              >\n                <MobileCard \n                  className={cn(\n                    \"shadow-lg hover:shadow-xl transition-all duration-300\",\n                    isFailed \n                      ? \"bg-gradient-to-br from-red-500/10 to-red-600/5 border-red-500/20\" \n                      : hasFailures\n                        ? \"bg-gradient-to-br from-yellow-500/10 to-yellow-600/5 border-yellow-500/20\"\n                        : \"bg-gradient-to-br from-green-500/10 to-green-600/5 border-green-500/20\"\n                  )}\n                  onClick={() => {\n                    navigate(`/insights/${conversion.id}`);\n                  }}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className={cn(\n                        \"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg\",\n                        isFailed \n                          ? \"bg-gradient-to-br from-red-500 to-red-600\" \n                          : hasFailures\n                            ? \"bg-gradient-to-br from-yellow-500 to-yellow-600\"\n                            : \"bg-gradient-to-br from-green-500 to-green-600\"\n                      )}>\n                        {isFailed ? (\n                          <AlertTriangle className=\"w-6 h-6 text-white\" />\n                        ) : hasFailures ? (\n                          <AlertCircle className=\"w-6 h-6 text-white\" />\n                        ) : (\n                          <CheckCircle className=\"w-6 h-6 text-white\" />\n                        )}\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold text-gray-900 dark:text-white text-lg\">\n                          {conversion.spotifyPlaylistName || 'Playlist Conversion'}\n                        </h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          Spotify → YouTube\n                        </p>\n                        <div className=\"flex items-center space-x-4 mt-2\">\n                          <div className=\"flex items-center space-x-1\">\n                            <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                            <span className=\"text-xs text-green-600 font-medium\">\n                              {conversion.tracksMatched} matched\n                            </span>\n                          </div>\n                          {hasFailures && (\n                            <div className=\"flex items-center space-x-1\">\n                              <AlertTriangle className=\"w-4 h-4 text-red-500\" />\n                              <span className=\"text-xs text-red-600 font-medium\">\n                                {conversion.tracksFailed} failed\n                              </span>\n                            </div>\n                          )}\n                          <div className=\"flex items-center space-x-1\">\n                            <Clock className=\"w-4 h-4 text-blue-500\" />\n                            <span className=\"text-xs text-blue-600 font-medium\">\n                              {new Date(conversion.convertedAt).toLocaleDateString()}\n                            </span>\n                          </div>\n                        </div>\n                        {hasFailures && (\n                          <div className=\"mt-3\">\n                            <motion.button\n                              whileHover={{ scale: 1.02 }}\n                              whileTap={{ scale: 0.98 }}\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                console.log('View Failed Tracks clicked:', conversion);\n                                console.log('Failed tracks:', conversion.failedTracks);\n                                // Navigate to the mobile failed tracks page\n                                navigate('/failed-tracks', { \n                                  state: { \n                                    failedTracks: conversion.failedTracks || [],\n                                    conversionId: conversion.id \n                                  } \n                                });\n                              }}\n                              className=\"inline-flex items-center gap-2 px-3 py-1.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg text-xs font-medium hover:bg-red-200 dark:hover:bg-red-800/30 transition-colors\"\n                            >\n                              <AlertTriangle size={12} />\n                              View Failed Tracks ({conversion.tracksFailed})\n                            </motion.button>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"text-right\">\n                        <div className={cn(\n                          \"text-sm font-semibold\",\n                          isFailed \n                            ? \"text-red-600 dark:text-red-400\" \n                            : hasFailures\n                              ? \"text-yellow-600 dark:text-yellow-400\"\n                              : \"text-green-600 dark:text-green-400\"\n                        )}>\n                          {isFailed ? 'Failed' : hasFailures ? 'Partial' : 'Complete'}\n                        </div>\n                        <div className=\"text-xs text-muted-foreground\">\n                          {successRate}% Success\n                        </div>\n                      </div>\n                      <ChevronRight className=\"w-5 h-5 text-muted-foreground\" />\n                    </div>\n                  </div>\n                </MobileCard>\n              </motion.div>\n            );\n          })}\n        </motion.div>\n      ) : (\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          transition={{ duration: 0.5, delay: 0.3 }}\n        >\n          <MobileCard className=\"bg-gradient-to-br from-gray-500/10 to-gray-600/5 border-gray-500/20 shadow-lg\">\n            <div className=\"text-center py-12\">\n              <div className=\"w-16 h-16 bg-gradient-to-br from-gray-400 to-gray-500 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <History className=\"w-8 h-8 text-white\" />\n              </div>\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">\n                No Conversions Yet\n              </h3>\n              <p className=\"text-muted-foreground text-sm mb-4\">\n                Start converting your playlists to see your history here\n              </p>\n              <MobileButton\n                onClick={() => setActiveTab('converter')}\n                variant=\"primary\"\n                className=\"bg-gradient-to-r from-[#FF7A59] to-[#FF007A]\"\n              >\n                Start Converting\n              </MobileButton>\n            </div>\n          </MobileCard>\n        </motion.div>\n      )}\n    </div>\n  );\n  \n  const renderProfileContent = () => (\n    <ProfileContent\n      showEditProfile={showEditProfile}\n      setShowEditProfile={setShowEditProfile}\n      profileImage={profileImage}\n      isUploadingImage={isUploadingImage}\n      handleImageUpload={handleImageUpload}\n      user={user}\n      state={state}\n      onShowToast={(type, message) => showToastWrapper.current?.(type, message)}\n      setActiveTab={setActiveTab}\n      setConversionStep={setConversionStep}\n      signOut={signOut}\n    />\n  );\n  \n  const renderContent = () => {\n    switch (activeTab) {\n      case 'converter':\n        return renderConverterContent();\n      case 'connections':\n        return renderConnectionsContent();\n      case 'history':\n        return renderHistoryContent();\n      case 'profile':\n        return (\n          <ProfileTab\n            onShowToast={showToast}\n            setActiveTab={setActiveTab}\n          />\n        );\n      default:\n        return renderConverterContent();\n    }\n  };\n  \n  // Update conversion progress based on ConversionContext state\n  useEffect(() => {\n    if (state.status === ConversionStatus.MATCHING_TRACKS || \n        state.status === ConversionStatus.CREATING_PLAYLIST) {\n      setConversionProgress(state.matchingProgress);\n    } else if (state.status === ConversionStatus.LOADING_TRACKS) {\n      setConversionProgress(10); // Show some progress while loading tracks\n    } else if (state.status === ConversionStatus.SUCCESS) {\n      setConversionProgress(100);\n    } else {\n      setConversionProgress(0);\n    }\n  }, [state.status, state.matchingProgress]);\n\n  // Trigger conversion when step changes to 'converting'\n  useEffect(() => {\n    if (conversionStep === 'converting' && state.selectedPlaylistId) {\n      // Start the conversion process\n      handleStartConversion();\n    }\n  }, [conversionStep, state.selectedPlaylistId, handleStartConversion]);\n\n  // Save selected platforms to localStorage for conversion context\n  useEffect(() => {\n    if (selectedSourcePlatform && selectedDestinationPlatform) {\n      localStorage.setItem('source_platform', selectedSourcePlatform);\n      localStorage.setItem('destination_platform', selectedDestinationPlatform);\n    }\n  }, [selectedSourcePlatform, selectedDestinationPlatform]);\n  \n  return (\n    <div className=\"flex flex-col h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900\">\n      {/* Top Navigation Header */}\n      <MobileHeader>\n        <div className=\"flex items-center justify-between px-2\">\n          {/* Left Side - Branding */}\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"soundswapp-logo\">\n              <SoundSwappLogo width={40} height={40} />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-bold bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent font-sf-pro-display\">\n                SoundSwapp\n              </h1>\n              <p className=\"text-xs text-gray-600 dark:text-gray-400 font-sf-pro-text\">\n                {activeTab === 'connections' ? 'Platform Connections' :\n                 activeTab === 'converter' ? 'Convert Playlists' :\n                 activeTab === 'history' ? 'Conversion History' :\n                 'User Profile'}\n              </p>\n            </div>\n          </div>\n          {/* Right Side - Theme toggle + Profile avatar */}\n          <div className=\"flex items-center space-x-3\">\n            <motion.button \n              onClick={() => {\n                toggleTheme();\n                hapticLight();\n              }}\n              className={cn(\n                \"relative transition-all duration-300 rounded-full p-2\",\n                isDark \n                  ? \"text-yellow-500 hover:text-yellow-400 hover:bg-yellow-500/10 hover:shadow-yellow-500/20 hover:shadow-lg\" \n                  : \"text-gray-800 dark:text-gray-200 hover:text-gray-600 dark:hover:text-gray-100 hover:bg-gray-200/50 dark:hover:bg-gray-700/30\"\n              )}\n              whileHover={{ scale: 1.1 }}\n              whileTap={{ scale: 0.9 }}\n              transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n              aria-label=\"Toggle theme\"\n            >\n              <motion.div\n                animate={{ rotate: isDark ? 180 : 0 }}\n                transition={{ duration: 0.5, ease: \"easeInOut\" }}\n              >\n                {isDark ? (\n                  <Sun className=\"w-6 h-6 drop-shadow-sm\" />\n                ) : (\n                  <Moon className=\"w-6 h-6 drop-shadow-sm\" />\n                )}\n              </motion.div>\n            </motion.button>\n\n            {/* Profile avatar (replaces settings icon) */}\n            <button\n              onClick={() => setActiveTab('profile')}\n              onContextMenu={(e) => { e.preventDefault(); navigate('/preferences'); }}\n              className=\"relative w-14 h-14 rounded-full overflow-hidden outline-none ring-0 border-0 shadow-sm bg-transparent\"\n              aria-label=\"Open profile\"\n            >\n              <img\n                src={profileImage || user?.photoURL || \"/images/default-avatar.svg\"}\n                alt=\"Profile\"\n                className=\"w-full h-full object-cover rounded-full select-none\"\n                draggable={false}\n                onError={(e) => {\n                  const img = e.currentTarget as HTMLImageElement;\n                  if (img.src.endsWith('default-avatar.svg')) return;\n                  img.src = \"/images/default-avatar.svg\";\n                  setProfileImage(\"/images/default-avatar.svg\");\n                }}\n              />\n            </button>\n          </div>\n        </div>\n      </MobileHeader>\n\n      {/* Main Content Area */}\n      <div className=\"flex-1 overflow-hidden relative\">\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={activeTab}\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: -20 }}\n            transition={{ duration: 0.3, ease: \"easeInOut\" }}\n            className=\"h-full\"\n          >\n            <motion.div\n              className=\"h-full overflow-y-auto pb-[calc(5rem+env(safe-area-inset-bottom))] mobile-surface-premium\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              transition={{ duration: 0.1, ease: \"easeOut\" }}\n            >\n              {/* apply premium card style to existing sections without changing layout */}\n              <div className=\"mx-4 mt-4 rounded-2xl p-4 shadow-lg mobile-card-premium animate-rise-fade\">\n                {renderContent()}\n              </div>\n            </motion.div>\n          </motion.div>\n        </AnimatePresence>\n      </div>\n      \n      {/* Fixed Bottom Navigation */}\n      <div className=\"flex-shrink-0 z-10\">\n        <MobileBottomNav>\n          {/* existing nav items preserved */}\n          <MobileNavItem\n            icon={<LinkIcon className=\"w-6 h-6\" />}\n            label=\"Connect\"\n            active={activeTab === 'connections'}\n            onClick={() => {\n              setActiveTab('connections');\n              hapticLight();\n            }}\n            badge={(!hasSpotifyAuth || !hasYouTubeAuth) ? '!' : undefined}\n          />\n          <MobileNavItem\n            icon={<Music className=\"w-6 h-6\" />}\n            label=\"Convert\"\n            active={activeTab === 'converter'}\n            onClick={() => {\n              setActiveTab('converter');\n              hapticLight();\n            }}\n            badge={state.conversionHistory && state.conversionHistory.length > 0 ? \n              state.conversionHistory.length.toString() : undefined}\n          />\n          <MobileNavItem\n            icon={<Clock className=\"w-6 h-6\" />}\n            label=\"History\"\n            active={activeTab === 'history'}\n            onClick={() => {\n              setActiveTab('history');\n              hapticLight();\n            }}\n            badge={state.conversionHistory && state.conversionHistory.length > 0 ? \n              state.conversionHistory.length.toString() : undefined}\n          />\n          <MobileNavItem\n            icon={<Settings className=\"w-6 h-6\" />}\n            label=\"Profile\"\n            active={activeTab === 'profile'}\n            onClick={() => {\n              setActiveTab('profile');\n              hapticLight();\n            }}\n          />\n        </MobileBottomNav>\n      </div>\n    </div>\n  );\n});\n\nexport default MobileConverter;","import { useCallback, useRef, useEffect } from 'react';\r\n\r\ninterface PerformanceConfig {\r\n  throttleMs?: number;\r\n  debounceMs?: number;\r\n  maxFPS?: number;\r\n  enableRAF?: boolean;\r\n}\r\n\r\ninterface ThrottledFunction<T extends (...args: any[]) => any> {\r\n  (...args: Parameters<T>): void;\r\n  cancel: () => void;\r\n}\r\n\r\ninterface DebouncedFunction<T extends (...args: any[]) => any> {\r\n  (...args: Parameters<T>): void;\r\n  cancel: () => void;\r\n  flush: () => void;\r\n}\r\n\r\nexport const usePerformanceOptimization = (config: PerformanceConfig = {}) => {\r\n  const {\r\n    throttleMs = 16, // ~60fps\r\n    debounceMs = 300,\r\n    maxFPS = 60,\r\n    enableRAF = true\r\n  } = config;\r\n\r\n  const rafIdRef = useRef<number>();\r\n  const lastFrameTimeRef = useRef<number>(0);\r\n  const frameIntervalRef = useRef<number>(1000 / maxFPS);\r\n\r\n  // Throttle function for performance\r\n  const throttle = useCallback(<T extends (...args: any[]) => any>(\r\n    func: T,\r\n    limit: number = throttleMs\r\n  ): ThrottledFunction<T> => {\r\n    let inThrottle: boolean;\r\n    let timeoutId: NodeJS.Timeout;\r\n\r\n    const throttled = (...args: Parameters<T>) => {\r\n      if (!inThrottle) {\r\n        func(...args);\r\n        inThrottle = true;\r\n        timeoutId = setTimeout(() => {\r\n          inThrottle = false;\r\n        }, limit);\r\n      }\r\n    };\r\n\r\n    throttled.cancel = () => {\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n      }\r\n      inThrottle = false;\r\n    };\r\n\r\n    return throttled;\r\n  }, [throttleMs]);\r\n\r\n  // Debounce function for performance\r\n  const debounce = useCallback(<T extends (...args: any[]) => any>(\r\n    func: T,\r\n    wait: number = debounceMs\r\n  ): DebouncedFunction<T> => {\r\n    let timeoutId: NodeJS.Timeout;\r\n    let lastArgs: Parameters<T> | null = null;\r\n\r\n    const debounced = (...args: Parameters<T>) => {\r\n      lastArgs = args;\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n      }\r\n      timeoutId = setTimeout(() => {\r\n        if (lastArgs) {\r\n          func(...lastArgs);\r\n          lastArgs = null;\r\n        }\r\n      }, wait);\r\n    };\r\n\r\n    debounced.cancel = () => {\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n      }\r\n      lastArgs = null;\r\n    };\r\n\r\n    debounced.flush = () => {\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n      }\r\n      if (lastArgs) {\r\n        func(...lastArgs);\r\n        lastArgs = null;\r\n      }\r\n    };\r\n\r\n    return debounced;\r\n  }, [debounceMs]);\r\n\r\n  // RequestAnimationFrame wrapper with FPS limiting\r\n  const requestAnimationFrame = useCallback((callback: FrameRequestCallback): number => {\r\n    if (!enableRAF) {\r\n      return window.setTimeout(callback, frameIntervalRef.current);\r\n    }\r\n\r\n    const now = performance.now();\r\n    const timeSinceLastFrame = now - lastFrameTimeRef.current;\r\n\r\n    if (timeSinceLastFrame >= frameIntervalRef.current) {\r\n      lastFrameTimeRef.current = now;\r\n      return window.requestAnimationFrame(callback);\r\n    } else {\r\n      const delay = frameIntervalRef.current - timeSinceLastFrame;\r\n      return window.setTimeout(() => {\r\n        lastFrameTimeRef.current = performance.now();\r\n        callback(lastFrameTimeRef.current);\r\n      }, delay);\r\n    }\r\n  }, [enableRAF]);\r\n\r\n  // Cancel animation frame wrapper\r\n  const cancelAnimationFrame = useCallback((id: number) => {\r\n    if (enableRAF) {\r\n      window.cancelAnimationFrame(id);\r\n    } else {\r\n      window.clearTimeout(id);\r\n    }\r\n  }, [enableRAF]);\r\n\r\n  // Memory leak prevention\r\n  const cleanup = useCallback(() => {\r\n    if (rafIdRef.current) {\r\n      cancelAnimationFrame(rafIdRef.current);\r\n      rafIdRef.current = undefined;\r\n    }\r\n  }, [cancelAnimationFrame]);\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return cleanup;\r\n  }, [cleanup]);\r\n\r\n  // Performance monitoring\r\n  const measurePerformance = useCallback((name: string, fn: () => void) => {\r\n    const start = performance.now();\r\n    fn();\r\n    const end = performance.now();\r\n    console.log(`${name} took ${end - start}ms`);\r\n  }, []);\r\n\r\n  // Batch state updates\r\n  const batchUpdates = useCallback((updates: (() => void)[]) => {\r\n    if (rafIdRef.current) {\r\n      cancelAnimationFrame(rafIdRef.current);\r\n    }\r\n    \r\n    rafIdRef.current = requestAnimationFrame(() => {\r\n      updates.forEach(update => update());\r\n      rafIdRef.current = undefined;\r\n    });\r\n  }, [requestAnimationFrame, cancelAnimationFrame]);\r\n\r\n  return {\r\n    throttle,\r\n    debounce,\r\n    requestAnimationFrame,\r\n    cancelAnimationFrame,\r\n    cleanup,\r\n    measurePerformance,\r\n    batchUpdates\r\n  };\r\n};\r\n\r\n// Hook for reducing re-renders\r\nexport const useStableCallback = <T extends (...args: any[]) => any>(\r\n  callback: T,\r\n  deps: React.DependencyList = []\r\n): T => {\r\n  const callbackRef = useRef<T>(callback);\r\n  \r\n  useEffect(() => {\r\n    callbackRef.current = callback;\r\n  }, [callback]);\r\n  \r\n  return useCallback((...args: Parameters<T>) => {\r\n    return callbackRef.current(...args);\r\n  }, deps) as T;\r\n};\r\n\r\n// Hook for preventing unnecessary re-renders\r\nexport const useStableValue = <T>(value: T, deps: React.DependencyList = []): T => {\r\n  const valueRef = useRef<T>(value);\r\n  \r\n  useEffect(() => {\r\n    valueRef.current = value;\r\n  }, deps);\r\n  \r\n  return valueRef.current;\r\n};\r\n\r\n// Hook for animation performance\r\nexport const useAnimationPerformance = (config: {\r\n  maxFPS?: number;\r\n  enableThrottling?: boolean;\r\n} = {}) => {\r\n  const { maxFPS = 60, enableThrottling = true } = config;\r\n  const frameInterval = 1000 / maxFPS;\r\n  const lastFrameRef = useRef<number>(0);\r\n  const rafIdRef = useRef<number>();\r\n\r\n  const throttledRAF = useCallback((callback: FrameRequestCallback) => {\r\n    if (!enableThrottling) {\r\n      return window.requestAnimationFrame(callback);\r\n    }\r\n\r\n    const now = performance.now();\r\n    const timeSinceLastFrame = now - lastFrameRef.current;\r\n\r\n    if (timeSinceLastFrame >= frameInterval) {\r\n      lastFrameRef.current = now;\r\n      return window.requestAnimationFrame(callback);\r\n    } else {\r\n      const delay = frameInterval - timeSinceLastFrame;\r\n      return window.setTimeout(() => {\r\n        lastFrameRef.current = performance.now();\r\n        callback(lastFrameRef.current);\r\n      }, delay);\r\n    }\r\n  }, [enableThrottling, frameInterval]);\r\n\r\n  const cancelRAF = useCallback((id: number) => {\r\n    window.cancelAnimationFrame(id);\r\n    window.clearTimeout(id);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (rafIdRef.current) {\r\n        cancelRAF(rafIdRef.current);\r\n      }\r\n    };\r\n  }, [cancelRAF]);\r\n\r\n  return {\r\n    requestAnimationFrame: throttledRAF,\r\n    cancelAnimationFrame: cancelRAF\r\n  };\r\n}; ","import { useCallback } from 'react';\r\n\r\ntype HapticType = 'light' | 'medium' | 'heavy' | 'success' | 'warning' | 'error';\r\n\r\nexport const useHapticFeedback = () => {\r\n  const triggerHaptic = useCallback((type: HapticType = 'light') => {\r\n    // Check if the device supports haptic feedback\r\n    if ('vibrate' in navigator) {\r\n      const patterns = {\r\n        light: [10],\r\n        medium: [20],\r\n        heavy: [30],\r\n        success: [10, 50, 10],\r\n        warning: [20, 50, 20],\r\n        error: [30, 50, 30]\r\n      };\r\n\r\n      const pattern = patterns[type] || patterns.light;\r\n      navigator.vibrate(pattern);\r\n    }\r\n  }, []);\r\n\r\n  const hapticSuccess = useCallback(() => triggerHaptic('success'), [triggerHaptic]);\r\n  const hapticWarning = useCallback(() => triggerHaptic('warning'), [triggerHaptic]);\r\n  const hapticError = useCallback(() => triggerHaptic('error'), [triggerHaptic]);\r\n  const hapticLight = useCallback(() => triggerHaptic('light'), [triggerHaptic]);\r\n  const hapticMedium = useCallback(() => triggerHaptic('medium'), [triggerHaptic]);\r\n  const hapticHeavy = useCallback(() => triggerHaptic('heavy'), [triggerHaptic]);\r\n\r\n  return {\r\n    triggerHaptic,\r\n    hapticSuccess,\r\n    hapticWarning,\r\n    hapticError,\r\n    hapticLight,\r\n    hapticMedium,\r\n    hapticHeavy\r\n  };\r\n}; ","import { useState, useEffect } from 'react';\r\n\r\ninterface NetworkStatus {\r\n  isOnline: boolean;\r\n  isOffline: boolean;\r\n  connectionType?: string;\r\n  effectiveType?: string;\r\n  downlink?: number;\r\n  rtt?: number;\r\n}\r\n\r\nexport const useOfflineStatus = () => {\r\n  const [networkStatus, setNetworkStatus] = useState<NetworkStatus>({\r\n    isOnline: navigator.onLine,\r\n    isOffline: !navigator.onLine\r\n  });\r\n\r\n  useEffect(() => {\r\n    const updateNetworkStatus = () => {\r\n      const isOnline = navigator.onLine;\r\n      \r\n      // Get additional network information if available\r\n      const connection = (navigator as any).connection || (navigator as any).mozConnection || (navigator as any).webkitConnection;\r\n      \r\n      setNetworkStatus({\r\n        isOnline,\r\n        isOffline: !isOnline,\r\n        connectionType: connection?.effectiveType,\r\n        effectiveType: connection?.effectiveType,\r\n        downlink: connection?.downlink,\r\n        rtt: connection?.rtt\r\n      });\r\n    };\r\n\r\n    // Initial check\r\n    updateNetworkStatus();\r\n\r\n    // Listen for online/offline events\r\n    window.addEventListener('online', updateNetworkStatus);\r\n    window.addEventListener('offline', updateNetworkStatus);\r\n\r\n    // Listen for connection changes if supported\r\n    const connection = (navigator as any).connection || (navigator as any).mozConnection || (navigator as any).webkitConnection;\r\n    if (connection) {\r\n      connection.addEventListener('change', updateNetworkStatus);\r\n    }\r\n\r\n    return () => {\r\n      window.removeEventListener('online', updateNetworkStatus);\r\n      window.removeEventListener('offline', updateNetworkStatus);\r\n      if (connection) {\r\n        connection.removeEventListener('change', updateNetworkStatus);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return networkStatus;\r\n}; ","import { useState, useEffect, useCallback, useRef } from 'react';\r\n\r\n// Add type declarations for SpeechRecognition API\r\ndeclare global {\r\n  interface Window {\r\n    SpeechRecognition: any;\r\n    webkitSpeechRecognition: any;\r\n  }\r\n}\r\n\r\ninterface SpeechRecognition extends EventTarget {\r\n  continuous: boolean;\r\n  interimResults: boolean;\r\n  lang: string;\r\n  onstart: ((this: SpeechRecognition, ev: Event) => any) | null;\r\n  onresult: ((this: SpeechRecognition, ev: SpeechRecognitionEvent) => any) | null;\r\n  onerror: ((this: SpeechRecognition, ev: Event) => any) | null;\r\n  onend: ((this: SpeechRecognition, ev: Event) => any) | null;\r\n  start(): void;\r\n  stop(): void;\r\n}\r\n\r\ninterface SpeechRecognitionEvent extends Event {\r\n  resultIndex: number;\r\n  results: SpeechRecognitionResultList;\r\n}\r\n\r\ninterface SpeechRecognitionResultList {\r\n  length: number;\r\n  [index: number]: SpeechRecognitionResult;\r\n}\r\n\r\ninterface SpeechRecognitionResult {\r\n  isFinal: boolean;\r\n  [index: number]: SpeechRecognitionAlternative;\r\n}\r\n\r\ninterface SpeechRecognitionAlternative {\r\n  transcript: string;\r\n  confidence: number;\r\n}\r\n\r\ninterface VoiceCommandConfig {\r\n  commands: Record<string, () => void>;\r\n  isEnabled?: boolean;\r\n  language?: string;\r\n}\r\n\r\nexport const useVoiceCommands = (config: VoiceCommandConfig) => {\r\n  const { commands, isEnabled = false, language = 'en-US' } = config;\r\n  \r\n  const [isListening, setIsListening] = useState(false);\r\n  const [transcript, setTranscript] = useState('');\r\n  const [isSupported, setIsSupported] = useState(false);\r\n  const recognitionRef = useRef<SpeechRecognition | null>(null);\r\n\r\n  useEffect(() => {\r\n    // Check if speech recognition is supported\r\n    const SpeechRecognition = window.SpeechRecognition || (window as any).webkitSpeechRecognition;\r\n    setIsSupported(!!SpeechRecognition);\r\n\r\n    if (SpeechRecognition && isEnabled) {\r\n      recognitionRef.current = new SpeechRecognition();\r\n      const recognition = recognitionRef.current;\r\n\r\n      if (recognition) {\r\n        recognition.continuous = true;\r\n        recognition.interimResults = true;\r\n        recognition.lang = language;\r\n\r\n        recognition.onstart = () => {\r\n          setIsListening(true);\r\n          setTranscript('');\r\n        };\r\n\r\n        recognition.onresult = (event: SpeechRecognitionEvent) => {\r\n          let finalTranscript = '';\r\n          let interimTranscript = '';\r\n\r\n          for (let i = event.resultIndex; i < event.results.length; i++) {\r\n            const transcript = event.results[i][0].transcript;\r\n            if (event.results[i].isFinal) {\r\n              finalTranscript += transcript;\r\n            } else {\r\n              interimTranscript += transcript;\r\n            }\r\n          }\r\n\r\n          setTranscript(finalTranscript || interimTranscript);\r\n\r\n          // Check for commands\r\n          const lowerTranscript = finalTranscript.toLowerCase();\r\n          Object.entries(commands).forEach(([command, action]) => {\r\n            if (lowerTranscript.includes(command.toLowerCase())) {\r\n              action();\r\n              setTranscript('');\r\n            }\r\n          });\r\n        };\r\n\r\n        recognition.onerror = (event: Event) => {\r\n          console.error('Speech recognition error:', event);\r\n          setIsListening(false);\r\n        };\r\n\r\n        recognition.onend = () => {\r\n          setIsListening(false);\r\n        };\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (recognitionRef.current) {\r\n        recognitionRef.current.stop();\r\n      }\r\n    };\r\n  }, [commands, isEnabled, language]);\r\n\r\n  const startListening = useCallback(() => {\r\n    if (recognitionRef.current && isSupported) {\r\n      recognitionRef.current.start();\r\n    }\r\n  }, [isSupported]);\r\n\r\n  const stopListening = useCallback(() => {\r\n    if (recognitionRef.current) {\r\n      recognitionRef.current.stop();\r\n    }\r\n  }, []);\r\n\r\n  const toggleListening = useCallback(() => {\r\n    if (isListening) {\r\n      stopListening();\r\n    } else {\r\n      startListening();\r\n    }\r\n  }, [isListening, startListening, stopListening]);\r\n\r\n  return {\r\n    isListening,\r\n    transcript,\r\n    isSupported,\r\n    startListening,\r\n    stopListening,\r\n    toggleListening\r\n  };\r\n}; ","import { useEffect, useRef, useState, useCallback } from 'react';\r\n\r\ninterface UseScrollAnimationOptions {\r\n  threshold?: number;\r\n  rootMargin?: string;\r\n  triggerOnce?: boolean;\r\n}\r\n\r\nexport const useScrollAnimation = (options: UseScrollAnimationOptions = {}) => {\r\n  const { threshold = 0.1, rootMargin = '0px', triggerOnce = true } = options;\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [hasTriggered, setHasTriggered] = useState(false);\r\n  const elementRef = useRef<HTMLElement>(null);\r\n\r\n  const handleIntersection = useCallback((entries: IntersectionObserverEntry[]) => {\r\n    const [entry] = entries;\r\n    \r\n    if (entry.isIntersecting) {\r\n      setIsVisible(true);\r\n      if (triggerOnce) {\r\n        setHasTriggered(true);\r\n      }\r\n    } else if (!triggerOnce) {\r\n      setIsVisible(false);\r\n    }\r\n  }, [triggerOnce]);\r\n\r\n  useEffect(() => {\r\n    const observer = new IntersectionObserver(handleIntersection, {\r\n      threshold,\r\n      rootMargin,\r\n    });\r\n\r\n    const currentElement = elementRef.current;\r\n    if (currentElement) {\r\n      observer.observe(currentElement);\r\n    }\r\n\r\n    return () => {\r\n      if (currentElement) {\r\n        observer.unobserve(currentElement);\r\n      }\r\n    };\r\n  }, [handleIntersection, threshold, rootMargin]);\r\n\r\n  return { elementRef, isVisible: isVisible || hasTriggered };\r\n};\r\n\r\ninterface UseScrollProgressOptions {\r\n  containerRef?: React.RefObject<HTMLElement>;\r\n  onProgressChange?: (progress: number) => void;\r\n}\r\n\r\nexport const useScrollProgress = (options: UseScrollProgressOptions = {}) => {\r\n  const { containerRef, onProgressChange } = options;\r\n  const [scrollProgress, setScrollProgress] = useState(0);\r\n  const [isScrolling, setIsScrolling] = useState(false);\r\n  const scrollTimeoutRef = useRef<NodeJS.Timeout>();\r\n\r\n  const calculateProgress = useCallback((element: HTMLElement) => {\r\n    const { scrollTop, scrollHeight, clientHeight } = element;\r\n    const progress = scrollHeight > clientHeight ? scrollTop / (scrollHeight - clientHeight) : 0;\r\n    return Math.min(Math.max(progress, 0), 1);\r\n  }, []);\r\n\r\n  const handleScroll = useCallback((e: React.UIEvent<HTMLElement>) => {\r\n    const target = e.target as HTMLElement;\r\n    const progress = calculateProgress(target);\r\n    \r\n    setScrollProgress(progress);\r\n    setIsScrolling(true);\r\n    onProgressChange?.(progress);\r\n\r\n    // Clear existing timeout\r\n    if (scrollTimeoutRef.current) {\r\n      clearTimeout(scrollTimeoutRef.current);\r\n    }\r\n\r\n    // Reset scrolling state after delay\r\n    scrollTimeoutRef.current = setTimeout(() => {\r\n      setIsScrolling(false);\r\n    }, 150);\r\n  }, [calculateProgress, onProgressChange]);\r\n\r\n  const scrollToTop = useCallback(() => {\r\n    const element = containerRef?.current;\r\n    if (element) {\r\n      element.scrollTo({\r\n        top: 0,\r\n        behavior: 'smooth'\r\n      });\r\n    }\r\n  }, [containerRef]);\r\n\r\n  const scrollToBottom = useCallback(() => {\r\n    const element = containerRef?.current;\r\n    if (element) {\r\n      element.scrollTo({\r\n        top: element.scrollHeight,\r\n        behavior: 'smooth'\r\n      });\r\n    }\r\n  }, [containerRef]);\r\n\r\n  const scrollToElement = useCallback((element: HTMLElement, offset = 0) => {\r\n    const container = containerRef?.current;\r\n    if (container) {\r\n      const containerRect = container.getBoundingClientRect();\r\n      const elementRect = element.getBoundingClientRect();\r\n      const scrollTop = container.scrollTop + elementRect.top - containerRect.top - offset;\r\n      \r\n      container.scrollTo({\r\n        top: scrollTop,\r\n        behavior: 'smooth'\r\n      });\r\n    }\r\n  }, [containerRef]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (scrollTimeoutRef.current) {\r\n        clearTimeout(scrollTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    scrollProgress,\r\n    isScrolling,\r\n    handleScroll,\r\n    scrollToTop,\r\n    scrollToBottom,\r\n    scrollToElement\r\n  };\r\n};\r\n\r\ninterface UseScrollDirectionOptions {\r\n  threshold?: number;\r\n}\r\n\r\nexport const useScrollDirection = (options: UseScrollDirectionOptions = {}) => {\r\n  const { threshold = 10 } = options;\r\n  const [scrollDirection, setScrollDirection] = useState<'up' | 'down' | null>(null);\r\n  const lastScrollY = useRef(0);\r\n\r\n  const handleScroll = useCallback((e: React.UIEvent<HTMLElement>) => {\r\n    const currentScrollY = e.currentTarget.scrollTop;\r\n    const diff = currentScrollY - lastScrollY.current;\r\n\r\n    if (Math.abs(diff) > threshold) {\r\n      setScrollDirection(diff > 0 ? 'down' : 'up');\r\n      lastScrollY.current = currentScrollY;\r\n    }\r\n  }, [threshold]);\r\n\r\n  return { scrollDirection, handleScroll };\r\n}; ","import React, { useEffect, useRef } from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '../../lib/utils';\nimport { useTheme } from '../../lib/ThemeContext';\n\ninterface EnhancedGradientTextProps {\n  variant?: \"spotify\" | \"youtube\" | \"transition\" | \"default\";\n  size?: \"sm\" | \"md\" | \"lg\" | \"xl\";\n  weight?: \"normal\" | \"medium\" | \"semibold\" | \"bold\";\n  animationDuration?: number;\n  showNoise?: boolean;\n  letterSpacing?: string;\n  className?: string;\n  children: React.ReactNode;\n}\n\nconst fontSizeMap = {\n  sm: \"text-lg md:text-xl\",\n  md: \"text-xl md:text-2xl\",\n  lg: \"text-2xl md:text-4xl\",\n  xl: \"text-3xl md:text-5xl lg:text-6xl\"\n};\n\nconst fontWeightMap = {\n  normal: \"font-normal\",\n  medium: \"font-medium\",\n  semibold: \"font-semibold\",\n  bold: \"font-bold\"\n};\n\nexport const EnhancedGradientText = ({\n  className,\n  children,\n  variant = \"default\",\n  size = \"md\",\n  weight = \"bold\",\n  animationDuration = 3,\n  showNoise = true,\n  letterSpacing = \"-0.02em\",\n}: EnhancedGradientTextProps) => {\n  const { isDark } = useTheme();\n  const textRef = useRef<HTMLDivElement>(null);\n  \n  // More sophisticated gradient definitions\n  const gradients = {\n    spotify: \"bg-gradient-to-r from-green-400 from-20% via-green-300 via-40% to-green-500 to-80%\",\n    youtube: \"bg-gradient-to-r from-red-500 from-20% via-red-400 via-40% to-red-600 to-80%\",\n    transition: \"bg-gradient-to-r from-green-400 from-10% via-purple-500 via-50% to-red-500 to-90%\",\n    default: isDark \n      ? \"bg-gradient-to-r from-blue-400 from-20% via-violet-400 via-50% to-pink-400 to-80%\" \n      : \"bg-gradient-to-r from-blue-600 from-20% via-violet-600 via-50% to-pink-600 to-80%\"\n  };\n  \n  // Animation settings\n  useEffect(() => {\n    if (!textRef.current || !showNoise) return;\n    \n    // Add noise texture overlay - we'll simulate this with CSS\n    const applyNoiseEffect = () => {\n      if (!textRef.current) return;\n      textRef.current.style.position = 'relative';\n      \n      // Apply a subtle noise pattern with CSS\n      textRef.current.classList.add('noise-texture');\n    };\n    \n    applyNoiseEffect();\n  }, [showNoise]);\n  \n  return (\n    <motion.div\n      ref={textRef}\n      className={cn(\n        \"inline-block bg-clip-text text-transparent relative\",\n        fontSizeMap[size],\n        fontWeightMap[weight],\n        gradients[variant],\n        className,\n      )}\n      style={{\n        letterSpacing,\n        backgroundSize: \"200% auto\",\n      }}\n      initial={{\n        backgroundPosition: \"0% 50%\"\n      }}\n      animate={{\n        backgroundPosition: [\"0% 50%\", \"100% 50%\", \"0% 50%\"]\n      }}\n      transition={{\n        duration: animationDuration,\n        ease: \"easeInOut\",\n        repeat: Infinity,\n      }}\n    >\n      {children}\n    </motion.div>\n  );\n}; ","import React, { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../lib/AuthContext';\nimport { handleSpotifyCallback } from '../lib/spotifyAuth';\nimport { EnhancedGradientText } from './ui/EnhancedGradientText';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faSpinner, faCheckCircle, faExclamationTriangle, faExclamationCircle, faArrowLeft, faSignInAlt } from '@fortawesome/free-solid-svg-icons';\nimport { isMobileDevice, isAndroidDevice, detectConnectionQuality } from '../lib/utils';\nimport GlassmorphicContainer from './ui/GlassmorphicContainer';\nimport { cn } from '../lib/utils';\nimport { useTheme } from '../lib/ThemeContext';\n\nconst SpotifyCallback: React.FC = () => {\n  const navigate = useNavigate();\n  const { user, loading: authLoading } = useAuth();\n  const [status, setStatus] = useState<'loading' | 'success' | 'error' | 'network-error' | 'auth-required'>('loading');\n  const [error, setError] = useState<string | null>(null);\n  const [isMobile, setIsMobile] = useState(false);\n  const [isAndroid, setIsAndroid] = useState(false);\n  const [connectionQuality, setConnectionQuality] = useState<'good' | 'slow' | 'limited' | 'offline'>('good');\n  const [retryCount, setRetryCount] = useState(0);\n  const { isDark } = useTheme();\n  \n  useEffect(() => {\n    // Detect device type for better error handling\n    setIsMobile(isMobileDevice());\n    setIsAndroid(isAndroidDevice());\n    setConnectionQuality(detectConnectionQuality());\n    \n    const processCallback = async () => {\n      try {\n        // Wait for auth loading to complete\n        if (authLoading) {\n          console.log(\"Waiting for auth loading to complete...\");\n          return;\n        }\n\n        // Check network connectivity first\n        const currentConnectionQuality = detectConnectionQuality();\n        setConnectionQuality(currentConnectionQuality);\n        \n        if (currentConnectionQuality === 'offline') {\n          setStatus('network-error');\n          setError('You appear to be offline. Please check your internet connection.');\n          return;\n        }\n        \n        // Verify that user is logged in - CRITICAL CHECK!\n        if (!user) {\n          console.error(\"User not logged in during Spotify authentication\");\n          setStatus('auth-required');\n          setError('You need to be logged in to connect your Spotify account');\n          return;\n        }\n\n        // Log URL parameters for debugging\n        const urlParams = new URLSearchParams(window.location.search);\n        console.log('Callback URL parameters:', {\n          code: urlParams.get('code') ? 'present' : 'missing',\n          state: urlParams.get('state') ? 'present' : 'missing',\n          error: urlParams.get('error') || 'none'\n        });\n        \n        // Handle the callback (token is in URL)\n        const result = await handleSpotifyCallback();\n        \n        if (!result.success) {\n          // Check for specific error conditions\n          if (result.error?.includes('authorization code')) {\n            setStatus('error');\n            setError('Failed to validate Spotify authorization. Please try connecting again.');\n          } else if (result.error?.includes('state parameter')) {\n            setStatus('error');\n            setError('Authentication session expired. Please try connecting again.');\n          } else if (isMobileDevice() && \n              (result.error?.includes('timeout') || \n               result.error?.includes('network') || \n               result.error?.includes('connection'))) {\n            setStatus('network-error');\n            setError(result.error || 'Network issue during Spotify authentication');\n          } else {\n            setStatus('error');\n            setError(result.error || 'Failed to authenticate with Spotify');\n          }\n          return;\n        }\n        \n        setStatus('success');\n        \n        // Dispatch event to notify application of successful authentication\n        window.dispatchEvent(new CustomEvent('spotify-auth-changed', { \n          detail: { authenticated: true } \n        }));\n        console.log(\"Dispatched spotify-auth-changed event\");\n        \n        // Redirect after a short delay\n        // Use a longer delay on mobile to ensure the success message is seen\n        const redirectDelay = isMobileDevice() ? 3000 : 2000;\n        setTimeout(() => {\n          // Get return path from localStorage or default to home\n          const returnPath = localStorage.getItem('spotify_auth_return_path') || '/';\n          localStorage.removeItem('spotify_auth_return_path');\n          navigate(returnPath);\n        }, redirectDelay);\n      } catch (error) {\n        console.error('Error in Spotify callback:', error);\n        \n        // Check if it's a network error\n        if (error instanceof Error && \n            (error.message.includes('network') || \n             error.message.includes('connection') || \n             error.message.includes('offline'))) {\n          setStatus('network-error');\n          setError('Network error during authentication. Please check your connection and try again.');\n        } else {\n          setStatus('error');\n          setError(error instanceof Error ? error.message : 'Failed to authenticate with Spotify');\n        }\n      }\n    };\n    \n    // Only run the callback processing if not still loading auth state\n    if (!authLoading) {\n      processCallback();\n    }\n  }, [navigate, user, retryCount, authLoading]);\n  \n  const handleRetry = () => {\n    setStatus('loading');\n    setError(null);\n    setRetryCount(prev => prev + 1);\n  };\n\n  const handleLogin = () => {\n    // Save current URL to return after login\n    localStorage.setItem('auth_return_path', window.location.pathname);\n    navigate('/login');\n  };\n  \n  return (\n    <div className=\"h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4 pt-safe pb-safe\">\n      <GlassmorphicContainer \n        className=\"max-w-md w-full p-6 sm:p-8 text-center\"\n        animate={true}\n        rounded=\"2xl\"\n        shadow=\"lg\"\n      >\n        <EnhancedGradientText\n          variant=\"spotify\"\n          size=\"lg\"\n          className=\"mb-6\"\n        >\n          Spotify Authentication\n        </EnhancedGradientText>\n        \n        {status === 'loading' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mb-4\">\n              <FontAwesomeIcon icon={faSpinner} spin className=\"text-3xl text-green-500\" />\n            </div>\n            <p className={cn(\n              \"text-base\",\n              isDark ? \"text-gray-200\" : \"text-gray-700\"\n            )}>\n              {isMobile ? 'Connecting to Spotify... Please wait' : 'Connecting to Spotify...'}\n            </p>\n            {isMobile && connectionQuality === 'slow' && (\n              <p className=\"text-xs text-amber-600 dark:text-amber-400 mt-2\">\n                Slow connection detected. This may take a bit longer.\n              </p>\n            )}\n          </div>\n        )}\n        \n        {status === 'success' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mb-4\">\n              <FontAwesomeIcon icon={faCheckCircle} className=\"text-3xl text-green-500\" />\n            </div>\n            <p className={cn(\n              \"text-xl font-medium mb-2\",\n              isDark ? \"text-white\" : \"text-gray-800\"\n            )}>\n              Successfully Connected!\n            </p>\n            <p className={cn(\n              \"text-sm\",\n              isDark ? \"text-gray-300\" : \"text-gray-600\"\n            )}>\n              Your Spotify account is now connected. Redirecting you back{isMobile ? ' to the app' : ''}...\n            </p>\n          </div>\n        )}\n        \n        {status === 'error' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mb-4\">\n              <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-3xl text-red-500\" />\n            </div>\n            <p className={cn(\n              \"text-xl font-medium mb-2\",\n              isDark ? \"text-white\" : \"text-gray-800\"\n            )}>\n              Connection Error\n            </p>\n            {error && (\n              <p className={cn(\n                \"text-sm mb-4 max-w-xs mx-auto\",\n                \"text-red-500 dark:text-red-400\"\n              )}>\n                {error}\n              </p>\n            )}\n            {isAndroid && (\n              <p className={cn(\n                \"text-xs mb-4\",\n                isDark ? \"text-gray-400\" : \"text-gray-500\"\n              )}>\n                If you're using Android, try closing your browser completely and trying again.\n              </p>\n            )}\n            <div className=\"flex flex-col sm:flex-row gap-3 w-full\">\n              <button\n                onClick={() => navigate('/')}\n                className={cn(\n                  \"px-4 py-3 rounded-xl flex items-center justify-center transition-all\",\n                  \"hover:scale-[1.02]\",\n                  isDark\n                    ? \"bg-gray-800 hover:bg-gray-700 text-white\"\n                    : \"bg-gray-200 hover:bg-gray-300 text-gray-900\",\n                  \"text-sm sm:text-base flex-1\"\n                )}\n              >\n                <FontAwesomeIcon icon={faArrowLeft} className=\"mr-2\" />\n                Go Back\n              </button>\n              <button\n                onClick={handleRetry}\n                className={cn(\n                  \"px-4 py-3 rounded-xl flex items-center justify-center transition-all\",\n                  \"bg-green-600 hover:bg-green-700 text-white hover:scale-[1.02]\",\n                  \"text-sm sm:text-base flex-1\"\n                )}\n              >\n                Try Again\n              </button>\n            </div>\n          </div>\n        )}\n        \n        {status === 'network-error' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-16 h-16 rounded-full bg-amber-500/20 flex items-center justify-center mb-4\">\n              <FontAwesomeIcon icon={faExclamationCircle} className=\"text-3xl text-amber-500\" />\n            </div>\n            <p className={cn(\n              \"text-xl font-medium mb-2\",\n              isDark ? \"text-white\" : \"text-gray-800\"\n            )}>\n              Network Issue Detected\n            </p>\n            {error && (\n              <p className={cn(\n                \"text-sm mb-4 max-w-xs mx-auto\",\n                \"text-amber-600 dark:text-amber-400\"\n              )}>\n                {error}\n              </p>\n            )}\n            <p className={cn(\n              \"text-sm mb-6\",\n              isDark ? \"text-gray-300\" : \"text-gray-600\"\n            )}>\n              {isMobile \n                ? 'Mobile networks can sometimes interrupt authentication. Try switching to WiFi if available.'\n                : 'Please check your internet connection and try again.'}\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-3 w-full\">\n              <button\n                onClick={() => navigate('/')}\n                className={cn(\n                  \"px-4 py-3 rounded-xl flex items-center justify-center transition-all\",\n                  \"hover:scale-[1.02]\",\n                  isDark\n                    ? \"bg-gray-800 hover:bg-gray-700 text-white\"\n                    : \"bg-gray-200 hover:bg-gray-300 text-gray-900\",\n                  \"text-sm sm:text-base flex-1\"\n                )}\n              >\n                <FontAwesomeIcon icon={faArrowLeft} className=\"mr-2\" />\n                Go Back\n              </button>\n              <button\n                onClick={handleRetry}\n                className={cn(\n                  \"px-4 py-3 rounded-xl flex items-center justify-center transition-all\",\n                  \"bg-amber-600 hover:bg-amber-700 text-white hover:scale-[1.02]\",\n                  \"text-sm sm:text-base flex-1\"\n                )}\n              >\n                Retry Connection\n              </button>\n            </div>\n          </div>\n        )}\n\n        {status === 'auth-required' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center mb-4\">\n              <FontAwesomeIcon icon={faExclamationCircle} className=\"text-3xl text-blue-500\" />\n            </div>\n            <p className={cn(\n              \"text-xl font-medium mb-2\",\n              isDark ? \"text-white\" : \"text-gray-800\"\n            )}>\n              Authentication Required\n            </p>\n            {error && (\n              <p className={cn(\n                \"text-sm mb-4 max-w-xs mx-auto\",\n                \"text-blue-500 dark:text-blue-400\"\n              )}>\n                {error}\n              </p>\n            )}\n            <p className={cn(\n              \"text-sm mb-6\",\n              isDark ? \"text-gray-300\" : \"text-gray-600\"\n            )}>\n              You need to sign in to your account before connecting Spotify.\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-3 w-full\">\n              <button\n                onClick={() => navigate('/')}\n                className={cn(\n                  \"px-4 py-3 rounded-xl flex items-center justify-center transition-all\",\n                  \"hover:scale-[1.02]\",\n                  isDark\n                    ? \"bg-gray-800 hover:bg-gray-700 text-white\"\n                    : \"bg-gray-200 hover:bg-gray-300 text-gray-900\",\n                  \"text-sm sm:text-base flex-1\"\n                )}\n              >\n                <FontAwesomeIcon icon={faArrowLeft} className=\"mr-2\" />\n                Go Back\n              </button>\n              <button\n                onClick={handleLogin}\n                className={cn(\n                  \"px-4 py-3 rounded-xl flex items-center justify-center transition-all\",\n                  \"bg-blue-600 hover:bg-blue-700 text-white hover:scale-[1.02]\",\n                  \"text-sm sm:text-base flex-1\"\n                )}\n              >\n                <FontAwesomeIcon icon={faSignInAlt} className=\"mr-2\" />\n                Sign In\n              </button>\n            </div>\n          </div>\n        )}\n      </GlassmorphicContainer>\n    </div>\n  );\n};\n\nexport default SpotifyCallback; ","import React, { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../lib/AuthContext';\nimport { \n  handleYouTubeCallback,\n  getYouTubeToken,\n  isYouTubeAuthenticated \n} from '../lib/youtubeAuth';\nimport { EnhancedGradientText } from './ui/EnhancedGradientText';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { \n  faSpinner, \n  faCheckCircle, \n  faExclamationTriangle, \n  faExclamationCircle, \n  faArrowLeft, \n  faSignInAlt,\n  faSync\n} from '@fortawesome/free-solid-svg-icons';\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\nimport GlassmorphicContainer from './ui/GlassmorphicContainer';\nimport { cn } from '../lib/utils';\nimport { useTheme } from '../lib/ThemeContext';\n\nconst MAX_AUTH_WAIT = 10000; // 10 seconds\nconst AUTH_CHECK_INTERVAL = 500; // 0.5 seconds\n\nconst YouTubeCallback: React.FC = () => {\n  const navigate = useNavigate();\n  const { user, loading: authLoading, setHasYouTubeAuth } = useAuth();\n  const [status, setStatus] = useState<'loading' | 'success' | 'error' | 'auth-required' | 'auth-waiting'>('loading');\n  const [error, setError] = useState<string | null>(null);\n  const [debugInfo, setDebugInfo] = useState<string>('');\n  const { isDark } = useTheme();\n  const [authWaitTime, setAuthWaitTime] = useState(0);\n  \n  useEffect(() => {\n    let authCheckInterval: NodeJS.Timeout;\n    let authTimeout: NodeJS.Timeout;\n    let isMounted = true;\n\n    const processCallback = async () => {\n      try {\n        // Save callback URL immediately\n        const currentUrl = window.location.href;\n        sessionStorage.setItem('youtube_callback_url', currentUrl);\n        \n        setDebugInfo('Starting callback processing...');\n        console.log('User signed in:', !!user);\n        \n        // If not signed in, start waiting for auth\n        if (!user && !authLoading) {\n          setStatus('auth-waiting');\n          let waitTime = 0;\n          \n          // Start auth check interval\n          authCheckInterval = setInterval(() => {\n            waitTime += AUTH_CHECK_INTERVAL;\n            if (isMounted) {\n              setAuthWaitTime(waitTime);\n            }\n            \n            // Check if auth state has been restored\n            const auth = getAuth();\n            if (auth.currentUser) {\n              clearInterval(authCheckInterval);\n              if (isMounted) {\n                setStatus('loading');\n                processCallback();\n              }\n            }\n          }, AUTH_CHECK_INTERVAL);\n          \n          // Set timeout for auth waiting\n          authTimeout = setTimeout(() => {\n            clearInterval(authCheckInterval);\n            if (isMounted) {\n              setStatus('auth-required');\n              setError('Authentication session expired. Please sign in again.');\n            }\n          }, MAX_AUTH_WAIT);\n          \n          return;\n        }\n        \n        // Clear intervals if we have a user\n        clearInterval(authCheckInterval);\n        clearTimeout(authTimeout);\n\n        // Require authentication\n        if (!user) {\n          setStatus('auth-required');\n          setError('You need to be logged in to connect your YouTube account');\n          return;\n        }\n        \n        // Handle the callback\n        await handleYouTubeCallback();\n        \n        // Verify authentication was successful\n        const isAuthenticated = await isYouTubeAuthenticated();\n        if (!isAuthenticated) {\n          throw new Error('Failed to verify YouTube authentication');\n        }\n        \n        // Update auth context\n          setHasYouTubeAuth(true);\n        setStatus('success');\n        \n        // Notify about successful authentication\n        notifyAuthComplete();\n        \n        // Clean up stored URL\n        sessionStorage.removeItem('youtube_callback_url');\n        \n        // Redirect after success message\n        setTimeout(() => {\n          const returnPath = localStorage.getItem('youtube_auth_return_path') || '/';\n          localStorage.removeItem('youtube_auth_return_path');\n          navigate(returnPath);\n        }, 2000);\n      } catch (err) {\n        console.error('YouTube callback error:', err);\n        setStatus('error');\n        setError(err instanceof Error ? err.message : 'Failed to authenticate with YouTube');\n        setDebugInfo(prev => `${prev}\\nError: ${err instanceof Error ? err.message : String(err)}`);\n      }\n    };\n    \n    if (!authLoading) {\n      processCallback();\n    }\n\n    return () => {\n      isMounted = false;\n      clearInterval(authCheckInterval);\n      clearTimeout(authTimeout);\n    };\n  }, [navigate, setHasYouTubeAuth, authLoading, user]);\n\n  const handleReturnHome = () => {\n    navigate('/');\n  };\n  \n  const handleLogin = () => {\n    // Save current URL to return after login\n    sessionStorage.setItem('youtube_callback_url', window.location.href);\n    localStorage.setItem('auth_return_path', '/youtube-callback');\n    navigate('/login');\n  };\n\n  const handleRetry = () => {\n    window.location.reload();\n  };\n  \n  // Add a function to dispatch authentication event\n  const notifyAuthComplete = () => {\n    try {\n      // Notify opener if this is a popup\n      if (window.opener && window.opener !== window) {\n        window.opener.postMessage({ \n          type: 'youtube-auth-complete', \n          success: true \n        }, window.location.origin);\n        console.log('Sent youtube-auth-complete message to opener');\n      }\n      \n      // Also dispatch a custom event for direct listeners\n      window.dispatchEvent(new CustomEvent('youtube-auth-changed', { \n        detail: { authenticated: true } \n      }));\n      console.log('Dispatched youtube-auth-changed event');\n    } catch (err) {\n      console.error('Error notifying about YouTube authentication:', err);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-b from-gray-900 to-black p-4\">\n      <GlassmorphicContainer \n        className=\"max-w-md w-full p-8 text-center\"\n        animate={true}\n        rounded=\"2xl\"\n        shadow=\"lg\"\n      >\n        <EnhancedGradientText\n          variant=\"youtube\"\n          size=\"lg\"\n          className=\"mb-6\"\n        >\n          YouTube Authentication\n        </EnhancedGradientText>\n        \n        {status === 'loading' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <FontAwesomeIcon icon={faSpinner} spin className=\"text-4xl text-red-500 mb-4\" />\n            <p className=\"text-gray-200\">\n              Authenticating with YouTube...\n            </p>\n          </div>\n        )}\n\n        {status === 'auth-waiting' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center mb-4\">\n              <FontAwesomeIcon icon={faSync} spin className=\"text-3xl text-blue-500\" />\n            </div>\n            <p className=\"text-xl font-medium mb-2 text-white\">\n              Restoring Session\n            </p>\n            <p className=\"text-sm text-gray-300 mb-4\">\n              Please wait while we restore your session...\n              {authWaitTime > 0 && ` (${(MAX_AUTH_WAIT - authWaitTime) / 1000}s)`}\n            </p>\n          </div>\n        )}\n        \n        {status === 'success' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mb-4\">\n              <FontAwesomeIcon icon={faCheckCircle} className=\"text-3xl text-green-500\" />\n            </div>\n            <p className=\"text-xl font-medium mb-2 text-white\">\n              Successfully Connected!\n            </p>\n            <p className=\"text-sm mb-4 text-gray-300\">\n              Your YouTube account is now connected. Redirecting you back...\n            </p>\n          </div>\n        )}\n        \n        {status === 'error' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mb-4\">\n              <FontAwesomeIcon icon={faExclamationCircle} className=\"text-3xl text-red-500\" />\n            </div>\n            <p className=\"text-xl font-medium mb-2 text-white\">\n              Authentication Failed\n            </p>\n            <p className=\"text-sm mb-6 text-red-400\">\n              {error}\n            </p>\n            <div className=\"flex gap-4\">\n            <button\n                onClick={handleRetry}\n                className=\"flex items-center justify-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors\"\n              >\n                <FontAwesomeIcon icon={faSync} />\n                Try Again\n            </button>\n              <button\n                onClick={handleReturnHome}\n                className=\"flex items-center justify-center gap-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg transition-colors\"\n              >\n                <FontAwesomeIcon icon={faArrowLeft} />\n                Go Back\n              </button>\n            </div>\n          </div>\n        )}\n        \n        {status === 'auth-required' && (\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-16 h-16 rounded-full bg-yellow-500/20 flex items-center justify-center mb-4\">\n              <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-3xl text-yellow-500\" />\n            </div>\n            <p className=\"text-xl font-medium mb-2 text-white\">\n              Authentication Required\n            </p>\n            <p className=\"text-sm mb-6 text-gray-300\">\n              {error || 'You need to be logged in to connect your YouTube account'}\n            </p>\n            <div className=\"flex gap-4\">\n            <button\n              onClick={handleLogin}\n                className=\"flex items-center justify-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors\"\n            >\n                <FontAwesomeIcon icon={faSignInAlt} />\n                Sign In\n            </button>\n              <button\n                onClick={handleReturnHome}\n                className=\"flex items-center justify-center gap-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg transition-colors\"\n              >\n                <FontAwesomeIcon icon={faArrowLeft} />\n                Go Back\n              </button>\n            </div>\n          </div>\n        )}\n      </GlassmorphicContainer>\n    </div>\n  );\n};\n\nexport default YouTubeCallback; ","import React, { useState, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useUser } from '../context/UserContext';\nimport { useTheme } from '../lib/ThemeContext';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Eye, EyeOff, Mail, Lock, User, Music, Shield, Zap } from 'lucide-react';\nimport { FaSpotify, FaYoutube } from 'react-icons/fa';\nimport FaviconLogo from '../../public/favicon.svg';\nimport { SoundSwappLogo } from '../assets';\nimport { ParticleField } from './ui/ParticleField';\n\n// Exact gradient from Login.tsx\nconst logoGradient = 'linear-gradient(to right, #FF7A59, #FF007A, #00C4CC)';\nconst cardGradient = 'bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC]';\nconst buttonGradient = 'bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC]';\nconst dividerGradient = 'bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC]';\n\nconst featureList = [\n  {\n    icon: <Music className=\"w-6 h-6 text-[#FF7A59]\" />,\n    title: 'All Your Music, One Place',\n    desc: 'Sync Spotify, YouTube, and more in a single click.'\n  },\n  {\n    icon: <Shield className=\"w-6 h-6 text-[#00C4CC]\" />,\n    title: 'Private by Design',\n    desc: 'Your playlists are yours. We never share your data.'\n  },\n  {\n    icon: <Zap className=\"w-6 h-6 text-[#FF007A]\" />,\n    title: 'Lightning Fast',\n    desc: 'Convert and transfer playlists in seconds.'\n  }\n];\n\nconst passwordStrengthColor = (score: number) => [\n  'bg-red-500', 'bg-orange-400', 'bg-yellow-400', 'bg-green-400', 'bg-cyan-500'\n][score] || 'bg-gray-300';\n\nconst passwordTip = 'Use 8+ characters, a number, and a symbol for a strong password.';\n\nconst SimpleLogin: React.FC = () => {\n  const { isDark } = useTheme();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { \n    signInWithEmail, \n    signInWithGoogle,\n    signUpWithEmail,\n    loading, \n    error, \n    user\n  } = useUser();\n  \n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [displayName, setDisplayName] = useState('');\n  const [isSignUp, setIsSignUp] = useState(false);\n  const [localError, setLocalError] = useState<string | null>(null);\n  const [showPassword, setShowPassword] = useState(false);\n  const [isRecoveryMode, setIsRecoveryMode] = useState(false);\n  \n  // Check if we're in recovery mode\n  useEffect(() => {\n    const isRecovery = window.location.search.includes('recovery=true');\n    setIsRecoveryMode(isRecovery);\n    \n    if (isRecovery) {\n      console.log('[DEBUG] Login page in recovery mode');\n      // Clear any stale auth data when in recovery mode\n      localStorage.removeItem('auth_recovery_data');\n      sessionStorage.removeItem('youtube_callback_url');\n    }\n  }, []);\n  \n  // Get the redirect path from location state\n  const from = (location.state as { from?: { pathname: string } })?.from?.pathname || '/app';\n\n  // Redirect if already logged in\n  useEffect(() => {\n    if (user) {\n      // Check if we have a preserved YouTube callback\n      const youtubeCallback = localStorage.getItem('youtube_callback_url');\n      if (youtubeCallback) {\n        // Clear the stored URL\n        localStorage.removeItem('youtube_callback_url');\n        // Redirect to the full callback URL\n        window.location.href = youtubeCallback;\n        return;\n      }\n      \n      // Otherwise, use the normal redirect path\n      navigate(from, { replace: true });\n    }\n  }, [user, navigate, from]);\n\n  const handleEmailAuth = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLocalError(null);\n    \n    if (!email || !password) {\n      setLocalError('Please fill in all fields');\n      return;\n    }\n    \n    if (isSignUp && !displayName) {\n      setLocalError('Please enter your name');\n      return;\n    }\n    \n    try {\n      if (isSignUp) {\n        await signUpWithEmail(email, password, displayName);\n      } else {\n        await signInWithEmail(email, password);\n      }\n      // Success - navigation will happen via useEffect\n    } catch (error) {\n      setLocalError(error instanceof Error ? error.message : 'Authentication failed');\n    }\n  };\n\n  const handleGoogleAuth = async () => {\n    setLocalError(null);\n    try {\n      await signInWithGoogle();\n    } catch (error) {\n      setLocalError(error instanceof Error ? error.message : 'Google sign-in failed');\n    }\n  };\n\n  // Password strength (simple)\n  const getPasswordScore = (pw: string) => {\n    let score = 0;\n    if (pw.length >= 8) score++;\n    if (/[0-9]/.test(pw)) score++;\n    if (/[!@#$%^&*]/.test(pw)) score++;\n    if (/[A-Z]/.test(pw)) score++;\n    if (pw.length >= 12) score++;\n    return Math.min(score, 4);\n  };\n  const passwordScore = isSignUp ? getPasswordScore(password) : 0;\n\n  const displayError = localError || error;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300 relative overflow-hidden flex items-center justify-center\">\n      {/* Particle background */}\n      <ParticleField\n        colorScheme=\"colorful\"\n        density=\"medium\"\n        interactive={false}\n        className=\"fixed top-0 left-0 w-full h-full z-0 opacity-80 dark:opacity-60\"\n      />\n      {/* Animated orb background */}\n      <motion.div\n        className=\"absolute -top-32 left-1/2 -translate-x-1/2 w-[600px] h-[600px] rounded-full bg-gradient-to-br from-[#FF7A59] via-[#FF007A] to-[#00C4CC] blur-3xl opacity-30\"\n        animate={{ scale: [1, 1.1, 1], rotate: [0, 360, 0] }}\n        transition={{ duration: 18, repeat: Infinity, ease: 'linear' }}\n      />\n      {/* Floating notes */}\n      {[...Array(3)].map((_, i) => (\n        <motion.div\n          key={i}\n          className=\"absolute text-white/20 drop-shadow-[0_0_10px_rgba(255,255,255,0.25)]\"\n          style={{ left: `${20 + i * 30}%`, top: `${30 + i * 15}%` }}\n          animate={{ y: [0, -24, 0], rotate: [0, 360], opacity: [0.2, 0.5, 0.2] }}\n          transition={{ duration: 8 + i * 2, repeat: Infinity, delay: i }}\n        >\n          <Music size={28} />\n        </motion.div>\n      ))}\n      <div className=\"relative z-10 w-full max-w-5xl mx-auto flex flex-col lg:flex-row items-center justify-center gap-12 px-4 py-12\">\n        {/* Left: Branding & Features */}\n        <div className=\"w-full lg:w-1/2 flex flex-col items-center lg:items-start text-center lg:text-left mb-10 lg:mb-0\">\n          <h1\n            className=\"text-5xl md:text-6xl font-extrabold mb-4 tracking-tight\"\n            style={{\n              background: logoGradient,\n              WebkitBackgroundClip: 'text',\n              backgroundClip: 'text',\n              color: 'transparent',\n              display: 'inline-block',\n              fontWeight: 800,\n              textShadow: '0 0 30px rgba(255,122,89,0.3)',\n              fontSize: '4.5rem',\n              letterSpacing: '-0.04em',\n            }}\n          >\n            SoundSwapp\n          </h1>\n          <p className=\"text-lg text-neutral-600 dark:text-gray-300 mb-8 max-w-md\">Seamlessly sync your music across all platforms. One click, pure magic.</p>\n          <div className=\"space-y-6 mb-8 w-full max-w-xs mx-auto lg:mx-0\">\n            {featureList.map((f, i) => (\n              <div key={i} className=\"flex items-center gap-4\">\n                <div className=\"bg-white/10 rounded-xl p-3 flex items-center justify-center\">\n                  {f.icon}\n                </div>\n                <div>\n                  <h3 className=\"text-base font-semibold text-neutral-900 dark:text-white\">{f.title}</h3>\n                  <p className=\"text-sm text-neutral-600 dark:text-gray-400\">{f.desc}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n          <div className=\"flex items-center space-x-4 text-gray-400 text-sm mt-4\">\n            <span>Trusted by music lovers worldwide</span>\n            <div className=\"flex space-x-2\">\n              <div className=\"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center\">\n                <FaSpotify className=\"text-white w-5 h-5\" />\n              </div>\n              <div className=\"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center\">\n                <FaYoutube className=\"text-white w-5 h-5\" />\n              </div>\n            </div>\n          </div>\n          <div className=\"mt-2 text-xs text-gray-500 italic\">“Playlist magic, powered by you.”</div>\n        </div>\n        {/* Right: Login Card */}\n        <div className=\"w-full max-w-md mx-auto\">\n          <div className=\"space-y-6\">\n              <div className=\"text-center mb-8\">\n                <div className=\"flex items-center justify-center mb-6\">\n                  <SoundSwappLogo width={48} height={48} />\n                </div>\n                <h2 className=\"text-2xl md:text-3xl font-extrabold tracking-tight bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent mb-2\">\n                  {isRecoveryMode ? 'Authentication Recovery' : (isSignUp ? 'Create your account' : 'Welcome back')}\n                </h2>\n                <p className=\"text-neutral-600 dark:text-gray-300\">\n                  {isRecoveryMode \n                    ? 'Please sign in again to continue with your music service connection'\n                    : (isSignUp ? 'Sign up to start swapping playlists' : 'Sign in to continue')\n                  }\n                </p>\n              </div>\n              {displayError && (\n                <motion.div\n                  initial={{ opacity: 0, y: -10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  exit={{ opacity: 0, y: -10 }}\n                  className=\"mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-xl backdrop-blur-sm\"\n                >\n                  <p className=\"text-red-300 text-sm flex items-center\">\n                    <span className=\"w-2 h-2 bg-red-400 rounded-full mr-2\"></span>\n                    {displayError}\n                  </p>\n                </motion.div>\n              )}\n              \n              {/* Recovery mode indicator */}\n              {isRecoveryMode && (\n                <motion.div\n                  initial={{ opacity: 0, y: -10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  className=\"mb-6 p-4 bg-blue-500/20 border border-blue-500/30 rounded-xl backdrop-blur-sm\"\n                >\n                  <p className=\"text-blue-300 text-sm flex items-center\">\n                    <span className=\"w-2 h-2 bg-blue-400 rounded-full mr-2\"></span>\n                    Recovery Mode: Your previous session expired. Please sign in again.\n                  </p>\n                </motion.div>\n              )}\n              <motion.button\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                onClick={handleGoogleAuth}\n                disabled={loading}\n                className={\"w-full py-4 rounded-xl transition-all duration-200 flex items-center justify-center gap-3 shadow-lg text-white bg-[linear-gradient(90deg,#4285F4_0%,#34A853_33%,#FBBC05_66%,#EA4335_100%)] hover:brightness-110 active:brightness-95 focus:outline-none focus:ring-2 focus:ring-white/70 disabled:opacity-50 disabled:cursor-not-allowed mb-6\"}\n                aria-label=\"Sign in with Google\"\n              >\n                {loading ? (\n                  <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin mr-3\"></div>\n                ) : (\n                  <svg className=\"w-5 h-5 mr-3\" viewBox=\"0 0 24 24\">\n                    <path fill=\"currentColor\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\n                    <path fill=\"currentColor\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\n                    <path fill=\"currentColor\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\n                    <path fill=\"currentColor\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\n                  </svg>\n                )}\n                Continue with Google\n              </motion.button>\n              <div className=\"relative mb-6\">\n                <div className=\"absolute inset-0 flex items-center\">\n                  <div className=\"w-full border-t border-neutral-200 dark:border-white/20\"></div>\n                </div>\n                <div className=\"relative flex justify-center text-sm\">\n                  <span className=\"px-4 py-1 bg-transparent text-neutral-500 dark:text-gray-400\">or</span>\n                </div>\n              </div>\n              <form onSubmit={handleEmailAuth} className=\"space-y-4\" encType=\"application/x-www-form-urlencoded\">\n                {isSignUp && (\n                  <div className=\"relative\">\n                    <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n                      <User className=\"h-5 w-5 text-gradient bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent\" />\n                    </div>\n                    <input\n                      type=\"text\"\n                      value={displayName}\n                      onChange={(e) => setDisplayName(e.target.value)}\n                      className={`w-full pl-12 pr-4 py-4 rounded-xl transition-all duration-200\n                                   bg-white text-neutral-900 placeholder-neutral-500 border border-neutral-200 focus:outline-none focus:ring-2 focus:ring-[#FF7A59]\n                                   dark:bg-white/10 dark:text-white dark:placeholder-gray-400 dark:border-white/20`}\n                      placeholder=\"Full Name\"\n                      required={isSignUp}\n                      aria-label=\"Full Name\"\n                      autoComplete=\"name\"\n                    />\n                  </div>\n                )}\n                <div className=\"relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n                    <Mail className=\"h-5 w-5 text-gradient bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent\" />\n                  </div>\n                  <input\n                    type=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    className={`w-full pl-12 pr-4 py-4 rounded-xl transition-all duration-200\n                               bg-white text-neutral-900 placeholder-neutral-500 border border-neutral-200 focus:outline-none focus:ring-2 focus:ring-[#FF7A59]\n                               dark:bg-white/10 dark:text-white dark:placeholder-gray-400 dark:border-white/20`}\n                    placeholder=\"Email Address\"\n                    required\n                    aria-label=\"Email Address\"\n                    autoComplete=\"email\"\n                  />\n                </div>\n                <div className=\"relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n                    <Lock className=\"h-5 w-5 text-gradient bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent\" />\n                  </div>\n                  <input\n                    type={showPassword ? 'text' : 'password'}\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    className={`w-full pl-12 pr-12 py-4 rounded-xl transition-all duration-200\n                               bg-white text-neutral-900 placeholder-neutral-500 border border-neutral-200 focus:outline-none focus:ring-2 focus:ring-[#FF7A59]\n                               dark:bg-white/10 dark:text-white dark:placeholder-gray-400 dark:border-white/20`}\n                    placeholder=\"Password\"\n                    required\n                    minLength={6}\n                    aria-label=\"Password\"\n                    autoComplete={isSignUp ? \"new-password\" : \"current-password\"}\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    className=\"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-white transition-colors\"\n                    aria-label={showPassword ? 'Hide password' : 'Show password'}\n                  >\n                    {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\n                  </button>\n                </div>\n                {/* Password strength bar for sign up */}\n                {isSignUp && (\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <div className={`h-2 w-32 rounded-full ${passwordStrengthColor(passwordScore)}`}></div>\n                    <span className=\"text-xs text-gray-400\">{passwordTip}</span>\n                  </div>\n                )}\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  type=\"submit\"\n                  disabled={loading}\n                  className={`w-full py-4 ${buttonGradient} text-white font-semibold rounded-xl hover:from-[#FF7A59] hover:to-[#00C4CC] focus:outline-none focus:ring-2 focus:ring-[#FF7A59] focus:ring-offset-2 focus:ring-offset-transparent disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg`}\n                >\n                  {loading ? (\n                    <div className=\"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto\"></div>\n                  ) : (\n                    isSignUp ? 'Create Account' : 'Sign In'\n                  )}\n                </motion.button>\n              </form>\n              <div className=\"text-center mt-6\">\n                <button\n                  onClick={() => setIsSignUp(!isSignUp)}\n                  className=\"text-gray-300 hover:text-white transition-colors\"\n                >\n                  {isSignUp ? 'Already have an account? ' : \"Don't have an account? \"}\n                  <span className=\"text-[#FF7A59] hover:text-[#00C4CC] font-medium\">\n                    {isSignUp ? 'Sign in' : 'Sign up'}\n                  </span>\n                </button>\n                <div className=\"mt-6 text-xs text-gray-400\">\n                  By using this app, you agree to our\n                  <a href=\"/terms.html\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline ml-1\">Terms of Use</a>\n                  and\n                  <a href=\"/privacy.html\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline ml-1\">Privacy Policy</a>.\n                </div>\n              </div>\n            </div>\n          </div>\n                </div>\n      </div>\n   );\n};\n\nexport default SimpleLogin; ","import React, { useState, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useUser } from '../context/UserContext';\nimport { useTheme } from '../lib/ThemeContext';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  Eye, \n  EyeOff, \n  Mail, \n  Lock, \n  User, \n  Music, \n  Shield, \n  Zap, \n  CheckCircle,\n  AlertCircle,\n  Sparkles,\n  Sun,\n  Moon\n} from 'lucide-react';\nimport { FaSpotify, FaYoutube } from 'react-icons/fa';\nimport { SoundSwappLogo } from '../assets';\nimport { ParticleField } from './ui/ParticleField';\nimport { GlassmorphicCard } from './ui/GlassmorphicCard';\nimport { MobileButton } from './ResponsiveLayout';\n\n// Brand gradients\nconst logoGradient = 'linear-gradient(to right, #FF7A59, #FF007A, #00C4CC)';\nconst buttonGradient = 'bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC]';\n\nconst featureList = [\n  {\n    icon: <Music className=\"w-6 h-6 text-[#FF7A59]\" />,\n    title: 'All Your Music, One Place',\n    desc: 'Sync Spotify, YouTube, and more in a single click.'\n  },\n  {\n    icon: <Shield className=\"w-6 h-6 text-[#00C4CC]\" />,\n    title: 'Private by Design',\n    desc: 'Your playlists are yours. We never share your data.'\n  },\n  {\n    icon: <Zap className=\"w-6 h-6 text-[#FF007A]\" />,\n    title: 'Lightning Fast',\n    desc: 'Convert and transfer playlists in seconds.'\n  }\n];\n\nconst passwordStrengthColor = (score: number) => [\n  'bg-red-500', 'bg-orange-400', 'bg-yellow-400', 'bg-green-400', 'bg-cyan-500'\n][score] || 'bg-gray-300';\n\nconst MobileLogin: React.FC = () => {\n  const themeCtx = useTheme() as any;\n  const { isDark } = themeCtx;\n  const toggleTheme = (themeCtx?.toggleTheme as (() => void) | undefined);\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { \n    signInWithEmail, \n    signInWithGoogle,\n    signUpWithEmail,\n    loading, \n    error, \n    user\n  } = useUser();\n  \n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [displayName, setDisplayName] = useState('');\n  const [isSignUp, setIsSignUp] = useState(false);\n  const [localError, setLocalError] = useState<string | null>(null);\n  const [showPassword, setShowPassword] = useState(false);\n  const [isRecoveryMode, setIsRecoveryMode] = useState(false);\n  const [rememberMe, setRememberMe] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [validationErrors, setValidationErrors] = useState<{[key: string]: string}>({});\n  const [showSuccessAnimation, setShowSuccessAnimation] = useState(false);\n  \n  // Dynamic greeting based on time of day\n  const getGreeting = () => {\n    const hour = new Date().getHours();\n    if (hour < 12) return \"Good morning! ☀️\";\n    if (hour < 18) return \"Good afternoon! 🌤️\";\n    return \"Good evening! 🌙\";\n  };\n  \n  // Enhanced form validation\n  const validateForm = () => {\n    const errors: {[key: string]: string} = {};\n    \n    if (!email) {\n      errors.email = 'Email is required';\n    } else if (!/\\S+@\\S+\\.\\S+/.test(email)) {\n      errors.email = 'Please enter a valid email address';\n    }\n    \n    if (!password) {\n      errors.password = 'Password is required';\n    } else if (password.length < 6) {\n      errors.password = 'Password must be at least 6 characters';\n    }\n    \n    if (isSignUp && !displayName) {\n      errors.displayName = 'Full name is required';\n    } else if (isSignUp && displayName.length < 2) {\n      errors.displayName = 'Name must be at least 2 characters';\n    }\n    \n    setValidationErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n  \n  // Real-time validation\n  const validateField = (field: string, value: string) => {\n    const errors = { ...validationErrors };\n    \n    switch (field) {\n      case 'email':\n        if (!value) {\n          errors.email = 'Email is required';\n        } else if (!/\\S+@\\S+\\.\\S+/.test(value)) {\n          errors.email = 'Please enter a valid email address';\n        } else {\n          delete errors.email;\n        }\n        break;\n      case 'password':\n        if (!value) {\n          errors.password = 'Password is required';\n        } else if (value.length < 6) {\n          errors.password = 'Password must be at least 6 characters';\n        } else {\n          delete errors.password;\n        }\n        break;\n      case 'displayName':\n        if (isSignUp && !value) {\n          errors.displayName = 'Full name is required';\n        } else if (isSignUp && value.length < 2) {\n          errors.displayName = 'Name must be at least 2 characters';\n        } else {\n          delete errors.displayName;\n        }\n        break;\n    }\n    \n    setValidationErrors(errors);\n  };\n  \n  // Password strength calculation\n  const calculatePasswordStrength = (pwd: string): number => {\n    let score = 0;\n    if (pwd.length >= 8) score++;\n    if (/[a-z]/.test(pwd)) score++;\n    if (/[A-Z]/.test(pwd)) score++;\n    if (/[0-9]/.test(pwd)) score++;\n    if (/[^A-Za-z0-9]/.test(pwd)) score++;\n    return score;\n  };\n\n  const passwordScore = calculatePasswordStrength(password);\n  const passwordTip = password.length === 0 ? '' : \n    passwordScore < 2 ? 'Weak password' : \n    passwordScore < 4 ? 'Good password' : \n    'Strong password';\n  \n  // Check if we're in recovery mode\n  useEffect(() => {\n    const isRecovery = window.location.search.includes('recovery=true');\n    setIsRecoveryMode(isRecovery);\n    \n    if (isRecovery) {\n      console.log('[DEBUG] Mobile Login page in recovery mode');\n      localStorage.removeItem('auth_recovery_data');\n      sessionStorage.removeItem('youtube_callback_url');\n    }\n  }, []);\n  \n  // Get the redirect path from location state\n  const from = (location.state as { from?: { pathname: string } })?.from?.pathname || '/';\n\n  // Redirect if already logged in\n  useEffect(() => {\n    if (user) {\n      const youtubeCallback = localStorage.getItem('youtube_callback_url');\n      if (youtubeCallback) {\n        localStorage.removeItem('youtube_callback_url');\n        window.location.href = youtubeCallback;\n        return;\n      }\n      navigate(from, { replace: true });\n    }\n  }, [user, navigate, from]);\n\n  const handleEmailAuth = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLocalError(null);\n    setIsSubmitting(true);\n    \n    // Enhanced validation\n    if (!validateForm()) {\n      setIsSubmitting(false);\n      return;\n    }\n    \n    try {\n      if (isSignUp) {\n        await signUpWithEmail(email, password, displayName);\n        setShowSuccessAnimation(true);\n        setTimeout(() => setShowSuccessAnimation(false), 2000);\n      } else {\n        await signInWithEmail(email, password);\n        // Store remember me preference\n        if (rememberMe) {\n          localStorage.setItem('rememberMe', 'true');\n        }\n        setShowSuccessAnimation(true);\n        setTimeout(() => setShowSuccessAnimation(false), 2000);\n      }\n    } catch (error) {\n      // Better error messages\n      const errorMessage = error instanceof Error ? error.message : 'Authentication failed';\n      if (errorMessage.includes('email-already-in-use')) {\n        setLocalError('An account with this email already exists. Try signing in instead.');\n      } else if (errorMessage.includes('weak-password')) {\n        setLocalError('Password is too weak. Please choose a stronger password.');\n      } else if (errorMessage.includes('invalid-email')) {\n        setLocalError('Please enter a valid email address.');\n      } else if (errorMessage.includes('user-not-found')) {\n        setLocalError('No account found with this email. Try signing up instead.');\n      } else if (errorMessage.includes('wrong-password')) {\n        setLocalError('Incorrect password. Please try again.');\n      } else {\n        setLocalError(errorMessage);\n      }\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleGoogleAuth = async () => {\n    setLocalError(null);\n    setIsSubmitting(true);\n    try {\n      await signInWithGoogle();\n      setShowSuccessAnimation(true);\n      setTimeout(() => setShowSuccessAnimation(false), 2000);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Google sign-in failed';\n      if (errorMessage.includes('popup-closed')) {\n        setLocalError('Sign-in was cancelled. Please try again.');\n      } else if (errorMessage.includes('network-request-failed')) {\n        setLocalError('Network error. Please check your connection and try again.');\n      } else {\n        setLocalError('Google sign-in failed. Please try again.');\n      }\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n\n\n  const displayError = localError || error;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300 relative overflow-hidden premium-overlay\">\n      {/* Background Particles */}\n            <ParticleField\n           colorScheme=\"colorful\"\n           density=\"medium\"\n           interactive={false}\n           className=\"fixed top-0 left-0 w-full h-full z-0 opacity-80 dark:opacity-60\"\n         />\n      {/* Animated orb background */}\n      <motion.div\n        className=\"absolute -top-32 left-1/2 -translate-x-1/2 w-[600px] h-[600px] rounded-full bg-gradient-to-br from-[#FF7A59] via-[#FF007A] to-[#00C4CC] blur-3xl opacity-30\"\n        animate={{ scale: [1, 1.1, 1], rotate: [0, 360, 0] }}\n        transition={{ duration: 18, repeat: Infinity, ease: 'linear' }}\n      />\n      {/* Floating notes */}\n      {[...Array(3)].map((_, i) => (\n        <motion.div\n          key={i}\n          className=\"absolute text-white/20 drop-shadow-[0_0_10px_rgba(255,255,255,0.25)]\"\n          style={{ left: `${20 + i * 30}%`, top: `${30 + i * 15}%` }}\n          animate={{ y: [0, -24, 0], rotate: [0, 360], opacity: [0.2, 0.5, 0.2] }}\n          transition={{ duration: 8 + i * 2, repeat: Infinity, delay: i }}\n        >\n          <Music size={28} />\n        </motion.div>\n      ))}\n       \n      {/* Back Button */}\n      <motion.button\n        initial={{ opacity: 0, x: 20 }}\n        animate={{ opacity: 1, x: 0 }}\n        transition={{ duration: 0.5, delay: 0.1 }}\n        onClick={() => {\n          if (typeof toggleTheme === 'function') {\n            toggleTheme();\n            return;\n          }\n          const root = document.documentElement;\n          const isDarkNow = root.classList.contains('dark');\n          root.classList.remove('light', 'dark');\n          root.classList.add(isDarkNow ? 'light' : 'dark');\n          localStorage.setItem('theme', isDarkNow ? 'light' : 'dark');\n        }}\n        aria-label=\"Toggle theme\"\n        className=\"absolute top-6 right-6 z-50 grid place-items-center h-10 w-10\"\n      >\n        <div className=\"h-10 w-10 rounded-full grid place-items-center bg-white/20 dark:bg-[#181926]/90 backdrop-blur-md border border-white/20 transition-colors duration-300\">\n          {isDark ? (\n            <Sun className=\"w-5 h-5 text-yellow-400 drop-shadow-[0_0_6px_rgba(250,204,21,0.7)]\" />\n          ) : (\n            <Moon className=\"w-5 h-5 text-[#FF7A59] drop-shadow-[0_0_6px_rgba(255,122,89,0.7)]\" />\n          )}\n        </div>\n      </motion.button>\n\n      <div className=\"relative z-10 min-h-screen flex items-center justify-center p-4\">\n        <div className=\"w-full max-w-md space-y-6\">\n          {/* Header Section */}\n          <motion.div \n            className=\"text-center mb-8\"\n            initial={{ opacity: 0, y: -30 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6, ease: \"easeOut\" }}\n          >\n            {/* Dynamic Greeting */}\n            <motion.p \n              className=\"text-sm text-gray-400 mb-4\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              transition={{ delay: 0.1 }}\n            >\n              {getGreeting()}\n            </motion.p>\n            \n            {/* Breathing Logo Animation */}\n            <motion.div\n              className=\"relative mb-6\"\n              initial={{ scale: 0.8 }}\n              animate={{ scale: 1 }}\n              transition={{ duration: 0.5, delay: 0.2 }}\n            >\n                           <motion.div \n                 className=\"mx-auto flex items-center justify-center\"\n                 animate={{ \n                   scale: [1, 1.05, 1]\n                 }}\n                 transition={{ \n                   duration: 3, \n                   repeat: Infinity, \n                   ease: \"easeInOut\" \n                 }}\n               >\n                 <SoundSwappLogo width={40} height={40} />\n               </motion.div>\n            </motion.div>\n            \n            <motion.h1 \n              className=\"text-3xl md:text-4xl font-extrabold tracking-tight bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent mb-3 drop-shadow-[0_2px_8px_rgba(0,0,0,0.15)]\"\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.4 }}\n            >\n              {isRecoveryMode ? 'Authentication Recovery' : (isSignUp ? 'Create Account' : 'Welcome Back')}\n            </motion.h1>\n            \n            <motion.p \n              className=\"text-neutral-600 dark:text-gray-300 text-base leading-relaxed\"\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.5 }}\n            >\n              {isRecoveryMode \n                ? 'Please sign in again to continue with your music service connection'\n                : (isSignUp ? 'Join SoundSwapp to start converting playlists' : 'Sign in to continue your music journey')\n              }\n            </motion.p>\n          </motion.div>\n\n          {/* Main Auth Section (no card wrapper) */}\n          <motion.div\n            initial={{ opacity: 0, y: 30 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6, delay: 0.3 }}\n          >\n            <div className=\"space-y-6\">\n              {/* Recovery Mode Indicator */}\n              {isRecoveryMode && (\n                <motion.div\n                  initial={{ opacity: 0, scale: 0.9 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                  className=\"p-4 bg-blue-500/20 border border-blue-500/30 rounded-xl backdrop-blur-sm\"\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    <AlertCircle className=\"w-5 h-5 text-blue-400\" />\n                    <p className=\"text-blue-300 text-sm\">\n                      Recovery mode: Please authenticate to continue\n                    </p>\n                  </div>\n                </motion.div>\n              )}\n\n              {/* Error Display */}\n              <AnimatePresence>\n                {displayError && (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -10 }}\n                    className=\"p-4 bg-red-500/20 border border-red-500/30 rounded-xl backdrop-blur-sm\"\n                  >\n                    <div className=\"flex items-center space-x-3\">\n                      <AlertCircle className=\"w-5 h-5 text-red-400\" />\n                      <p className=\"text-red-300 text-sm\">{displayError}</p>\n                    </div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n\n              {/* Google Sign In Button (Google gradient) */}\n              <motion.button\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                onClick={handleGoogleAuth}\n                disabled={loading || isSubmitting}\n                className=\"w-full py-4 rounded-xl transition-all duration-200 flex items-center justify-center gap-3 shadow-lg text-white bg-[linear-gradient(90deg,#4285F4_0%,#34A853_33%,#FBBC05_66%,#EA4335_100%)] hover:brightness-110 active:brightness-95 focus:outline-none focus:ring-2 focus:ring-white/70\"\n                aria-label=\"Sign in with Google\"\n                initial={{ opacity: 0, x: -20 }}\n                animate={{ opacity: 1, x: 0 }}\n                transition={{ duration: 0.5, delay: 0.4 }}\n              >\n                {loading || isSubmitting ? (\n                  <div className=\"w-5 h-5 border-2 border-white/70 border-t-transparent rounded-full animate-spin\"></div>\n                ) : (\n                  <svg className=\"w-5 h-5 text-white\" viewBox=\"0 0 24 24\">\n                    <path fill=\"currentColor\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\n                    <path fill=\"currentColor\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\n                    <path fill=\"currentColor\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\n                    <path fill=\"currentColor\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\n                  </svg>\n                )}\n                <span className=\"font-semibold\">Continue with Google</span>\n              </motion.button>\n\n              {/* Divider */}\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 flex items-center\">\n                  <div className=\"w-full border-t border-neutral-200 dark:border-white/20\"></div>\n                </div>\n                <div className=\"relative flex justify-center text-sm\">\n                  <span className=\"px-4 py-1 bg-transparent text-neutral-500 dark:text-gray-400\">or</span>\n                </div>\n              </div>\n\n              {/* Auth Form */}\n              <form onSubmit={handleEmailAuth} className=\"space-y-4\" encType=\"application/x-www-form-urlencoded\">\n                {isSignUp && (\n                  <motion.div\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    transition={{ duration: 0.5, delay: 0.5 }}\n                  >\n                    <div className=\"relative\">\n                      <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n                        <User className=\"h-5 w-5 bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent\" />\n                      </div>\n                      <input\n                        type=\"text\"\n                        value={displayName}\n                        onChange={(e) => {\n                          setDisplayName(e.target.value);\n                          validateField('displayName', e.target.value);\n                        }}\n                        className={`w-full pl-12 pr-4 py-4 rounded-xl transition-all duration-200\n                                   bg-white text-neutral-900 placeholder-neutral-500 border border-neutral-200 focus:outline-none focus:ring-2 focus:ring-[#FF7A59]\n                                   dark:bg-white/10 dark:text-white dark:placeholder-gray-400 dark:border-white/20`}\n                        placeholder=\"Full Name\"\n                        required={isSignUp}\n                        aria-label=\"Full Name\"\n                        autoComplete=\"name\"\n                      />\n                    </div>\n                    {validationErrors.displayName && (\n                      <motion.p\n                        initial={{ opacity: 0, y: -10 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        className=\"text-red-500 dark:text-red-400 text-sm mt-1 flex items-center\"\n                      >\n                        <AlertCircle className=\"w-4 h-4 mr-1\" />\n                        {validationErrors.displayName}\n                      </motion.p>\n                    )}\n                  </motion.div>\n                )}\n\n                {/* Email */}\n                <motion.div\n                  initial={{ opacity: 0, x: -20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  transition={{ duration: 0.5, delay: 0.6 }}\n                >\n                  <div className=\"relative\">\n                    <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n                      <Mail className=\"h-5 w-5 bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent\" />\n                    </div>\n                    <input\n                      type=\"email\"\n                      value={email}\n                      onChange={(e) => {\n                        setEmail(e.target.value);\n                        validateField('email', e.target.value);\n                      }}\n                      className={`w-full pl-12 pr-4 py-4 rounded-xl transition-all duration-200\n                                 bg-white text-neutral-900 placeholder-neutral-500 border border-neutral-200 focus:outline-none focus:ring-2 focus:ring-[#FF7A59]\n                                 dark:bg-white/10 dark:text-white dark:placeholder-gray-400 dark:border-white/20`}\n                      placeholder=\"Email Address\"\n                      required\n                      aria-label=\"Email Address\"\n                      autoComplete=\"email\"\n                    />\n                  </div>\n                  {validationErrors.email && (\n                    <motion.p\n                      initial={{ opacity: 0, y: -10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      className=\"text-red-500 dark:text-red-400 text-sm mt-1 flex items-center\"\n                    >\n                      <AlertCircle className=\"w-4 h-4 mr-1\" />\n                      {validationErrors.email}\n                    </motion.p>\n                  )}\n                </motion.div>\n\n                {/* Password */}\n                <motion.div\n                  initial={{ opacity: 0, x: -20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  transition={{ duration: 0.5, delay: 0.7 }}\n                >\n                  <div className=\"relative\">\n                    <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n                      <Lock className=\"h-5 w-5 bg-gradient-to-r from-[#FF7A59] via-[#FF007A] to-[#00C4CC] bg-clip-text text-transparent\" />\n                    </div>\n                    <input\n                      type={showPassword ? 'text' : 'password'}\n                      value={password}\n                      onChange={(e) => {\n                        setPassword(e.target.value);\n                        validateField('password', e.target.value);\n                      }}\n                      className={`w-full pl-12 pr-12 py-4 rounded-xl transition-all duration-200\n                                 bg-white text-neutral-900 placeholder-neutral-500 border border-neutral-200 focus:outline-none focus:ring-2 focus:ring-[#FF7A59]\n                                 dark:bg-white/10 dark:text-white dark:placeholder-gray-400 dark:border-white/20`}\n                      placeholder=\"Password\"\n                      required\n                      aria-label=\"Password\"\n                      autoComplete={isSignUp ? \"new-password\" : \"current-password\"}\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowPassword(!showPassword)}\n                      className=\"absolute inset-y-0 right-0 pr-4 flex items-center text-neutral-500 hover:text-neutral-800 dark:text-gray-400 dark:hover:text-white transition-colors\"\n                    >\n                      {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\n                    </button>\n                  </div>\n                  {validationErrors.password && (\n                    <motion.p\n                      initial={{ opacity: 0, y: -10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      className=\"text-red-500 dark:text-red-400 text-sm mt-1 flex items-center\"\n                    >\n                      <AlertCircle className=\"w-4 h-4 mr-1\" />\n                      {validationErrors.password}\n                    </motion.p>\n                  )}\n                </motion.div>\n\n                {/* Password strength bar for sign up */}\n                {isSignUp && (\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <div className={`h-2 w-32 rounded-full ${passwordStrengthColor(passwordScore)}`}></div>\n                    <span className=\"text-xs text-gray-400\">{passwordTip}</span>\n                  </div>\n                )}\n\n                {/* Remember Me Checkbox (only for sign in) */}\n                {!isSignUp && (\n                  <motion.div\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    transition={{ duration: 0.5, delay: 0.8 }}\n                    className=\"flex items-center space-x-3\"\n                  >\n                    <label className=\"flex items-center space-x-2 cursor-pointer\">\n                      <input\n                        type=\"checkbox\"\n                        checked={rememberMe}\n                        onChange={(e) => setRememberMe(e.target.checked)}\n                        className=\"w-4 h-4 text-[#FF7A59] bg-white/10 border-white/20 rounded focus:ring-[#FF7A59] focus:ring-2 focus:ring-offset-0\"\n                      />\n                      <span className=\"text-sm text-gray-300\">Keep me signed in</span>\n                    </label>\n                  </motion.div>\n                )}\n\n                {/* Submit Button */}\n                <motion.button\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ duration: 0.5, delay: 0.9 }}\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  type=\"submit\"\n                  disabled={loading || isSubmitting}\n                  className={`w-full py-4 ${buttonGradient} text-white font-semibold rounded-xl hover:from-[#FF7A59] hover:to-[#00C4CC] focus:outline-none focus:ring-2 focus:ring-[#FF7A59] focus:ring-offset-2 focus:ring-offset-transparent disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg relative overflow-hidden`}\n                >\n                  {/* Success Animation Overlay */}\n                  <AnimatePresence>\n                    {showSuccessAnimation && (\n                      <motion.div\n                        initial={{ opacity: 0, scale: 0 }}\n                        animate={{ opacity: 1, scale: 1 }}\n                        exit={{ opacity: 0, scale: 0 }}\n                        className=\"absolute inset-0 bg-green-500 flex items-center justify-center rounded-xl\"\n                      >\n                        <CheckCircle className=\"w-6 h-6 text-white\" />\n                      </motion.div>\n                    )}\n                  </AnimatePresence>\n                  \n                  {/* Button Content */}\n                  <motion.div\n                    animate={{ opacity: showSuccessAnimation ? 0 : 1 }}\n                    transition={{ duration: 0.2 }}\n                  >\n                    {(loading || isSubmitting) ? (\n                      <div className=\"flex items-center justify-center space-x-2\">\n                        <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\n                        <span>{isSignUp ? 'Creating Account...' : 'Signing In...'}</span>\n                      </div>\n                    ) : (\n                      isSignUp ? 'Create Account' : 'Sign In'\n                    )}\n                  </motion.div>\n                </motion.button>\n              </form>\n\n              {/* Toggle Sign Up/In */}\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ duration: 0.5, delay: 1.0 }}\n                className=\"text-center\"\n              >\n                <button\n                  onClick={() => setIsSignUp(!isSignUp)}\n                  className=\"text-gray-300 hover:text-white transition-colors\"\n                >\n                  {isSignUp ? 'Already have an account? ' : \"Don't have an account? \"}\n                  <span className=\"text-[#FF7A59] hover:text-[#00C4CC] font-medium\">\n                    {isSignUp ? 'Sign in' : 'Sign up'}\n                  </span>\n                </button>\n              </motion.div>\n\n              {/* Terms */}\n              <div className=\"text-center text-xs text-gray-400\">\n                By using this app, you agree to our\n                <a href=\"/terms-of-service\" className=\"underline ml-1\">Terms of Use</a>\n                and\n                <a href=\"/privacy-policy\" className=\"underline ml-1\">Privacy Policy</a>.\n              </div>\n            </div>\n          </motion.div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MobileLogin; ","import React from 'react';\nimport { Navigate, useLocation } from 'react-router-dom';\nimport { useAuth } from '../lib/AuthContext';\n\ninterface PrivateRouteProps {\n  children?: React.ReactElement;\n  element?: React.ReactElement;\n  requireProvider?: boolean;\n}\n\nexport const PrivateRoute: React.FC<PrivateRouteProps> = ({ \n  children, \n  element,\n  requireProvider = false \n}) => {\n  const { isAuthenticated, isProvider, loading } = useAuth();\n  const location = useLocation();\n  \n  const content = children ?? element ?? null;\n  \n  // Show loading state while authentication state is being determined\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"flex flex-col items-center space-y-4\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600\"></div>\n          <p className=\"text-gray-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n  \n  // If not authenticated, redirect to login\n  if (!isAuthenticated) {\n    return <Navigate to=\"/login\" state={{ from: location }} replace />;\n  }\n  \n  // If provider role is required but user is not a provider\n  if (requireProvider && !isProvider) {\n    return <Navigate to=\"/get-started\" state={{ from: location }} replace />;\n  }\n  \n  return content;\n};\n\nexport default PrivateRoute; ","import { Link } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faArrowLeft, faMusic } from '@fortawesome/free-solid-svg-icons';\nimport { faGithub, faTwitter } from '@fortawesome/free-brands-svg-icons';\nimport { useTheme } from '../lib/ThemeContext';\nimport SoundSwappLogo from '../assets/SoundSwappLogo';\n\nexport default function PrivacyPolicy() {\n  const { isDark } = useTheme();\n  \n  return (\n    <div className={isDark ? \"bg-gray-900 text-white min-h-screen\" : \"bg-white text-gray-800 min-h-screen\"}>\n      <header className={`p-4 border-b ${isDark ? \"border-gray-800\" : \"border-gray-200\"}`}>\n        <div className=\"container mx-auto flex items-center\">\n          <Link to=\"/\" className={`flex items-center text-sm font-medium ${isDark ? \"text-gray-300 hover:text-white\" : \"text-gray-600 hover:text-gray-900\"}`}>\n            <FontAwesomeIcon icon={faArrowLeft} className=\"mr-2\" />\n            Back to App\n          </Link>\n          <h1 className=\"text-xl font-bold mx-auto\">Privacy Policy</h1>\n        </div>\n      </header>\n      \n      <main className=\"container mx-auto py-8 px-4 max-w-4xl\">\n        <div className={`prose ${isDark ? \"prose-invert\" : \"\"} max-w-none`}>\n          <h2>Privacy Policy</h2>\n          <p><strong>Last updated: {new Date().toLocaleDateString()}</strong></p>\n          \n          <p>Playlist Converter does not store your playlists or personal data on our servers. Authentication is used solely to access your Spotify and YouTube accounts for playlist conversion. We do not share or sell your data to third parties.</p>\n          \n          <h3>Third-Party APIs</h3>\n          <ul>\n            <li><strong>Spotify API:</strong> Used to fetch your playlists and tracks for conversion.</li>\n            <li><strong>YouTube API:</strong> Used to create playlists and add tracks to your YouTube account.</li>\n          </ul>\n          \n          <h3>Cookies & Analytics</h3>\n          <p>This app does not use cookies or analytics to track your activity.</p>\n          \n          <h3>Contact</h3>\n          <p>For questions or concerns, contact us at <a href=\"mailto:michmichira@gmail.com\">michmichira@gmail.com</a>.</p>\n        </div>\n      </main>\n      \n      <footer className={`py-10 border-t ${isDark ? \"bg-gray-900 border-gray-800\" : \"bg-gray-50 border-gray-200\"}`}>\n        <div className=\"container mx-auto px-4\">\n          {/* Footer top section with logo and social links */}\n          <div className=\"flex flex-col md:flex-row items-center justify-between mb-8\">\n            <div className=\"flex items-center mb-6 md:mb-0\">\n              <div className=\"w-10 h-10 rounded-lg flex items-center justify-center mr-3\">\n                <SoundSwappLogo width={40} height={40} />\n              </div>\n              <span className=\"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-500 to-blue-400\">\n                Playlist Converter\n              </span>\n            </div>\n            \n            <div className=\"flex space-x-5\">\n              <a \n                href=\"https://github.com\" \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className={`h-10 w-10 rounded-full flex items-center justify-center transition-colors duration-300 ${\n                  isDark \n                    ? \"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white\" \n                    : \"bg-gray-200 text-gray-600 hover:bg-gray-300 hover:text-gray-900\"\n                }`}\n              >\n                <FontAwesomeIcon icon={faGithub} />\n              </a>\n              <a \n                href=\"https://twitter.com\" \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className={`h-10 w-10 rounded-full flex items-center justify-center transition-colors duration-300 ${\n                  isDark \n                    ? \"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white\" \n                    : \"bg-gray-200 text-gray-600 hover:bg-gray-300 hover:text-gray-900\"\n                }`}\n              >\n                <FontAwesomeIcon icon={faTwitter} />\n              </a>\n              <a \n                href={`mailto:michmichira@gmail.com`}\n                className={`h-10 w-10 rounded-full flex items-center justify-center transition-colors duration-300 ${\n                  isDark \n                    ? \"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white\" \n                    : \"bg-gray-200 text-gray-600 hover:bg-gray-300 hover:text-gray-900\"\n                }`}\n              >\n                <FontAwesomeIcon icon={faMusic} />\n              </a>\n            </div>\n          </div>\n          \n          {/* Divider */}\n          <div className={`h-px w-full my-6 ${isDark ? \"bg-gray-800\" : \"bg-gray-200\"}`} />\n          \n          {/* Footer links section */}\n          <div className=\"flex flex-col md:flex-row items-center justify-between\">\n            <div className=\"flex flex-wrap justify-center md:justify-start gap-x-6 gap-y-2 mb-4 md:mb-0\">\n              <Link \n                to=\"/privacy-policy\" \n                className={`text-sm transition-colors duration-200 ${\n                  isDark ? \"text-gray-400 hover:text-white\" : \"text-gray-600 hover:text-gray-900\"\n                }`}\n              >\n                Privacy Policy\n              </Link>\n              <Link \n                to=\"/terms-of-service\" \n                className={`text-sm transition-colors duration-200 ${\n                  isDark ? \"text-gray-400 hover:text-white\" : \"text-gray-600 hover:text-gray-900\"\n                }`}\n              >\n                Terms of Service\n              </Link>\n              <Link \n                to=\"/\" \n                className={`text-sm transition-colors duration-200 ${\n                  isDark ? \"text-gray-400 hover:text-white\" : \"text-gray-600 hover:text-gray-900\"\n                }`}\n              >\n                Home\n              </Link>\n            </div>\n            \n            <p className={`text-sm ${isDark ? \"text-gray-500\" : \"text-gray-600\"}`}>\n              © {new Date().getFullYear()} Playlist Converter. All rights reserved.\n            </p>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n} ","import { Link } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faArrowLeft, faMusic } from '@fortawesome/free-solid-svg-icons';\nimport { faGithub, faTwitter } from '@fortawesome/free-brands-svg-icons';\nimport { useTheme } from '../lib/ThemeContext';\nimport SoundSwappLogo from '../assets/SoundSwappLogo';\n\nexport default function TermsOfService() {\n  const { isDark } = useTheme();\n  \n  return (\n    <div className={isDark ? \"bg-gray-900 text-white min-h-screen\" : \"bg-white text-gray-800 min-h-screen\"}>\n      <header className={`p-4 border-b ${isDark ? \"border-gray-800\" : \"border-gray-200\"}`}>\n        <div className=\"container mx-auto flex items-center\">\n          <Link to=\"/\" className={`flex items-center text-sm font-medium ${isDark ? \"text-gray-300 hover:text-white\" : \"text-gray-600 hover:text-gray-900\"}`}>\n            <FontAwesomeIcon icon={faArrowLeft} className=\"mr-2\" />\n            Back to App\n          </Link>\n          <h1 className=\"text-xl font-bold mx-auto\">Terms of Service</h1>\n        </div>\n      </header>\n      \n      <main className=\"container mx-auto py-8 px-4 max-w-4xl\">\n        <div className={`prose ${isDark ? \"prose-invert\" : \"\"} max-w-none`}>\n          <h2>Terms of Service</h2>\n          <p><strong>Last updated: {new Date().toLocaleDateString()}</strong></p>\n          \n          <h3>Use of Service</h3>\n          <p>By using Playlist Converter, you agree to use the app for personal, non-commercial purposes only. You are responsible for complying with the terms of Spotify and YouTube.</p>\n          \n          <h3>Third-Party APIs</h3>\n          <p>This app uses the Spotify and YouTube APIs. You are responsible for following their terms of use. We are not affiliated with or endorsed by Spotify or YouTube.</p>\n          \n          <h3>No Warranty</h3>\n          <p>Playlist Converter is provided \"as is\" without warranty of any kind. We do not guarantee the accuracy, reliability, or availability of the service.</p>\n          \n          <h3>Contact</h3>\n          <p>For questions or concerns, contact us at <a href=\"mailto:michmichira@gmail.com\">michmichira@gmail.com</a>.</p>\n        </div>\n      </main>\n      \n      <footer className={`py-10 border-t ${isDark ? \"bg-gray-900 border-gray-800\" : \"bg-gray-50 border-gray-200\"}`}>\n        <div className=\"container mx-auto px-4\">\n          {/* Footer top section with logo and social links */}\n          <div className=\"flex flex-col md:flex-row items-center justify-between mb-8\">\n            <div className=\"flex items-center mb-6 md:mb-0\">\n              <div className=\"w-10 h-10 rounded-lg flex items-center justify-center mr-3\">\n                <SoundSwappLogo width={40} height={40} />\n              </div>\n              <span className=\"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-500 to-blue-400\">\n                Playlist Converter\n              </span>\n            </div>\n            \n            <div className=\"flex space-x-5\">\n              <a \n                href=\"https://github.com\" \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className={`h-10 w-10 rounded-full flex items-center justify-center transition-colors duration-300 ${\n                  isDark \n                    ? \"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white\" \n                    : \"bg-gray-200 text-gray-600 hover:bg-gray-300 hover:text-gray-900\"\n                }`}\n              >\n                <FontAwesomeIcon icon={faGithub} />\n              </a>\n              <a \n                href=\"https://twitter.com\" \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className={`h-10 w-10 rounded-full flex items-center justify-center transition-colors duration-300 ${\n                  isDark \n                    ? \"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white\" \n                    : \"bg-gray-200 text-gray-600 hover:bg-gray-300 hover:text-gray-900\"\n                }`}\n              >\n                <FontAwesomeIcon icon={faTwitter} />\n              </a>\n              <a \n                href={`mailto:michmichira@gmail.com`}\n                className={`h-10 w-10 rounded-full flex items-center justify-center transition-colors duration-300 ${\n                  isDark \n                    ? \"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white\" \n                    : \"bg-gray-200 text-gray-600 hover:bg-gray-300 hover:text-gray-900\"\n                }`}\n              >\n                <FontAwesomeIcon icon={faMusic} />\n              </a>\n            </div>\n          </div>\n          \n          {/* Divider */}\n          <div className={`h-px w-full my-6 ${isDark ? \"bg-gray-800\" : \"bg-gray-200\"}`} />\n          \n          {/* Footer links section */}\n          <div className=\"flex flex-col md:flex-row items-center justify-between\">\n            <div className=\"flex flex-wrap justify-center md:justify-start gap-x-6 gap-y-2 mb-4 md:mb-0\">\n              <Link \n                to=\"/privacy-policy\" \n                className={`text-sm transition-colors duration-200 ${\n                  isDark ? \"text-gray-400 hover:text-white\" : \"text-gray-600 hover:text-gray-900\"\n                }`}\n              >\n                Privacy Policy\n              </Link>\n              <Link \n                to=\"/terms-of-service\" \n                className={`text-sm transition-colors duration-200 ${\n                  isDark ? \"text-gray-400 hover:text-white\" : \"text-gray-600 hover:text-gray-900\"\n                }`}\n              >\n                Terms of Service\n              </Link>\n              <Link \n                to=\"/\" \n                className={`text-sm transition-colors duration-200 ${\n                  isDark ? \"text-gray-400 hover:text-white\" : \"text-gray-600 hover:text-gray-900\"\n                }`}\n              >\n                Home\n              </Link>\n            </div>\n            \n            <p className={`text-sm ${isDark ? \"text-gray-500\" : \"text-gray-600\"}`}>\n              © {new Date().getFullYear()} Playlist Converter. All rights reserved.\n            </p>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n} ","import { cn } from './utils';\n\n/**\n * Glassmorphic styling utility to ensure consistent styling across the application\n */\n\nexport interface GlassmorphicStyleProps {\n  isDark?: boolean;\n  blurStrength?: number;\n  borderOpacity?: number;\n  bgOpacity?: number;\n  rounded?: 'sm' | 'md' | 'lg' | 'xl' | '2xl' | 'full';\n  shadow?: 'sm' | 'md' | 'lg' | 'xl' | '2xl' | 'inner' | 'none';\n}\n\n/**\n * Returns consistent glassmorphic styles as a className string\n */\nexport const getGlassmorphicClasses = ({\n  isDark = false,\n  rounded = '2xl',\n  shadow = 'lg',\n}: Pick<GlassmorphicStyleProps, 'isDark' | 'rounded' | 'shadow'>) => {\n  return cn(\n    `rounded-${rounded} overflow-hidden relative backdrop-blur-md`,\n    shadow !== 'none' && shadow !== 'inner' && `shadow-${shadow}`,\n    shadow === 'inner' && 'shadow-inner',\n    isDark \n      ? \"bg-gray-900/40 border border-gray-700/50\" \n      : \"bg-white/70 border border-gray-200\"\n  );\n};\n\n/**\n * Returns inline styles for glassmorphic elements\n */\nexport const getGlassmorphicStyles = ({\n  isDark = false,\n  blurStrength = 10,\n  borderOpacity = 0.2,\n  bgOpacity = 0.2,\n}: Omit<GlassmorphicStyleProps, 'rounded' | 'shadow'>) => {\n  // Determine colors based on theme\n  const bgColor = isDark \n    ? `rgba(17, 24, 39, ${bgOpacity})` \n    : `rgba(255, 255, 255, ${bgOpacity})`;\n  \n  const borderColor = isDark \n    ? `rgba(255, 255, 255, ${borderOpacity})` \n    : `rgba(0, 0, 0, ${borderOpacity})`;\n  \n  return {\n    backdropFilter: `blur(${blurStrength}px)`,\n    WebkitBackdropFilter: `blur(${blurStrength}px)`,\n    backgroundColor: bgColor,\n    borderWidth: '1px',\n    borderStyle: 'solid',\n    borderColor: borderColor,\n    boxShadow: isDark \n      ? '0 8px 32px rgba(0, 0, 0, 0.2)'\n      : '0 8px 32px rgba(0, 0, 0, 0.1)',\n  };\n};\n\n/**\n * Returns hover effect styles for glassmorphic elements\n */\nexport const getGlassmorphicHoverStyles = ({\n  isDark = false,\n  blurStrength = 10,\n  hoverScale = 1.02,\n}: Pick<GlassmorphicStyleProps, 'isDark' | 'blurStrength'> & { hoverScale?: number }) => {\n  return {\n    scale: hoverScale,\n    boxShadow: isDark \n      ? '0 10px 40px rgba(0, 0, 0, 0.3)'\n      : '0 10px 40px rgba(0, 0, 0, 0.15)',\n    backdropFilter: `blur(${blurStrength * 1.5}px)`,\n    WebkitBackdropFilter: `blur(${blurStrength * 1.5}px)`,\n  };\n};\n\n/**\n * Simple glassmorphic component class names\n */\nexport const simpleGlassmorphic = (isDark = false) => cn(\n  \"backdrop-blur-md rounded-2xl overflow-hidden\",\n  isDark \n    ? \"bg-gray-900/40 border border-gray-700/50\" \n    : \"bg-white/70 border border-gray-200\"\n); ","import { AnimatePresence, motion } from 'framer-motion';\nimport React, { useEffect, useState } from 'react';\nimport { getGlassmorphicStyles } from '../../lib/glassmorphic';\nimport { cn } from '../../lib/utils';\nimport GlassmorphicContainer from './GlassmorphicContainer';\nimport SoundSwappLogo from '../../assets/SoundSwappLogo';\n\n// Simulates a loading process with different stages\nconst simulateLoading = (\n  onProgress: (stage: string, percent: number) => void,\n  onComplete: () => void,\n  initialProgress: number = 0\n) => {\n  const stages = [\n    { name: \"Loading your music universe...\", duration: 800 },\n    { name: \"Connecting to platforms\", duration: 600 },\n    { name: \"Preparing converter\", duration: 700 },\n    { name: \"Almost ready\", duration: 500 }\n  ];\n\n  let currentStage = 0;\n  let currentPercent = initialProgress;\n  let interval: NodeJS.Timeout;\n\n  // Determine which stage we're in based on initial progress\n  if (initialProgress > 0) {\n    if (initialProgress < 25) {\n      currentStage = 0;\n    } else if (initialProgress < 50) {\n      currentStage = 1;\n    } else if (initialProgress < 75) {\n      currentStage = 2;\n    } else {\n      currentStage = 3;\n    }\n  }\n\n  const updateProgress = () => {\n    if (currentStage >= stages.length) {\n      clearInterval(interval);\n      onComplete();\n      return;\n    }\n\n    const stage = stages[currentStage];\n\n    if (currentPercent >= 100) {\n      currentStage++;\n      currentPercent = 0;\n\n      if (currentStage < stages.length) {\n        onProgress(stages[currentStage].name, 0);\n      }\n      return;\n    }\n\n    const increment = 100 / (stage.duration / 50); // Update every 50ms\n    currentPercent = Math.min(100, currentPercent + increment);\n\n    onProgress(stage.name, currentPercent);\n  };\n\n  interval = setInterval(updateProgress, 50);\n\n  // Start with the first stage or continue from the current stage based on initialProgress\n  onProgress(stages[currentStage].name, currentPercent);\n\n  // Return cleanup function\n  return () => clearInterval(interval);\n};\n\ninterface PreloaderProps {\n  onComplete?: () => void;\n  initialDelay?: number;\n  showProgressText?: boolean;\n  theme?: 'spotify' | 'youtube' | 'default';\n  customLogo?: React.ReactNode;\n  size?: 'sm' | 'md' | 'lg';\n  initialProgress?: number;\n}\n\nexport const Preloader: React.FC<PreloaderProps> = ({\n  onComplete,\n  initialDelay = 500,\n  showProgressText = true,\n  theme = 'default',\n  customLogo,\n  size = 'md',\n  initialProgress = 0,\n}) => {\n  const [visible, setVisible] = useState(true);\n  const [currentStage, setCurrentStage] = useState(\"Initializing...\");\n  const [loadingProgress, setLoadingProgress] = useState(initialProgress);\n  const [loadingComplete, setLoadingComplete] = useState(false);\n\n  // Safely use theme context with fallback - don't use useTheme hook\n  // Instead, check for system dark mode preference\n  const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;\n\n  useEffect(() => {\n    const initialTimer = setTimeout(() => {\n      const cleanup = simulateLoading(\n        (stage, percent) => {\n          setCurrentStage(stage);\n          setLoadingProgress(percent);\n        },\n        () => {\n          setLoadingComplete(true);\n          setCurrentStage(\"Ready!\");\n          setLoadingProgress(100);\n\n          // Hide the preloader after a delay\n          setTimeout(() => {\n            setVisible(false);\n            if (onComplete) onComplete();\n          }, 800);\n        },\n        initialProgress\n      );\n\n      return cleanup;\n    }, initialDelay);\n\n    return () => clearTimeout(initialTimer);\n  }, [initialDelay, onComplete, initialProgress]);\n\n  // Get theme-specific colors\n  const getThemeColors = () => {\n    switch(theme) {\n      case 'spotify':\n        return {\n          primary: '#1DB954',\n          secondary: '#191414',\n          glow: 'rgba(30, 215, 96, 0.3)',\n          spinnerGradient: 'conic-gradient(from 90deg, #1DB954, #19141400)' // Spotify themed gradient\n        };\n      case 'youtube':\n        return {\n          primary: '#FF0000',\n          secondary: '#282828',\n          glow: 'rgba(255, 0, 0, 0.3)',\n          spinnerGradient: 'conic-gradient(from 90deg, #FF0000, #28282800)' // YouTube themed gradient\n        };\n      default:\n        return {\n          primary: 'var(--brand-primary)', // Use CSS var\n          secondary: 'var(--brand-secondary)', // Use CSS var\n          glow: 'rgba(var(--brand-accent-pink-rgb), 0.4)', // Use CSS var\n          spinnerGradient: 'conic-gradient(from 90deg, var(--brand-primary), var(--brand-accent-pink), var(--brand-secondary), var(--brand-primary-dark))' // SoundSwapp gradient\n        };\n    }\n  };\n\n  const themeColors = getThemeColors();\n  const sizeConfig = getSizeConfig(size);\n\n  // Glassmorphic styles for the preloader container\n  const containerStyles = getGlassmorphicStyles({\n    isDark,\n    blurStrength: 12,\n    bgOpacity: isDark ? 0.25 : 0.7,\n    borderOpacity: 0.15\n  });\n\n  return (\n    <AnimatePresence>\n      {visible && (\n        <motion.div\n          className=\"fixed inset-0 z-50 flex items-center justify-center\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ duration: 0.5 }}\n        >\n          <div\n            className={cn(\n              \"absolute inset-0\",\n              isDark ? 'bg-gray-900/95 backdrop-blur-md' : 'bg-white/95 backdrop-blur-md'\n            )}\n          ></div>\n\n          <div className=\"relative z-10 flex flex-col items-center justify-center p-8\">\n            {/* Logo and loader container */}\n            <motion.div\n              className={cn(\n                \"relative rounded-full overflow-hidden\",\n                sizeConfig.containerSize\n              )}\n              style={containerStyles}\n              initial={{ scale: 0.8, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              transition={{\n                type: \"spring\",\n                stiffness: 260,\n                damping: 20,\n                delay: 0.2\n              }}\n            >\n              <GlassmorphicContainer\n                className=\"w-full h-full rounded-full\"\n                rounded=\"full\"\n                shadow=\"lg\"\n              >\n                {/* Animated spinner */}\n                <motion.div\n                  className={cn(\"absolute inset-0\",\n                    loadingComplete ? \"opacity-0\" : \"opacity-100\"\n                  )}\n                  style={{\n                    borderRadius: \"50%\",\n                    border: `${sizeConfig.spinnerWidth}px solid transparent`,\n                    // Split background shorthand into individual properties\n                    backgroundColor: 'transparent', // Assuming the transparent part of the radial gradient is the base\n                    backgroundImage: `radial-gradient(transparent ${sizeConfig.spinnerWidth*5}px, transparent ${sizeConfig.spinnerWidth*5}px), ${themeColors.spinnerGradient}`,\n                    backgroundRepeat: 'no-repeat, no-repeat', // Adjust as needed for your gradients\n                    backgroundPosition: 'center, center', // Adjust as needed\n                    backgroundSize: 'cover, cover', // Adjust as needed\n                    backgroundClip: 'padding-box, border-box',\n                    backgroundOrigin: 'padding-box, border-box',\n                    WebkitMask: `linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)`,\n                    WebkitMaskComposite: 'destination-out',\n                    maskComposite: 'exclude',\n                  }}\n                  animate={{\n                    rotate: 360,\n                  }}\n                  transition={{\n                    duration: 1.5,\n                    ease: \"linear\",\n                    repeat: Infinity\n                  }}\n                />\n\n                {/* Inner circle with the logo */}\n                <GlassmorphicContainer\n                  className={cn(\n                    \"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center\",\n                    sizeConfig.innerCircleSize\n                  )}\n                  rounded=\"full\"\n                  shadow=\"sm\"\n                >\n                  {/* Logo container - improved positioning */}\n                  <div className=\"flex items-center justify-center w-full h-full\">\n                    {customLogo ? (\n                      customLogo\n                    ) : (\n                        theme === 'youtube' ? (\n                          <div className={cn(\"flex items-center justify-center\", sizeConfig.logoContainerSize)}>\n                            <img\n                              src=\"/images/yt_logo_rgb_dark.png\"\n                              alt=\"YouTube\"\n                              style={{ \n                                height: 32, \n                                minHeight: 20, \n                                maxHeight: 40, \n                                width: 'auto', \n                                objectFit: 'contain', \n                                display: 'block',\n                                minWidth: '32px'\n                              }}\n                            />\n                          </div>\n                        ) : (\n                          <SoundSwappLogo width={parseInt(sizeConfig.logoContainerSize.replace('w-', '').replace('h-', ''))} height={parseInt(sizeConfig.logoContainerSize.replace('w-', '').replace('h-', ''))} />\n                        )\n                    )}\n                  </div>\n                </GlassmorphicContainer>\n              </GlassmorphicContainer>\n            </motion.div>\n\n            {/* Progress indicator */}\n            {showProgressText && (\n              <motion.div\n                className=\"mt-8 max-w-md text-center\"\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.3 }}\n              >\n                <GlassmorphicContainer\n                  className=\"px-6 py-4\"\n                  rounded=\"xl\"\n                  shadow=\"sm\"\n                  animate={false}\n                >\n                  <motion.div\n                    className={cn(\n                      \"font-medium mb-2 text-center\",\n                      isDark ? \"text-white\" : \"text-gray-800\"\n                    )}\n                    animate={{ opacity: loadingComplete ? 0.5 : 1 }}\n                  >\n                    {loadingComplete ? \"Ready!\" : currentStage}\n                  </motion.div>\n\n                  <div className={`relative h-1 mt-5 rounded-full overflow-hidden ${sizeConfig.progressWidth} bg-white/10`}>\n                    <motion.div\n                      className=\"h-full rounded-full\"\n                      style={{ background: themeColors.primary }}\n                      initial={{ width: `${initialProgress}%` }}\n                      animate={{ width: `${loadingProgress}%` }}\n                      transition={{ type: \"tween\" }}\n                    />\n                  </div>\n\n                  {/* Loading percentage */}\n                  <div className=\"flex justify-between mt-2 text-xs text-gray-400\">\n                    <div>{Math.round(loadingProgress)}%</div>\n                    <div>100%</div>\n                  </div>\n\n                  {/* Loading dots animation */}\n                  {!loadingComplete && (\n                    <div className=\"flex justify-center mt-4 space-x-1\">\n                      {[0, 1, 2].map((i) => (\n                        <motion.div\n                          key={i}\n                          className={`h-1.5 w-1.5 rounded-full ${isDark ? 'bg-white/50' : 'bg-gray-500/50'}`}\n                          animate={{\n                            opacity: [0.3, 1, 0.3],\n                            scale: [0.8, 1.2, 0.8],\n                          }}\n                          transition={{\n                            duration: 1.5,\n                            repeat: Infinity,\n                            delay: i * 0.2,\n                          }}\n                        />\n                      ))}\n                    </div>\n                  )}\n                </GlassmorphicContainer>\n              </motion.div>\n            )}\n          </div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n};\n\n// Helper to get size configuration based on size prop\nfunction getSizeConfig(size: string) {\n  switch(size) {\n    case 'sm':\n      return {\n        containerSize: 'w-24 h-24',\n        innerCircleSize: 'w-16 h-16',\n        logoContainerSize: 'w-7 h-7',\n        spinnerWidth: 3,\n        progressWidth: 'w-48'\n      };\n    case 'lg':\n      return {\n        containerSize: 'w-40 h-40',\n        innerCircleSize: 'w-28 h-28',\n        logoContainerSize: 'w-12 h-12',\n        spinnerWidth: 5,\n        progressWidth: 'w-80'\n      };\n    default: // 'md'\n      return {\n        containerSize: 'w-32 h-32',\n        innerCircleSize: 'w-20 h-20',\n        logoContainerSize: 'w-9 h-9',\n        spinnerWidth: 4,\n        progressWidth: 'w-64'\n      };\n  }\n}\n\nexport default Preloader;","import React, { useState } from 'react';\nimport Preloader from './ui/Preloader';\nimport { motion } from 'framer-motion';\nimport { useTheme } from '../lib/ThemeContext';\n\nconst PreloaderDemo: React.FC = () => {\n  const { isDark } = useTheme();\n  const [showFullScreen, setShowFullScreen] = useState(false);\n  const [loadingText, setLoadingText] = useState('Loading...');\n  const [size, setSize] = useState<'sm' | 'md' | 'lg'>('md');\n  const [showProgressText, setShowProgressText] = useState(true);\n  const [theme, setTheme] = useState<'spotify' | 'youtube' | 'default'>('default');\n\n  const customTexts = [\n    'Loading...',\n    'Converting playlist...',\n    'Syncing tracks...',\n    'Almost there...',\n    'Getting your music...'\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col items-center justify-center p-6\">\n      <motion.div\n        className={`max-w-3xl w-full rounded-2xl overflow-hidden relative p-8 ${\n          isDark ? 'bg-gray-800/30' : 'bg-white/70'\n        } backdrop-blur-lg border ${\n          isDark ? 'border-gray-700/50' : 'border-gray-200'\n        } shadow-xl`}\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n      >\n        <h1 className={`text-3xl font-bold mb-6 ${isDark ? 'text-white' : 'text-gray-800'}`}>\n          Preloader Component\n        </h1>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8\">\n          <div className={`rounded-xl p-6 flex flex-col items-center justify-center ${\n            isDark ? 'bg-gray-900/40' : 'bg-gray-50/80'\n          } border ${isDark ? 'border-gray-700/50' : 'border-gray-200/80'}`}>\n            <Preloader \n              size={size} \n              showProgressText={showProgressText}\n              theme={theme}\n            />\n          </div>\n\n          <div className=\"space-y-6\">\n            <div>\n              <h2 className={`text-lg font-medium mb-3 ${isDark ? 'text-white' : 'text-gray-800'}`}>\n                Configuration\n              </h2>\n              \n              <div className=\"space-y-4\">\n                <div>\n                  <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>\n                    Size\n                  </label>\n                  <div className=\"flex space-x-3\">\n                    {[\n                      { value: 'sm', label: 'Small' },\n                      { value: 'md', label: 'Medium' },\n                      { value: 'lg', label: 'Large' }\n                    ].map((sizeOption) => (\n                      <button\n                        key={sizeOption.value}\n                        className={`px-3 py-1.5 rounded-md text-sm transition-colors ${\n                          size === sizeOption.value\n                            ? isDark\n                              ? 'bg-purple-600 text-white'\n                              : 'bg-purple-500 text-white'\n                            : isDark\n                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600'\n                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n                        }`}\n                        onClick={() => setSize(sizeOption.value as 'sm' | 'md' | 'lg')}\n                      >\n                        {sizeOption.label}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n\n                <div>\n                  <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>\n                    Theme\n                  </label>\n                  <div className=\"grid grid-cols-3 gap-2\">\n                    {[\n                      { value: 'default', label: 'Default' },\n                      { value: 'spotify', label: 'Spotify' },\n                      { value: 'youtube', label: 'YouTube' }\n                    ].map((themeOption) => (\n                      <button\n                        key={themeOption.value}\n                        className={`px-3 py-1.5 rounded-md text-sm transition-colors ${\n                          theme === themeOption.value\n                            ? isDark\n                              ? 'bg-purple-600 text-white'\n                              : 'bg-purple-500 text-white'\n                            : isDark\n                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600'\n                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n                        }`}\n                        onClick={() => setTheme(themeOption.value as 'spotify' | 'youtube' | 'default')}\n                      >\n                        {themeOption.label}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n\n                <div className=\"flex items-center\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"showProgressText\"\n                    checked={showProgressText}\n                    onChange={() => setShowProgressText(!showProgressText)}\n                    className=\"h-4 w-4 rounded border-gray-300 text-purple-600 focus:ring-purple-500\"\n                  />\n                  <label\n                    htmlFor=\"showProgressText\"\n                    className={`ml-2 block text-sm ${isDark ? 'text-gray-300' : 'text-gray-700'}`}\n                  >\n                    Show Progress Text\n                  </label>\n                </div>\n              </div>\n            </div>\n\n            <button\n              onClick={() => setShowFullScreen(true)}\n              className={`w-full py-2.5 px-4 rounded-md font-medium transition-colors ${\n                isDark\n                  ? 'bg-purple-600 hover:bg-purple-700 text-white'\n                  : 'bg-purple-500 hover:bg-purple-600 text-white'\n              }`}\n            >\n              Show Fullscreen Preloader\n            </button>\n          </div>\n        </div>\n\n        <div className={`p-4 rounded-lg text-sm ${\n          isDark ? 'bg-gray-900/50 text-gray-300' : 'bg-gray-100 text-gray-700'\n        }`}>\n          <p>\n            This preloader component can be integrated into your application to provide visual feedback during loading processes.\n            Use the fullscreen mode for initial app loading, and the inline versions for component-specific loading states.\n          </p>\n        </div>\n      </motion.div>\n\n      {showFullScreen && (\n        <div className=\"fixed inset-0 z-50\">\n          <Preloader\n            size=\"lg\"\n            showProgressText={showProgressText}\n            theme={theme}\n          />\n        </div>\n      )}\n\n      {showFullScreen && (\n        <div className=\"fixed bottom-6 right-6 z-[60]\">\n          <button\n            onClick={() => setShowFullScreen(false)}\n            className=\"px-4 py-2 bg-white text-gray-800 rounded-md shadow-lg font-medium\"\n          >\n            Close Fullscreen Preview\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default PreloaderDemo; ","import React, { useState, useEffect } from 'react';\nimport { useAuth } from '../lib/AuthContext';\nimport Preloader from './ui/Preloader';\nimport usePageLifecycle from '../hooks/usePageLifecycle';\n\n// Add import for mobile utilities\nimport { isMobileDevice } from '../lib/utils';\n\n// Declare global window interface\ndeclare global {\n  interface Window {\n    APP_INITIALIZED?: boolean;\n    HTML_PRELOADER_PROGRESS?: number;\n  }\n}\n\ninterface AppInitializerProps {\n  children: React.ReactNode;\n}\n\n// Get the progress value from HTML preloader if available\nconst getInitialProgress = (): number => {\n  if (typeof window !== 'undefined' && (window as any).HTML_PRELOADER_PROGRESS) {\n    return (window as any).HTML_PRELOADER_PROGRESS;\n  }\n  return 60; // Default value if not available\n};\n\nconst AppInitializer: React.FC<AppInitializerProps> = ({ children }) => {\n  const { loading: authLoading } = useAuth();\n  const [initialLoadComplete, setInitialLoadComplete] = useState(false);\n  const { isLoading, isRefreshing } = usePageLifecycle();\n  const [progress, setProgress] = useState(getInitialProgress());\n  // Add mobile detection state and handling\n  const [isMobile, setIsMobile] = useState(false);\n  const [mobileOptimized, setMobileOptimized] = useState(false);\n  \n  // Initialize mobile detection (debug only, no optimization)\n  useEffect(() => {\n    const mobile = isMobileDevice() || window.innerWidth < 768;\n    setIsMobile(mobile);\n    console.log('[AppInitializer] Mobile detected:', mobile);\n    // Disabled optimizeForMobile for debugging\n  }, []);\n  \n  // Fallback: Dispatch app-initialized event after a reasonable timeout\n  // This ensures the HTML preloader doesn't timeout even if React takes too long\n  useEffect(() => {\n    const fallbackTimeout = setTimeout(() => {\n      if (!window.APP_INITIALIZED) {\n        console.log('[AppInitializer] Fallback timeout - dispatching app-initialized event');\n        window.dispatchEvent(new CustomEvent('app-initialized', {\n          detail: { progress: 100 }\n        }));\n        window.APP_INITIALIZED = true;\n      }\n    }, 5000); // 5 second fallback timeout\n    return () => clearTimeout(fallbackTimeout);\n  }, []);\n  \n  // Simulate loading progress for better UX\n  useEffect(() => {\n    if (isLoading || authLoading) {\n      let progressInterval: NodeJS.Timeout;\n      \n      // Continue progress from where HTML preloader left off\n      \n      // Define custom timing points for a realistic loading feeling\n      const simulateProgress = () => {\n        progressInterval = setInterval(() => {\n          setProgress(prev => {\n            // Move slower as we approach 100% to give time for auth and data loading\n            if (prev < 85) return prev + 0.7;\n            if (prev < 95) return prev + 0.3;\n            \n            // Hold at 95% if still loading (waiting for actual completion)\n            // This prevents the progress from reaching 100% before the app is ready\n            if (isLoading || authLoading) return 95;\n            \n            // Complete to 100% and clear interval\n            clearInterval(progressInterval);\n            return 100;\n          });\n        }, 50);\n      };\n      \n      simulateProgress();\n      \n      return () => {\n        if (progressInterval) clearInterval(progressInterval);\n      };\n    } else if (progress < 100) {\n      // When loading is complete but progress isn't at 100%, \n      // quickly complete the progress bar\n      const completeProgress = setTimeout(() => {\n        setProgress(100);\n      }, 100);\n      \n      return () => clearTimeout(completeProgress);\n    }\n  }, [isLoading, authLoading, progress]);\n  \n  // Complete initialization after progress reaches 100%\n  useEffect(() => {\n    if (progress >= 100 && !initialLoadComplete) {\n      const completeTimer = setTimeout(() => {\n        setInitialLoadComplete(true);\n        \n        // Dispatch app-initialized event for HTML preloader\n        window.dispatchEvent(new CustomEvent('app-initialized', {\n          detail: { progress: 100 }\n        }));\n        console.log('App initialization complete - dispatched app-initialized event');\n        \n        // Set global flag to indicate app is initialized\n        window.APP_INITIALIZED = true;\n      }, 500); // Small delay after reaching 100% for smooth transition\n      \n      return () => clearTimeout(completeTimer);\n    }\n  }, [progress, initialLoadComplete]);\n\n  // Add mobile-specific safety timeout\n  useEffect(() => {\n    // Safety timeout for mobile - ensure we don't get stuck in loading state\n    if (isMobile) {\n      const safetyTimeout = setTimeout(() => {\n        if (!initialLoadComplete) {\n          console.warn('[AppInitializer] Mobile safety timeout triggered - forcing app to load');\n          setProgress(100);\n          setInitialLoadComplete(true);\n          // Dispatch app-initialized event even on safety timeout\n          window.dispatchEvent(new CustomEvent('app-initialized', {\n            detail: { progress: 100 }\n          }));\n          console.log('[AppInitializer] Mobile safety timeout - dispatched app-initialized event');\n          window.APP_INITIALIZED = true;\n        }\n      }, 10000); // 10 second safety timeout for mobile devices\n      return () => clearTimeout(safetyTimeout);\n    }\n  }, [isMobile, initialLoadComplete]);\n  \n  // Set custom loading messages based on state\n    /* Unused function  const getLoadingMessage = () => {    if (authLoading) return \"Authenticating...\";    if (isRefreshing) return \"Refreshing your music universe...\";    if (progress < 75) return \"Connecting to your music...\";    if (progress < 90) return \"Preparing your experience...\";    return \"Almost ready...\";  };*/\n  \n  // Show preloader if app is still initializing, refreshing, or auth is loading\n  if (!initialLoadComplete || isLoading || authLoading) {\n    console.log('[AppInitializer] Showing Preloader', { initialLoadComplete, isLoading, authLoading, progress });\n    return (\n      <Preloader \n        onComplete={() => {\n          setInitialLoadComplete(true);\n          console.log('[AppInitializer] Preloader onComplete called');\n        }}\n        theme={authLoading ? \"spotify\" : \"default\"}\n        showProgressText={true}\n        size=\"lg\"\n        initialProgress={progress}\n      />\n    );\n  }\n  \n  console.log('[AppInitializer] Rendering children');\n  return <>{children}</>;\n};\n\nexport default AppInitializer; ","import { useState, useEffect } from 'react';\n\ninterface PageLifecycleState {\n  isLoading: boolean;\n  isRefreshing: boolean;\n  isNavigating: boolean;\n  previousUrl: string | null;\n}\n\n/**\n * A custom hook that tracks page lifecycle events\n * This helps determine when a page is refreshing vs initial load\n */\nexport function usePageLifecycle(): PageLifecycleState {\n  const [state, setState] = useState<PageLifecycleState>({\n    isLoading: true,\n    isRefreshing: false,\n    isNavigating: false,\n    previousUrl: null\n  });\n\n  useEffect(() => {\n    let pageLoadTimestamp = Date.now();\n    const storageKey = 'playlist_converter_page_state';\n    \n    // Check if this is a refresh or initial load\n    const checkForRefresh = () => {\n      try {\n        // Try to get previous navigation state from sessionStorage\n        const savedState = sessionStorage.getItem(storageKey);\n        \n        if (savedState) {\n          const parsedState = JSON.parse(savedState);\n          const currentUrl = window.location.href;\n          const isRefresh = parsedState.lastUrl === currentUrl;\n          \n          setState({\n            isLoading: true,\n            isRefreshing: isRefresh,\n            isNavigating: !isRefresh,\n            previousUrl: parsedState.lastUrl\n          });\n        }\n      } catch (e) {\n        console.error('Error reading page state:', e);\n      }\n    };\n    \n    // Save current state for future checks\n    const saveCurrentState = () => {\n      try {\n        const stateToSave = {\n          lastUrl: window.location.href,\n          timestamp: Date.now()\n        };\n        sessionStorage.setItem(storageKey, JSON.stringify(stateToSave));\n      } catch (e) {\n        console.error('Error saving page state:', e);\n      }\n    };\n    \n    // Complete loading after a reasonable delay\n    const finishLoading = () => {\n      // Ensure the preloader shows for at least 1 second for better UX\n      const timeElapsed = Date.now() - pageLoadTimestamp;\n      const minLoadingTime = 1000; // 1 second minimum\n      \n      const delay = timeElapsed < minLoadingTime \n        ? minLoadingTime - timeElapsed \n        : 0;\n      \n      setTimeout(() => {\n        setState(prev => ({\n          ...prev,\n          isLoading: false,\n          isRefreshing: false,\n          isNavigating: false\n        }));\n      }, delay);\n    };\n    \n    // Check if this is a refresh\n    checkForRefresh();\n    \n    // Run when page is fully loaded\n    if (document.readyState === 'complete') {\n      finishLoading();\n    } else {\n      window.addEventListener('load', finishLoading);\n    }\n    \n    // Handle browser refresh\n    window.addEventListener('beforeunload', saveCurrentState);\n    \n    return () => {\n      window.removeEventListener('load', finishLoading);\n      window.removeEventListener('beforeunload', saveCurrentState);\n    };\n  }, []); // Empty dependency array to run only once on mount\n\n  return state;\n}\n\nexport default usePageLifecycle; ","import { useEffect, useState } from 'react';\nimport TokenManager from '../lib/tokenManager';\nimport { useAuth } from '../lib/AuthContext';\n\ninterface TokenManagerInitializerProps {\n  children: React.ReactNode;\n}\n\nconst TokenManagerInitializer: React.FC<TokenManagerInitializerProps> = ({ children }) => {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [initializationError, setInitializationError] = useState<string | null>(null);\n  const { user } = useAuth();\n\n  useEffect(() => {\n    const initializeTokenManager = async () => {\n      try {\n        console.log('[TokenManagerInitializer] Starting token manager initialization');\n        \n        // Initialize monitoring for all services\n        await TokenManager.initializeMonitoring();\n        \n        console.log('[TokenManagerInitializer] Token manager initialized successfully');\n        setIsInitialized(true);\n        setInitializationError(null);\n      } catch (error) {\n        console.error('[TokenManagerInitializer] Failed to initialize token manager:', error);\n        setInitializationError(error instanceof Error ? error.message : 'Failed to initialize token manager');\n        // Still set as initialized to not block the app\n        setIsInitialized(true);\n      }\n    };\n\n    // Only initialize when user is authenticated\n    if (user) {\n      initializeTokenManager();\n    } else {\n      // Reset state when user logs out\n      setIsInitialized(false);\n      setInitializationError(null);\n    }\n  }, [user]);\n\n  // Always render children, don't show loading screen\n  // The token manager will initialize in the background\n  return <>{children}</>;\n};\n\nexport default TokenManagerInitializer; ","import React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, Copy, Check } from 'lucide-react';\n\ninterface ShareModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  url?: string;\n  title?: string;\n  description?: string;\n}\n\nexport const ShareModal: React.FC<ShareModalProps> = ({ \n  isOpen, \n  onClose, \n  url = window.location.href, \n  title = 'Share',\n  description = 'Check out this playlist conversion!'\n}) => {\n  const [copied, setCopied] = useState(false);\n  const [canShare, setCanShare] = useState(false);\n  const shareUrl = url || window.location.href;\n\n  useEffect(() => {\n    // Check if Web Share API is supported\n    setCanShare(typeof navigator !== 'undefined' && 'share' in navigator);\n  }, []);\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy:', err);\n    }\n  };\n\n  const handleShare = async () => {\n    if (canShare) {\n      try {\n        await navigator.share({\n          title: title || 'SoundSwapp',\n          text: description,\n          url: shareUrl\n        });\n      } catch (err) {\n        if (err instanceof Error && err.name !== 'AbortError') {\n          console.error('Error sharing:', err);\n        }\n      }\n    } else {\n      handleCopy();\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50\"\n            onClick={onClose}\n          />\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md z-50\"\n          >\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 m-4\">\n              <div className=\"flex justify-between items-center mb-4\">\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                  {title}\n                </h3>\n                <button\n                  onClick={onClose}\n                  className=\"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors\"\n                >\n                  <X size={20} />\n                </button>\n              </div>\n              \n              <div className=\"flex items-center gap-2 mb-4\">\n                <input\n                  type=\"text\"\n                  value={shareUrl}\n                  readOnly\n                  className=\"flex-1 p-2 text-sm border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white\"\n                />\n                <button\n                  onClick={handleCopy}\n                  className=\"p-2 text-white bg-brand-primary hover:bg-brand-primaryHover rounded-lg transition-colors\"\n                  title=\"Copy to clipboard\"\n                >\n                  {copied ? <Check size={20} /> : <Copy size={20} />}\n                </button>\n              </div>\n\n              {description && (\n                <p className=\"text-sm text-gray-600 dark:text-gray-300 mb-4\">\n                  {description}\n                </p>\n              )}\n\n              <button\n                onClick={handleShare}\n                className=\"w-full py-2 px-4 bg-brand-primary hover:bg-brand-primaryHover text-white rounded-lg transition-colors\"\n              >\n                {canShare ? 'Share' : 'Copy Link'}\n              </button>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}; ","import type { PlaylistTypes } from '../types/playlist';\r\n\r\ninterface ConversionTrack {\r\n  name: string;\r\n  artists: string[];\r\n  popularity?: number;\r\n  duration_ms?: number;\r\n  explicit?: boolean;\r\n  album?: string;\r\n  releaseYear?: string | number;\r\n  genres?: string[];\r\n  artistImages?: string[];\r\n}\r\n\r\nconst convertTrack = (track: ConversionTrack): PlaylistTypes.Track => ({\r\n  name: track.name,\r\n  artists: track.artists,\r\n  popularity: track.popularity || 0,\r\n  duration_ms: track.duration_ms || 0,\r\n  explicit: track.explicit || false,\r\n  album: track.album || 'Unknown Album',\r\n  releaseYear: track.releaseYear,\r\n  genres: track.genres || [],\r\n  artistImages: track.artistImages || []\r\n});\r\n\r\nconst generateGenreColor = (genre: string): string => {\r\n  const colors = [\r\n    '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',\r\n    '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9',\r\n    '#F8C471', '#82E0AA', '#F1948A', '#85C1E9', '#D7BDE2'\r\n  ];\r\n  const hash = genre.split('').reduce((a, b) => {\r\n    a = ((a << 5) - a) + b.charCodeAt(0);\r\n    return a & a;\r\n  }, 0);\r\n  return colors[Math.abs(hash) % colors.length];\r\n};\r\n\r\n// Function to get playlist insights from the tracks data\r\nexport const generatePlaylistInsights = (tracks: ConversionTrack[]): PlaylistTypes.PlaylistStats => {\r\n  const artistCounts: Record<string, number> = {};\r\n  const artistImages: Record<string, string> = {};\r\n  const genreCounts: Record<string, number> = {};\r\n  const yearCounts: Record<string, number> = {};\r\n  const albumCounts: Record<string, number> = {};\r\n  const genres = new Set<string>();\r\n  let totalTracks = tracks.length;\r\n  let explicitCount = 0;\r\n  let nonExplicitCount = 0;\r\n  let validPopularityCount = 0;\r\n  let totalPopularity = 0;\r\n  let totalDuration = 0;\r\n  let longestTrackDuration = 0;\r\n  let shortestTrackDuration = Infinity;\r\n  let longestTrack: ConversionTrack | null = null;\r\n  let shortestTrack: ConversionTrack | null = null;\r\n  let mostPopularTrack: ConversionTrack | null = null;\r\n  let leastPopularTrack: ConversionTrack | null = null;\r\n  let highestPopularity = 0;\r\n  let lowestPopularity = 100;\r\n  let oldestYear = '9999';\r\n  let newestYear = '0';\r\n  let oldestTrack: ConversionTrack | null = null;\r\n  let newestTrack: ConversionTrack | null = null;\r\n  \r\n  // Duration categories\r\n  const durationCategories = {\r\n    short: 0, // < 3 min\r\n    medium: 0, // 3-5 min\r\n    long: 0, // > 5 min\r\n  };\r\n  \r\n  // Popularity ranges\r\n  const popularityRanges = {\r\n    low: 0, // 0-33\r\n    medium: 0, // 34-66\r\n    high: 0, // 67-100\r\n  };\r\n  \r\n  // Process each track\r\n  tracks.forEach(track => {\r\n    // Process artists\r\n    track.artists.forEach((artist, index) => {\r\n      artistCounts[artist] = (artistCounts[artist] || 0) + 1;\r\n      if (track.artistImages?.[index] && !artistImages[artist]) {\r\n        artistImages[artist] = track.artistImages[index];\r\n      }\r\n    });\r\n    \r\n    // Process genres\r\n    if (track.genres) {\r\n      track.genres.forEach(genre => {\r\n        genres.add(genre);\r\n        genreCounts[genre] = (genreCounts[genre] || 0) + 1;\r\n      });\r\n    }\r\n    \r\n    // Process duration\r\n    if (track.duration_ms) {\r\n      totalDuration += track.duration_ms;\r\n      const durationMinutes = track.duration_ms / 1000 / 60;\r\n      if (durationMinutes < 3) durationCategories.short++;\r\n      else if (durationMinutes <= 5) durationCategories.medium++;\r\n      else durationCategories.long++;\r\n      \r\n      if (track.duration_ms > longestTrackDuration) {\r\n        longestTrackDuration = track.duration_ms;\r\n        longestTrack = track;\r\n      }\r\n      if (track.duration_ms < shortestTrackDuration) {\r\n        shortestTrackDuration = track.duration_ms;\r\n        shortestTrack = track;\r\n      }\r\n    }\r\n    \r\n    // Process popularity\r\n    if (track.popularity !== undefined) {\r\n      totalPopularity += track.popularity;\r\n      validPopularityCount++;\r\n      if (track.popularity <= 33) popularityRanges.low++;\r\n      else if (track.popularity <= 66) popularityRanges.medium++;\r\n      else popularityRanges.high++;\r\n      \r\n      if (track.popularity > highestPopularity) {\r\n        highestPopularity = track.popularity;\r\n        mostPopularTrack = track;\r\n      }\r\n      if (track.popularity < lowestPopularity) {\r\n        lowestPopularity = track.popularity;\r\n        leastPopularTrack = track;\r\n      }\r\n    }\r\n    \r\n    // Process release year\r\n    if (track.releaseYear) {\r\n      const year = track.releaseYear.toString();\r\n      yearCounts[year] = (yearCounts[year] || 0) + 1;\r\n      if (year < oldestYear) {\r\n        oldestYear = year;\r\n        oldestTrack = track;\r\n      }\r\n      if (year > newestYear) {\r\n        newestYear = year;\r\n        newestTrack = track;\r\n      }\r\n    }\r\n    \r\n    // Process explicit content\r\n    if (track.explicit) explicitCount++;\r\n    else nonExplicitCount++;\r\n    \r\n    // Process albums\r\n    if (track.album) {\r\n      albumCounts[track.album] = (albumCounts[track.album] || 0) + 1;\r\n    }\r\n  });\r\n  \r\n  // Calculate genre percentages\r\n  const genrePercentages: Record<string, number> = {};\r\n  const totalGenreMentions = Object.values(genreCounts).reduce((a, b) => a + b, 0);\r\n  Object.entries(genreCounts).forEach(([genre, count]) => {\r\n    genrePercentages[genre] = (count / totalGenreMentions) * 100;\r\n  });\r\n  \r\n  // Calculate yearly trends\r\n  const yearlyTrends = Object.entries(yearCounts)\r\n    .map(([year, count]) => ({\r\n      year,\r\n      count,\r\n      avgPopularity: tracks\r\n        .filter(t => t.releaseYear?.toString() === year && t.popularity !== undefined)\r\n        .reduce((acc, t) => acc + (t.popularity || 0), 0) / count\r\n    }))\r\n    .sort((a, b) => a.year.localeCompare(b.year));\r\n  \r\n  // Calculate decade distribution\r\n  const decadeDistribution: Record<string, number> = {};\r\n  Object.entries(yearCounts).forEach(([year, count]) => {\r\n    const decade = year.slice(0, 3) + '0';\r\n    decadeDistribution[decade] = (decadeDistribution[decade] || 0) + count;\r\n  });\r\n  \r\n  // Convert genres to array with colors\r\n  const genreArray = Array.from(genres).map(name => ({\r\n    name,\r\n    count: genreCounts[name],\r\n    color: generateGenreColor(name),\r\n    percentage: genrePercentages[name]\r\n  })).sort((a, b) => b.count - a.count);\r\n  \r\n  // Convert artists to array with images\r\n  const artistArray = Object.entries(artistCounts)\r\n    .map(([name, count]) => ({\r\n      name,\r\n      count,\r\n      image: artistImages[name],\r\n      popularity: tracks.find(t => t.artists.includes(name))?.popularity\r\n    }))\r\n    .sort((a, b) => b.count - a.count)\r\n    .slice(0, 10); // Top 10 artists\r\n  \r\n  // Convert albums to array\r\n  const albumArray = Object.entries(albumCounts)\r\n    .map(([name, trackCount]) => {\r\n      const track = tracks.find(t => t.album === name);\r\n      const year = track?.releaseYear ? Number(track.releaseYear) : undefined;\r\n      return { \r\n        name, \r\n        trackCount,\r\n        year: !isNaN(year as number) ? year : undefined\r\n      };\r\n    })\r\n    .sort((a, b) => b.trackCount - a.trackCount)\r\n    .slice(0, 5); // Top 5 albums\r\n  \r\n  return {\r\n    totalTracks,\r\n    avgPopularity: validPopularityCount ? totalPopularity / validPopularityCount : 0,\r\n    totalDuration: Math.round(totalDuration / 60000), // Convert to minutes\r\n    genres: genreArray,\r\n    topArtists: artistArray,\r\n    releaseYears: yearCounts,\r\n    totalGenreMentions,\r\n    mostPopularTrack: mostPopularTrack ? convertTrack(mostPopularTrack) : undefined,\r\n    leastPopularTrack: leastPopularTrack ? convertTrack(leastPopularTrack) : undefined,\r\n    longestTrack: longestTrack ? convertTrack(longestTrack) : undefined,\r\n    shortestTrack: shortestTrack ? convertTrack(shortestTrack) : undefined,\r\n    explicitCount,\r\n    nonExplicitCount,\r\n    topAlbums: albumArray,\r\n    avgTrackLength: totalDuration / totalTracks,\r\n    oldestTrack: oldestTrack ? convertTrack(oldestTrack) : undefined,\r\n    newestTrack: newestTrack ? convertTrack(newestTrack) : undefined,\r\n    explicitPercentage: (explicitCount / totalTracks) * 100,\r\n    uniqueArtists: Object.keys(artistCounts).length,\r\n    uniqueAlbums: Object.keys(albumCounts).length,\r\n    decadeDistribution,\r\n    // New fields\r\n    genrePercentages,\r\n    yearlyTrends,\r\n    durationCategories,\r\n    popularityRanges,\r\n  };\r\n}; ","import React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../lib/AuthContext';\nimport { useConversion } from '../lib/ConversionContext';\nimport { PlaylistInsights, MobilePlaylistInsights } from './visualization/PlaylistInsights';\nimport { GlassmorphicContainer } from './ui/GlassmorphicContainer';\nimport { motion } from 'framer-motion';\nimport { doc, getDoc, type Firestore } from 'firebase/firestore';\nimport { db, waitForFirestore, handleFirestoreError, saveUserInsights, getUserInsights } from '../lib/firebase';\nimport { ChevronLeft } from 'lucide-react';\nimport { generatePlaylistInsights } from '../lib/playlistInsights';\nimport type { PlaylistTypes } from '../types/playlist';\nimport { SpotifyService } from '../lib/spotifyApi';\nimport { Preloader } from './ui/Preloader';\nimport useMobileDetection from '../hooks/useMobileDetection';\n\n// Type assertion for Firestore db\nconst firestore = db as Firestore;\n\ninterface ConversionData {\n  id: string;\n  spotifyPlaylistId: string;\n  spotifyPlaylistName: string;\n  tracks: PlaylistTypes.Track[];\n  convertedAt: Date;\n}\n\nconst convertTrackData = (track: any): PlaylistTypes.Track => {\n  // Validate track object exists\n  if (!track) {\n    console.warn('Debug - Received null or undefined track');\n    return {\n      name: 'Unknown Track',\n      artists: ['Unknown Artist'],\n      popularity: 0,\n      duration_ms: 0,\n      explicit: false,\n      album: 'Unknown Album',\n      releaseYear: undefined,\n      genres: [],\n      artistImages: []\n    };\n  }\n\n  // Log track data before conversion\n  console.log('Debug - Converting track data:', track);\n\n  // Convert and validate each field with detailed logging\n  const convertedTrack = {\n    name: typeof track.name === 'string' ? track.name : 'Unknown Track',\n    artists: Array.isArray(track.artists) ? track.artists.filter(Boolean) : [typeof track.artists === 'string' ? track.artists : 'Unknown Artist'],\n    popularity: typeof track.popularity === 'number' && !isNaN(track.popularity) ? track.popularity : 0,\n    duration_ms: typeof track.duration_ms === 'number' && !isNaN(track.duration_ms) ? track.duration_ms : 0,\n    explicit: typeof track.explicit === 'boolean' ? track.explicit : false,\n    album: typeof track.album === 'string' ? track.album : 'Unknown Album',\n    releaseYear: track.releaseYear ? Number(track.releaseYear) : undefined,\n    genres: Array.isArray(track.genres) ? track.genres.filter(Boolean) : [],\n    artistImages: Array.isArray(track.artistImages) ? track.artistImages.filter(Boolean) : []\n  };\n\n  // Log converted track data\n  console.log('Debug - Converted track data:', convertedTrack);\n\n  return convertedTrack;\n};\n\nexport const ConversionInsights: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const { state: conversionState, dispatch } = useConversion();\n  const [conversionData, setConversionData] = useState<ConversionData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [playlistStats, setPlaylistStats] = useState<PlaylistTypes.PlaylistStats | null>(null);\n  const { isMobile } = useMobileDetection();\n\n  useEffect(() => {\n    const loadConversion = async () => {\n      if (!id) return;\n      \n      setLoading(true);\n      setError(null);\n      \n      try {\n        // Try to initialize Firebase, but don't fail if it doesn't work\n        let db = null;\n        try {\n          db = await waitForFirestore();\n        } catch (firebaseError) {\n          console.warn('Firebase initialization failed, continuing with local data:', firebaseError);\n        }\n        \n        // First try to get conversion from local storage as fallback\n        const localHistory = localStorage.getItem(`conversion_history_${user?.uid}`);\n        let localConversion = null;\n        \n        if (localHistory) {\n          try {\n            const history = JSON.parse(localHistory);\n            localConversion = history.find((conv: any) => conv.id === id);\n          } catch (parseError) {\n            console.warn('Failed to parse local history:', parseError);\n          }\n        }\n        \n        // Try to get conversion data from Firestore (only if Firebase is available)\n        let conversionData = null;\n        let firestoreError = null;\n        \n        if (user && db) {\n          try {\n            // Use correct path: users/{userId}/conversions/{conversionId}\n            const conversionRef = doc(db, 'users', user.uid, 'conversions', id);\n            const conversionDoc = await getDoc(conversionRef);\n            \n            if (conversionDoc.exists()) {\n              conversionData = conversionDoc.data();\n            }\n          } catch (err) {\n            console.warn('Firestore fetch failed, using local data:', err);\n            firestoreError = err;\n          }\n        }\n        \n        // If Firestore failed, use local conversion data\n        if (!conversionData && localConversion) {\n          console.log('Using local conversion data as fallback');\n          conversionData = localConversion;\n        }\n        \n        // If still no data, try to get from conversion state\n        if (!conversionData) {\n          const stateConversion = conversionState.conversionHistory.find(conv => conv.id === id);\n          if (stateConversion) {\n            console.log('Using conversion state data');\n            conversionData = stateConversion;\n          }\n        }\n        \n        if (!conversionData) {\n          throw new Error('Conversion not found. It may have been deleted or you may not have permission to access it.');\n        }\n        \n        // Process the conversion data\n        const processedData = {\n          id: conversionData.id,\n          spotifyPlaylistId: conversionData.spotifyPlaylistId || conversionData.youtubePlaylistId,\n          spotifyPlaylistName: conversionData.spotifyPlaylistName || conversionData.youtubePlaylistName || 'Unknown Playlist',\n          tracks: (conversionData.tracks || []).map(convertTrackData),\n          convertedAt: (() => {\n            // Handle different date formats from Firestore and local storage\n            const dateValue = conversionData.convertedAt;\n            \n            if (!dateValue) {\n              return new Date(); // Fallback to current date\n            }\n            \n            // If it's a Firestore Timestamp object\n            if (dateValue && typeof dateValue === 'object' && dateValue.toDate) {\n              return dateValue.toDate();\n            }\n            \n            // If it's already a Date object\n            if (dateValue instanceof Date) {\n              return dateValue;\n            }\n            \n            // If it's a timestamp number or string\n            const parsedDate = new Date(dateValue);\n            if (isNaN(parsedDate.getTime())) {\n              console.warn('Invalid date value:', dateValue, 'using current date as fallback');\n              return new Date();\n            }\n            \n            return parsedDate;\n          })()\n        };\n        \n        setConversionData(processedData);\n        \n        // Update conversion state\n        dispatch({ type: 'SET_TRACKS', payload: processedData.tracks });\n        \n      } catch (err: any) {\n        console.error('Error loading conversion:', err);\n        let errorMessage = 'Unable to load conversion data. Please try again.';\n        \n        if (err.message.includes('not found')) {\n          errorMessage = 'Conversion not found. It may have been deleted or you may not have permission to access it.';\n        } else if (err.message.includes('permission')) {\n          errorMessage = 'You do not have permission to access this conversion.';\n        } else if (err.message.includes('network') || err.message.includes('connection')) {\n          errorMessage = 'Network error. Please check your connection and try again.';\n        } else if (err.message.includes('Firebase')) {\n          errorMessage = 'Database connection issue. The app will work with local data only.';\n        } else if (err.message) {\n          errorMessage = err.message;\n        }\n        \n        setError(errorMessage);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadConversion();\n  }, [id, dispatch, user]);\n\n  useEffect(() => {\n    const loadOrSaveInsights = async () => {\n      if (!user || !conversionData) return;\n      try {\n        // Try to load existing insights from Firebase\n        let existing = null;\n        try {\n          existing = await getUserInsights(user.uid);\n        } catch (firebaseError) {\n          console.warn('Failed to load insights from Firebase, generating locally:', firebaseError);\n        }\n        \n        if (existing && existing[conversionData.spotifyPlaylistId]) {\n          setPlaylistStats(existing[conversionData.spotifyPlaylistId]);\n        } else {\n          // Generate and save new insights\n          const stats = generatePlaylistInsights(conversionData.tracks);\n          setPlaylistStats(stats);\n          \n          // Try to save insights, but don't fail if it doesn't work\n          try {\n            await saveUserInsights(user.uid, {\n              ...(existing || {}),\n              [conversionData.spotifyPlaylistId]: stats\n            });\n          } catch (saveError) {\n            console.warn('Failed to save insights to Firebase, but continuing with local data:', saveError);\n          }\n        }\n      } catch (err) {\n        console.warn('Failed to load insights, generating locally:', err);\n        // fallback: generate locally if error\n        setPlaylistStats(generatePlaylistInsights(conversionData.tracks));\n      }\n    };\n    if (conversionData) loadOrSaveInsights();\n  }, [user, conversionData]);\n\n  // Add debug logging for conversion data and stats\n  useEffect(() => {\n    if (conversionData) {\n      console.log('Debug - Processed conversion data:', {\n        name: conversionData.spotifyPlaylistName,\n        trackCount: conversionData.tracks.length,\n        sampleTrack: conversionData.tracks[0]\n      });\n    }\n  }, [conversionData]);\n\n  if (loading) {\n    return (\n      <Preloader\n        showProgressText={true}\n        theme=\"default\"\n        size=\"lg\"\n        initialDelay={0}\n        onComplete={() => {\n          // This will be called when preloader finishes, but we'll handle the actual loading in the useEffect\n        }}\n      />\n    );\n  }\n\n  if (error || !conversionData) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h2 className=\"text-xl font-semibold text-red-600 mb-4\">{error || 'No data available'}</h2>\n          <button\n            onClick={() => navigate('/')}\n            className=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-900 dark:text-white bg-gray-200 hover:bg-gray-300 dark:bg-brand-primary dark:hover:bg-brand-primaryHover border border-gray-300 dark:border-transparent rounded-md shadow-sm transition-colors\"\n          >\n            <ChevronLeft size={16} />\n            Back to Converter\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Add debug logging\n  console.log('Conversion data:', {\n    name: conversionData.spotifyPlaylistName,\n    trackCount: conversionData.tracks.length,\n    sampleTrack: conversionData.tracks[0]\n  });\n\n  // Use playlistStats if available, else fallback\n  const statsToShow = playlistStats || generatePlaylistInsights(conversionData.tracks);\n  \n  // Add debug logging\n  console.log('Generated playlist stats:', statsToShow);\n\n  return (\n    <div className=\"min-h-screen bg-white dark:bg-gray-900 py-12 px-4\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"mb-8 flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-content-primary mb-2\">\n              {conversionData.spotifyPlaylistName}\n            </h1>\n            <p className=\"text-sm text-content-secondary\">\n              Converted on {(() => {\n                const date = conversionData.convertedAt;\n                if (!date || isNaN(date.getTime())) {\n                  return 'Recently';\n                }\n                return date.toLocaleDateString();\n              })()}\n            </p>\n          </div>\n          <button\n            onClick={() => navigate('/')}\n            className=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-900 dark:text-white bg-gray-200 hover:bg-gray-300 dark:bg-brand-primary dark:hover:bg-brand-primaryHover border border-gray-300 dark:border-transparent rounded-md shadow-sm transition-colors\"\n          >\n            <ChevronLeft size={16} />\n            Back to Converter\n          </button>\n        </div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5 }}\n        >\n          {isMobile ? (\n            <MobilePlaylistInsights\n              stats={statsToShow}\n              tracks={conversionData.tracks}\n            />\n          ) : (\n            <GlassmorphicContainer\n              className=\"p-4 sm:p-6\"\n              shadow=\"xl\"\n              animate={true}\n              hoverEffect={true}\n            >\n              <PlaylistInsights\n                stats={statsToShow}\n                tracks={conversionData.tracks}\n              />\n            </GlassmorphicContainer>\n          )}\n        </motion.div>\n      </div>\n    </div>\n  );\n}; ","import React, { createContext, useContext } from 'react';\n\ninterface MobileContextType {\n  isMobile: boolean;\n  isPortrait: boolean;\n  isLandscape: boolean;\n  isIOS: boolean;\n  isAndroid: boolean;\n  isTablet: boolean;\n  viewport: {\n    width: number;\n    height: number;\n    devicePixelRatio: number;\n  };\n  isSmallScreen: boolean;\n  isMediumScreen: boolean;\n  isLargeScreen: boolean;\n  isMobileOrTablet: boolean;\n  isStandalone: boolean;\n}\n\nconst MobileContext = createContext<MobileContextType | undefined>(undefined);\n\nexport const useMobileContext = (): MobileContextType => {\n  const context = useContext(MobileContext);\n  if (context === undefined) {\n    throw new Error('useMobileContext must be used within a MobileProvider');\n  }\n  return context;\n};\n\nexport { MobileContext }; ","import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { \r\n  AlertTriangle, \r\n  X, \r\n  Info, \r\n  Search, \r\n  ExternalLink, \r\n  Copy, \r\n  Check, \r\n  Music,\r\n  Youtube,\r\n  ArrowLeft,\r\n  RefreshCw,\r\n  Download,\r\n  Share2,\r\n  BarChart3,\r\n  PieChart,\r\n  Heart,\r\n  Loader2,\r\n  CheckCircle2\r\n} from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { FailedTrack, useConversion } from '../../lib/ConversionContext';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { addToYouTubePlaylist } from '../../lib/youtubeApi';\r\nimport { addTracksToSpotifyPlaylist } from '../../lib/spotifyApi';\r\n\r\ninterface MobileFailedTracksDetailsProps {\r\n  failedTracks?: FailedTrack[];\r\n  onClose?: () => void;\r\n  onAddToYouTube?: (videoId: string, trackIndex: number) => Promise<void>;\r\n  onAddToSpotify?: (trackUri: string, trackIndex: number) => Promise<void>;\r\n}\r\n\r\n// Helper function to generate alternative search queries\r\nconst generateAlternativeQueries = (track: FailedTrack): string[] => {\r\n  const queries: string[] = [];\r\n  const artist = track.artists[0];\r\n  const title = track.name;\r\n  \r\n  // Remove common prefixes/suffixes\r\n  const cleanTitle = title\r\n    .replace(/\\(feat\\.?.*?\\)/gi, '')\r\n    .replace(/\\(Explicit.*?\\)/gi, '')\r\n    .replace(/\\(Album Version\\)/gi, '')\r\n    .replace(/\\(Clean.*?\\)/gi, '')\r\n    .trim();\r\n  \r\n  // Basic variations\r\n  queries.push(`${artist} ${cleanTitle}`);\r\n  queries.push(`${cleanTitle} ${artist}`);\r\n  queries.push(`${artist} - ${cleanTitle}`);\r\n  \r\n  // Artist variations\r\n  if (artist.includes('(') && artist.includes(')')) {\r\n    const mainArtist = artist.split('(')[0].trim();\r\n    queries.push(`${mainArtist} ${cleanTitle}`);\r\n  }\r\n  \r\n  // Title variations\r\n  if (cleanTitle.includes('(')) {\r\n    const mainTitle = cleanTitle.split('(')[0].trim();\r\n    queries.push(`${artist} ${mainTitle}`);\r\n  }\r\n  \r\n  // Remove \"feat.\" variations\r\n  if (artist.toLowerCase().includes('feat')) {\r\n    const mainArtist = artist.split(/feat\\.?/i)[0].trim();\r\n    queries.push(`${mainArtist} ${cleanTitle}`);\r\n  }\r\n  \r\n  return [...new Set(queries)]; // Remove duplicates\r\n};\r\n\r\n// Enhanced animations\r\nconst fadeInUp = {\r\n  initial: { opacity: 0, y: 20 },\r\n  animate: { opacity: 1, y: 0 },\r\n  transition: { duration: 0.5 }\r\n};\r\n\r\nconst staggerChildren = {\r\n  animate: {\r\n    transition: {\r\n      staggerChildren: 0.1\r\n    }\r\n  }\r\n};\r\n\r\nconst scaleOnHover = {\r\n  whileHover: { scale: 1.02, y: -2 },\r\n  whileTap: { scale: 0.98 }\r\n};\r\n\r\nexport const MobileFailedTracksDetails: React.FC<MobileFailedTracksDetailsProps> = ({\r\n  failedTracks: propsFailedTracks,\r\n  onClose,\r\n  onAddToYouTube: propsOnAddToYouTube,\r\n  onAddToSpotify: propsOnAddToSpotify\r\n}) => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { state } = useConversion();\r\n  const [copiedQuery, setCopiedQuery] = useState<string | null>(null);\r\n  const [manualInputs, setManualInputs] = useState<{ [key: number]: { youtube: string; spotify: string } }>({});\r\n  const [activeTab, setActiveTab] = useState<'overview' | 'search' | 'manual'>('overview');\r\n  const [failedTracks, setFailedTracks] = useState<FailedTrack[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [addedTracks, setAddedTracks] = useState<Set<number>>(new Set());\r\n  const hasProcessedData = useRef(false);\r\n\r\n  // Reset processed data flag when location changes\r\n  useEffect(() => {\r\n    hasProcessedData.current = false;\r\n  }, [location.pathname]);\r\n\r\n  // Get failed tracks from props or from navigation state\r\n  useEffect(() => {\r\n    console.log('MobileFailedTracksDetails: useEffect triggered');\r\n    console.log('Props failed tracks:', propsFailedTracks);\r\n    console.log('Location state:', location.state);\r\n    console.log('Has processed data:', hasProcessedData.current);\r\n    \r\n    // Don't process if we've already processed\r\n    if (hasProcessedData.current) {\r\n      console.log('Already processed, skipping data processing');\r\n      return;\r\n    }\r\n    \r\n    if (propsFailedTracks) {\r\n      console.log('Using props failed tracks:', propsFailedTracks);\r\n      setFailedTracks(propsFailedTracks);\r\n      hasProcessedData.current = true;\r\n    } else if (location.state?.failedTracks) {\r\n      // Get failed tracks from navigation state (like desktop modal)\r\n      console.log('Using failed tracks from navigation state:', location.state.failedTracks);\r\n      setFailedTracks(location.state.failedTracks);\r\n      hasProcessedData.current = true;\r\n    } else {\r\n      console.log('No failed tracks found in props or navigation state');\r\n      console.log('Setting empty failed tracks array');\r\n      setFailedTracks([]);\r\n      hasProcessedData.current = true;\r\n    }\r\n  }, [propsFailedTracks, location.state]);\r\n\r\n  const handleCopyQuery = async (query: string) => {\r\n    try {\r\n      await navigator.clipboard.writeText(query);\r\n      setCopiedQuery(query);\r\n      setTimeout(() => setCopiedQuery(null), 2000);\r\n    } catch (err) {\r\n      console.error('Failed to copy to clipboard:', err);\r\n    }\r\n  };\r\n\r\n  // Implement YouTube handler\r\n  const handleAddToYouTube = async (videoId: string, trackIndex: number) => {\r\n    if (propsOnAddToYouTube) {\r\n      return propsOnAddToYouTube(videoId, trackIndex);\r\n    }\r\n\r\n    try {\r\n      \r\n      // Get the current YouTube playlist ID from state\r\n      const youtubePlaylistId = state.youtubePlaylistId;\r\n      \r\n      if (!youtubePlaylistId) {\r\n        throw new Error('No YouTube playlist found. Please start a conversion first.');\r\n      }\r\n      \r\n      // Extract video ID if a full URL was provided\r\n      const cleanVideoId = videoId.includes('youtube.com') || videoId.includes('youtu.be') \r\n        ? videoId.match(/(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/\\s]{11})/)?.[1] || videoId\r\n        : videoId;\r\n      \r\n      if (!cleanVideoId || cleanVideoId.length !== 11) {\r\n        throw new Error('Invalid YouTube video ID. Please provide a valid 11-character video ID or YouTube URL.');\r\n      }\r\n      \r\n      console.log(`Adding YouTube video ${cleanVideoId} to playlist ${youtubePlaylistId}`);\r\n      \r\n      // Add the video to the YouTube playlist\r\n      await addToYouTubePlaylist('user', youtubePlaylistId, cleanVideoId);\r\n      \r\n      console.log('Successfully added YouTube video to playlist');\r\n      \r\n    } catch (error) {\r\n      console.error('Error adding YouTube video:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // Implement Spotify handler\r\n  const handleAddToSpotify = async (trackUri: string, trackIndex: number) => {\r\n    if (propsOnAddToSpotify) {\r\n      return propsOnAddToSpotify(trackUri, trackIndex);\r\n    }\r\n\r\n    try {\r\n      \r\n      // Get the current Spotify playlist ID from state\r\n      const spotifyPlaylistId = state.spotifyPlaylistId;\r\n      \r\n      if (!spotifyPlaylistId) {\r\n        throw new Error('No Spotify playlist found. Please start a conversion first.');\r\n      }\r\n      \r\n      // Clean the track URI\r\n      let cleanTrackUri = trackUri;\r\n      \r\n      // If it's a URL, extract the track ID\r\n      if (trackUri.includes('spotify.com/track/')) {\r\n        const match = trackUri.match(/spotify\\.com\\/track\\/([a-zA-Z0-9]+)/);\r\n        if (match) {\r\n          cleanTrackUri = `spotify:track:${match[1]}`;\r\n        }\r\n      }\r\n      \r\n      // Validate track URI format\r\n      if (!cleanTrackUri.startsWith('spotify:track:')) {\r\n        throw new Error('Invalid Spotify track URI. Please provide a valid track URI or Spotify URL.');\r\n      }\r\n      \r\n      console.log(`Adding Spotify track ${cleanTrackUri} to playlist ${spotifyPlaylistId}`);\r\n      \r\n      // Add the track to the Spotify playlist\r\n      await addTracksToSpotifyPlaylist(spotifyPlaylistId, [cleanTrackUri]);\r\n      \r\n      console.log('Successfully added Spotify track to playlist');\r\n      \r\n    } catch (error) {\r\n      console.error('Error adding Spotify track:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const handleAddToYouTubeButton = async (trackIndex: number) => {\r\n    const videoId = manualInputs[trackIndex]?.youtube;\r\n    if (!videoId) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      await handleAddToYouTube(videoId, trackIndex);\r\n      setAddedTracks(prev => new Set([...prev, trackIndex]));\r\n    } catch (error) {\r\n      console.error('Failed to add to YouTube:', error);\r\n      // You could add toast notification here if needed\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAddToSpotifyButton = async (trackIndex: number) => {\r\n    const trackUri = manualInputs[trackIndex]?.spotify;\r\n    if (!trackUri) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      await handleAddToSpotify(trackUri, trackIndex);\r\n      setAddedTracks(prev => new Set([...prev, trackIndex]));\r\n    } catch (error) {\r\n      console.error('Failed to add to Spotify:', error);\r\n      // You could add toast notification here if needed\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateManualInput = (trackIndex: number, platform: 'youtube' | 'spotify', value: string) => {\r\n    let processedValue = value;\r\n    \r\n    // Auto-extract video ID from YouTube URLs\r\n    if (platform === 'youtube' && (value.includes('youtube.com') || value.includes('youtu.be'))) {\r\n      const match = value.match(/(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/\\s]{11})/);\r\n      if (match) {\r\n        processedValue = match[1];\r\n      }\r\n    }\r\n    \r\n    // Auto-extract track URI from Spotify URLs\r\n    if (platform === 'spotify' && value.includes('spotify.com/track/')) {\r\n      const match = value.match(/spotify\\.com\\/track\\/([a-zA-Z0-9]+)/);\r\n      if (match) {\r\n        processedValue = `spotify:track:${match[1]}`;\r\n      }\r\n    }\r\n    \r\n    setManualInputs(prev => ({\r\n      ...prev,\r\n      [trackIndex]: {\r\n        ...prev[trackIndex],\r\n        [platform]: processedValue\r\n      }\r\n    }));\r\n  };\r\n\r\n  const getFailureReasonColor = (reason: string) => {\r\n    if (reason.includes('No match found') || reason.includes('below threshold')) {\r\n      return 'text-orange-600 dark:text-orange-400';\r\n    }\r\n    if (reason.includes('Failed to add') || reason.includes('Error')) {\r\n      return 'text-red-600 dark:text-red-400';\r\n    }\r\n    return 'text-yellow-600 dark:text-yellow-400';\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 font-sf-pro\">\r\n      {/* Premium Mobile Header */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: -20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        className=\"sticky top-0 z-50 bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-700/50 shadow-sm\"\r\n      >\r\n        <div className=\"flex items-center justify-between px-4 py-3\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <motion.button\r\n              whileHover={{ scale: 1.05 }}\r\n              whileTap={{ scale: 0.95 }}\r\n              onClick={() => {\r\n                if (onClose) {\r\n                  onClose();\r\n                } else {\r\n                  navigate('/');\r\n                }\r\n              }}\r\n              className=\"p-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors\"\r\n            >\r\n              <ArrowLeft size={20} />\r\n            </motion.button>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"p-2 rounded-xl bg-gradient-to-r from-red-500 to-orange-500 text-white shadow-lg\">\r\n                <AlertTriangle size={20} />\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-lg font-sf-pro-display font-bold text-gray-900 dark:text-white\">\r\n                  Failed Tracks\r\n                </h1>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                  {failedTracks?.length} tracks failed to convert\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <motion.button\r\n            whileHover={{ scale: 1.05 }}\r\n            whileTap={{ scale: 0.95 }}\r\n            onClick={() => {\r\n              const queries = failedTracks?.map(track => \r\n                encodeURIComponent(track.artists[0] + ' ' + track.name)\r\n              );\r\n              queries?.forEach(query => {\r\n                window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');\r\n              });\r\n            }}\r\n            className=\"px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm flex items-center gap-1\"\r\n          >\r\n            <ExternalLink size={14} />\r\n            Search All\r\n          </motion.button>\r\n        </div>\r\n      </motion.div>\r\n\r\n      {/* Mobile Content */}\r\n      <div className=\"px-4 py-6 space-y-6\">\r\n        {/* Premium Navigation Tabs */}\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.1 }}\r\n          className=\"flex justify-center\"\r\n        >\r\n          <div className=\"flex gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-xl max-w-full overflow-x-auto hide-scrollbar\">\r\n            {[\r\n              { key: 'overview', label: 'Overview', icon: Info },\r\n              { key: 'search', label: 'Search', icon: Search },\r\n              { key: 'manual', label: 'Manual Add', icon: Music }\r\n            ].map(({ key, label, icon: Icon }) => (\r\n              <motion.button\r\n                key={key}\r\n                whileHover={{ scale: 1.02 }}\r\n                whileTap={{ scale: 0.98 }}\r\n                onClick={() => setActiveTab(key as any)}\r\n                className={`flex items-center gap-1.5 px-3 py-2 rounded-lg transition-all whitespace-nowrap min-w-0 flex-shrink-0 ${\r\n                  activeTab === key\r\n                    ? 'bg-gradient-to-r from-orange-500 to-pink-500 text-white shadow-md'\r\n                    : 'bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-200/60 dark:border-gray-600/60 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600'\r\n                }`}\r\n                disabled={isLoading}\r\n              >\r\n                <Icon size={14} />\r\n                <span className=\"text-xs font-medium\">{label}</span>\r\n              </motion.button>\r\n            ))}\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Content Sections */}\r\n        <AnimatePresence mode=\"wait\">\r\n          {activeTab === 'overview' && (\r\n            <motion.div\r\n              key=\"overview\"\r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              exit={{ opacity: 0, x: 20 }}\r\n              transition={{ duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }}\r\n              className=\"space-y-6\"\r\n            >\r\n              {/* Stats Cards */}\r\n              <motion.div\r\n                variants={staggerChildren}\r\n                initial=\"initial\"\r\n                animate=\"animate\"\r\n                className=\"grid grid-cols-2 gap-4\"\r\n              >\r\n                <motion.div\r\n                  {...scaleOnHover}\r\n                  className=\"bg-white/80 dark:bg-gray-800/80 rounded-xl p-4 border border-gray-200/50 dark:border-gray-700/50 shadow-lg backdrop-blur-sm\"\r\n                >\r\n                  <div className=\"flex items-center gap-2 mb-3\">\r\n                    <div className=\"p-2 rounded-lg bg-gradient-to-r from-red-500 to-orange-500 text-white shadow-md\">\r\n                      <AlertTriangle size={16} />\r\n                    </div>\r\n                    <div>\r\n                      <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white\">Failed</h3>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Total count</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">\r\n                    {failedTracks?.length}\r\n                  </div>\r\n                </motion.div>\r\n\r\n                <motion.div\r\n                  {...scaleOnHover}\r\n                  className=\"bg-white/80 dark:bg-gray-800/80 rounded-xl p-4 border border-gray-200/50 dark:border-gray-700/50 shadow-lg backdrop-blur-sm\"\r\n                >\r\n                  <div className=\"flex items-center gap-2 mb-3\">\r\n                    <div className=\"p-2 rounded-lg bg-gradient-to-r from-orange-500 to-yellow-500 text-white shadow-md\">\r\n                      <Search size={16} />\r\n                    </div>\r\n                    <div>\r\n                      <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white\">No Matches</h3>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Search issues</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-2xl font-bold text-orange-600 dark:text-orange-400\">\r\n                    {failedTracks?.filter(t => t.reason.includes('No match') || t.reason.includes('below threshold')).length}\r\n                  </div>\r\n                </motion.div>\r\n              </motion.div>\r\n\r\n              {/* Smart Search Tips */}\r\n              <motion.div\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                transition={{ delay: 0.2 }}\r\n                className=\"bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl p-4 border border-yellow-200/50 dark:border-yellow-700/50\"\r\n              >\r\n                <h3 className=\"text-base font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2\">\r\n                  <Info className=\"text-yellow-600 dark:text-yellow-400\" size={18} />\r\n                  Search Tips\r\n                </h3>\r\n                <div className=\"space-y-2 text-sm text-gray-700 dark:text-gray-300\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"w-1.5 h-1.5 bg-yellow-500 rounded-full\"></div>\r\n                    <span>Remove \"feat.\" from artist names</span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"w-1.5 h-1.5 bg-yellow-500 rounded-full\"></div>\r\n                    <span>Try just the main artist name</span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"w-1.5 h-1.5 bg-yellow-500 rounded-full\"></div>\r\n                    <span>Check for remixes or live versions</span>\r\n                  </div>\r\n                </div>\r\n              </motion.div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {activeTab === 'search' && (\r\n            <motion.div\r\n              key=\"search\"\r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              exit={{ opacity: 0, x: 20 }}\r\n              transition={{ duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }}\r\n              className=\"space-y-4\"\r\n            >\r\n              <div className=\"space-y-4\">\r\n                {failedTracks?.map((track, index) => (\r\n                  <motion.div\r\n                    key={index}\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: index * 0.1 }}\r\n                    className={`bg-white/80 dark:bg-gray-800/80 rounded-xl p-4 border border-gray-200/50 dark:border-gray-700/50 shadow-lg backdrop-blur-sm ${\r\n                      addedTracks.has(index) ? 'ring-2 ring-green-500/50' : ''\r\n                    }`}\r\n                  >\r\n                    <div className=\"mb-4\">\r\n                      <h4 className=\"text-base font-semibold text-gray-900 dark:text-white mb-1\">\r\n                        {track.name}\r\n                      </h4>\r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                        by {track.artists.join(', ')}\r\n                      </p>\r\n                      {track.bestMatchScore !== undefined && track.bestMatchScore > 0 && (\r\n                        <div className=\"mt-2\">\r\n                          <span className=\"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-1 rounded-full\">\r\n                            Best match: {Math.round(track.bestMatchScore * 100)}%\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3 mb-4\">\r\n                      <div>\r\n                        <span className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">Reason:</span>\r\n                        <p className={`text-xs mt-1 ${getFailureReasonColor(track.reason)}`}>\r\n                          {track.reason}\r\n                        </p>\r\n                      </div>\r\n\r\n                      {/* Alternative Search Queries */}\r\n                      <div>\r\n                        <h5 className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-1\">\r\n                          <Search className=\"h-3 w-3\" />\r\n                          Try these searches:\r\n                        </h5>\r\n                        <div className=\"flex flex-wrap gap-1\">\r\n                          {generateAlternativeQueries(track).slice(0, 3).map((query, queryIndex) => (\r\n                            <motion.button\r\n                              key={queryIndex}\r\n                              whileHover={{ scale: 1.05 }}\r\n                              whileTap={{ scale: 0.95 }}\r\n                              onClick={() => handleCopyQuery(query)}\r\n                              className=\"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded-full hover:bg-blue-200 dark:hover:bg-blue-800/30 transition-colors cursor-pointer flex items-center gap-1\"\r\n                              disabled={isLoading}\r\n                            >\r\n                              {copiedQuery === query ? (\r\n                                <>\r\n                                  <Check className=\"h-2 w-2\" />\r\n                                  Copied!\r\n                                </>\r\n                              ) : (\r\n                                <>\r\n                                  <Copy className=\"h-2 w-2\" />\r\n                                  {query.length > 20 ? query.substring(0, 20) + '...' : query}\r\n                                </>\r\n                              )}\r\n                            </motion.button>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Quick Search Buttons */}\r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                      <motion.button\r\n                        whileHover={{ scale: 1.02 }}\r\n                        whileTap={{ scale: 0.98 }}\r\n                        onClick={() => {\r\n                          const query = encodeURIComponent(track.artists[0] + ' ' + track.name);\r\n                          window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');\r\n                        }}\r\n                        className=\"px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-xs flex items-center justify-center\"\r\n                        disabled={isLoading}\r\n                      >\r\n                        <Search size={14} />\r\n                      </motion.button>\r\n                      <motion.button\r\n                        whileHover={{ scale: 1.02 }}\r\n                        whileTap={{ scale: 0.98 }}\r\n                        onClick={() => {\r\n                          const query = encodeURIComponent(track.artists[0] + ' ' + track.name);\r\n                          window.open(`https://open.spotify.com/search/${query}`, '_blank');\r\n                        }}\r\n                        className=\"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-xs flex items-center justify-center\"\r\n                        disabled={isLoading}\r\n                      >\r\n                        <Search size={14} />\r\n                      </motion.button>\r\n                    </div>\r\n                  </motion.div>\r\n                ))}\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {activeTab === 'manual' && (\r\n            <motion.div\r\n              key=\"manual\"\r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              exit={{ opacity: 0, x: 20 }}\r\n              transition={{ duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }}\r\n              className=\"space-y-4\"\r\n            >\r\n              <div className=\"space-y-4\">\r\n                {failedTracks?.map((track, index) => {\r\n                  const isTrackAdded = addedTracks.has(index);\r\n                  const hasYouTubeInput = Boolean(manualInputs[index]?.youtube);\r\n                  const hasSpotifyInput = Boolean(manualInputs[index]?.spotify);\r\n                  \r\n                  return (\r\n                    <motion.div\r\n                      key={index}\r\n                      initial={{ opacity: 0, y: 20 }}\r\n                      animate={{ opacity: 1, y: 0 }}\r\n                      transition={{ delay: index * 0.1 }}\r\n                      className={`bg-white/80 dark:bg-gray-800/80 rounded-xl p-4 border border-gray-200/50 dark:border-gray-700/50 shadow-lg backdrop-blur-sm ${\r\n                        isTrackAdded ? 'ring-2 ring-green-500/50' : ''\r\n                      }`}\r\n                    >\r\n                      <div className=\"mb-4\">\r\n                        <h4 className=\"text-base font-semibold text-gray-900 dark:text-white mb-1\">\r\n                          {track.name}\r\n                        </h4>\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                          by {track.artists.join(', ')}\r\n                        </p>\r\n                      </div>\r\n\r\n                      <div className=\"space-y-4\">\r\n                        <div className=\"space-y-3\">\r\n                          <div className=\"flex items-center gap-2 mb-2\">\r\n                            <div className=\"p-1.5 rounded-lg bg-red-500 text-white\">\r\n                              <Youtube size={12} />\r\n                            </div>\r\n                            <h5 className=\"text-sm font-medium text-gray-900 dark:text-white\">Add to YouTube</h5>\r\n                          </div>\r\n                          \r\n                          <div className=\"space-y-2\">\r\n                            <input\r\n                              type=\"text\"\r\n                              placeholder=\"YouTube video ID or URL\"\r\n                              value={manualInputs[index]?.youtube || ''}\r\n                              onChange={(e) => updateManualInput(index, 'youtube', e.target.value)}\r\n                              className=\"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500\"\r\n                              disabled={isLoading || isTrackAdded}\r\n                            />\r\n                            <motion.button\r\n                              whileHover={{ scale: 1.02 }}\r\n                              whileTap={{ scale: 0.98 }}\r\n                              onClick={() => handleAddToYouTubeButton(index)}\r\n                              disabled={!hasYouTubeInput || isLoading || isTrackAdded}\r\n                              className=\"w-full px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                            >\r\n                              {isLoading ? (\r\n                                <>\r\n                                  <Loader2 size={14} className=\"animate-spin\" />\r\n                                  Adding...\r\n                                </>\r\n                              ) : isTrackAdded ? (\r\n                                <>\r\n                                  <CheckCircle2 size={14} />\r\n                                  Added\r\n                                </>\r\n                              ) : (\r\n                                'Add to YouTube'\r\n                              )}\r\n                            </motion.button>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3\">\r\n                          <div className=\"flex items-center gap-2 mb-2\">\r\n                            <div className=\"p-1.5 rounded-lg bg-green-500 text-white\">\r\n                              <Music size={12} />\r\n                            </div>\r\n                            <h5 className=\"text-sm font-medium text-gray-900 dark:text-white\">Add to Spotify</h5>\r\n                          </div>\r\n                          \r\n                          <div className=\"space-y-2\">\r\n                            <input\r\n                              type=\"text\"\r\n                              placeholder=\"Spotify track URI or URL\"\r\n                              value={manualInputs[index]?.spotify || ''}\r\n                              onChange={(e) => updateManualInput(index, 'spotify', e.target.value)}\r\n                              className=\"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500\"\r\n                              disabled={isLoading || isTrackAdded}\r\n                            />\r\n                            <motion.button\r\n                              whileHover={{ scale: 1.02 }}\r\n                              whileTap={{ scale: 0.98 }}\r\n                              onClick={() => handleAddToSpotifyButton(index)}\r\n                              disabled={!hasSpotifyInput || isLoading || isTrackAdded}\r\n                              className=\"w-full px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                            >\r\n                              {isLoading ? (\r\n                                <>\r\n                                  <Loader2 size={14} className=\"animate-spin\" />\r\n                                  Adding...\r\n                                </>\r\n                              ) : isTrackAdded ? (\r\n                                <>\r\n                                  <CheckCircle2 size={14} />\r\n                                  Added\r\n                                </>\r\n                              ) : (\r\n                                'Add to Spotify'\r\n                              )}\r\n                            </motion.button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </motion.div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n\r\n      {/* Loading Overlay */}\r\n      {isLoading && (\r\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-xl flex items-center gap-3\">\r\n            <Loader2 size={24} className=\"animate-spin text-blue-600\" />\r\n            <span className=\"text-gray-900 dark:text-white font-medium\">Processing...</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};","import React from 'react';\nimport { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom'; // Removed useNavigate\nimport { ThemeProvider } from './lib/ThemeContext';\nimport { AuthProvider } from './lib/AuthContext'; // Removed useAuth, as RedirectHandler is removed\nimport { ConversionProvider } from './lib/ConversionContext';\nimport { UserProvider } from './context/UserContext';\nimport ModernPlaylistConverter from './components/EnhancedPlaylistConverter';\nimport { MobileConverter } from './components/MobileConverter';\nimport SpotifyCallback from './components/SpotifyCallback';\nimport YouTubeCallback from './components/YouTubeCallback';\nimport Login from './components/Login';\nimport MobileLogin from './components/MobileLogin';\nimport { PrivateRoute } from './components/PrivateRoute';\nimport PrivacyPolicy from './components/PrivacyPolicy';\nimport TermsOfService from './components/TermsOfService';\nimport PreloaderDemo from './components/PreloaderDemo';\nimport AppInitializer from './components/AppInitializer';\nimport TokenManagerInitializer from './components/TokenManagerInitializer';\nimport { useState, useEffect, createContext, useContext, useMemo } from 'react';\n// Import our new useMobileDetection hook\nimport useMobileDetection from './hooks/useMobileDetection';\nimport { ParticleField } from './components/ui/ParticleField';\nimport { ShareModal } from './components/ui/ShareModal';\nimport { useShareModal } from './hooks/useShareModal';\nimport { ConversionInsights } from './components/ConversionInsights';\nimport { MobileContext } from './context/MobileContext';\nimport networkResilience from './services/networkResilience';\n// Removed Firebase auth and getAuthRedirectResult imports, as RedirectHandler is removed\nimport { SettingsPage, PreferencesPage, ThemeSettingsPage, NotificationSettingsPage, PrivacySettingsPage, DataExportPage } from './components/modals/SettingsModal';\nimport { PremiumPage } from './components/modals/PremiumModal';\nimport { HelpPage } from './components/modals/HelpModal';\nimport { EditProfilePage } from './components/modals/EditProfileModal';\nimport { EnhancedFailedTracksModal } from './components/EnhancedFailedTracksModal';\nimport { MobileFailedTracksDetails } from './components/visualization/MobileFailedTracksDetails';\n\n// Declare global window interface for mobile debugging\ndeclare global {\n  interface Window {\n    _mobileDebug?: {\n      isMobile: boolean;\n      isPortrait: boolean;\n      isIOS: boolean;\n      isAndroid: boolean;\n      userAgent: string;\n      viewport: {\n        width: number;\n        height: number;\n        devicePixelRatio: number;\n      };\n      date: string;\n    };\n  }\n}\n\n// CSS for the --angle property and animations\nconst angularCss = `\n  :root {\n    --angle: 0deg;\n  }\n  \n  @property --angle {\n    syntax: '<angle>';\n    initial-value: 0deg;\n    inherits: false;\n  }\n  \n  @keyframes rotate {\n    to {\n      --angle: 360deg;\n    }\n  }\n`;\n\n// Removed RedirectHandler component\n\nfunction App() {\n  const [isDarkTheme, setIsDarkTheme] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [mobileDetectionReady, setMobileDetectionReady] = useState(false);\n  \n  // Use our enhanced mobile detection hook\n  const { isMobile, isPortrait, isIOS, isAndroid } = useMobileDetection();\n  \n  // Force mobile layout for testing (check URL parameter or localStorage)\n  const forceMobile = new URLSearchParams(window.location.search).get('mobile') === 'true' || \n                     localStorage.getItem('forceMobile') === 'true';\n  \n  const { isOpen, shareData, closeShareModal } = useShareModal();\n  \n  // Add debugging for mobile issues\n  useEffect(() => {\n    console.log('App.tsx: Mobile detection state:', { isMobile, isPortrait, isIOS, isAndroid });\n    \n    // Initialize network resilience service\n    networkResilience.initialize();\n    \n    // Mark mobile detection as ready after first detection\n    setMobileDetectionReady(true);\n    \n    // Add global function for testing mobile layout\n    (window as any).toggleMobileLayout = () => {\n      const current = localStorage.getItem('forceMobile') === 'true';\n      localStorage.setItem('forceMobile', (!current).toString());\n      window.location.reload();\n    };\n    \n    if (isMobile) {\n      console.log('Mobile device detected', { isPortrait, isIOS, isAndroid });\n      \n      // Add mobile debugging info to window object for troubleshooting\n      window._mobileDebug = {\n        isMobile,\n        isPortrait,\n        isIOS,\n        isAndroid,\n        userAgent: navigator.userAgent,\n        viewport: {\n          width: window.innerWidth,\n          height: window.innerHeight,\n          devicePixelRatio: window.devicePixelRatio\n        },\n        date: new Date().toISOString()\n      };\n    }\n  }, [isMobile, isPortrait, isIOS, isAndroid]);\n  \n  // Update mobile status when the component mounts or orientation changes  \n  useEffect(() => {\n    if (isMobile) {\n      // When the app first loads, indicate that animations should be deferred\n      document.body.classList.add('defer-animations');\n      \n      // Once page loads, enable animations\n      const timeout = setTimeout(() => {\n        document.body.classList.remove('defer-animations');\n        document.body.classList.add('animations-ready');\n      }, 1000); // 1 second delay\n      \n      // Set body classes based on orientation\n      if (isPortrait) {\n        document.body.classList.add('portrait');\n        document.body.classList.remove('landscape');\n      } else {\n        document.body.classList.add('landscape');\n        document.body.classList.remove('portrait');\n      }\n      \n      // Add OS-specific classes\n      if (isIOS) document.body.classList.add('ios-device');\n      if (isAndroid) document.body.classList.add('android-device');\n      \n      return () => clearTimeout(timeout);\n    }\n  }, [isMobile, isPortrait, isIOS, isAndroid]);\n  \n  // Fix the MobileContext value to include all required properties\n  const mobileContextValue = useMemo(() => ({\n    isMobile,\n    isPortrait,\n    isLandscape: !isPortrait,\n    isIOS,\n    isAndroid,\n    isTablet: isMobile && !isPortrait,\n    viewport: {\n      width: window.innerWidth,\n      height: window.innerHeight,\n      devicePixelRatio: window.devicePixelRatio || 1\n    },\n    isSmallScreen: window.innerWidth < 640,\n    isMediumScreen: window.innerWidth >= 640 && window.innerWidth < 1024,\n    isLargeScreen: window.innerWidth >= 1024,\n    isMobileOrTablet: isMobile,\n    isStandalone: window.matchMedia('(display-mode: standalone)').matches\n  }), [isMobile, isPortrait, isIOS, isAndroid]);\n\n  // Debug which layout is being rendered\n  const shouldRenderMobile = isMobile || forceMobile;\n  console.log('App.tsx: Rendering layout:', { \n    isMobile, \n    forceMobile, \n    shouldRenderMobile,\n    isPortrait, \n    layout: shouldRenderMobile ? 'MOBILE' : 'DESKTOP' \n  });\n\n  // Show loading screen while mobile detection is initializing\n  if (!mobileDetectionReady) {\n    console.log('App.tsx: Mobile detection not ready yet, showing loading...');\n    return (\n      <div className=\"min-h-screen bg-background-primary flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Detecting device...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Render mobile layout if mobile is detected\n  if (shouldRenderMobile) {\n    console.log('App.tsx: Rendering MOBILE layout');\n    return (\n      <ThemeProvider>\n        <AuthProvider>\n          <UserProvider>\n            <ConversionProvider>\n              <TokenManagerInitializer>\n                <MobileContext.Provider value={mobileContextValue}>\n                  <ParticleField\n                    colorScheme=\"colorful\"\n                    density=\"medium\"\n                    interactive={true}\n                    className=\"fixed top-0 left-0 w-full h-full z-[-1]\"\n                  />\n                  <Router>\n                    <style>{angularCss}</style>\n                    <AppInitializer>\n                      <Routes>\n                        <Route path=\"/\" element={<PrivateRoute element={<MobileConverter />} />} />\n                        <Route path=\"/login\" element={<MobileLogin />} />\n                        <Route path=\"/callback\" element={<SpotifyCallback />} />\n                        <Route path=\"/youtube-callback\" element={<YouTubeCallback />} />\n                        <Route path=\"/privacy-policy\" element={<PrivacyPolicy />} />\n                        <Route path=\"/terms-of-service\" element={<TermsOfService />} />\n                        <Route path=\"/preloader-demo\" element={<PreloaderDemo />} />\n                        <Route path=\"/insights/:id\" element={<PrivateRoute element={<ConversionInsights />} />} />\n                        <Route path=\"/preferences\" element={<PrivateRoute element={<PreferencesPage />} />} />\n                        <Route path=\"/preferences/theme\" element={<PrivateRoute element={<ThemeSettingsPage />} />} />\n                        <Route path=\"/preferences/notifications\" element={<PrivateRoute element={<NotificationSettingsPage />} />} />\n                        <Route path=\"/preferences/privacy\" element={<PrivateRoute element={<PrivacySettingsPage />} />} />\n                        <Route path=\"/preferences/export\" element={<PrivateRoute element={<DataExportPage />} />} />\n                        <Route path=\"/settings\" element={<Navigate to=\"/preferences\" replace />} />\n                        <Route path=\"/premium\" element={<PrivateRoute element={<PremiumPage />} />} />\n                        <Route path=\"/help\" element={<PrivateRoute element={<HelpPage />} />} />\n                        <Route path=\"/profile/edit\" element={<PrivateRoute element={<EditProfilePage />} />} />\n                        <Route path=\"/failed-tracks\" element={<PrivateRoute element={<MobileFailedTracksDetails />} />} />\n                        <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\n                      </Routes>\n                      <ShareModal\n                        isOpen={isOpen}\n                        onClose={closeShareModal}\n                        title={shareData.title}\n                        url={shareData.url}\n                        description={shareData.description}\n                      />\n                    </AppInitializer>\n                  </Router>\n                </MobileContext.Provider>\n              </TokenManagerInitializer>\n            </ConversionProvider>\n          </UserProvider>\n        </AuthProvider>\n      </ThemeProvider>\n    );\n  }\n\n  // Render desktop layout for desktop screens\n  console.log('App.tsx: Rendering DESKTOP layout');\n  return (\n    <ThemeProvider>\n      <AuthProvider>\n        <UserProvider>\n          <ConversionProvider>\n            <TokenManagerInitializer>\n              <MobileContext.Provider value={mobileContextValue}>\n                <ParticleField\n                  colorScheme=\"colorful\"\n                  density=\"medium\"\n                  interactive={true}\n                  className=\"fixed top-0 left-0 w-full h-full z-[-1]\"\n                />\n                <Router>\n                  <style>{angularCss}</style>\n                  <AppInitializer>\n                    <Routes>\n                      <Route path=\"/\" element={<PrivateRoute element={<ModernPlaylistConverter />} />} />\n                      <Route path=\"/login\" element={<Login />} />\n                      <Route path=\"/callback\" element={<SpotifyCallback />} />\n                      <Route path=\"/youtube-callback\" element={<YouTubeCallback />} />\n                      <Route path=\"/privacy-policy\" element={<PrivacyPolicy />} />\n                      <Route path=\"/terms-of-service\" element={<TermsOfService />} />\n                      <Route path=\"/preloader-demo\" element={<PreloaderDemo />} />\n                      <Route path=\"/insights/:id\" element={<PrivateRoute element={<ConversionInsights />} />} />\n                      <Route path=\"/preferences\" element={<PrivateRoute element={<PreferencesPage />} />} />\n                      <Route path=\"/preferences/theme\" element={<PrivateRoute element={<ThemeSettingsPage />} />} />\n                      <Route path=\"/preferences/notifications\" element={<PrivateRoute element={<NotificationSettingsPage />} />} />\n                      <Route path=\"/preferences/privacy\" element={<PrivateRoute element={<PrivacySettingsPage />} />} />\n                      <Route path=\"/preferences/export\" element={<PrivateRoute element={<DataExportPage />} />} />\n                      <Route path=\"/settings\" element={<Navigate to=\"/preferences\" replace />} />\n                      <Route path=\"/premium\" element={<PrivateRoute element={<PremiumPage />} />} />\n                      <Route path=\"/help\" element={<PrivateRoute element={<HelpPage />} />} />\n                      <Route path=\"/profile/edit\" element={<PrivateRoute element={<EditProfilePage />} />} />\n                      <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\n                    </Routes>\n                    <ShareModal\n                      isOpen={isOpen}\n                      onClose={closeShareModal}\n                      title={shareData.title}\n                      url={shareData.url}\n                      description={shareData.description}\n                    />\n                  </AppInitializer>\n                </Router>\n              </MobileContext.Provider>\n            </TokenManagerInitializer>\n          </ConversionProvider>\n        </UserProvider>\n      </AuthProvider>\n    </ThemeProvider>\n  );\n}\n\nexport default App;","import { useState, useEffect } from 'react';\n\ninterface ShareData {\n  url?: string;\n  title?: string;\n  description?: string;\n}\n\nexport const useShareModal = () => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [shareData, setShareData] = useState<ShareData>({});\n\n  useEffect(() => {\n    const handleOpenShareModal = (event: CustomEvent<ShareData>) => {\n      setShareData(event.detail);\n      setIsOpen(true);\n    };\n\n    // Add event listener\n    window.addEventListener('openShareModal', handleOpenShareModal as EventListener);\n\n    // Cleanup\n    return () => {\n      window.removeEventListener('openShareModal', handleOpenShareModal as EventListener);\n    };\n  }, []);\n\n  const closeShareModal = () => {\n    setIsOpen(false);\n    setShareData({});\n  };\n\n  return {\n    isOpen,\n    shareData,\n    closeShareModal\n  };\n}; ","/**\n * Utility to inject polyfills into iframes\n * This helps with Google authentication iframes that may need polyfills\n */\n\n// Browser API polyfill script\nconst browserPolyfillScript = `\n  if (typeof browser === 'undefined') {\n    window.browser = {\n      runtime: { \n        sendMessage: () => Promise.resolve(),\n        onMessage: {\n          addListener: () => {},\n          removeListener: () => {}\n        },\n        getURL: (path) => path\n      },\n      tabs: {\n        query: () => Promise.resolve([]),\n        sendMessage: () => Promise.resolve(),\n        create: () => Promise.resolve({}),\n        update: () => Promise.resolve()\n      },\n      storage: {\n        local: {\n          get: () => Promise.resolve({}),\n          set: () => Promise.resolve()\n        },\n        sync: {\n          get: () => Promise.resolve({}),\n          set: () => Promise.resolve()\n        }\n      },\n      i18n: {\n        getMessage: () => ''\n      }\n    };\n    console.log('[Polyfill] Browser API polyfilled');\n  }\n`;\n\n// Trusted Types polyfill script\nconst trustedTypesPolyfillScript = `\n  if (window.trustedTypes && window.trustedTypes.createPolicy) {\n    try {\n      window.trustedTypes.createPolicy('default', {\n        createHTML: (string) => string,\n        createScriptURL: (string) => string,\n        createScript: (string) => string\n      });\n      console.log('[Polyfill] Default TrustedTypes policy created');\n    } catch (e) {\n      console.log('[Polyfill] Default policy already exists');\n    }\n    \n    try {\n      window.trustedTypes.createPolicy('firebase-js-sdk-policy', {\n        createScriptURL: (string) => string\n      });\n      console.log('[Polyfill] Firebase TrustedTypes policy created');\n    } catch (e) {\n      console.log('[Polyfill] Firebase policy already exists');\n    }\n  }\n`;\n\n/**\n * Observes and injects polyfills into any iframes added to the document\n */\nexport function setupIframePolyfills() {\n  // Inject into existing iframes\n  const existingIframes = document.querySelectorAll('iframe');\n  existingIframes.forEach(injectPolyfillsIntoIframe);\n  \n  // Set up observer for future iframes\n  const observer = new MutationObserver((mutations) => {\n    mutations.forEach((mutation) => {\n      mutation.addedNodes.forEach((node) => {\n        // Check if any iframes were added\n        if (node.nodeName === 'IFRAME') {\n          injectPolyfillsIntoIframe(node as HTMLIFrameElement);\n        } else if (node.nodeType === 1) {\n          // Check for iframes inside added DOM nodes\n          const iframes = (node as Element).querySelectorAll('iframe');\n          iframes.forEach(injectPolyfillsIntoIframe);\n        }\n      });\n    });\n  });\n  \n  // Start observing document for iframe additions\n  observer.observe(document.body, { \n    childList: true, \n    subtree: true \n  });\n  \n  console.log('[Polyfill] Iframe observer started');\n  \n  return () => observer.disconnect();\n}\n\n/**\n * Injects polyfills into an iframe\n */\nfunction injectPolyfillsIntoIframe(iframe: HTMLIFrameElement) {\n  // Wait for iframe to load\n  iframe.addEventListener('load', () => {\n    try {\n      const iframeDocument = iframe.contentDocument || iframe.contentWindow?.document;\n      \n      if (!iframeDocument) {\n        console.log('[Polyfill] Cannot access iframe content (likely cross-origin)');\n        return;\n      }\n      \n      // Create and inject browser polyfill script\n      const browserScript = iframeDocument.createElement('script');\n      browserScript.textContent = browserPolyfillScript;\n      iframeDocument.head.appendChild(browserScript);\n      \n      // Create and inject trusted types polyfill script\n      const trustedTypesScript = iframeDocument.createElement('script');\n      trustedTypesScript.textContent = trustedTypesPolyfillScript;\n      iframeDocument.head.appendChild(trustedTypesScript);\n      \n      console.log('[Polyfill] Injected polyfills into iframe:', iframe.src);\n    } catch (error) {\n      console.log('[Polyfill] Error injecting into iframe:', error);\n    }\n  });\n} ","import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\n\r\n// Initialize Trusted Types polyfill first to prevent TrustedScriptURL errors\r\nif (typeof window !== 'undefined' && window.trustedTypes && window.trustedTypes.createPolicy) {\r\n  try {\r\n    // Create default policy if it doesn't exist\r\n    window.trustedTypes.createPolicy('default', {\r\n      createHTML: (string: string) => string,\r\n      createScriptURL: (string: string) => string,\r\n      createScript: (string: string) => string\r\n    });\r\n    console.log('[TrustedTypes] Default policy created');\r\n  } catch (e) {\r\n    // Policy might already exist, which is fine\r\n    console.log('[TrustedTypes] Default policy already exists');\r\n  }\r\n  \r\n  try {\r\n    // Create Firebase-specific policy\r\n    window.trustedTypes.createPolicy('firebase-js-sdk-policy', {\r\n      createScriptURL: (string: string) => string\r\n    });\r\n    console.log('[TrustedTypes] Firebase policy created');\r\n  } catch (e) {\r\n    console.log('[TrustedTypes] Firebase policy already exists');\r\n  }\r\n}\r\n\r\n// Ensure React is available globally before any other imports\r\nif (typeof window !== 'undefined') {\r\n  (window as any).React = React;\r\n}\r\n\r\nimport App from './App';\r\nimport './index.css';\r\nimport { setupIframePolyfills } from './lib/polyfillInjector';\r\n\r\n// Ensure React is properly loaded before any other imports\r\nif (!React || !React.isValidElement) {\r\n  console.error('React is not properly loaded');\r\n}\r\n\r\nif (import.meta.env.PROD && import.meta.env.VITE_SENTRY_DSN) {\r\n  // Lazy import to avoid adding Sentry to dev bundle if not used\r\n  import('@sentry/react').then(({ init /*, reactRouterV6BrowserTracingIntegration, replayIntegration*/ }) => {\r\n    init({\r\n      dsn: import.meta.env.VITE_SENTRY_DSN as string,\r\n      // integrations: [reactRouterV6BrowserTracingIntegration()],\r\n      tracesSampleRate: 0.1,\r\n      replaysSessionSampleRate: 0.0,\r\n    });\r\n  }).catch(() => {/* ignore */});\r\n}\r\n\r\nsetupIframePolyfills(); // Initialize iframe polyfills early\r\n\r\nconst root = ReactDOM.createRoot(document.getElementById('root')!);\r\n\r\nroot.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n);\r\n\r\n// Dispatch app initialization event to hide preloader\r\nsetTimeout(() => {\r\n  window.dispatchEvent(new CustomEvent('app-initialized', { \r\n    detail: { progress: 100 } \r\n  }));\r\n  if (!import.meta.env.PROD) console.log('App initialization complete');\r\n}, 100);"],"file":"assets/index-90e52a9f.js"}